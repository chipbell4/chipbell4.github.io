!function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return n(r?r:e)},l,l.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t,r){var i=e("range-function"),n=function(e,t,r){this.geometry=e,this.weight=t,this.tightness=r};n.prototype.weightForClickAtNode=function(e,t){return this.geometry.isBoundaryNode(t)?0:(t=this.geometry.threeGeometry.vertices[t],this.weight/(this.tightness*t.distanceToSquared(e)+1))},n.prototype.nearestNodes=function(e,t){var r=this.geometry.threeGeometry.vertices,n=this.geometry.internalNodes;return i(this.geometry.internalNodes.length).sort(function(t,i){var o=n[t],a=n[i],s=r[o].distanceTo(e),c=r[a].distanceTo(e);return s<c?-1:1}).slice(0,t)},n.prototype.buildMatrix=function(e){for(var t=this.geometry.internalNodes.length,r=[],i=this.nearestNodes(e,Math.ceil(t/10)),n=0;n<t;n++)if(i.indexOf(n)<0)r.push(0);else{var o=this.geometry.internalNodes[n];r.push(this.weightForClickAtNode(e,o))}return r},t.exports=n},{"range-function":40}],2:[function(e,t,r){var i=e("underscore"),n=e("three"),o=function(e,t){this.threeGeometry=e,this.boundaryNodes=t;var r=i.range(e.vertices.length);this.internalNodes=i.difference(r,t),this.internalNodes.sort(),this.rebuildAdjacencyList()},a=function(e,t){if(t.a!=e&&t.b!=e&&t.c!=e)return[];var r=[t.a,t.b,t.c];return r.filter(function(t){return t!=e})};o.prototype.calculateAdjacentNodesTo=function(e){for(var t=[],r=this.threeGeometry.faces.length,n=0;n<r;n++)Array.prototype.push.apply(t,a(e,this.threeGeometry.faces[n]));return i.uniq(t)},o.prototype.rebuildAdjacencyList=function(){this.adjacency=[];for(var e=this.threeGeometry.vertices.length,t=0;t<e;t++)this.adjacency[t]=this.calculateAdjacentNodesTo(t)},o.prototype.isBoundaryNode=function(e){return this.boundaryNodes.indexOf(e)!=-1};var s=function(e){return function(t){return t.a==e||t.b==e||t.c==e}},c=function(e){return[e.a,e.b,e.c]},l=function(e){return this.threeGeometry.vertices[e]};o.prototype.sharedAdjacentVertices=function(e,t){var r=this.threeGeometry.faces.filter(s(e)).filter(s(t)).map(c).reduce(function(e,t){return Array.prototype.push.apply(e,t),e},[]).filter(function(r){return r!=e&&r!=t});return i.unique(r)},o.prototype.nodesAreAdjacent=function(e,t){return this.adjacency[e].indexOf(t)!=-1},o.prototype.trianglesAttachedToNodeAsIndices=function(e){return this.threeGeometry.faces.filter(s(e)).map(c).map(function(t){return t.sort(function(t,r){return t==e?-1:r==e?1:0})})},o.prototype.trianglesAttachedToNode=function(e){var t=this;return t.trianglesAttachedToNodeAsIndices(e).map(function(e){return e.map(l.bind(t))})},o.prototype.sharedTriangleIndices=function(e,t){return this.sharedAdjacentVertices(e,t).map(function(r){return[e,t,r]})},o.prototype.sharedTriangles=function(e,t){var r=this,i=function(e){return r.threeGeometry.vertices[e]};return this.sharedTriangleIndices(e,t).map(function(e){return e.map(i)})},o.prototype.asMesh=function(){return new n.Mesh(this.threeGeometry,new n.MeshBasicMaterial({color:16777215,side:n.DoubleSide,wireframe:!0}))},t.exports=o},{three:41,underscore:42}],3:[function(e,t,r){var i=e("./TriangleMassCalculator.js"),n=function(e){this.geometry=e};n.prototype.innerProductTriviallyZero=function(e,t){return e==t?this.geometry.isBoundaryNode(e):this.geometry.isBoundaryNode(e)||this.geometry.isBoundaryNode(t)||!this.geometry.nodesAreAdjacent(e,t)},n.prototype.massBetweenDifferentAdjacentNodes=function(e,t){return this.geometry.sharedTriangles(e,t).reduce(function(e,t){return e+i.twoNodeInnerProduct(t)},0)},n.prototype.squaredMassForNode=function(e){return this.geometry.trianglesAttachedToNode(e).reduce(function(e,t){return e+i.oneNodeInnerProduct(t)},0)},n.prototype.massBetweenNodes=function(e,t){return this.innerProductTriviallyZero(e,t)?0:e==t?this.squaredMassForNode(e):this.massBetweenDifferentAdjacentNodes(e,t)},n.prototype.buildMatrix=function(){var e,t,r=this.geometry.internalNodes.length,i=Array(r);for(e=0;e<r;e++)i[e]=Array(r);for(e=0;e<r;e++){for(t=e;t<r;t++)i[e][t]=this.massBetweenNodes(this.geometry.internalNodes[e],this.geometry.internalNodes[t]);for(t=0;t<e;t++)i[e][t]=i[t][e]}return i},t.exports=n},{"./TriangleMassCalculator.js":6}],4:[function(e,t,r){var i=e("numeric"),n=function(e,t,r){var n=[[e.x,e.y,1],[t.x,t.y,1],[r.x,r.y,1]],o=[e.z,t.z,r.z],a=i.solve(n,o);this.A=a[0],this.B=a[1],this.C=a[2]};n.prototype.at=function(e){var t=this.A*e.x+this.B*e.y+this.C,r=e.clone();return r.z=t,r},t.exports=n},{numeric:39}],5:[function(e,t,r){var i=e("three"),n=e("./PartialBasisFunction.js"),o=function(e){this.geometry=e},a=function(e){var t=e[1].clone().sub(e[0]),r=e[2].clone().sub(e[0]),n=new i.Vector3;return n.crossVectors(t,r),n.length()/2},s=function(e,t){e.forEach(function(e){e.z=0}),e[t].z=1;var r=new n(e[0],e[1],e[2]);return new i.Vector2(r.A,r.B)};o.prototype.singleTriangleInnerProduct=function(e,t){var r=this,i=t.map(function(t){return e[t]}).some(function(e){return r.geometry.boundaryNodes.indexOf(e)>-1});if(i)return 0;var n=this.geometry.threeGeometry.vertices;e=e.map(function(e){return n[e]});var o=a(e),c=s(e,t[0]),l=s(e,t[1]);return c.dot(l)*o},o.prototype.stiffnessBetweenNodes=function(e,t){if(this.geometry.isBoundaryNode(e)||this.geometry.isBoundaryNode(t))return 0;var r=this;return e==t?this.geometry.trianglesAttachedToNodeAsIndices(e).reduce(function(e,t){return e+r.singleTriangleInnerProduct(t,[0,0])},0):this.geometry.sharedTriangleIndices(e,t).reduce(function(e,t){return e+r.singleTriangleInnerProduct(t,[0,1])},0)},o.prototype.buildMatrix=function(){var e,t,r=this.geometry.internalNodes.length,i=Array(r);for(e=0;e<r;e++)i[e]=Array(r);for(e=0;e<r;e++){for(t=e;t<r;t++)i[e][t]=this.stiffnessBetweenNodes(this.geometry.internalNodes[e],this.geometry.internalNodes[t]);for(t=0;t<e;t++)i[e][t]=i[t][e]}return i},t.exports=o},{"./PartialBasisFunction.js":4,three:41}],6:[function(e,t,r){var i=function(e){var t=e[1].clone().sub(e[0]),r=e[2].clone().sub(e[0]);return t.cross(r).length()},n=function(e){return i(e)/24},o=function(e){return i(e)/12};t.exports={twoNodeInnerProduct:n,oneNodeInnerProduct:o}},{}],7:[function(e,t,r){var i=e("three"),n=e("./PolygonUtils/Polygon.js"),o=e("./PolygonUtils/PolygonPointContainmentChecker.js"),a=e("./PolygonUtils/MeshPointSetBuilder.js"),s=e("./GeometryBuilder.js"),c=e("./Fem/FemGeometry.js"),l=e("./Ui/MouseProjector.js"),h=e("range-function"),u=e("./Pde/Stepper.js"),f=e("dat-gui"),p=function(){this.cameraDistance=2.5,this.elevation=0,this.azimuth=0,this.scene=new i.Scene,this.camera=new i.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.01,1e4),this.camera.up=new i.Vector3(0,0,1),this.positionCamera(),this.options={elasticity:[0,1],dampingCoefficient:[0,10],waveSpeed:[.1,.5],clickWeight:[100,500],clickTightness:[10,1e3]}};p.prototype.resolveDefaultValue=function(e){return.5*(this.options[e][0]+this.options[e][1])},p.prototype.positionCamera=function(){this.camera.position.x=.5+this.cameraDistance*Math.cos(this.azimuth)*Math.sin(this.elevation),this.camera.position.y=.5+this.cameraDistance*Math.sin(this.azimuth)*Math.sin(this.elevation),this.camera.position.z=this.cameraDistance*Math.cos(this.elevation),this.camera.lookAt(new i.Vector3(.5,.5,0))},p.prototype.mousemove=function(e){this.azimuth=e.clientX/document.body.clientWidth*2*Math.PI,this.elevation=-e.clientY/document.body.clientHeight*(Math.PI/2)+Math.PI/2,this.positionCamera()},p.prototype.mousedown=function(e){var t=new l(this.camera,window.innerWidth,window.innerHeight),r=new i.Vector3(e.clientX,e.clientY,0);this.currentClick=t.projectClick(r)},p.prototype.mouseup=function(){delete this.currentClick},p.prototype.update=function(){var e=this.stepper.calculatePreferredTimeStep();e=Math.max(e,.01),this.stepper.step(e,this.currentClick);var t=this;this.stepper.geometry.internalNodes.forEach(function(e,r){t.scene.children[0].geometry.vertices[e].z=10*t.stepper.currentWavePosition[r]}),this.scene.children[0].geometry.verticesNeedUpdate=!0,this.scene.children[0].geometry.elementsNeedUpdate=!0,this.scene.children[0].geometry.computeBoundingSphere()},p.prototype.setupDataGui=function(){if(this.stepper){this.gui&&document.getElementsByClassName(f.GUI.CLASS_AUTO_PLACE)[0].remove(),this.gui=new f.GUI;for(var e in this.options)this.gui.add(this.stepper,e).min(this.options[e][0]).max(this.options[e][1])}},p.prototype.setCurrentPolygon=function(e){var t=n.factory(e).mappedPoints(),r=new o(t),i=new a(.1,.1,r),l=i.calculateMeshPoints(),f=h(t.length,"inclusive"),p=new s(l).buildGeometry(),d=new c(p,f),m=d.asMesh();this.scene.remove(this.scene.children[0]),this.scene.add(m),this.stepper=new u({geometry:d,elasticity:this.resolveDefaultValue("elasticity"),dampingCoefficient:this.resolveDefaultValue("dampingCoefficient"),waveSpeed:this.resolveDefaultValue("waveSpeed"),clickWeight:this.resolveDefaultValue("clickWeight"),clickTightness:this.resolveDefaultValue("clickTightness")}),this.setupDataGui()},t.exports=p},{"./Fem/FemGeometry.js":2,"./GeometryBuilder.js":8,"./Pde/Stepper.js":9,"./PolygonUtils/MeshPointSetBuilder.js":13,"./PolygonUtils/Polygon.js":15,"./PolygonUtils/PolygonPointContainmentChecker.js":17,"./Ui/MouseProjector.js":21,"dat-gui":24,"range-function":40,three:41}],8:[function(e,t,r){var i=e("three"),n=e("delaunay-triangulate"),o=function(e){this.points=e},a=function(e){var t=e.map(function(e){return[e.x,e.y]});return n(t).map(function(e){return new i.Face3(e[0],e[1],e[2])})};o.prototype.buildGeometry=function(){var e=new i.Geometry;return e.vertices=this.points.map(function(e){return e.clone()}),e.faces=a(e.vertices),e},t.exports=o},{"delaunay-triangulate":38,three:41}],9:[function(e,t,r){var i=e("numeric");i.scale=e("../util/scale.js");var n=e("../Fem/FMatrixCalculator.js"),o=e("../Fem/StiffnessMatrixCalculator.js"),a=e("../Fem/MassMatrixCalculator.js"),s=function(e){this.geometry=e.geometry,this.massMatrix=new a(e.geometry).buildMatrix(),this.stiffnessMatrix=new o(e.geometry).buildMatrix(),this.elasticity=e.elasticity||0,this.dampingCoefficient=e.dampingCoefficient||0,this.waveSpeed=e.waveSpeed||.3,this.clickWeight=e.clickWeight||2e3,this.clickTightness=e.clickTightness||5e3,this.currentWavePosition=this.zeroVector(),this.previousWavePosition=this.zeroVector(),this.massLU=i.LU(this.massMatrix)};s.prototype.zeroVector=function(){for(var e=this.geometry.internalNodes.length,t=[],r=0;r<e;r++)t.push(0);return t},s.prototype.resolveF=function(e){return void 0===e?this.zeroVector():new n(this.geometry,this.clickWeight,this.clickTightness).buildMatrix(e)},s.prototype.currentWaveTerm=function(e){return i.scale(this.currentWavePosition,2/e-this.elasticity)},s.prototype.currentDiffusionTerm=function(){var e=i.scale(this.stiffnessMatrix,-this.waveSpeed*this.waveSpeed);return i.LUsolve(this.massLU,i.dot(e,this.currentWavePosition))},s.prototype.previousTerm=function(e){return i.scale(this.previousWavePosition,this.dampingCoefficient/(2*e)-1/(e*e))},s.prototype.step=function(e,t){var r=this.currentWaveTerm(e),n=this.currentDiffusionTerm(e),o=this.previousTerm(e),a=this.resolveF(t),s=i.add(r,i.add(n,i.add(o,a))),c=1/e/e+this.dampingCoefficient/2/e;return s=i.scale(s,1/c),this.previousWavePosition=this.currentWavePosition,this.currentWavePosition=s,this.currentWavePosition},s.prototype.calculatePreferredTimeStep=function(){var e=1/i.norm2(this.massMatrix),t=i.norm2(this.stiffnessMatrix),r=this.elasticity+this.waveSpeed*this.waveSpeed*e*t,n=this.dampingCoefficient,o=-2;return(-n+Math.sqrt(n*n-4*r*o))/(2*r)*1.1},t.exports=s},{"../Fem/FMatrixCalculator.js":1,"../Fem/MassMatrixCalculator.js":3,"../Fem/StiffnessMatrixCalculator.js":5,"../util/scale.js":23,numeric:39}],10:[function(e,t,r){var i=e("three"),n=e("./PolygonUtils/PolygonBuffer.js"),o=function(){var e=.5;this.aspectRatio=window.innerWidth/window.innerHeight,this.scene=new i.Scene,this.camera=new i.OrthographicCamera(-e*this.aspectRatio,e*this.aspectRatio,(-e),e,1,1e4),this.camera.up=new i.Vector3(0,(-1),0),this.camera.position.x=this.camera.position.y=e,this.camera.position.z=-50,this.camera.lookAt(new i.Vector3(e,e,0)),this.buffer=new n(1e3),this.buffer.addPoint(new i.Vector3(0,0,0)),this.buffer.addPoint(new i.Vector3(1,0,0)),this.buffer.addPoint(new i.Vector3(1,1,0)),this.buffer.addPoint(new i.Vector3(0,1,0)),this.refreshGeometries(),this.showPolygon()};o.prototype.refreshGeometry=function(e){e.vertices=this.buffer.vertices,e.faces=this.buffer.faces,e.verticesNeedUpdate=!0,e.elementsNeedUpdate=!0,e.computeBoundingSphere()},o.prototype.refreshGeometries=function(){this.lineMesh||(this.lineMesh=new i.Line(new i.Geometry,new i.LineBasicMaterial({color:"#ffffff",linewidth:2}))),this.polygonMesh||(this.polygonMesh=new i.Mesh(new i.Geometry,new i.MeshBasicMaterial({color:"#ffffff",side:i.DoubleSide}))),this.refreshGeometry(this.lineMesh.geometry),this.refreshGeometry(this.polygonMesh.geometry)},o.prototype.showPolygon=function(){this.scene&&(this.scene.remove(this.lineMesh),this.scene.remove(this.polygonMesh),this.scene.add(this.polygonMesh))},o.prototype.showLine=function(){this.scene&&(this.scene.remove(this.lineMesh),this.scene.add(this.lineMesh),this.scene.remove(this.polygonMesh))},o.prototype.mouseup=function(){this.showPolygon(),this.editingPolygon=!1,this.buffer.length<=2&&(this.buffer.addPoint(new i.Vector3(0,0,0)),this.buffer.addPoint(new i.Vector3(1,0,0)),this.buffer.addPoint(new i.Vector3(1,1,0)),this.buffer.addPoint(new i.Vector3(0,1,0)),this.refreshGeometries())},o.prototype.mousedown=function(){this.showLine(),this.editingPolygon=!0,this.pointSkipIndex=0,this.buffer.resetVertexBuffer()},o.prototype.mousemove=function(e){if(this.editingPolygon&&(this.pointSkipIndex=(this.pointSkipIndex+1)%3,0===this.pointSkipIndex)){var t=new i.Vector3(e.clientX,window.innerHeight-e.clientY,0),r=t.clone();r.y/=window.innerHeight;var n=(window.innerWidth-window.innerHeight)/2,o=Math.max(n,t.x);o=Math.min(o,window.innerWidth-n),r.x=(o-n)/window.innerHeight,this.buffer.addPoint(r),this.refreshGeometries()}},t.exports=o},{"./PolygonUtils/PolygonBuffer.js":16,three:41}],11:[function(e,t,r){var i=function(e,t){return t=(t+e.length)%e.length,e[t]},n=function(e,t,r){var n=i(e,t-1),o=i(e,t),a=i(e,t+1),s=o.clone().sub(n),c=a.clone().sub(o),l=s.cross(c).length();return l<=r},o=function(e,t){for(var r=1;r<e.length-1;)n(e,r,t)?e.splice(r,1):r++;return e},a=function(e){return function(t){return o(t,e)}};t.exports=a},{}],12:[function(e,t,r){var i=function(e,t){return t=(t+e.length)%e.length,e[t]},n=function(e,t,r){var i=t.clone().sub(e),n=r.clone().sub(e);return i.cross(n).z>=0},o=function(e){for(var t=[e[0]],r=e.length,o=1;o<r;o++){var a=t[t.length-1],s=e[o],c=i(e,o+1);n(a,s,c)&&t.push(s)}return t},a=function(){return o};t.exports=a},{}],13:[function(e,t,r){function i(e){return e.map(function(e){return e.clone()})}function n(e,t,r){return r.containsPoint(t)&&e.push(t),e}function o(e,t,r,i){for(var o=0;o<=1;o+=r)e=n(e,new a.Vector3(t,o,0),i);return e}var a=e("three"),s=function(e,t,r){this.dx=e,this.dy=t,this.containmentChecker=r};s.prototype.calculateMeshPoints=function(){for(var e=i(this.containmentChecker.points),t=0;t<=1;t+=this.dx)e=o(e,t,this.dy,this.containmentChecker);return e},t.exports=s},{three:41}],14:[function(e,t,r){var i=e("range-function"),n=function(e,t){return t=(t+e.length)%e.length,e[t]},o=function(e,t,r){var o=n(e,t).distanceTo(n(e,t+1));if(o<=r)return[n(e,t)];var a=n(e,t+1).clone().sub(n(e,t)).normalize(),s=Math.ceil(o/r)-1,c=i(0,s,"inclusive").map(function(e){return e*o/(s+1)});return c.map(function(r){return a.clone().setLength(r).add(n(e,t))})},a=function(e,t){var r=i(e.length).map(function(r){return o(e,r,t)});return r.reduce(function(e,t){return Array.prototype.push.apply(e,t),e},[])},s=function(e){return function(t){return a(t,e)}};t.exports=s},{"range-function":40}],15:[function(e,t,r){var i=e("./CollinearityFilter.js"),n=e("./PointSetDensifier.js"),o=e("./PolygonRescaler.js"),a=e("./PolygonWindingFixer.js"),s=e("./Smoother.js"),c=e("./Concaver.js"),l=function(e){this.vertices=e,this.maps=[]};l.prototype.addMap=function(e){if(e instanceof Function)return this.maps.push(e),this;throw new Error("You need to pass a map")},l.prototype.mappedPoints=function(){return this.maps.reduce(function(e,t){return t(e)},this.vertices)},l.factory=function(e){var t=new l(e);return t.addMap(i(.001)).addMap(s(0)).addMap(c()).addMap(i(.001)).addMap(n(.1)).addMap(a()).addMap(o()),t},t.exports=l},{"./CollinearityFilter.js":11,"./Concaver.js":12,"./PointSetDensifier.js":14,"./PolygonRescaler.js":18,"./PolygonWindingFixer.js":19,"./Smoother.js":20}],16:[function(e,t,r){var i=e("three"),n=function(e){this.BUFFER_SIZE=e,this.vertices=new Array(e),this.faces=new Array(e-2),this.length=0,this.resetVertexBuffer();for(var t=0;t<this.BUFFER_SIZE-2;t++)this.faces[t]=new i.Face3(0,t+1,t+2)};n.prototype.addPoint=function(e){this.vertices[this.length]=e,this.length=(this.length+1)%this.BUFFER_SIZE;for(var t=this.length;t<this.BUFFER_SIZE;t++)this.vertices[t]=e.clone()},n.prototype.resetVertexBuffer=function(){for(var e=0;e<this.BUFFER_SIZE;e++)this.vertices[e]=new i.Vector3(0,0,0);this.length=0},t.exports=n},{three:41}],17:[function(e,t,r){var i=e("range-function"),n=function(e){this.points=e};n.prototype.pointAt=function(e){return this.points[(e+this.points.length)%this.points.length]},n.prototype.calculateWindingForPointAtIndex=function(e,t){var r=this.points[t].clone(),i=this.points[(t+1)%this.points.length].clone(),n=i.clone().sub(r.clone());if(n.setZ(0),n.length()<1e-4)return-1;var o=e.clone().sub(r.clone());if(o.setZ(0),o.length()<1e-4)return-1;var a=n.clone().cross(o),s=a.z/n.length()/o.length();return s<=.001?-1:1},n.prototype.containsPoint=function(e){for(var t=0,r=this.points.length,n=0;n<r;n++)t+=this.calculateWindingForPointAtIndex(e,n);if(t!=r)return!1;var o=this,a=i(this.points.length).some(function(t){var r=o.pointAt(t),i=o.pointAt(t+1),n=i.clone().sub(r),a=n.lengthSq(),s=n.dot(e.clone().sub(r))/a,c=r.clone().add(n.clone().multiplyScalar(s));return s>=0&&s<=1&&c.distanceTo(e)<.05});return!a},t.exports=n},{"range-function":40}],18:[function(e,t,r){function i(e,t){var r=e.map(function(e){return e[t]});return Math.min.apply(Math,r)}function n(e,t){var r=e.map(function(e){return e[t]});return Math.max.apply(Math,r)}var o=e("three"),a=function(e){if(e.length<2)throw new Error("Point list must have at least two points");var t=i(e,"x"),r=n(e,"x"),a=i(e,"y"),s=n(e,"y"),c=1e-6;if(r-t<c||s-a<c)throw new Error("Point range encloses a zero area region");var l=new o.Vector3(t,a,0),h=1/(r-t),u=1/(s-a);return e.map(function(e){var t=e.sub(l);return t.x*=h,t.y*=u,t})},s=function(){return function(e){return a(e)}};t.exports=s},{three:41}],19:[function(e,t,r){var i=function(e){for(var t=0,r=e.length,i=0;i<r;i++){var n=(i-1+r)%r,o=(i+1+r)%r;t+=e[i].x*(e[o].y-e[n].y)}return t},n=function(e){var t=e.slice(0);return i(e)<0&&(t=t.reverse()),t},o=function(){return n};t.exports=o},{}],20:[function(e,t,r){var i=e("three"),n=function(e,t){var r=(t+e.length)%e.length;return e[r]},o=function(e,t,r){for(var o=new i.Vector3(0,0,0),a=-r;a<=r;a++)o=o.add(n(e,t+a));return o.x/=2*r+1,o.y/=2*r+1,o.z/=2*r+1,o},a=function(e,t){for(var r=[],i=e.length,n=0;n<i;n++)r.push(o(e,n,t));return r},s=function(e){return function(t){return a(t,e)}};t.exports=s},{three:41}],21:[function(e,t,r){var i=e("three"),n=function(e,t,r){this.camera=e,this.screenWidth=t,this.screenHeight=r,this.bigPlane=new i.Mesh(new i.PlaneGeometry(200,200),new i.MeshBasicMaterial)};n.prototype.projectClick=function(e){var t=new i.Vector3(0,0,1).cross(this.camera.position).normalize(),r=Math.PI/4*(this.screenHeight/2-e.y)/this.screenHeight,n=this.camera.position.clone().cross(t).normalize(),o=-Math.PI/4*(e.x-this.screenWidth/2)/this.screenHeight,a=new i.Vector3(0,0,(-1)).applyQuaternion(this.camera.quaternion);a.applyAxisAngle(t,r).applyAxisAngle(n,o);var s=new i.Raycaster(this.camera.position,a),c=s.intersectObject(this.bigPlane);if(0!==c.length)return c[0].point},t.exports=n},{three:41}],22:[function(e,t,r){var i=e("three"),n=e("./PolygonDrawingState.js"),o=e("./FemDrawingState.js");!function(){var e,t=new n,r=new o,a=r;window.scene=new i.Scene;var s=function(){e.render(a.scene,a.camera),requestAnimationFrame(s.bind(this)),a.update&&a.update()},c=function(e){return function(t){a[e]&&a[e](t)}},l=function(){a==r?(t.showPolygon(),a=t):(r.setCurrentPolygon(t.buffer.vertices),a=r)};window.setup=function(){e=window.WebGLRenderingContext?new i.WebGLRenderer:new i.CanvasRenderer,e.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(e.domElement);var t=["mousedown","mouseup","mousemove"];for(var n in t){var o=t[n];document.addEventListener(o,c(o))}document.addEventListener("keydown",l),r.setCurrentPolygon([new i.Vector3(0,0,0),new i.Vector3(1,0,0),new i.Vector3(1,1,0),new i.Vector3(0,1,0)]),s()}}(window)},{"./FemDrawingState.js":7,"./PolygonDrawingState.js":10,three:41}],23:[function(e,t,r){var i=function(e,t){for(var r=e.length,n=[],o=0;o<r;o++)e[o]instanceof Array?n.push(i(e[o],t)):n.push(t*e[o]);return n};t.exports=i},{}],24:[function(e,t,r){t.exports=e("./vendor/dat.gui"),t.exports.color=e("./vendor/dat.color")},{"./vendor/dat.color":25,"./vendor/dat.gui":26}],25:[function(e,t,r){var i=t.exports=i||{};i.color=i.color||{},i.utils=i.utils||{},i.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var r in t)this.isUndefined(t[r])||(e[r]=t[r])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var r in t)this.isUndefined(e[r])&&(e[r]=t[r])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var r=t.call(arguments),i=e.length-1;i>=0;i--)r=[e[i].apply(this,r)];return r[0]}},each:function(t,r,i){if(e&&t.forEach===e)t.forEach(r,i);else if(t.length===t.length+0){for(var n=0,o=t.length;n<o;n++)if(n in t&&r.call(i,t[n],n)===this.BREAK)return}else for(var n in t)if(r.call(i,t[n],n)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),i.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(var r=t.hex.toString(16);r.length<6;)r="0"+r;return"#"+r}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(i.utils.common),i.Color=i.color.Color=function(e,t,r,i){function n(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(a(this,t,r),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(a(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(s(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(s(this),this.__state.space="HSV"),this.__state[t]=e}})}function a(e,r,n){if("HEX"===e.__state.space)e.__state[r]=t.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw"Corrupted color state";i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function s(e){var r=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:r.s,v:r.v}),i.isNaN(r.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=r.h}var c=function(){if(this.__state=e.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return c.COMPONENTS=["r","g","b","h","s","v","hex","a"],i.extend(c.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),n(c.prototype,"r",2),n(c.prototype,"g",1),n(c.prototype,"b",0),o(c.prototype,"h"),o(c.prototype,"s"),o(c.prototype,"v"),Object.defineProperty(c.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(c.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),c}(i.color.interpret=function(e,t){var r,i,n=function(){i=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(o,function(n){if(n.litmus(e))return t.each(n.conversions,function(n,o){if(r=n.read(e),i===!1&&r!==!1)return i=r,r.conversionName=o,r.conversion=n,t.BREAK}),t.BREAK}),i},o=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return n}(i.color.toString,i.utils.common),i.color.math=function(){var e;return{hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),o=r*(1-t),a=r*(1-n*t),s=r*(1-(1-n)*t),c=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][i];return{r:255*c[0],g:255*c[1],b:255*c[2]}},rgb_to_hsv:function(e,t,r){var i,n,o=Math.min(e,t,r),a=Math.max(e,t,r),s=a-o;return 0==a?{h:NaN,s:0,v:0}:(n=s/a,i=e==a?(t-r)/s:t==a?2+(r-e)/s:4+(e-t)/s,i/=6,i<0&&(i+=1),{h:360*i,s:n,v:a/255})},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(t,r,i){return i<<(e=8*r)|t&~(255<<e)}}}(),i.color.toString,i.utils.common)},{}],26:[function(e,t,r){var i=t.exports=i||{};i.gui=i.gui||{},i.utils=i.utils||{},i.controllers=i.controllers||{},i.dom=i.dom||{},i.color=i.color||{},i.utils.css=function(){return{load:function(e,t){t=t||document;var r=t.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){t=t||document;var r=document.createElement("style");r.type="text/css",r.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(r)}}}(),i.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var r in t)this.isUndefined(t[r])||(e[r]=t[r])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var r in t)this.isUndefined(e[r])&&(e[r]=t[r])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var r=t.call(arguments),i=e.length-1;i>=0;i--)r=[e[i].apply(this,r)];return r[0]}},each:function(t,r,i){if(e&&t.forEach===e)t.forEach(r,i);else if(t.length===t.length+0){for(var n=0,o=t.length;n<o;n++)if(n in t&&r.call(i,t[n],n)===this.BREAK)return}else for(var n in t)if(r.call(i,t[n],n)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),i.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(i.utils.common),i.dom.dom=function(e){function t(t){if("0"===t||e.isUndefined(t))return 0;var r=t.match(n);return e.isNull(r)?0:parseFloat(r[1])}var r={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},i={};e.each(r,function(t,r){e.each(t,function(e){i[e]=r})});var n=/(\d+(\.\d+)?)px/,o={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,r,i){e.isUndefined(r)&&(r=!0),e.isUndefined(i)&&(i=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,r,n,o){n=n||{};var a=i[r];if(!a)throw new Error("Event type "+r+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var c=n.x||n.clientX||0,l=n.y||n.clientY||0;s.initMouseEvent(r,n.bubbles||!1,n.cancelable||!0,window,n.clickCount||1,0,0,c,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=s.initKeyboardEvent||s.initKeyEvent;e.defaults(n,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(r,n.bubbles||!1,n.cancelable,window,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode);break;default:s.initEvent(r,n.bubbles||!1,n.cancelable||!0)}e.defaults(s,o),t.dispatchEvent(s)},bind:function(e,t,r,i){return i=i||!1,e.addEventListener?e.addEventListener(t,r,i):e.attachEvent&&e.attachEvent("on"+t,r),o},unbind:function(e,t,r,i){return i=i||!1,e.removeEventListener?e.removeEventListener(t,r,i):e.detachEvent&&e.detachEvent("on"+t,r),o},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){
var r=e.className.split(/ +/);r.indexOf(t)==-1&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return o},removeClass:function(e,t){if(t)if(void 0===e.className);else if(e.className===t)e.removeAttribute("class");else{var r=e.className.split(/ +/),i=r.indexOf(t);i!=-1&&(r.splice(i,1),e.className=r.join(" "))}else e.className=void 0;return o},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var r=getComputedStyle(e);return t(r["border-left-width"])+t(r["border-right-width"])+t(r["padding-left"])+t(r["padding-right"])+t(r.width)},getHeight:function(e){var r=getComputedStyle(e);return t(r["border-top-width"])+t(r["border-bottom-width"])+t(r["padding-top"])+t(r["padding-bottom"])+t(r.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return o}(i.utils.common),i.controllers.OptionController=function(e,t,r){var i=function(e,n,o){i.superclass.call(this,e,n);var a=this;if(this.__select=document.createElement("select"),r.isArray(o)){var s={};r.each(o,function(e){s[e]=e}),o=s}r.each(o,function(e,t){var r=document.createElement("option");r.innerHTML=t,r.setAttribute("value",e),a.__select.appendChild(r)}),this.updateDisplay(),t.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;a.setValue(e)}),this.domElement.appendChild(this.__select)};return i.superclass=e,r.extend(i.prototype,e.prototype,{setValue:function(e){var t=i.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t},updateDisplay:function(){return this.__select.value=this.getValue(),i.superclass.prototype.updateDisplay.call(this)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.NumberController=function(e,t){function r(e){return e=e.toString(),e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var i=function(e,n,o){i.superclass.call(this,e,n),o=o||{},this.__min=o.min,this.__max=o.max,this.__step=o.step,t.isUndefined(this.__step)?0==this.initialValue?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=r(this.__impliedStep)};return i.superclass=e,t.extend(i.prototype,e.prototype,{setValue:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),i.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),i}(i.controllers.Controller,i.utils.common),i.controllers.NumberControllerBox=function(e,t,r){function i(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}var n=function(e,i,o){function a(){var e=parseFloat(f.__input.value);r.isNaN(e)||f.setValue(e)}function s(){a(),f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())}function c(e){t.bind(window,"mousemove",l),t.bind(window,"mouseup",h),u=e.clientY}function l(e){var t=u-e.clientY;f.setValue(f.getValue()+t*f.__impliedStep),u=e.clientY}function h(){t.unbind(window,"mousemove",l),t.unbind(window,"mouseup",h)}this.__truncationSuspended=!1,n.superclass.call(this,e,i,o);var u,f=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",a),t.bind(this.__input,"blur",s),t.bind(this.__input,"mousedown",c),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&(f.__truncationSuspended=!0,this.blur(),f.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return n.superclass=e,r.extend(n.prototype,e.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():i(this.getValue(),this.__precision),n.superclass.prototype.updateDisplay.call(this)}}),n}(i.controllers.NumberController,i.dom.dom,i.utils.common),i.controllers.NumberControllerSlider=function(e,t,r,i,n){function o(e,t,r,i,n){return i+(n-i)*((e-t)/(r-t))}var a=function(e,r,i,n,s){function c(e){t.bind(window,"mousemove",l),t.bind(window,"mouseup",h),l(e)}function l(e){e.preventDefault();var r=t.getOffset(u.__background),i=t.getWidth(u.__background);return u.setValue(o(e.clientX,r.left,r.left+i,u.__min,u.__max)),!1}function h(){t.unbind(window,"mousemove",l),t.unbind(window,"mouseup",h),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}a.superclass.call(this,e,r,{min:i,max:n,step:s});var u=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",c),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return a.superclass=e,a.useDefaultStyles=function(){r.inject(n)},i.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",a.superclass.prototype.updateDisplay.call(this)}}),a}(i.controllers.NumberController,i.dom.dom,i.utils.css,i.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),i.controllers.FunctionController=function(e,t,r){var i=function(e,r,n){i.superclass.call(this,e,r);var o=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===n?"Fire":n,t.bind(this.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return i.superclass=e,r.extend(i.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.BooleanController=function(e,t,r){var i=function(e,r){function n(){o.setValue(!o.__prev)}i.superclass.call(this,e,r);var o=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",n,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return i.superclass=e,r.extend(i.prototype,e.prototype,{setValue:function(e){var t=i.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,i.superclass.prototype.updateDisplay.call(this)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(var r=t.hex.toString(16);r.length<6;)r="0"+r;return"#"+r}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(i.utils.common),i.color.interpret=function(e,t){var r,i,n=function(){i=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(o,function(n){if(n.litmus(e))return t.each(n.conversions,function(n,o){if(r=n.read(e),i===!1&&r!==!1)return i=r,r.conversionName=o,r.conversion=n,t.BREAK}),t.BREAK}),i},o=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return n}(i.color.toString,i.utils.common),i.GUI=i.gui.GUI=function(e,t,r,i,n,o,a,s,c,l,h,u,f,p,d){function m(e,t,r,o){if(void 0===t[r])throw new Error("Object "+t+' has no property "'+r+'"');var a;if(o.color)a=new h(t,r);else{var s=[t,r].concat(o.factoryArgs);a=i.apply(e,s)}o.before instanceof n&&(o.before=o.before.__li),y(e,a),p.addClass(a.domElement,"c");var c=document.createElement("span");p.addClass(c,"property-name"),c.innerHTML=a.property;var l=document.createElement("div");l.appendChild(c),l.appendChild(a.domElement);var u=v(e,l,o.before);return p.addClass(u,k.CLASS_CONTROLLER_ROW),p.addClass(u,typeof a.getValue()),g(e,u,a),e.__controllers.push(a),a}function v(e,t,r){var i=document.createElement("li");return t&&i.appendChild(t),r?e.__ul.insertBefore(i,params.before):e.__ul.appendChild(i),e.onResize(),i}function g(e,t,r){if(r.__li=t,r.__gui=e,d.extend(r,{options:function(t){return arguments.length>1?(r.remove(),m(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[d.toArray(arguments)]})):d.isArray(t)||d.isObject(t)?(r.remove(),m(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[t]})):void 0},name:function(e){return r.__li.firstElementChild.firstElementChild.innerHTML=e,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof c){var i=new s(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});d.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=r[e],n=i[e];r[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(r,e),n.apply(i,e)}}),p.addClass(t,"has-slider"),r.domElement.insertBefore(i.domElement,r.domElement.firstElementChild)}else if(r instanceof s){var n=function(t){return d.isNumber(r.__min)&&d.isNumber(r.__max)?(r.remove(),m(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]})):t};r.min=d.compose(n,r.min),r.max=d.compose(n,r.max)}else r instanceof o?(p.bind(t,"click",function(){p.fakeEvent(r.__checkbox,"click")}),p.bind(r.__checkbox,"click",function(e){e.stopPropagation()})):r instanceof a?(p.bind(t,"click",function(){p.fakeEvent(r.__button,"click")}),p.bind(t,"mouseover",function(){p.addClass(r.__button,"hover")}),p.bind(t,"mouseout",function(){p.removeClass(r.__button,"hover")})):r instanceof h&&(p.addClass(t,"color"),r.updateDisplay=d.compose(function(e){return t.style.borderLeftColor=r.__color.toString(),e},r.updateDisplay),r.updateDisplay());r.setValue=d.compose(function(t){return e.getRoot().__preset_select&&r.isModified()&&C(e.getRoot(),!0),t},r.setValue)}function y(e,t){var r=e.getRoot(),i=r.__rememberedObjects.indexOf(t.object);if(i!=-1){var n=r.__rememberedObjectIndecesToControllers[i];if(void 0===n&&(n={},r.__rememberedObjectIndecesToControllers[i]=n),n[t.property]=t,r.load&&r.load.remembered){var o,a=r.load.remembered;if(a[e.preset])o=a[e.preset];else{if(!a[V])return;o=a[V]}if(o[i]&&void 0!==o[i][t.property]){var s=o[i][t.property];t.initialValue=s,t.setValue(s)}}}}function x(e,t){return document.location.href+"."+t}function _(e){function t(){l.style.display=e.useLocalStorage?"block":"none"}var r=e.__save_row=document.createElement("li");p.addClass(e.domElement,"has-save"),e.__ul.insertBefore(r,e.__ul.firstChild),p.addClass(r,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",p.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",p.addClass(n,"button"),p.addClass(n,"save");var o=document.createElement("span");o.innerHTML="New",p.addClass(o,"button"),p.addClass(o,"save-as");var a=document.createElement("span");a.innerHTML="Revert",p.addClass(a,"button"),p.addClass(a,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?d.each(e.load.remembered,function(t,r){S(e,r,r==e.preset)}):S(e,V,!1),p.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),r.appendChild(s),r.appendChild(i),r.appendChild(n),r.appendChild(o),r.appendChild(a),F){var c=document.getElementById("dg-save-locally"),l=document.getElementById("dg-local-explain");c.style.display="block";var h=document.getElementById("dg-local-storage");"true"===localStorage.getItem(x(e,"isLocal"))&&h.setAttribute("checked","checked"),t(),p.bind(h,"change",function(){e.useLocalStorage=!e.useLocalStorage,t()})}var u=document.getElementById("dg-new-constructor");p.bind(u,"keydown",function(e){!e.metaKey||67!==e.which&&67!=e.keyCode||E.hide()}),p.bind(i,"click",function(){u.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),E.show(),u.focus(),u.select()}),p.bind(n,"click",function(){e.save()}),p.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),p.bind(a,"click",function(){e.revert()})}function b(e){function t(t){return t.preventDefault(),n=t.clientX,p.addClass(e.__closeButton,k.CLASS_DRAG),p.bind(window,"mousemove",r),p.bind(window,"mouseup",i),!1}function r(t){return t.preventDefault(),e.width+=n-t.clientX,e.onResize(),n=t.clientX,!1}function i(){p.removeClass(e.__closeButton,k.CLASS_DRAG),p.unbind(window,"mousemove",r),p.unbind(window,"mouseup",i)}e.__resize_handle=document.createElement("div"),d.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var n;p.bind(e.__resize_handle,"mousedown",t),p.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function w(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function M(e,t){var r={};return d.each(e.__rememberedObjects,function(i,n){var o={},a=e.__rememberedObjectIndecesToControllers[n];d.each(a,function(e,r){o[r]=t?e.initialValue:e.getValue()}),r[n]=o}),r}function S(e,t,r){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),r&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function A(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value==e.preset&&(e.__preset_select.selectedIndex=t)}function C(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];t?r.innerHTML=r.value+"*":r.innerHTML=r.value}function T(e){0!=e.length&&u(function(){T(e)}),d.each(e,function(e){e.updateDisplay()})}e.inject(r);var E,L,P="dg",R=72,D=20,V="Default",F=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),U=!0,N=!1,O=[],k=function(e){function t(){localStorage.setItem(x(i,"gui"),JSON.stringify(i.getSaveObject()))}function r(){var e=i.getRoot();e.width+=1,d.defer(function(){e.width-=1})}var i=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),p.addClass(this.domElement,P),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=d.defaults(e,{autoPlace:!0,width:k.DEFAULT_WIDTH}),e=d.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),d.isUndefined(e.load)?e.load={preset:V}:e.preset&&(e.load.preset=e.preset),d.isUndefined(e.parent)&&e.hideable&&O.push(this),e.resizable=d.isUndefined(e.parent)&&e.resizable,e.autoPlace&&d.isUndefined(e.scrollable)&&(e.scrollable=!0);var n=F&&"true"===localStorage.getItem(x(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return i.parent?i.getRoot().preset:e.load.preset},set:function(t){i.parent?i.getRoot().preset=t:e.load.preset=t,A(this),i.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t,w(i,t)}},name:{get:function(){return e.name},set:function(t){e.name=t,a&&(a.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t,e.closed?p.addClass(i.__ul,k.CLASS_CLOSED):p.removeClass(i.__ul,k.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=t?k.TEXT_OPEN:k.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return n},set:function(e){F&&(n=e,e?p.bind(window,"unload",t):p.unbind(window,"unload",t),localStorage.setItem(x(i,"isLocal"),e))}}}),d.isUndefined(e.parent)){if(e.closed=!1,p.addClass(this.domElement,k.CLASS_MAIN),p.makeSelectable(this.domElement,!1),F&&n){i.useLocalStorage=!0;var o=localStorage.getItem(x(this,"gui"));o&&(e.load=JSON.parse(o))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=k.TEXT_CLOSED,p.addClass(this.__closeButton,k.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),p.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{void 0===e.closed&&(e.closed=!0);var a=document.createTextNode(e.name);p.addClass(a,"controller-name");var s=v(i,a),c=function(e){return e.preventDefault(),i.closed=!i.closed,!1};p.addClass(this.__ul,k.CLASS_CLOSED),p.addClass(s,"title"),p.bind(s,"click",c),e.closed||(this.closed=!1)}e.autoPlace&&(d.isUndefined(e.parent)&&(U&&(L=document.createElement("div"),p.addClass(L,P),p.addClass(L,k.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(L),U=!1),L.appendChild(this.domElement),p.addClass(this.domElement,k.CLASS_AUTO_PLACE)),this.parent||w(i,e.width)),p.bind(window,"resize",function(){i.onResize()}),p.bind(this.__ul,"webkitTransitionEnd",function(){i.onResize()}),p.bind(this.__ul,"transitionend",function(){i.onResize()}),p.bind(this.__ul,"oTransitionEnd",function(){i.onResize()}),this.onResize(),e.resizable&&b(this);i.getRoot();e.parent||r()};return k.toggleHide=function(){N=!N,d.each(O,function(e){e.domElement.style.zIndex=N?-999:999,e.domElement.style.opacity=N?0:1})},k.CLASS_AUTO_PLACE="a",k.CLASS_AUTO_PLACE_CONTAINER="ac",k.CLASS_MAIN="main",k.CLASS_CONTROLLER_ROW="cr",k.CLASS_TOO_TALL="taller-than-window",k.CLASS_CLOSED="closed",k.CLASS_CLOSE_BUTTON="close-button",k.CLASS_DRAG="drag",k.DEFAULT_WIDTH=245,k.TEXT_CLOSED="Close Controls",k.TEXT_OPEN="Open Controls",p.bind(window,"keydown",function(e){"text"===document.activeElement.type||e.which!==R&&e.keyCode!=R||k.toggleHide()},!1),d.extend(k.prototype,{add:function(e,t){return m(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return m(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;d.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&L.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var r=new k(t);this.__folders[e]=r;var i=v(this,r.domElement);return p.addClass(i,"folder"),r},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=p.getOffset(e.__ul).top,r=0;d.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(r+=p.getHeight(t))}),window.innerHeight-t-D<r?(p.addClass(e.domElement,k.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-D+"px"):(p.removeClass(e.domElement,k.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&d.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){if(d.isUndefined(E)&&(E=new f,E.domElement.innerHTML=t),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;d.each(Array.prototype.slice.call(arguments),function(t){0==e.__rememberedObjects.length&&_(e),e.__rememberedObjects.indexOf(t)==-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&w(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=M(this)),e.folders={},d.each(this.__folders,function(t,r){e.folders[r]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=M(this),C(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[V]=M(this,!0)),this.load.remembered[e]=M(this),this.preset=e,S(this,e,!0)},revert:function(e){d.each(this.__controllers,function(t){this.getRoot().load.remembered?y(e||this.getRoot(),t):t.setValue(t.initialValue)},this),d.each(this.__folders,function(e){e.revert(e)}),e||C(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e),t&&T(this.__listening)}}),k}(i.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",i.controllers.factory=function(e,t,r,i,n,o,a){return function(s,c){var l=s[c];return a.isArray(arguments[2])||a.isObject(arguments[2])?new e(s,c,arguments[2]):a.isNumber(l)?a.isNumber(arguments[2])&&a.isNumber(arguments[3])?new r(s,c,arguments[2],arguments[3]):new t(s,c,{min:arguments[2],max:arguments[3]}):a.isString(l)?new i(s,c):a.isFunction(l)?new n(s,c,""):a.isBoolean(l)?new o(s,c):void 0}}(i.controllers.OptionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.StringController=function(e,t,r){var i=function(e,r){function n(){a.setValue(a.__input.value)}function o(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}i.superclass.call(this,e,r);var a=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",n),t.bind(this.__input,"change",n),t.bind(this.__input,"blur",o),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return i.superclass=e,r.extend(i.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),i.superclass.prototype.updateDisplay.call(this)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.FunctionController,i.controllers.BooleanController,i.utils.common),i.controllers.Controller,i.controllers.BooleanController,i.controllers.FunctionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.OptionController,i.controllers.ColorController=function(e,t,r,i,n){function o(e,t,r,i){e.style.background="",n.each(c,function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+r+" 0%, "+i+" 100%); "})}function a(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var s=function(e,c){function l(e){p(e),t.bind(window,"mousemove",p),t.bind(window,"mouseup",h)}function h(){t.unbind(window,"mousemove",p),t.unbind(window,"mouseup",h)}function u(){var e=i(this.value);e!==!1?(m.__color.__state=e,m.setValue(m.__color.toOriginal())):this.value=m.__color.toString()}function f(){t.unbind(window,"mousemove",d),t.unbind(window,"mouseup",f)}function p(e){e.preventDefault();var r=t.getWidth(m.__saturation_field),i=t.getOffset(m.__saturation_field),n=(e.clientX-i.left+document.body.scrollLeft)/r,o=1-(e.clientY-i.top+document.body.scrollTop)/r;
return o>1?o=1:o<0&&(o=0),n>1?n=1:n<0&&(n=0),m.__color.v=o,m.__color.s=n,m.setValue(m.__color.toOriginal()),!1}function d(e){e.preventDefault();var r=t.getHeight(m.__hue_field),i=t.getOffset(m.__hue_field),n=1-(e.clientY-i.top+document.body.scrollTop)/r;return n>1?n=1:n<0&&(n=0),m.__color.h=360*n,m.setValue(m.__color.toOriginal()),!1}s.superclass.call(this,e,c),this.__color=new r(this.getValue()),this.__temp=new r(0);var m=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){13===e.keyCode&&u.call(this)}),t.bind(this.__input,"blur",u),t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(m.__selector,"drag")})});var v=document.createElement("div");n.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),n.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),n.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),n.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),n.extend(v.style,{width:"100%",height:"100%",background:"none"}),o(v,"top","rgba(0,0,0,0)","#000"),n.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),a(this.__hue_field),n.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",l),t.bind(this.__field_knob,"mousedown",l),t.bind(this.__hue_field,"mousedown",function(e){d(e),t.bind(window,"mousemove",d),t.bind(window,"mouseup",f)}),this.__saturation_field.appendChild(v),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};s.superclass=e,n.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=i(this.getValue());if(e!==!1){var t=!1;n.each(r.COMPONENTS,function(r){if(!n.isUndefined(e[r])&&!n.isUndefined(this.__color.__state[r])&&e[r]!==this.__color.__state[r])return t=!0,{}},this),t&&n.extend(this.__color.__state,e)}n.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var a=this.__color.v<.5||this.__color.s>.5?255:0,s=255-a;n.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+a+","+a+","+a+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,o(this.__saturation_field,"left","#fff",this.__temp.toString()),n.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+a+","+a+","+a+")",textShadow:this.__input_textShadow+"rgba("+s+","+s+","+s+",.7)"})}});var c=["-moz-","-o-","-webkit-","-ms-",""];return s}(i.controllers.Controller,i.dom.dom,i.color.Color=function(e,t,r,i){function n(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(a(this,t,r),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(a(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(s(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(s(this),this.__state.space="HSV"),this.__state[t]=e}})}function a(e,r,n){if("HEX"===e.__state.space)e.__state[r]=t.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw"Corrupted color state";i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function s(e){var r=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:r.s,v:r.v}),i.isNaN(r.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=r.h}var c=function(){if(this.__state=e.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return c.COMPONENTS=["r","g","b","h","s","v","hex","a"],i.extend(c.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),n(c.prototype,"r",2),n(c.prototype,"g",1),n(c.prototype,"b",0),o(c.prototype,"h"),o(c.prototype,"s"),o(c.prototype,"v"),Object.defineProperty(c.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(c.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),c}(i.color.interpret,i.color.math=function(){var e;return{hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),o=r*(1-t),a=r*(1-n*t),s=r*(1-(1-n)*t),c=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][i];return{r:255*c[0],g:255*c[1],b:255*c[2]}},rgb_to_hsv:function(e,t,r){var i,n,o=Math.min(e,t,r),a=Math.max(e,t,r),s=a-o;return 0==a?{h:NaN,s:0,v:0}:(n=s/a,i=e==a?(t-r)/s:t==a?2+(r-e)/s:4+(e-t)/s,i/=6,i<0&&(i+=1),{h:360*i,s:n,v:a/255})},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(t,r,i){return i<<(e=8*r)|t&~(255<<e)}}}(),i.color.toString,i.utils.common),i.color.interpret,i.utils.common),i.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),i.dom.CenteredDiv=function(e,t){var r=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var r=this;e.bind(this.backgroundElement,"click",function(){r.hide()})};return r.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},r.prototype.hide=function(){var t=this,r=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",r),e.unbind(t.domElement,"transitionend",r),e.unbind(t.domElement,"oTransitionEnd",r)};e.bind(this.domElement,"webkitTransitionEnd",r),e.bind(this.domElement,"transitionend",r),e.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},r.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},r}(i.dom.dom,i.utils.common),i.dom.dom,i.utils.common)},{}],27:[function(e,t,r){"use strict";function i(e,t,r){this.vertices=e,this.adjacent=t,this.boundary=r,this.lastVisited=-1}function n(e,t,r){this.vertices=e,this.cell=t,this.index=r}function o(e,t){return h(e.vertices,t.vertices)}function a(e){for(var t=["function orient(){var tuple=this.tuple;return test("],r=0;r<=e;++r)r>0&&t.push(","),t.push("tuple[",r,"]");t.push(")}return orient");var i=new Function("test",t.join("")),n=l[e+1];return n||(n=l),i(n)}function s(e,t,r){this.dimension=e,this.vertices=t,this.simplices=r,this.interior=r.filter(function(e){return!e.boundary}),this.tuple=new Array(e+1);for(var i=0;i<=e;++i)this.tuple[i]=this.vertices[i];var n=u[e];n||(n=u[e]=a(e)),this.orient=n}function c(e,t){var r=e.length;if(0===r)throw new Error("Must have at least d+1 points");var n=e[0].length;if(r<=n)throw new Error("Must input at least d+1 points");var o=e.slice(0,n+1),a=l.apply(void 0,o);if(0===a)throw new Error("Input not in general position");for(var c=new Array(n+1),h=0;h<=n;++h)c[h]=h;a<0&&(c[0]=1,c[1]=0);for(var u=new i(c,new Array(n+1),(!1)),f=u.adjacent,p=new Array(n+2),h=0;h<=n;++h){for(var d=c.slice(),m=0;m<=n;++m)m===h&&(d[m]=-1);var v=d[0];d[0]=d[1],d[1]=v;var g=new i(d,new Array(n+1),(!0));f[h]=g,p[h]=g}p[n+1]=u;for(var h=0;h<=n;++h)for(var d=f[h].vertices,y=f[h].adjacent,m=0;m<=n;++m){var x=d[m];if(x<0)y[m]=u;else for(var _=0;_<=n;++_)f[_].vertices.indexOf(x)<0&&(y[m]=f[_])}for(var b=new s(n,o,p),w=!!t,h=n+1;h<r;++h)b.insert(e[h],w);return b.boundary()}t.exports=c;var l=e("robust-orientation"),h=e("simplicial-complex").compareCells;i.prototype.flip=function(){var e=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=e;var t=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=t};var u=[],f=s.prototype;f.handleBoundaryDegeneracy=function(e,t){var r=this.dimension,i=this.vertices.length-1,n=this.tuple,o=this.vertices,a=[e];for(e.lastVisited=-i;a.length>0;){e=a.pop();for(var s=(e.vertices,e.adjacent),c=0;c<=r;++c){var l=s[c];if(l.boundary&&!(l.lastVisited<=-i)){for(var h=l.vertices,u=0;u<=r;++u){var f=h[u];f<0?n[u]=t:n[u]=o[f]}var p=this.orient();if(p>0)return l;l.lastVisited=-i,0===p&&a.push(l)}}}return null},f.walk=function(e,t){var r=this.vertices.length-1,i=this.dimension,n=this.vertices,o=this.tuple,a=t?this.interior.length*Math.random()|0:this.interior.length-1,s=this.interior[a];e:for(;!s.boundary;){for(var c=s.vertices,l=s.adjacent,h=0;h<=i;++h)o[h]=n[c[h]];s.lastVisited=r;for(var h=0;h<=i;++h){var u=l[h];if(!(u.lastVisited>=r)){var f=o[h];o[h]=e;var p=this.orient();if(o[h]=f,p<0){s=u;continue e}u.boundary?u.lastVisited=-r:u.lastVisited=r}}return}return s},f.addPeaks=function(e,t){var r=this.vertices.length-1,a=this.dimension,s=this.vertices,c=this.tuple,l=this.interior,h=this.simplices,u=[t];t.lastVisited=r,t.vertices[t.vertices.indexOf(-1)]=r,t.boundary=!1,l.push(t);for(var f=[];u.length>0;){var t=u.pop(),p=t.vertices,d=t.adjacent,m=p.indexOf(r);if(!(m<0))for(var v=0;v<=a;++v)if(v!==m){var g=d[v];if(g.boundary&&!(g.lastVisited>=r)){var y=g.vertices;if(g.lastVisited!==-r){for(var x=0,_=0;_<=a;++_)y[_]<0?(x=_,c[_]=e):c[_]=s[y[_]];var b=this.orient();if(b>0){y[x]=r,g.boundary=!1,l.push(g),u.push(g),g.lastVisited=r;continue}g.lastVisited=-r}var w=g.adjacent,M=p.slice(),S=d.slice(),A=new i(M,S,(!0));h.push(A);var C=w.indexOf(t);if(!(C<0)){w[C]=A,S[m]=g,M[v]=-1,S[v]=t,d[v]=A,A.flip();for(var _=0;_<=a;++_){var T=M[_];if(!(T<0||T===r)){for(var E=new Array(a-1),L=0,P=0;P<=a;++P){var R=M[P];R<0||P===_||(E[L++]=R)}f.push(new n(E,A,_))}}}}}}f.sort(o);for(var v=0;v+1<f.length;v+=2){var D=f[v],V=f[v+1],F=D.index,U=V.index;F<0||U<0||(D.cell.adjacent[D.index]=V.cell,V.cell.adjacent[V.index]=D.cell)}},f.insert=function(e,t){var r=this.vertices;r.push(e);var i=this.walk(e,t);if(i){for(var n=this.dimension,o=this.tuple,a=0;a<=n;++a){var s=i.vertices[a];s<0?o[a]=e:o[a]=r[s]}var c=this.orient(o);c<0||(0!==c||(i=this.handleBoundaryDegeneracy(i,e)))&&this.addPeaks(e,i)}},f.boundary=function(){for(var e=this.dimension,t=[],r=this.simplices,i=r.length,n=0;n<i;++n){var o=r[n];if(o.boundary){for(var a=new Array(e),s=o.vertices,c=0,l=0,h=0;h<=e;++h)s[h]>=0?a[c++]=s[h]:l=1&h;if(l===(1&e)){var u=a[0];a[0]=a[1],a[1]=u}t.push(a)}}return t}},{"robust-orientation":33,"simplicial-complex":36}],28:[function(e,t,r){"use strict";function i(e,t,r){var i=e+t,n=i-e,o=i-n,a=t-n,s=e-o;return r?(r[0]=s+a,r[1]=i,r):[s+a,i]}t.exports=i},{}],29:[function(e,t,r){"use strict";function i(e,t){var r=e.length;if(1===r){var i=n(e[0],t);return i[0]?i:[i[1]]}var a=new Array(2*r),s=[.1,.1],c=[.1,.1],l=0;n(e[0],t,s),s[0]&&(a[l++]=s[0]);for(var h=1;h<r;++h){n(e[h],t,c);var u=s[1];o(u,c[0],s),s[0]&&(a[l++]=s[0]);var f=c[1],p=s[1],d=f+p,m=d-f,v=p-m;s[1]=d,v&&(a[l++]=v)}return s[1]&&(a[l++]=s[1]),0===l&&(a[l++]=0),a.length=l,a}var n=e("two-product"),o=e("two-sum");t.exports=i},{"two-product":32,"two-sum":28}],30:[function(e,t,r){"use strict";function i(e,t){var r=e+t,i=r-e,n=r-i,o=t-i,a=e-n,s=a+o;return s?[s,r]:[r]}function n(e,t){var r=0|e.length,n=0|t.length;if(1===r&&1===n)return i(e[0],-t[0]);var o,a,s=r+n,c=new Array(s),l=0,h=0,u=0,f=Math.abs,p=e[h],d=f(p),m=-t[u],v=f(m);d<v?(a=p,h+=1,h<r&&(p=e[h],d=f(p))):(a=m,u+=1,u<n&&(m=-t[u],v=f(m))),h<r&&d<v||u>=n?(o=p,h+=1,h<r&&(p=e[h],d=f(p))):(o=m,u+=1,u<n&&(m=-t[u],v=f(m)));for(var g,y,x,_,b,w=o+a,M=w-o,S=a-M,A=S,C=w;h<r&&u<n;)d<v?(o=p,h+=1,h<r&&(p=e[h],d=f(p))):(o=m,u+=1,u<n&&(m=-t[u],v=f(m))),a=A,w=o+a,M=w-o,S=a-M,S&&(c[l++]=S),g=C+w,y=g-C,x=g-y,_=w-y,b=C-x,A=b+_,C=g;for(;h<r;)o=p,a=A,w=o+a,M=w-o,S=a-M,S&&(c[l++]=S),g=C+w,y=g-C,x=g-y,_=w-y,b=C-x,A=b+_,C=g,h+=1,h<r&&(p=e[h]);for(;u<n;)o=m,a=A,w=o+a,M=w-o,S=a-M,S&&(c[l++]=S),g=C+w,y=g-C,x=g-y,_=w-y,b=C-x,A=b+_,C=g,u+=1,u<n&&(m=-t[u]);return A&&(c[l++]=A),C&&(c[l++]=C),l||(c[l++]=0),c.length=l,c}t.exports=n},{}],31:[function(e,t,r){"use strict";function i(e,t){var r=e+t,i=r-e,n=r-i,o=t-i,a=e-n,s=a+o;return s?[s,r]:[r]}function n(e,t){var r=0|e.length,n=0|t.length;if(1===r&&1===n)return i(e[0],t[0]);var o,a,s=r+n,c=new Array(s),l=0,h=0,u=0,f=Math.abs,p=e[h],d=f(p),m=t[u],v=f(m);d<v?(a=p,h+=1,h<r&&(p=e[h],d=f(p))):(a=m,u+=1,u<n&&(m=t[u],v=f(m))),h<r&&d<v||u>=n?(o=p,h+=1,h<r&&(p=e[h],d=f(p))):(o=m,u+=1,u<n&&(m=t[u],v=f(m)));for(var g,y,x,_,b,w=o+a,M=w-o,S=a-M,A=S,C=w;h<r&&u<n;)d<v?(o=p,h+=1,h<r&&(p=e[h],d=f(p))):(o=m,u+=1,u<n&&(m=t[u],v=f(m))),a=A,w=o+a,M=w-o,S=a-M,S&&(c[l++]=S),g=C+w,y=g-C,x=g-y,_=w-y,b=C-x,A=b+_,C=g;for(;h<r;)o=p,a=A,w=o+a,M=w-o,S=a-M,S&&(c[l++]=S),g=C+w,y=g-C,x=g-y,_=w-y,b=C-x,A=b+_,C=g,h+=1,h<r&&(p=e[h]);for(;u<n;)o=m,a=A,w=o+a,M=w-o,S=a-M,S&&(c[l++]=S),g=C+w,y=g-C,x=g-y,_=w-y,b=C-x,A=b+_,C=g,u+=1,u<n&&(m=t[u]);return A&&(c[l++]=A),C&&(c[l++]=C),l||(c[l++]=0),c.length=l,c}t.exports=n},{}],32:[function(e,t,r){"use strict";function i(e,t,r){var i=e*t,o=n*e,a=o-e,s=o-a,c=e-s,l=n*t,h=l-t,u=l-h,f=t-u,p=i-s*u,d=p-c*u,m=d-s*f,v=c*f-m;return r?(r[0]=v,r[1]=i,r):[v,i]}t.exports=i;var n=+(Math.pow(2,27)+1)},{}],33:[function(e,t,r){"use strict";function i(e,t){for(var r=new Array(e.length-1),i=1;i<e.length;++i)for(var n=r[i-1]=new Array(e.length-1),o=0,a=0;o<e.length;++o)o!==t&&(n[a++]=e[i][o]);return r}function n(e){for(var t=new Array(e),r=0;r<e;++r){t[r]=new Array(e);for(var i=0;i<e;++i)t[r][i]=["m",i,"[",e-r-1,"]"].join("")}return t}function o(e){return 1&e?"-":""}function a(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var t=e.length>>1;return["sum(",a(e.slice(0,t)),",",a(e.slice(t)),")"].join("")}function s(e){if(2===e.length)return[["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("")];for(var t=[],r=0;r<e.length;++r)t.push(["scale(",a(s(i(e,r))),",",o(r),e[0][r],")"].join(""));return t}function c(e){for(var t=[],r=[],o=n(e),c=[],l=0;l<e;++l)0===(1&l)?t.push.apply(t,s(i(o,l))):r.push.apply(r,s(i(o,l))),c.push("m"+l);var h=a(t),m=a(r),v="orientation"+e+"Exact",g=["function ",v,"(",c.join(),"){var p=",h,",n=",m,",d=sub(p,n);return d[d.length-1];};return ",v].join(""),y=new Function("sum","prod","scale","sub",g);return y(f,u,p,d)}function l(e){var t=b[e.length];return t||(t=b[e.length]=c(e.length)),t.apply(void 0,e)}function h(){for(;b.length<=m;)b.push(c(b.length));for(var e=[],r=["slow"],i=0;i<=m;++i)e.push("a"+i),r.push("o"+i);for(var n=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"],i=2;i<=m;++i)n.push("case ",i,":return o",i,"(",e.slice(0,i).join(),");");n.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),r.push(n.join(""));var o=Function.apply(void 0,r);t.exports=o.apply(void 0,[l].concat(b));for(var i=0;i<=m;++i)t.exports[i]=b[i]}var u=e("two-product"),f=e("robust-sum"),p=e("robust-scale"),d=e("robust-subtract"),m=5,v=1.1102230246251565e-16,g=(3+16*v)*v,y=(7+56*v)*v,x=c(3),_=c(4),b=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,r){var i,n=(e[1]-r[1])*(t[0]-r[0]),o=(e[0]-r[0])*(t[1]-r[1]),a=n-o;if(n>0){if(o<=0)return a;i=n+o}else{if(!(n<0))return a;if(o>=0)return a;i=-(n+o)}var s=g*i;return a>=s||a<=-s?a:x(e,t,r)},function(e,t,r,i){var n=e[0]-i[0],o=t[0]-i[0],a=r[0]-i[0],s=e[1]-i[1],c=t[1]-i[1],l=r[1]-i[1],h=e[2]-i[2],u=t[2]-i[2],f=r[2]-i[2],p=o*l,d=a*c,m=a*s,v=n*l,g=n*c,x=o*s,b=h*(p-d)+u*(m-v)+f*(g-x),w=(Math.abs(p)+Math.abs(d))*Math.abs(h)+(Math.abs(m)+Math.abs(v))*Math.abs(u)+(Math.abs(g)+Math.abs(x))*Math.abs(f),M=y*w;return b>M||-b>M?b:_(e,t,r,i)}];h()},{"robust-scale":29,"robust-subtract":30,"robust-sum":31,"two-product":32}],34:[function(e,t,r){"use strict";"use restrict";function i(e){var t=32;return e&=-e,e&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}var n=32;r.INT_BITS=n,r.INT_MAX=2147483647,r.INT_MIN=-1<<n-1,r.sign=function(e){return(e>0)-(e<0)},r.abs=function(e){var t=e>>n-1;return(e^t)-t},r.min=function(e,t){return t^(e^t)&-(e<t)},r.max=function(e,t){return e^(e^t)&-(e<t)},r.isPow2=function(e){return!(e&e-1||!e)},r.log2=function(e){var t,r;return t=(e>65535)<<4,e>>>=t,r=(e>255)<<3,e>>>=r,t|=r,r=(e>15)<<2,e>>>=r,t|=r,r=(e>3)<<1,e>>>=r,t|=r,t|e>>1},r.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},r.popCount=function(e){return e-=e>>>1&1431655765,e=(858993459&e)+(e>>>2&858993459),16843009*(e+(e>>>4)&252645135)>>>24},r.countTrailingZeros=i,r.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1},r.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e-(e>>>1)},r.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,e&=15,27030>>>e&1};var o=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,i=t,n=7;for(r>>>=1;r;r>>>=1)i<<=1,i|=1&r,--n;e[t]=i<<n&255}}(o),r.reverse=function(e){return o[255&e]<<24|o[e>>>8&255]<<16|o[e>>>16&255]<<8|o[e>>>24&255]},r.interleave2=function(e,t){return e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1},r.deinterleave2=function(e,t){return e=e>>>t&1431655765,e=858993459&(e|e>>>1),e=252645135&(e|e>>>2),e=16711935&(e|e>>>4),e=65535&(e|e>>>16),e<<16>>16},r.interleave3=function(e,t,r){return e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e|=t<<1,r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),e|r<<2},r.deinterleave3=function(e,t){return e=e>>>t&1227133513,e=3272356035&(e|e>>>2),e=251719695&(e|e>>>4),e=4278190335&(e|e>>>8),e=1023&(e|e>>>16),e<<22>>22},r.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>i(e)+1}},{}],35:[function(e,t,r){"use strict";"use restrict";function i(e){this.roots=new Array(e),this.ranks=new Array(e);for(var t=0;t<e;++t)this.roots[t]=t,this.ranks[t]=0}t.exports=i;var n=i.prototype;Object.defineProperty(n,"length",{get:function(){return this.roots.length}}),n.makeSet=function(){var e=this.roots.length;return this.roots.push(e),this.ranks.push(0),e},n.find=function(e){for(var t=e,r=this.roots;r[e]!==e;)e=r[e];for(;r[t]!==e;){var i=r[t];r[t]=e,t=i}return e},n.link=function(e,t){var r=this.find(e),i=this.find(t);if(r!==i){var n=this.ranks,o=this.roots,a=n[r],s=n[i];a<s?o[r]=i:s<a?o[i]=r:(o[i]=r,++n[r])}}},{}],36:[function(e,t,r){"use strict";"use restrict";function i(e){for(var t=0,r=Math.max,i=0,n=e.length;i<n;++i)t=r(t,e[i].length);return t-1}function n(e){for(var t=-1,r=Math.max,i=0,n=e.length;i<n;++i)for(var o=e[i],a=0,s=o.length;a<s;++a)t=r(t,o[a]);return t+1}function o(e){for(var t=new Array(e.length),r=0,i=e.length;r<i;++r)t[r]=e[r].slice(0);return t}function a(e,t){var r=e.length,i=e.length-t.length,n=Math.min;if(i)return i;switch(r){case 0:return 0;case 1:return e[0]-t[0];case 2:var o=e[0]+e[1]-t[0]-t[1];return o?o:n(e[0],e[1])-n(t[0],t[1]);case 3:var a=e[0]+e[1],s=t[0]+t[1];if(o=a+e[2]-(s+t[2]))return o;var c=n(e[0],e[1]),l=n(t[0],t[1]),o=n(c,e[2])-n(l,t[2]);return o?o:n(c+e[2],a)-n(l+t[2],s);default:var h=e.slice(0);h.sort();var u=t.slice(0);u.sort();for(var f=0;f<r;++f)if(i=h[f]-u[f])return i;return 0}}function s(e,t){return a(e[0],t[0])}function c(e,t){if(t){for(var r=e.length,i=new Array(r),n=0;n<r;++n)i[n]=[e[n],t[n]];i.sort(s);for(var n=0;n<r;++n)e[n]=i[n][0],t[n]=i[n][1];return e}return e.sort(a),e}function l(e){if(0===e.length)return[];for(var t=1,r=e.length,i=1;i<r;++i){var n=e[i];if(a(n,e[i-1])){if(i===t){t++;continue}e[t++]=n}}return e.length=t,e}function h(e,t){for(var r=0,i=e.length-1,n=-1;r<=i;){var o=r+i>>1,s=a(e[o],t);s<=0?(0===s&&(n=o),r=o+1):s>0&&(i=o-1)}return n}function u(e,t){for(var r=new Array(e.length),i=0,n=r.length;i<n;++i)r[i]=[];for(var o=[],i=0,s=t.length;i<s;++i)for(var c=t[i],l=c.length,u=1,f=1<<l;u<f;++u){o.length=x.popCount(u);for(var p=0,d=0;d<l;++d)u&1<<d&&(o[p++]=c[d]);var m=h(e,o);if(!(m<0))for(;;)if(r[m++].push(i),m>=e.length||0!==a(e[m],o))break}return r}function f(e,t){if(!t)return u(l(d(e,0)),e,0);for(var r=new Array(t),i=0;i<t;++i)r[i]=[];for(var i=0,n=e.length;i<n;++i)for(var o=e[i],a=0,s=o.length;a<s;++a)r[o[a]].push(i);return r}function p(e){for(var t=[],r=0,i=e.length;r<i;++r)for(var n=e[r],o=0|n.length,a=1,s=1<<o;a<s;++a){for(var l=[],h=0;h<o;++h)a>>>h&1&&l.push(n[h]);t.push(l)}return c(t)}function d(e,t){if(t<0)return[];for(var r=[],i=(1<<t+1)-1,n=0;n<e.length;++n)for(var o=e[n],a=i;a<1<<o.length;a=x.nextCombination(a)){for(var s=new Array(t+1),l=0,h=0;h<o.length;++h)a&1<<h&&(s[l++]=o[h]);r.push(s)}return c(r)}function m(e){for(var t=[],r=0,i=e.length;r<i;++r)for(var n=e[r],o=0,a=n.length;o<a;++o){for(var s=new Array(n.length-1),l=0,h=0;l<a;++l)l!==o&&(s[h++]=n[l]);t.push(s)}return c(t)}function v(e,t){for(var r=new _(t),i=0;i<e.length;++i)for(var n=e[i],o=0;o<n.length;++o)for(var a=o+1;a<n.length;++a)r.link(n[o],n[a]);for(var s=[],c=r.ranks,i=0;i<c.length;++i)c[i]=-1;for(var i=0;i<e.length;++i){var l=r.find(e[i][0]);c[l]<0?(c[l]=s.length,s.push([e[i].slice(0)])):s[c[l]].push(e[i].slice(0))}return s}function g(e){for(var t=l(c(d(e,0))),r=new _(t.length),i=0;i<e.length;++i)for(var n=e[i],o=0;o<n.length;++o)for(var a=h(t,[n[o]]),s=o+1;s<n.length;++s)r.link(a,h(t,[n[s]]));for(var u=[],f=r.ranks,i=0;i<f.length;++i)f[i]=-1;for(var i=0;i<e.length;++i){var p=r.find(h(t,[e[i][0]]));f[p]<0?(f[p]=u.length,u.push([e[i].slice(0)])):u[f[p]].push(e[i].slice(0))}return u}function y(e,t){return t?v(e,t):g(e)}var x=e("bit-twiddle"),_=e("union-find");r.dimension=i,r.countVertices=n,r.cloneCells=o,r.compareCells=a,r.normalize=c,r.unique=l,r.findCell=h,r.incidence=u,r.dual=f,r.explode=p,r.skeleton=d,r.boundary=m,r.connectedComponents=y},{"bit-twiddle":34,"union-find":35}],37:[function(e,t,r){"use strict";function i(e,t){for(var r=1,i=e.length,n=e[0],o=e[0],a=1;a<i;++a)if(o=n,n=e[a],t(n,o)){if(a===r){r++;continue}e[r++]=n}return e.length=r,e}function n(e){for(var t=1,r=e.length,i=e[0],n=e[0],o=1;o<r;++o,n=i)if(n=i,i=e[o],i!==n){if(o===t){t++;continue}e[t++]=i}return e.length=t,e}function o(e,t,r){return 0===e.length?e:t?(r||e.sort(t),i(e,t)):(r||e.sort(),n(e))}t.exports=o},{}],38:[function(e,t,r){"use strict";function i(e,t){this.point=e,this.index=t}function n(e,t){for(var r=e.point,i=t.point,n=r.length,o=0;o<n;++o){var a=i[o]-r[o];if(a)return a}return 0}function o(e,t,r){if(1===e)return r?[[-1,0]]:[];var i=t.map(function(e,t){return[e[0],t]});i.sort(function(e,t){return e[0]-t[0]});for(var n=new Array(e-1),o=1;o<e;++o){var a=i[o-1],s=i[o];n[o-1]=[a[1],s[1]]}return r&&n.push([-1,n[0][1]],[n[e-1][1],-1]),n}function a(e,t){var r=e.length;if(0===r)return[];var a=e[0].length;if(a<1)return[];if(1===a)return o(r,e,t);for(var l=new Array(r),h=1,u=0;u<r;++u){for(var f=e[u],p=new Array(a+1),d=0,m=0;m<a;++m){var v=f[m];p[m]=v,d+=v*v}p[a]=d,l[u]=new i(p,u),h=Math.max(d,h)}c(l,n),r=l.length;for(var g=new Array(r+a+1),y=new Array(r+a+1),x=(a+1)*(a+1)*h,_=new Array(a+1),u=0;u<=a;++u)_[u]=0;_[a]=x,g[0]=_.slice(),y[0]=-1;for(var u=0;u<=a;++u){var p=_.slice();p[u]=1,g[u+1]=p,y[u+1]=-1}for(var u=0;u<r;++u){var b=l[u];g[u+a+1]=b.point,y[u+a+1]=b.index}var w=s(g,!1);if(w=t?w.filter(function(e){for(var t=0,r=0;r<=a;++r){var i=y[e[r]];if(i<0&&++t>=2)return!1;e[r]=i}return!0}):w.filter(function(e){for(var t=0;t<=a;++t){var r=y[e[t]];if(r<0)return!1;e[t]=r}return!0}),1&a)for(var u=0;u<w.length;++u){var b=w[u],p=b[0];b[0]=b[1],b[1]=p}return w}var s=e("incremental-convex-hull"),c=e("uniq");t.exports=a},{"incremental-convex-hull":27,uniq:37}],39:[function(require,module,exports){(function(global){"use strict";var numeric="undefined"==typeof exports?function(){}:exports;"undefined"!=typeof global&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var r,i,n,o;for("undefined"==typeof t&&(t=15),n=.5,r=new Date;;){for(n*=2,o=n;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;if(i=new Date,i-r>t)break}for(o=n;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;return i=new Date,1e3*(3*n-1)/(i-r)},numeric._myIndexOf=function(e){var t,r=this.length;for(t=0;t<r;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var r=Math.floor(Math.log(e)/Math.log(10)),i=e/Math.pow(10,r),n=i.toPrecision(numeric.precision);return 10===parseFloat(n)&&(r++,i=1,n=i.toPrecision(numeric.precision)),parseFloat(n).toString()+"e"+r.toString()}return"Infinity"}function r(e){var n;if("undefined"==typeof e)return i.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof e)return i.push('"'+e+'"'),!1;if("boolean"==typeof e)return i.push(e.toString()),!1;if("number"==typeof e){var o=t(e),a=e.toPrecision(numeric.precision),s=parseFloat(e.toString()).toString(),c=[o,a,s,parseFloat(a).toString(),parseFloat(s).toString()];for(n=1;n<c.length;n++)c[n].length<o.length&&(o=c[n]);return i.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===e)return i.push("null"),!1;if("function"==typeof e){i.push(e.toString());var l=!1;for(n in e)e.hasOwnProperty(n)&&(l?i.push(",\n"):i.push("\n{"),l=!0,i.push(n),i.push(": \n"),r(e[n]));return l&&i.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return i.push("...Large Array..."),!0;var l=!1;for(i.push("["),n=0;n<e.length;n++)n>0&&(i.push(","),l&&i.push("\n ")),l=r(e[n]);return i.push("]"),!0}i.push("{");var l=!1;for(n in e)e.hasOwnProperty(n)&&(l&&i.push(",\n"),l=!0,i.push(n),i.push(": \n"),r(e[n]));return i.push("}"),!0}var i=[];return r(e),i.join("")},numeric.parseDate=function(e){function t(e){if("string"==typeof e)return Date.parse(e.replace(/-/g,"/"));if(!(e instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var r,i=[];for(r=0;r<e.length;r++)i[r]=t(e[r]);return i}return t(e)},numeric.parseFloat=function(e){function t(e){if("string"==typeof e)return parseFloat(e);if(!(e instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var r,i=[];for(r=0;r<e.length;r++)i[r]=t(e[r]);return i}return t(e)},numeric.parseCSV=function(e){var t,r,i=e.split("\n"),n=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,a=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,s=function(e){return e.substr(0,e.length-1)},c=0;for(r=0;r<i.length;r++){var l,h=(i[r]+",").match(o);if(h.length>0){for(n[c]=[],t=0;t<h.length;t++)l=s(h[t]),a.test(l)?n[c][t]=parseFloat(l):n[c][t]=l;c++}}return n},numeric.toCSV=function(e){var t,r,i,n,o,a,s=numeric.dim(e);for(i=s[0],n=s[1],a=[],t=0;t<i;t++){for(o=[],r=0;r<i;r++)o[r]=e[t][r].toString();a[t]=o.join(", ")}return a.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e){var t,r,i,n,o,a,s,c,l=e.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="";for(t=0;t<l;t+=3)r=e[t],i=e[t+1],n=e[t+2],o=r>>2,a=((3&r)<<4)+(i>>4),s=((15&i)<<2)+(n>>6),c=63&n,t+1>=l?s=c=64:t+2>=l&&(c=64),u+=h.charAt(o)+h.charAt(a)+h.charAt(s)+h.charAt(c);return u}function r(e,t,r){"undefined"==typeof t&&(t=0),"undefined"==typeof r&&(r=e.length);var i,n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1,a=0;
e.length;for(i=t;i<r;i++)a=255&(o^e[i]),o=o>>>8^n[a];return o^-1}var i,n,o,a,s,c,l,h,u,f,p=e[0].length,d=e[0][0].length,m=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,d>>24&255,d>>16&255,d>>8&255,255&d,p>>24&255,p>>16&255,p>>8&255,255&p,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(f=r(m,12,29),m[29]=f>>24&255,m[30]=f>>16&255,m[31]=f>>8&255,m[32]=255&f,i=1,n=0,l=0;l<p;l++){for(l<p-1?m.push(0):m.push(1),s=3*d+1+(0===l)&255,c=3*d+1+(0===l)>>8&255,m.push(s),m.push(c),m.push(255&~s),m.push(255&~c),0===l&&m.push(0),h=0;h<d;h++)for(o=0;o<3;o++)s=e[o][l][h],s=s>255?255:s<0?0:Math.round(s),i=(i+s)%65521,n=(n+i)%65521,m.push(s);m.push(0)}return u=(n<<16)+i,m.push(u>>24&255),m.push(u>>16&255),m.push(u>>8&255),m.push(255&u),a=m.length-41,m[33]=a>>24&255,m[34]=a>>16&255,m[35]=a>>8&255,m[36]=255&a,f=r(m,37),m.push(f>>24&255),m.push(f>>16&255),m.push(f>>8&255),m.push(255&f),m.push(0),m.push(0),m.push(0),m.push(0),m.push(73),m.push(69),m.push(78),m.push(68),m.push(174),m.push(66),m.push(96),m.push(130),"data:image/png;base64,"+t(m)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t,r;return"object"==typeof e?(t=e[0],"object"==typeof t?(r=t[0],"object"==typeof r?numeric._dim(e):[e.length,t.length]):[e.length]):[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,r){var i,n;if(!(t instanceof Array&&r instanceof Array))return!1;if(n=t.length,n!==r.length)return!1;for(i=0;i<n;i++)if(t[i]!==r[i]){if("object"!=typeof t[i])return!1;if(!e(t[i],r[i]))return!1}return!0},numeric.rep=function(e,t,r){"undefined"==typeof r&&(r=0);var i,n=e[r],o=Array(n);if(r===e.length-1){for(i=n-2;i>=0;i-=2)o[i+1]=t,o[i]=t;return i===-1&&(o[0]=t),o}for(i=n-1;i>=0;i--)o[i]=numeric.rep(e,t,r+1);return o},numeric.dotMMsmall=function(e,t){var r,i,n,o,a,s,c,l,h,u,f;for(o=e.length,a=t.length,s=t[0].length,c=Array(o),r=o-1;r>=0;r--){for(l=Array(s),h=e[r],n=s-1;n>=0;n--){for(u=h[a-1]*t[a-1][n],i=a-2;i>=1;i-=2)f=i-1,u+=h[i]*t[i][n]+h[f]*t[f][n];0===i&&(u+=h[0]*t[0][n]),l[n]=u}c[r]=l}return c},numeric._getCol=function(e,t,r){var i,n=e.length;for(i=n-1;i>0;--i)r[i]=e[i][t],--i,r[i]=e[i][t];0===i&&(r[0]=e[0][t])},numeric.dotMMbig=function(e,t){var r,i,n,o,a=numeric._getCol,s=t.length,c=Array(s),l=e.length,h=t[0].length,u=new Array(l),f=numeric.dotVV;for(--s,--l,i=l;i!==-1;--i)u[i]=Array(h);for(--h,i=h;i!==-1;--i)for(a(t,i,c),n=l;n!==-1;--n)o=0,r=e[n],u[n][i]=f(r,c);return u},numeric.dotMV=function(e,t){var r,i=e.length,n=(t.length,Array(i)),o=numeric.dotVV;for(r=i-1;r>=0;r--)n[r]=o(e[r],t);return n},numeric.dotVM=function(e,t){var r,i,n,o,a,s,c;for(n=e.length,o=t[0].length,a=Array(o),i=o-1;i>=0;i--){for(s=e[n-1]*t[n-1][i],r=n-2;r>=1;r-=2)c=r-1,s+=e[r]*t[r][i]+e[c]*t[c][i];0===r&&(s+=e[0]*t[0][i]),a[i]=s}return a},numeric.dotVV=function(e,t){var r,i,n=e.length,o=e[n-1]*t[n-1];for(r=n-2;r>=1;r-=2)i=r-1,o+=e[r]*t[r]+e[i]*t[i];return 0===r&&(o+=e[0]*t[0]),o},numeric.dot=function(e,t){var r=numeric.dim;switch(1e3*r(e).length+r(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,r,i,n,o=e.length,a=Array(o);for(t=o-1;t>=0;t--){for(n=Array(o),r=t+2,i=o-1;i>=r;i-=2)n[i]=0,n[i-1]=0;for(i>t&&(n[i]=0),n[t]=e[t],i=t-1;i>=1;i-=2)n[i]=0,n[i-1]=0;0===i&&(n[0]=0),a[t]=n}return a},numeric.getDiag=function(e){var t,r=Math.min(e.length,e[0].length),i=Array(r);for(t=r-1;t>=1;--t)i[t]=e[t][t],--t,i[t]=e[t][t];return 0===t&&(i[0]=e[0][0]),i},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,r){"undefined"==typeof r&&(r="");var i,n,o=[],a=/\[i\]$/,s="",c=!1;for(i=0;i<e.length;i++)a.test(e[i])?(n=e[i].substring(0,e[i].length-3),s=n):n=e[i],"ret"===n&&(c=!0),o.push(n);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+s+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(c?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,t,r){"undefined"==typeof r&&(r="");var i,n,o=[],a=/\[i\]$/,s="",c=!1;for(i=0;i<e.length;i++)a.test(e[i])?(n=e[i].substring(0,e[i].length-3),s=n):n=e[i],"ret"===n&&(c=!0),o.push(n);return o[e.length]="var _n = "+s+".length;\nvar i"+(c?"":", ret = Array(_n)")+";\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function t(e,r,i,n,o){if(n===i.length-1)return void o(e,r);var a,s=i[n];for(a=s-1;a>=0;a--)t("object"==typeof e?e[a]:e,"object"==typeof r?r[a]:r,i,n+1,o)},numeric._biforeach2=function r(e,t,i,n,o){if(n===i.length-1)return o(e,t);var a,s=i[n],c=Array(s);for(a=s-1;a>=0;--a)c[a]=r("object"==typeof e?e[a]:e,"object"==typeof t?t[a]:t,i,n+1,o);return c},numeric._foreach=function i(e,t,r,n){if(r===t.length-1)return void n(e);var o,a=t[r];for(o=a-1;o>=0;o--)i(e[o],t,r+1,n)},numeric._foreach2=function n(e,t,r,i){if(r===t.length-1)return i(e);var o,a=t[r],s=Array(a);for(o=a-1;o>=0;o--)s[o]=n(e[o],t,r+1,i);return s},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var r,i,n="";numeric.myIndexOf.call(numeric.mathfuns2,e)!==-1?(n="var "+t+" = Math."+t+";\n",r=function(e,r,i){return e+" = "+t+"("+r+","+i+")"},i=function(e,r){return e+" = "+t+"("+e+","+r+")"}):(r=function(e,r,i){return e+" = "+r+" "+t+" "+i},i=numeric.opseq.hasOwnProperty(e+"eq")?function(e,r){return e+" "+t+"= "+r}:function(e,r){return e+" = "+e+" "+t+" "+r}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],r("ret[i]","x[i]","y[i]"),n),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],r("ret[i]","x","y[i]"),n),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],r("ret[i]","x[i]","y"),n),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+i("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],i("ret[i]","x[i]"),n),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],i("ret[i]","x"),n),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(n="",t=numeric.ops1[e],numeric.myIndexOf.call(numeric.mathfuns,e)!==-1&&Math.hasOwnProperty(t)&&(n="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",n),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",n),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,r,i,n,o,a,s,e,c=numeric.dim(e),l=Math.abs,h=c[0],u=c[1],f=numeric.clone(e),p=numeric.identity(h);for(a=0;a<u;++a){var d=-1,m=-1;for(o=a;o!==h;++o)s=l(f[o][a]),s>m&&(d=o,m=s);for(r=f[d],f[d]=f[a],f[a]=r,n=p[d],p[d]=p[a],p[a]=n,e=r[a],s=a;s!==u;++s)r[s]/=e;for(s=u-1;s!==-1;--s)n[s]/=e;for(o=h-1;o!==-1;--o)if(o!==a){for(t=f[o],i=p[o],e=t[a],s=a+1;s!==u;++s)t[s]-=r[s]*e;for(s=u-1;s>0;--s)i[s]-=n[s]*e,--s,i[s]-=n[s]*e;0===s&&(i[0]-=n[0]*e)}}return p},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var r,i,n,o,a,s,c,l,h=t[0],u=1,f=numeric.clone(e);for(i=0;i<h-1;i++){for(n=i,r=i+1;r<h;r++)Math.abs(f[r][i])>Math.abs(f[n][i])&&(n=r);for(n!==i&&(c=f[n],f[n]=f[i],f[i]=c,u*=-1),o=f[i],r=i+1;r<h;r++){for(a=f[r],s=a[i]/o[i],n=i+1;n<h-1;n+=2)l=n+1,a[n]-=o[n]*s,a[l]-=o[l]*s;n!==h&&(a[n]-=o[n]*s)}if(0===o[i])return 0;u*=o[i]}return u*f[i][i]},numeric.transpose=function(e){var t,r,i,n,o,a=e.length,s=e[0].length,c=Array(s);for(r=0;r<s;r++)c[r]=Array(a);for(t=a-1;t>=1;t-=2){for(n=e[t],i=e[t-1],r=s-1;r>=1;--r)o=c[r],o[t]=n[r],o[t-1]=i[r],--r,o=c[r],o[t]=n[r],o[t-1]=i[r];0===r&&(o=c[0],o[t]=n[0],o[t-1]=i[0])}if(0===t){for(i=e[0],r=s-1;r>=1;--r)c[r][0]=i[r],--r,c[r][0]=i[r];0===r&&(c[0][0]=i[0])}return c},numeric.negtranspose=function(e){var t,r,i,n,o,a=e.length,s=e[0].length,c=Array(s);for(r=0;r<s;r++)c[r]=Array(a);for(t=a-1;t>=1;t-=2){for(n=e[t],i=e[t-1],r=s-1;r>=1;--r)o=c[r],o[t]=-n[r],o[t-1]=-i[r],--r,o=c[r],o[t]=-n[r],o[t-1]=-i[r];0===r&&(o=c[0],o[t]=-n[0],o[t-1]=-i[0])}if(0===t){for(i=e[0],r=s-1;r>=1;--r)c[r][0]=-i[r],--r,c[r][0]=-i[r];0===r&&(c[0][0]=-i[0])}return c},numeric._random=function o(e,t){var r,i,n=e[t],a=Array(n);if(t===e.length-1){for(i=Math.random,r=n-1;r>=1;r-=2)a[r]=i(),a[r-1]=i();return 0===r&&(a[0]=i()),a}for(r=n-1;r>=0;r--)a[r]=o(e,t+1);return a},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,r){if("undefined"==typeof r&&(r=Math.max(Math.round(t-e)+1,1)),r<2)return 1===r?[e]:[];var i,n=Array(r);for(r--,i=r;i>=0;i--)n[i]=(i*t+(r-i)*e)/r;return n},numeric.getBlock=function(e,t,r){function i(e,o){var a,s=t[o],c=r[o]-s,l=Array(c);if(o===n.length-1){for(a=c;a>=0;a--)l[a]=e[a+s];return l}for(a=c;a>=0;a--)l[a]=i(e[a+s],o+1);return l}var n=numeric.dim(e);return i(e,0)},numeric.setBlock=function(e,t,r,i){function n(e,i,a){var s,c=t[a],l=r[a]-c;if(a===o.length-1)for(s=l;s>=0;s--)e[s+c]=i[s];for(s=l;s>=0;s--)n(e[s+c],i[s],a+1)}var o=numeric.dim(e);return n(e,i,0),e},numeric.getRange=function(e,t,r){var i,n,o,a,s=t.length,c=r.length,l=Array(s);for(i=s-1;i!==-1;--i)for(l[i]=Array(c),o=l[i],a=e[t[i]],n=c-1;n!==-1;--n)o[n]=a[r[n]];return l},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var r,i,n,o,a,s=t[0],c=t[1];for(r=0,i=0,n=0;n<s;++n)r+=e[n][0].length;for(o=0;o<c;++o)i+=e[0][o][0].length;var l=Array(r);for(n=0;n<r;++n)l[n]=Array(i);var h,u,f,p,d,m=0;for(n=0;n<s;++n){for(h=i,o=c-1;o!==-1;--o)for(a=e[n][o],h-=a[0].length,f=a.length-1;f!==-1;--f)for(d=a[f],u=l[m+f],p=d.length-1;p!==-1;--p)u[h+p]=d[p];m+=e[n][0].length}return l},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var r=numeric.dim(e),i=numeric.dim(t);if(1!==r.length||1!==i.length)throw new Error("numeric: tensor product is only defined for vectors");var n,o,a,s,c=r[0],l=i[0],h=Array(c);for(o=c-1;o>=0;o--){for(n=Array(l),s=e[o],a=l-1;a>=3;--a)n[a]=s*t[a],--a,n[a]=s*t[a],--a,n[a]=s*t[a],--a,n[a]=s*t[a];for(;a>=0;)n[a]=s*t[a],--a;h[o]=n}return h},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,r,i,n){numeric.indexOf;if("string"!=typeof n){var o;n="";for(o in numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||t.indexOf(o)>=0||r.indexOf(o)>=0||i.indexOf(o)>=0)&&o.length>1&&(n+="var "+o+" = numeric."+o+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+n+"\nif(x.y) {  if(y.y) {    return new numeric.T("+i+");\n  }\n  return new numeric.T("+r+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var r=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,r),t(numeric.neg(this.y),r))}return new T(t(1,this.x))},numeric.T.prototype.div=function a(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var a=numeric.div;return this.y?new numeric.T(a(this.x,e.x),a(this.y,e.x)):new numeric.T(a(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,r=this.y;return r?new numeric.T(e(t),e(r)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,r=this.y;return r?new numeric.T(e(t),numeric.negtranspose(r)):new numeric.T(e(t))},numeric.Tunop=function(e,t,r){return"string"!=typeof r&&(r=""),Function("var x = this;\n"+r+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if("undefined"==typeof e.y)return new numeric.T(numeric.inv(e.x));var t,r,i,n,o,a,s,c,l,h,u,t,r,i,f,p,d,m,v,g,y,x=e.x.length,_=numeric.identity(x),b=numeric.rep([x,x],0),w=numeric.clone(e.x),M=numeric.clone(e.y);for(t=0;t<x;t++){for(d=w[t][t],m=M[t][t],f=d*d+m*m,i=t,r=t+1;r<x;r++)d=w[r][t],m=M[r][t],p=d*d+m*m,p>f&&(i=r,f=p);for(i!==t&&(y=w[t],w[t]=w[i],w[i]=y,y=M[t],M[t]=M[i],M[i]=y,y=_[t],_[t]=_[i],_[i]=y,y=b[t],b[t]=b[i],b[i]=y),n=w[t],o=M[t],c=_[t],l=b[t],d=n[t],m=o[t],r=t+1;r<x;r++)v=n[r],g=o[r],n[r]=(v*d+g*m)/f,o[r]=(g*d-v*m)/f;for(r=0;r<x;r++)v=c[r],g=l[r],c[r]=(v*d+g*m)/f,l[r]=(g*d-v*m)/f;for(r=t+1;r<x;r++){for(a=w[r],s=M[r],h=_[r],u=b[r],d=a[t],m=s[t],i=t+1;i<x;i++)v=n[i],g=o[i],a[i]-=v*d-g*m,s[i]-=g*d+v*m;for(i=0;i<x;i++)v=c[i],g=l[i],h[i]-=v*d-g*m,u[i]-=g*d+v*m}}for(t=x-1;t>0;t--)for(c=_[t],l=b[t],r=t-1;r>=0;r--)for(h=_[r],u=b[r],d=w[r][t],m=M[r][t],i=x-1;i>=0;i--)v=c[i],g=l[i],h[i]-=d*v-m*g,u[i]-=d*g+m*v;return new numeric.T(_,b)},numeric.T.prototype.get=function(e){var t,r=this.x,i=this.y,n=0,o=e.length;if(i){for(;n<o;)t=e[n],r=r[t],i=i[t],n++;return new numeric.T(r,i)}for(;n<o;)t=e[n],r=r[t],n++;return new numeric.T(r)},numeric.T.prototype.set=function(e,t){var r,i=this.x,n=this.y,o=0,a=e.length,s=t.x,c=t.y;if(0===a)return c?this.y=c:n&&(this.y=void 0),this.x=i,this;if(c){for(n||(n=numeric.rep(numeric.dim(i),0),this.y=n);o<a-1;)r=e[o],i=i[r],n=n[r],o++;return r=e[o],i[r]=s,n[r]=c,this}if(n){for(;o<a-1;)r=e[o],i=i[r],n=n[r],o++;return r=e[o],i[r]=s,s instanceof Array?n[r]=numeric.rep(numeric.dim(s),0):n[r]=0,this}for(;o<a-1;)r=e[o],i=i[r],o++;return r=e[o],i[r]=s,this},numeric.T.prototype.getRows=function(e,t){var r,i,n=t-e+1,o=Array(n),a=this.x,s=this.y;for(r=e;r<=t;r++)o[r-e]=a[r];if(s){for(i=Array(n),r=e;r<=t;r++)i[r-e]=s[r];return new numeric.T(o,i)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,t,r){var i,n=this.x,o=this.y,a=r.x,s=r.y;for(i=e;i<=t;i++)n[i]=a[i-e];if(s)for(o||(o=numeric.rep(numeric.dim(n),0),this.y=o),i=e;i<=t;i++)o[i]=s[i-e];else if(o)for(i=e;i<=t;i++)o[i]=numeric.rep([a[i-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,r=this.y;return r?new numeric.T(t[e],r[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var r=this.x,i=this.y,n=t.x,o=t.y;return r[e]=n,o?(i||(i=numeric.rep(numeric.dim(r),0),this.y=i),i[e]=o):i&&(i=numeric.rep([n.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var r=this.x,i=this.y,n=numeric.getBlock;return i?new numeric.T(n(r,e,t),n(i,e,t)):new numeric.T(n(r,e,t))},numeric.T.prototype.setBlock=function(e,t,r){r instanceof numeric.T||(r=new numeric.T(r));var i=this.x,n=this.y,o=numeric.setBlock,a=r.x,s=r.y;return s?(n||(this.y=numeric.rep(numeric.dim(this),0),n=this.y),o(i,e,t,a),o(n,e,t,s),this):(o(i,e,t,a),void(n&&o(n,e,t,numeric.rep(numeric.dim(a),0))))},numeric.T.rep=function(e,t){var r=numeric.T;t instanceof r||(t=new r(t));var i=t.x,n=t.y,o=numeric.rep;return n?new r(o(e,i),o(e,n)):new r(o(e,i))},numeric.T.diag=function s(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,r=e.y,s=numeric.diag;return r?new numeric.T(s(t),s(r)):new numeric.T(s(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,r=this.y;return r?new e.T(e.getDiag(t),e.getDiag(r)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),r=e[0]>=0?1:-1,i=r*numeric.norm2(e);t[0]+=i;var n=numeric.norm2(t);if(0===n)throw new Error("eig: internal error");return numeric.div(t,n)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var r,i,n,o,a,s,c,l,h,u,f=t[0],p=numeric.clone(e),d=numeric.identity(f);for(i=0;i<f-2;i++){for(o=Array(f-i-1),r=i+1;r<f;r++)o[r-i-1]=p[r][i];if(numeric.norm2(o)>0){for(a=numeric.house(o),s=numeric.getBlock(p,[i+1,i],[f-1,f-1]),c=numeric.tensor(a,numeric.dot(a,s)),r=i+1;r<f;r++)for(l=p[r],h=c[r-i-1],n=i;n<f;n++)l[n]-=2*h[n-i];for(s=numeric.getBlock(p,[0,i+1],[f-1,f-1]),c=numeric.tensor(numeric.dot(s,a),a),r=0;r<f;r++)for(l=p[r],h=c[r],n=i+1;n<f;n++)l[n]-=2*h[n-i-1];for(s=Array(f-i-1),r=i+1;r<f;r++)s[r-i-1]=d[r];for(c=numeric.tensor(a,numeric.dot(a,s)),r=i+1;r<f;r++)for(u=d[r],h=c[r-i-1],n=0;n<f;n++)u[n]-=2*h[n]}}return{H:p,Q:d}},numeric.epsilon=2.220446049250313e-16,numeric.QRFrancis=function(e,t){"undefined"==typeof t&&(t=1e4),e=numeric.clone(e);var r,i,n,o,a,s,c,l,h,u,f,p,d,m,v,g,y,x,_=(numeric.clone(e),numeric.dim(e)),b=_[0],w=numeric.identity(b);if(b<3)return{Q:w,B:[[0,b-1]]};var M=numeric.epsilon;for(x=0;x<t;x++){for(g=0;g<b-1;g++)if(Math.abs(e[g+1][g])<M*(Math.abs(e[g][g])+Math.abs(e[g+1][g+1]))){var S=numeric.QRFrancis(numeric.getBlock(e,[0,0],[g,g]),t),A=numeric.QRFrancis(numeric.getBlock(e,[g+1,g+1],[b-1,b-1]),t);for(p=Array(g+1),v=0;v<=g;v++)p[v]=w[v];for(d=numeric.dot(S.Q,p),v=0;v<=g;v++)w[v]=d[v];for(p=Array(b-g-1),v=g+1;v<b;v++)p[v-g-1]=w[v];for(d=numeric.dot(A.Q,p),v=g+1;v<b;v++)w[v]=d[v-g-1];return{Q:w,B:S.B.concat(numeric.add(A.B,g+1))}}if(n=e[b-2][b-2],o=e[b-2][b-1],a=e[b-1][b-2],s=e[b-1][b-1],l=n+s,c=n*s-o*a,h=numeric.getBlock(e,[0,0],[2,2]),l*l>=4*c){var C,T;C=.5*(l+Math.sqrt(l*l-4*c)),T=.5*(l-Math.sqrt(l*l-4*c)),h=numeric.add(numeric.sub(numeric.dot(h,h),numeric.mul(h,C+T)),numeric.diag(numeric.rep([3],C*T)))}else h=numeric.add(numeric.sub(numeric.dot(h,h),numeric.mul(h,l)),numeric.diag(numeric.rep([3],c)));for(r=[h[0][0],h[1][0],h[2][0]],i=numeric.house(r),p=[e[0],e[1],e[2]],d=numeric.tensor(i,numeric.dot(i,p)),v=0;v<3;v++)for(f=e[v],m=d[v],y=0;y<b;y++)f[y]-=2*m[y];for(p=numeric.getBlock(e,[0,0],[b-1,2]),d=numeric.tensor(numeric.dot(p,i),i),v=0;v<b;v++)for(f=e[v],m=d[v],y=0;y<3;y++)f[y]-=2*m[y];for(p=[w[0],w[1],w[2]],d=numeric.tensor(i,numeric.dot(i,p)),v=0;v<3;v++)for(u=w[v],m=d[v],y=0;y<b;y++)u[y]-=2*m[y];var E;for(g=0;g<b-2;g++){for(y=g;y<=g+1;y++)if(Math.abs(e[y+1][y])<M*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){var S=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),A=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[b-1,b-1]),t);for(p=Array(y+1),v=0;v<=y;v++)p[v]=w[v];for(d=numeric.dot(S.Q,p),v=0;v<=y;v++)w[v]=d[v];for(p=Array(b-y-1),v=y+1;v<b;v++)p[v-y-1]=w[v];for(d=numeric.dot(A.Q,p),v=y+1;v<b;v++)w[v]=d[v-y-1];return{Q:w,B:S.B.concat(numeric.add(A.B,y+1))}}for(E=Math.min(b-1,g+3),r=Array(E-g),v=g+1;v<=E;v++)r[v-g-1]=e[v][g];for(i=numeric.house(r),p=numeric.getBlock(e,[g+1,g],[E,b-1]),d=numeric.tensor(i,numeric.dot(i,p)),v=g+1;v<=E;v++)for(f=e[v],m=d[v-g-1],y=g;y<b;y++)f[y]-=2*m[y-g];for(p=numeric.getBlock(e,[0,g+1],[b-1,E]),d=numeric.tensor(numeric.dot(p,i),i),v=0;v<b;v++)for(f=e[v],m=d[v],y=g+1;y<=E;y++)f[y]-=2*m[y-g-1];for(p=Array(E-g),v=g+1;v<=E;v++)p[v-g-1]=w[v];for(d=numeric.tensor(i,numeric.dot(i,p)),v=g+1;v<=E;v++)for(u=w[v],m=d[v-g-1],y=0;y<b;y++)u[y]-=2*m[y]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var r,i,n,o,a,s,c,l,h,u,f,p,d,m,v,g,y,x=numeric.toUpperHessenberg(e),_=numeric.QRFrancis(x.H,t),b=numeric.T,w=e.length,M=_.B,S=numeric.dot(_.Q,numeric.dot(x.H,numeric.transpose(_.Q))),A=new b(numeric.dot(_.Q,x.Q)),C=M.length,T=Math.sqrt;for(i=0;i<C;i++)if(r=M[i][0],r===M[i][1]);else{if(o=r+1,a=S[r][r],s=S[r][o],c=S[o][r],l=S[o][o],0===s&&0===c)continue;h=-a-l,u=a*l-s*c,f=h*h-4*u,f>=0?(p=h<0?-.5*(h-T(f)):-.5*(h+T(f)),g=(a-p)*(a-p)+s*s,y=c*c+(l-p)*(l-p),g>y?(g=T(g),m=(a-p)/g,v=s/g):(y=T(y),m=c/y,v=(l-p)/y),n=new b([[v,-m],[m,v]]),A.setRows(r,o,n.dot(A.getRows(r,o)))):(p=-.5*h,d=.5*T(-f),g=(a-p)*(a-p)+s*s,y=c*c+(l-p)*(l-p),g>y?(g=T(g+d*d),m=(a-p)/g,v=s/g,p=0,d/=g):(y=T(y+d*d),m=c/y,v=(l-p)/y,p=d/y,d=0),n=new b([[v,-m],[m,v]],[[p,d],[d,-p]]),A.setRows(r,o,n.dot(A.getRows(r,o))))}var E=A.dot(e).dot(A.transjugate()),w=e.length,L=numeric.T.identity(w);for(o=0;o<w;o++)if(o>0)for(i=o-1;i>=0;i--){var P=E.get([i,i]),R=E.get([o,o]);numeric.neq(P.x,R.x)||numeric.neq(P.y,R.y)?(p=E.getRow(i).getBlock([i],[o-1]),d=L.getRow(o).getBlock([i],[o-1]),L.set([o,i],E.get([i,o]).neg().sub(p.dot(d)).div(P.sub(R)))):L.setRow(o,L.getRow(i))}for(o=0;o<w;o++)p=L.getRow(o),L.setRow(o,p.div(p.norm2()));return L=L.transpose(),L=A.transjugate().dot(L),{lambda:E.getDiag(),E:L}},numeric.ccsSparse=function(e){var t,r,i,n,o=e.length,a=[];for(i=o-1;i!==-1;--i){r=e[i];for(n in r){for(n=parseInt(n);n>=a.length;)a[a.length]=0;0!==r[n]&&a[n]++}}var t=a.length,s=Array(t+1);for(s[0]=0,i=0;i<t;++i)s[i+1]=s[i]+a[i];var c=Array(s[t]),l=Array(s[t]);for(i=o-1;i!==-1;--i){r=e[i];for(n in r)0!==r[n]&&(a[n]--,c[s[n]+a[n]]=i,l[s[n]+a[n]]=r[n])}return[s,c,l]},numeric.ccsFull=function(e){var t,r,i,n,o=e[0],a=e[1],s=e[2],c=numeric.ccsDim(e),l=c[0],h=c[1],u=numeric.rep([l,h],0);for(t=0;t<h;t++)for(i=o[t],n=o[t+1],r=i;r<n;++r)u[a[r]][t]=s[r];return u},numeric.ccsTSolve=function(e,t,r,i,n){function o(e){var t;if(0===r[e]){for(r[e]=1,t=a[e];t<a[e+1];++t)o(s[t]);n[u]=e,++u}}var a=e[0],s=e[1],c=e[2],l=a.length-1,h=Math.max,u=0;"undefined"==typeof i&&(r=numeric.rep([l],0)),"undefined"==typeof i&&(i=numeric.linspace(0,r.length-1)),"undefined"==typeof n&&(n=[]);var f,p,d,m,v,g,y;for(f=i.length-1;f!==-1;--f)o(i[f]);for(n.length=u,f=n.length-1;f!==-1;--f)r[n[f]]=0;for(f=i.length-1;f!==-1;--f)p=i[f],r[p]=t[p];for(f=n.length-1;f!==-1;--f){for(p=n[f],d=a[p],m=h(a[p+1],d),v=d;v!==m;++v)if(s[v]===p){r[p]/=c[v];break}for(y=r[p],v=d;v!==m;++v)g=s[v],g!==p&&(r[g]-=y*c[v])}return r},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,r,i,n,o){var a,s,c,l=0,h=n.length,u=this.k,f=this.k1,p=this.j;if(0===i[e])for(i[e]=1,p[0]=e,u[0]=s=t[e],f[0]=c=t[e+1];;)if(s>=c){if(n[h]=p[l],0===l)return;++h,--l,s=u[l],c=f[l]}else a=o[r[s]],0===i[a]?(i[a]=1,u[l]=s,++l,p[l]=a,s=t[a],f[l]=c=t[a+1]):++s},numeric.ccsLPSolve=function(e,t,r,i,n,o,a){var s,c,l,h,u,f,p,d,m,v=e[0],g=e[1],y=e[2],x=(v.length-1,t[0]),_=t[1],b=t[2];for(c=x[n],l=x[n+1],i.length=0,s=c;s<l;++s)a.dfs(o[_[s]],v,g,r,i,o);for(s=i.length-1;s!==-1;--s)r[i[s]]=0;for(s=c;s!==l;++s)h=o[_[s]],r[h]=b[s];for(s=i.length-1;s!==-1;--s){for(h=i[s],u=v[h],f=v[h+1],p=u;p<f;++p)if(o[g[p]]===h){r[h]/=y[p];break}for(m=r[h],p=u;p<f;++p)d=o[g[p]],d!==h&&(r[d]-=m*y[p])}return r},numeric.ccsLUP1=function(e,t){var r,i,n,o,a,s,c,l=e[0].length-1,h=[numeric.rep([l+1],0),[],[]],u=[numeric.rep([l+1],0),[],[]],f=h[0],p=h[1],d=h[2],m=u[0],v=u[1],g=u[2],y=numeric.rep([l],0),x=numeric.rep([l],0),_=numeric.ccsLPSolve,b=(Math.max,Math.abs),w=numeric.linspace(0,l-1),M=numeric.linspace(0,l-1),S=new numeric.ccsDFS(l);for("undefined"==typeof t&&(t=1),r=0;r<l;++r){for(_(h,e,y,x,r,M,S),o=-1,a=-1,i=x.length-1;i!==-1;--i)n=x[i],n<=r||(s=b(y[n]),s>o&&(a=n,o=s));for(b(y[r])<t*o&&(i=w[r],o=w[a],w[r]=o,M[o]=r,w[a]=i,M[i]=a,o=y[r],y[r]=y[a],y[a]=o),o=f[r],a=m[r],c=y[r],p[o]=w[r],d[o]=1,++o,i=x.length-1;i!==-1;--i)n=x[i],s=y[n],x[i]=0,y[n]=0,n<=r?(v[a]=n,g[a]=s,++a):(p[o]=w[n],d[o]=s/c,++o);f[r+1]=o,m[r+1]=a}for(i=p.length-1;i!==-1;--i)p[i]=M[p[i]];return{L:h,U:u,P:w,Pinv:M}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,r,i,n,o,a){var s,c,l,h=0,u=n.length,f=this.k,p=this.k1,d=this.j;if(0===i[e])for(i[e]=1,d[0]=e,f[0]=c=t[o[e]],p[0]=l=t[o[e]+1];;){if(isNaN(c))throw new Error("Ow!");if(c>=l){if(n[u]=o[d[h]],0===h)return;++u,--h,c=f[h],l=p[h]}else s=r[c],0===i[s]?(i[s]=1,f[h]=c,++h,d[h]=s,s=o[s],c=t[s],p[h]=l=t[s+1]):++c}},numeric.ccsLPSolve0=function(e,t,r,i,n,o,a,s){var c,l,h,u,f,p,d,m,v,g=e[0],y=e[1],x=e[2],_=(g.length-1,t[0]),b=t[1],w=t[2];for(l=_[n],h=_[n+1],i.length=0,c=l;c<h;++c)s.dfs(b[c],g,y,r,i,o,a);for(c=i.length-1;c!==-1;--c)u=i[c],r[a[u]]=0;for(c=l;c!==h;++c)u=b[c],r[u]=w[c];for(c=i.length-1;c!==-1;--c){for(u=i[c],m=a[u],f=g[u],p=g[u+1],d=f;d<p;++d)if(y[d]===m){r[m]/=x[d];break}for(v=r[m],d=f;d<p;++d)r[y[d]]-=v*x[d];r[m]=v}},numeric.ccsLUP0=function(e,t){var r,i,n,o,a,s,c,l=e[0].length-1,h=[numeric.rep([l+1],0),[],[]],u=[numeric.rep([l+1],0),[],[]],f=h[0],p=h[1],d=h[2],m=u[0],v=u[1],g=u[2],y=numeric.rep([l],0),x=numeric.rep([l],0),_=numeric.ccsLPSolve0,b=(Math.max,Math.abs),w=numeric.linspace(0,l-1),M=numeric.linspace(0,l-1),S=new numeric.ccsDFS0(l);for("undefined"==typeof t&&(t=1),r=0;r<l;++r){for(_(h,e,y,x,r,M,w,S),o=-1,a=-1,i=x.length-1;i!==-1;--i)n=x[i],n<=r||(s=b(y[w[n]]),s>o&&(a=n,o=s));for(b(y[w[r]])<t*o&&(i=w[r],o=w[a],w[r]=o,M[o]=r,w[a]=i,M[i]=a),o=f[r],a=m[r],c=y[w[r]],p[o]=w[r],d[o]=1,++o,i=x.length-1;i!==-1;--i)n=x[i],s=y[w[n]],x[i]=0,y[w[n]]=0,n<=r?(v[a]=n,g[a]=s,++a):(p[o]=w[n],d[o]=s/c,++o);f[r+1]=o,m[r+1]=a}for(i=p.length-1;i!==-1;--i)p[i]=M[p[i]];return{L:h,U:u,P:w,Pinv:M}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,r){var i=numeric.ccsDim(e),n=i[0],o=i[1];"undefined"==typeof t?t=numeric.linspace(0,n-1):"number"==typeof t&&(t=[t]),"undefined"==typeof r?r=numeric.linspace(0,o-1):"number"==typeof r&&(r=[r]);var a,s,c,l,h,u=t.length,f=r.length,p=numeric.rep([o],0),d=[],m=[],v=[p,d,m],g=e[0],y=e[1],x=e[2],_=numeric.rep([n],0),b=0,w=numeric.rep([n],0);for(s=0;s<f;++s){l=r[s];var M=g[l],S=g[l+1];for(a=M;a<S;++a)c=y[a],w[c]=1,_[c]=x[a];for(a=0;a<u;++a)h=t[a],w[h]&&(d[b]=a,m[b]=_[t[a]],++b);for(a=M;a<S;++a)c=y[a],w[c]=0;p[s+1]=b}return v},numeric.ccsDot=function(e,t){var r,i,n,o,a,s,c,l,h,u,f,p=e[0],d=e[1],m=e[2],v=t[0],g=t[1],y=t[2],x=numeric.ccsDim(e),_=numeric.ccsDim(t),b=x[0],w=(x[1],_[1]),M=numeric.rep([b],0),S=numeric.rep([b],0),A=Array(b),C=numeric.rep([w],0),T=[],E=[],L=[C,T,E];for(n=0;n!==w;++n){for(o=v[n],a=v[n+1],h=0,i=o;i<a;++i)for(u=g[i],f=y[i],s=p[u],c=p[u+1],r=s;r<c;++r)l=d[r],0===S[l]&&(A[h]=l,S[l]=1,h+=1),M[l]=M[l]+m[r]*f;for(o=C[n],a=o+h,C[n+1]=a,i=h-1;i!==-1;--i)f=o+i,r=A[i],T[f]=r,E[f]=M[r],S[r]=0,M[r]=0;C[n+1]=C[n]+h}return L},numeric.ccsLUPSolve=function(e,t){var r=e.L,i=e.U,n=(e.P,t[0]),o=!1;
"object"!=typeof n&&(t=[[0,t.length],numeric.linspace(0,t.length-1),t],n=t[0],o=!0);var a,s,c,l,h,u,f=t[1],p=t[2],d=r[0].length-1,m=n.length-1,v=numeric.rep([d],0),g=Array(d),y=numeric.rep([d],0),x=Array(d),_=numeric.rep([m+1],0),b=[],w=[],M=numeric.ccsTSolve,S=0;for(a=0;a<m;++a){for(h=0,c=n[a],l=n[a+1],s=c;s<l;++s)u=e.Pinv[f[s]],x[h]=u,y[u]=p[s],++h;for(x.length=h,M(r,y,v,x,g),s=x.length-1;s!==-1;--s)y[x[s]]=0;if(M(i,v,y,g,x),o)return y;for(s=g.length-1;s!==-1;--s)v[g[s]]=0;for(s=x.length-1;s!==-1;--s)u=x[s],b[S]=u,w[S]=y[u],y[u]=0,++S;_[a+1]=S}return[_,b,w]},numeric.ccsbinop=function(e,t){return"undefined"==typeof t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,r=e[0],i=e[1],n=e[2],o=numeric.sup(i)+1,a=r.length,s=numeric.rep([o],0),c=Array(a),l=Array(a),h=numeric.rep([o],0);for(t=0;t<a;++t)h[i[t]]++;for(t=0;t<o;++t)s[t+1]=s[t]+h[t];var u,f,p=s.slice(0);for(t=0;t<a;++t)f=i[t],u=p[f],c[u]=r[t],l[u]=n[t],p[f]=p[f]+1;return[s,c,l]},numeric.ccsGather=function(e){var t,r,i,n,o,a=e[0],s=e[1],c=e[2],l=a.length-1,h=s.length,u=Array(h),f=Array(h),p=Array(h);for(o=0,t=0;t<l;++t)for(i=a[t],n=a[t+1],r=i;r!==n;++r)f[o]=t,u[o]=s[r],p[o]=c[r],++o;return[u,f,p]},numeric.sdim=function c(e,t,r){if("undefined"==typeof t&&(t=[]),"object"!=typeof e)return t;"undefined"==typeof r&&(r=0),r in t||(t[r]=0),e.length>t[r]&&(t[r]=e.length);var i;for(i in e)e.hasOwnProperty(i)&&c(e[i],t,r+1);return t},numeric.sclone=function l(e,t,r){"undefined"==typeof t&&(t=0),"undefined"==typeof r&&(r=numeric.sdim(e).length);var i,n=Array(e.length);if(t===r-1){for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}for(i in e)e.hasOwnProperty(i)&&(n[i]=l(e[i],t+1,r));return n},numeric.sdiag=function(e){var t,r,i=e.length,n=Array(i);for(t=i-1;t>=1;t-=2)r=t-1,n[t]=[],n[t][t]=e[t],n[r]=[],n[r][r]=e[r];return 0===t&&(n[0]=[],n[0][0]=e[t]),n},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,r,i,n=[];e.length;for(t in e)if(e.hasOwnProperty(t)){i=e[t];for(r in i)i.hasOwnProperty(r)&&("object"!=typeof n[r]&&(n[r]=[]),n[r][t]=i[r])}return n},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var r,i,n,o,a,s,c,l=e.length,h=(t.length,numeric.stranspose(t)),u=h.length,f=Array(l);for(n=l-1;n>=0;n--){for(c=[],r=e[n],a=u-1;a>=0;a--){s=0,i=h[a];for(o in r)r.hasOwnProperty(o)&&o in i&&(s+=r[o]*i[o]);s&&(c[a]=s)}f[n]=c}return f},numeric.sdotMV=function(e,t){var r,i,n,o,a=e.length,s=Array(a);for(i=a-1;i>=0;i--){r=e[i],o=0;for(n in r)r.hasOwnProperty(n)&&t[n]&&(o+=r[n]*t[n]);o&&(s[i]=o)}return s},numeric.sdotVM=function(e,t){var r,i,n,o,a=[];for(r in e)if(e.hasOwnProperty(r)){n=t[r],o=e[r];for(i in n)n.hasOwnProperty(i)&&(a[i]||(a[i]=0),a[i]+=o*n[i])}return a},numeric.sdotVV=function(e,t){var r,i=0;for(r in e)e[r]&&t[r]&&(i+=e[r]*t[r]);return i},numeric.sdot=function(e,t){var r=numeric.sdim(e).length,i=numeric.sdim(t).length,n=1e3*r+i;switch(n){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+r+" and "+i)}},numeric.sscatter=function(e){var t,r,i,n,o=e[0].length,a=e.length,s=[];for(r=o-1;r>=0;--r)if(e[a-1][r]){for(n=s,i=0;i<a-2;i++)t=e[i][r],n[t]||(n[t]=[]),n=n[t];n[e[i][r]]=e[i+1][r]}return s},numeric.sgather=function h(e,t,r){"undefined"==typeof t&&(t=[]),"undefined"==typeof r&&(r=[]);var i,n,o;i=r.length;for(n in e)if(e.hasOwnProperty(n))if(r[i]=parseInt(n),o=e[n],"number"==typeof o){if(o){if(0===t.length)for(n=i+1;n>=0;--n)t[n]=[];for(n=i;n>=0;--n)t[n].push(r[n]);t[i+1].push(o)}}else h(o,t,r);return r.length>i&&r.pop(),t},numeric.cLU=function(e){var t,r,i,n,o,a,s=e[0],c=e[1],l=e[2],h=s.length,u=0;for(t=0;t<h;t++)s[t]>u&&(u=s[t]);u++;var f,p,d,m=Array(u),v=Array(u),g=numeric.rep([u],1/0),y=numeric.rep([u],-(1/0));for(i=0;i<h;i++)t=s[i],r=c[i],r<g[t]&&(g[t]=r),r>y[t]&&(y[t]=r);for(t=0;t<u-1;t++)y[t]>y[t+1]&&(y[t+1]=y[t]);for(t=u-1;t>=1;t--)g[t]<g[t-1]&&(g[t-1]=g[t]);var x=0,_=0;for(t=0;t<u;t++)v[t]=numeric.rep([y[t]-g[t]+1],0),m[t]=numeric.rep([t-g[t]],0),x+=t-g[t]+1,_+=y[t]-t+1;for(i=0;i<h;i++)t=s[i],v[t][c[i]-g[t]]=l[i];for(t=0;t<u-1;t++)for(n=t-g[t],f=v[t],r=t+1;g[r]<=t&&r<u;r++)if(o=t-g[r],a=y[t]-t,p=v[r],d=p[o]/f[n]){for(i=1;i<=a;i++)p[i+o]-=d*f[i+n];m[r][t-g[r]]=d}var h,b,w,f=[],p=[],M=[],S=[],A=[],C=[];for(h=0,b=0,t=0;t<u;t++){for(n=g[t],o=y[t],w=v[t],r=t;r<=o;r++)w[r-n]&&(f[h]=t,p[h]=r,M[h]=w[r-n],h++);for(w=m[t],r=n;r<t;r++)w[r-n]&&(S[b]=t,A[b]=r,C[b]=w[r-n],b++);S[b]=t,A[b]=t,C[b]=1,b++}return{U:[f,p,M],L:[S,A,C]}},numeric.cLUsolve=function(e,t){var r,i,n=e.L,o=e.U,a=numeric.clone(t),s=n[0],c=n[1],l=n[2],h=o[0],u=o[1],f=o[2],p=h.length,d=(s.length,a.length);for(i=0,r=0;r<d;r++){for(;c[i]<r;)a[r]-=l[i]*a[c[i]],i++;i++}for(i=p-1,r=d-1;r>=0;r--){for(;u[i]>r;)a[r]-=f[i]*a[u[i]],i--;a[r]/=f[i],i--}return a},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var r,i,n,o=numeric.rep(e,-1);if("function"!=typeof t)switch(t){case"L":t=function(t,r){return t>=e[0]/2||r<e[1]/2};break;default:t=function(e,t){return!0}}for(n=0,r=1;r<e[0]-1;r++)for(i=1;i<e[1]-1;i++)t(r,i)&&(o[r][i]=n,n++);return o},numeric.cdelsq=function(e){var t,r,i,n,o,a=[[-1,0],[0,-1],[0,1],[1,0]],s=numeric.dim(e),c=s[0],l=s[1],h=[],u=[],f=[];for(t=1;t<c-1;t++)for(r=1;r<l-1;r++)if(!(e[t][r]<0)){for(i=0;i<4;i++)n=t+a[i][0],o=r+a[i][1],e[n][o]<0||(h.push(e[t][r]),u.push(e[n][o]),f.push(-1));h.push(e[t][r]),u.push(e[t][r]),f.push(4)}return[h,u,f]},numeric.cdotMV=function(e,t){var r,i,n,o=e[0],a=e[1],s=e[2],c=o.length;for(n=0,i=0;i<c;i++)o[i]>n&&(n=o[i]);for(n++,r=numeric.rep([n],0),i=0;i<c;i++)r[o[i]]+=s[i]*t[a[i]];return r},numeric.Spline=function(e,t,r,i,n){this.x=e,this.yl=t,this.yr=r,this.kl=i,this.kr=n},numeric.Spline.prototype._at=function(e,t){var e,r,i,n,o=this.x,a=this.yl,s=this.yr,c=this.kl,l=this.kr,h=numeric.add,u=numeric.sub,f=numeric.mul;r=u(f(c[t],o[t+1]-o[t]),u(s[t+1],a[t])),i=h(f(l[t+1],o[t]-o[t+1]),u(s[t+1],a[t])),n=(e-o[t])/(o[t+1]-o[t]);var p=n*(1-n);return h(h(h(f(1-n,a[t]),f(n,s[t+1])),f(r,p*(1-n))),f(i,p*n))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,r,i,n=this.x,o=n.length,a=Math.floor;for(t=0,r=o-1;r-t>1;)i=a((t+r)/2),n[i]<=e?t=i:r=i;return this._at(e,t)}var s,o=e.length,c=Array(o);for(s=o-1;s!==-1;--s)c[s]=this.at(e[s]);return c},numeric.Spline.prototype.diff=function(){var e,t,r,i=this.x,n=this.yl,o=this.yr,a=this.kl,s=this.kr,c=n.length,l=a,h=s,u=Array(c),f=Array(c),p=numeric.add,d=numeric.mul,m=numeric.div,v=numeric.sub;for(e=c-1;e!==-1;--e)t=i[e+1]-i[e],r=v(o[e+1],n[e]),u[e]=m(p(d(r,6),d(a[e],-4*t),d(s[e+1],-2*t)),t*t),f[e+1]=m(p(d(r,-6),d(a[e],2*t),d(s[e+1],4*t)),t*t);return new numeric.Spline(i,l,h,u,f)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],r=this.x,i=this.yl,n=this.yr,o=this.kl,a=this.kr;"number"==typeof i[0]&&(i=[i],n=[n],o=[o],a=[a]);var s,c,l,h,u,f,p,d,m,v,g,y,x,_,b,w,M,S,A,C,T,E,L,P,R=i.length,D=r.length-1,t=Array(R),V=Math.sqrt;for(s=0;s!==R;++s){for(h=i[s],u=n[s],f=o[s],p=a[s],d=[],c=0;c!==D;c++){for(c>0&&u[c]*h[c]<0&&d.push(r[c]),w=r[c+1]-r[c],M=r[c],g=h[c],y=u[c+1],m=f[c]/w,v=p[c+1]/w,b=e(m-v+3*(g-y))+12*v*g,x=v+3*g+2*m-3*y,_=3*(v+m+2*(g-y)),b<=0?(A=x/_,S=A>r[c]&&A<r[c+1]?[r[c],A,r[c+1]]:[r[c],r[c+1]]):(A=(x-V(b))/_,C=(x+V(b))/_,S=[r[c]],A>r[c]&&A<r[c+1]&&S.push(A),C>r[c]&&C<r[c+1]&&S.push(C),S.push(r[c+1])),E=S[0],A=this._at(E,c),l=0;l<S.length-1;l++)if(L=S[l+1],C=this._at(L,c),0!==A)if(0===C||A*C>0)E=L,A=C;else{for(var F=0;;){if(P=(A*L-C*E)/(A-C),P<=E||P>=L)break;if(T=this._at(P,c),T*C>0)L=P,C=T,F===-1&&(A*=.5),F=-1;else{if(!(T*A>0))break;E=P,A=T,1===F&&(C*=.5),F=1}}d.push(P),E=S[l+1],A=this._at(E,c)}else d.push(E),E=L,A=C;0===C&&d.push(L)}t[s]=d}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,r,i){var n,o=e.length,a=[],s=[],c=[],l=numeric.sub,h=numeric.mul,u=numeric.add;for(n=o-2;n>=0;n--)s[n]=e[n+1]-e[n],c[n]=l(t[n+1],t[n]);"string"!=typeof r&&"string"!=typeof i||(r=i="periodic");var f=[[],[],[]];switch(typeof r){case"undefined":a[0]=h(3/(s[0]*s[0]),c[0]),f[0].push(0,0),f[1].push(0,1),f[2].push(2/s[0],1/s[0]);break;case"string":a[0]=u(h(3/(s[o-2]*s[o-2]),c[o-2]),h(3/(s[0]*s[0]),c[0])),f[0].push(0,0,0),f[1].push(o-2,0,1),f[2].push(1/s[o-2],2/s[o-2]+2/s[0],1/s[0]);break;default:a[0]=r,f[0].push(0),f[1].push(0),f[2].push(1)}for(n=1;n<o-1;n++)a[n]=u(h(3/(s[n-1]*s[n-1]),c[n-1]),h(3/(s[n]*s[n]),c[n])),f[0].push(n,n,n),f[1].push(n-1,n,n+1),f[2].push(1/s[n-1],2/s[n-1]+2/s[n],1/s[n]);switch(typeof i){case"undefined":a[o-1]=h(3/(s[o-2]*s[o-2]),c[o-2]),f[0].push(o-1,o-1),f[1].push(o-2,o-1),f[2].push(1/s[o-2],2/s[o-2]);break;case"string":f[1][f[1].length-1]=0;break;default:a[o-1]=i,f[0].push(o-1),f[1].push(o-1),f[2].push(1)}a="number"!=typeof a[0]?numeric.transpose(a):[a];var p=Array(a.length);if("string"==typeof r)for(n=p.length-1;n!==-1;--n)p[n]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(f)),a[n]),p[n][o-1]=p[n][0];else for(n=p.length-1;n!==-1;--n)p[n]=numeric.cLUsolve(numeric.cLU(f),a[n]);return p="number"==typeof t[0]?p[0]:numeric.transpose(p),new numeric.Spline(e,t,t,p,p)},numeric.fftpow2=function u(e,t){var r=e.length;if(1!==r){var i,n,o=Math.cos,a=Math.sin,s=Array(r/2),c=Array(r/2),l=Array(r/2),h=Array(r/2);for(n=r/2,i=r-1;i!==-1;--i)--n,l[n]=e[i],h[n]=t[i],--i,s[n]=e[i],c[n]=t[i];u(s,c),u(l,h),n=r/2;var f,p,d,m=-6.283185307179586/r;for(i=r-1;i!==-1;--i)--n,n===-1&&(n=r/2-1),f=m*i,p=o(f),d=a(f),e[i]=s[n]+p*l[n]-d*h[n],t[i]=c[n]+p*h[n]+d*l[n]}},numeric._ifftpow2=function f(e,t){var r=e.length;if(1!==r){var i,n,o=Math.cos,a=Math.sin,s=Array(r/2),c=Array(r/2),l=Array(r/2),h=Array(r/2);for(n=r/2,i=r-1;i!==-1;--i)--n,l[n]=e[i],h[n]=t[i],--i,s[n]=e[i],c[n]=t[i];f(s,c),f(l,h),n=r/2;var u,p,d,m=6.283185307179586/r;for(i=r-1;i!==-1;--i)--n,n===-1&&(n=r/2-1),u=m*i,p=o(u),d=a(u),e[i]=s[n]+p*l[n]-d*h[n],t[i]=c[n]+p*h[n]+d*l[n]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,r,i){numeric.fftpow2(e,t),numeric.fftpow2(r,i);var n,o,a,s,c,l=e.length;for(n=l-1;n!==-1;--n)o=e[n],s=t[n],a=r[n],c=i[n],e[n]=o*a-s*c,t[n]=o*c+s*a;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,r=this.x,i=this.y,n=r.length,o=Math.log,a=o(2),s=Math.ceil(o(2*n-1)/a),c=Math.pow(2,s),l=numeric.rep([c],0),h=numeric.rep([c],0),u=Math.cos,f=Math.sin,p=-3.141592653589793/n,d=numeric.rep([c],0),m=numeric.rep([c],0);Math.floor(n/2);for(e=0;e<n;e++)d[e]=r[e];if("undefined"!=typeof i)for(e=0;e<n;e++)m[e]=i[e];for(l[0]=1,e=1;e<=c/2;e++)t=p*e*e,l[e]=u(t),h[e]=f(t),l[c-e]=u(t),h[c-e]=f(t);var v=new numeric.T(d,m),g=new numeric.T(l,h);return v=v.mul(g),numeric.convpow2(v.x,v.y,numeric.clone(g.x),numeric.neg(g.y)),v=v.mul(g),v.x.length=n,v.y.length=n,v},numeric.T.prototype.ifft=function(){var e,t,r=this.x,i=this.y,n=r.length,o=Math.log,a=o(2),s=Math.ceil(o(2*n-1)/a),c=Math.pow(2,s),l=numeric.rep([c],0),h=numeric.rep([c],0),u=Math.cos,f=Math.sin,p=3.141592653589793/n,d=numeric.rep([c],0),m=numeric.rep([c],0);Math.floor(n/2);for(e=0;e<n;e++)d[e]=r[e];if("undefined"!=typeof i)for(e=0;e<n;e++)m[e]=i[e];for(l[0]=1,e=1;e<=c/2;e++)t=p*e*e,l[e]=u(t),h[e]=f(t),l[c-e]=u(t),h[c-e]=f(t);var v=new numeric.T(d,m),g=new numeric.T(l,h);return v=v.mul(g),numeric.convpow2(v.x,v.y,numeric.clone(g.x),numeric.neg(g.y)),v=v.mul(g),v.x.length=n,v.y.length=n,v.div(n)},numeric.gradient=function(e,t){var r=t.length,i=e(t);if(isNaN(i))throw new Error("gradient: f(x) is a NaN!");var n,o,a,s,c,l,h,u,f,p,d=Math.max,m=numeric.clone(t),v=Array(r),d=(numeric.div,numeric.sub,Math.max),g=.001,y=Math.abs,x=Math.min,_=0;for(n=0;n<r;n++)for(var b=d(1e-6*i,1e-8);;){if(++_,_>20)throw new Error("Numerical gradient fails");if(m[n]=t[n]+b,o=e(m),m[n]=t[n]-b,a=e(m),m[n]=t[n],isNaN(o)||isNaN(a))b/=16;else{if(v[n]=(o-a)/(2*b),c=t[n]-b,l=t[n],h=t[n]+b,u=(o-i)/b,f=(i-a)/b,p=d(y(v[n]),y(i),y(o),y(a),y(c),y(l),y(h),1e-8),s=x(d(y(u-v[n]),y(f-v[n]),y(u-f))/p,b/p),!(s>g))break;b/=16}}return v},numeric.uncmin=function(e,t,r,i,n,o,a){var s=numeric.gradient;"undefined"==typeof a&&(a={}),"undefined"==typeof r&&(r=1e-8),"undefined"==typeof i&&(i=function(t){return s(e,t)}),"undefined"==typeof n&&(n=1e3),t=numeric.clone(t);var c,l,h=t.length,u=e(t);if(isNaN(u))throw new Error("uncmin: f(x0) is a NaN!");var f=Math.max,p=numeric.norm2;r=f(r,numeric.epsilon);var d,m,v,g,y,x,_,b,w,M,S=a.Hinv||numeric.identity(h),A=numeric.dot,C=(numeric.inv,numeric.sub),T=numeric.add,E=numeric.tensor,L=numeric.div,P=numeric.mul,R=numeric.all,D=numeric.isFinite,V=numeric.neg,F=0,U="";for(m=i(t);F<n;){if("function"==typeof o&&o(F,t,u,m,S)){U="Callback returned true";break}if(!R(D(m))){U="Gradient has Infinity or NaN";break}if(d=V(A(S,m)),!R(D(d))){U="Search direction has Infinity or NaN";break}if(M=p(d),M<r){U="Newton step smaller than tol";break}for(w=1,l=A(m,d),y=t;F<n&&!(w*M<r)&&(g=P(d,w),y=T(t,g),c=e(y),c-u>=.1*w*l||isNaN(c));)w*=.5,++F;if(w*M<r){U="Line search step size smaller than tol";break}if(F===n){U="maxit reached during line search";break}v=i(y),x=C(v,m),b=A(x,g),_=A(S,x),S=C(T(S,P((b+A(x,_))/(b*b),E(g,g))),L(T(E(_,g),E(g,_)),b)),t=y,u=c,m=v,++F}return{solution:t,f:u,gradient:m,invHessian:S,iterations:F,message:U}},numeric.Dopri=function(e,t,r,i,n,o,a){this.x=e,this.y=t,this.f=r,this.ymid=i,this.iterations=n,this.events=a,this.message=o},numeric.Dopri.prototype._at=function(e,t){function r(e){return e*e}var i,n,o,a,s,c,e,l,h,u,f,p=this,d=p.x,m=p.y,v=p.f,g=p.ymid,y=(d.length,Math.floor,.5),x=numeric.add,_=numeric.mul,b=numeric.sub;return i=d[t],n=d[t+1],a=m[t],s=m[t+1],l=n-i,o=i+y*l,c=g[t],h=b(v[t],_(a,1/(i-o)+2/(i-n))),u=b(v[t+1],_(s,1/(n-o)+2/(n-i))),f=[r(e-n)*(e-o)/r(i-n)/(i-o),r(e-i)*r(e-n)/r(i-o)/r(n-o),r(e-i)*(e-o)/r(n-i)/(n-o),(e-i)*r(e-n)*(e-o)/r(i-n)/(i-o),(e-n)*r(e-i)*(e-o)/r(i-n)/(n-o)],x(x(x(x(_(a,f[0]),_(c,f[1])),_(s,f[2])),_(h,f[3])),_(u,f[4]))},numeric.Dopri.prototype.at=function(e){var t,r,i,n=Math.floor;if("number"!=typeof e){var o=e.length,a=Array(o);for(t=o-1;t!==-1;--t)a[t]=this.at(e[t]);return a}var s=this.x;for(t=0,r=s.length-1;r-t>1;)i=n(.5*(t+r)),s[i]<=e?t=i:r=i;return this._at(e,t)},numeric.dopri=function(e,t,r,i,n,o,a){"undefined"==typeof n&&(n=1e-6),"undefined"==typeof o&&(o=1e3);var s,c,l,h,u,f,p,d,m,v,g,y,x,_=[e],b=[r],w=[i(e,r)],M=[],S=.2,A=[.075,.225],C=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],E=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],L=[35/384,0,500/1113,125/192,-2187/6784,11/84],P=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],R=[.2,.3,.8,8/9,1,1],D=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,.025],V=0,F=(t-e)/10,U=0,N=numeric.add,O=numeric.mul,k=(Math.max,Math.min),B=Math.abs,z=numeric.norminf,I=Math.pow,G=numeric.any,j=numeric.lt,H=numeric.and,W=(numeric.sub,new numeric.Dopri(_,b,w,M,(-1),""));for("function"==typeof a&&(g=a(e,r));e<t&&U<o;)if(++U,e+F>t&&(F=t-e),s=i(e+R[0]*F,N(r,O(S*F,w[V]))),c=i(e+R[1]*F,N(N(r,O(A[0]*F,w[V])),O(A[1]*F,s))),l=i(e+R[2]*F,N(N(N(r,O(C[0]*F,w[V])),O(C[1]*F,s)),O(C[2]*F,c))),h=i(e+R[3]*F,N(N(N(N(r,O(T[0]*F,w[V])),O(T[1]*F,s)),O(T[2]*F,c)),O(T[3]*F,l))),u=i(e+R[4]*F,N(N(N(N(N(r,O(E[0]*F,w[V])),O(E[1]*F,s)),O(E[2]*F,c)),O(E[3]*F,l)),O(E[4]*F,h))),m=N(N(N(N(N(r,O(w[V],F*L[0])),O(c,F*L[2])),O(l,F*L[3])),O(h,F*L[4])),O(u,F*L[5])),f=i(e+F,m),p=N(N(N(N(N(O(w[V],F*D[0]),O(c,F*D[2])),O(l,F*D[3])),O(h,F*D[4])),O(u,F*D[5])),O(f,F*D[6])),v="number"==typeof p?B(p):z(p),v>n){if(F=.2*F*I(n/v,.25),e+F===e){W.msg="Step size became too small";break}}else{if(M[V]=N(N(N(N(N(N(r,O(w[V],F*P[0])),O(c,F*P[2])),O(l,F*P[3])),O(h,F*P[4])),O(u,F*P[5])),O(f,F*P[6])),++V,_[V]=e+F,b[V]=m,w[V]=f,"function"==typeof a){var X,q,Y=e,K=e+.5*F;if(y=a(K,M[V-1]),x=H(j(g,0),j(0,y)),G(x)||(Y=K,K=e+F,g=y,y=a(K,m),x=H(j(g,0),j(0,y))),G(x)){for(var Q,Z,J=0,$=1,ee=1;;){if("number"==typeof g)q=(ee*y*Y-$*g*K)/(ee*y-$*g);else for(q=K,d=g.length-1;d!==-1;--d)g[d]<0&&y[d]>0&&(q=k(q,(ee*y[d]*Y-$*g[d]*K)/(ee*y[d]-$*g[d])));if(q<=Y||q>=K)break;X=W._at(q,V-1),Z=a(q,X),Q=H(j(g,0),j(0,Z)),G(Q)?(K=q,y=Z,x=Q,ee=1,J===-1?$*=.5:$=1,J=-1):(Y=q,g=Z,$=1,1===J?ee*=.5:ee=1,J=1)}return m=W._at(.5*(e+q),V-1),W.f[V]=i(q,X),W.x[V]=q,W.y[V]=X,W.ymid[V-1]=m,W.events=x,W.iterations=U,W}}e+=F,r=m,g=y,F=k(.8*F*I(n/v,.25),4*F)}return W.iterations=U,W},numeric.LU=function(e,t){t=t||!1;var r,i,n,o,a,s,c,l,h,u=Math.abs,f=e.length,p=f-1,d=new Array(f);for(t||(e=numeric.clone(e)),n=0;n<f;++n){for(c=n,s=e[n],h=u(s[n]),i=n+1;i<f;++i)o=u(e[i][n]),h<o&&(h=o,c=i);for(d[n]=c,c!=n&&(e[n]=e[c],e[c]=s,s=e[n]),a=s[n],r=n+1;r<f;++r)e[r][n]/=a;for(r=n+1;r<f;++r){for(l=e[r],i=n+1;i<p;++i)l[i]-=l[n]*s[i],++i,l[i]-=l[n]*s[i];i===p&&(l[i]-=l[n]*s[i])}}return{LU:e,P:d}},numeric.LUsolve=function(e,t){var r,i,n,o,a,s=e.LU,c=s.length,l=numeric.clone(t),h=e.P;for(r=c-1;r!==-1;--r)l[r]=t[r];for(r=0;r<c;++r)for(n=h[r],h[r]!==r&&(a=l[r],l[r]=l[n],l[n]=a),o=s[r],i=0;i<r;++i)l[r]-=l[i]*o[i];for(r=c-1;r>=0;--r){for(o=s[r],i=r+1;i<c;++i)l[r]-=l[i]*o[i];l[r]/=o[r]}return l},numeric.solve=function(e,t,r){return numeric.LUsolve(numeric.LU(e,r),t)},numeric.echelonize=function(e){var t,r,i,n,o,a,s,c,l=numeric.dim(e),h=l[0],u=l[1],f=numeric.identity(h),p=Array(h),d=Math.abs,m=numeric.diveq;for(e=numeric.clone(e),t=0;t<h;++t){for(i=0,o=e[t],a=f[t],r=1;r<u;++r)d(o[i])<d(o[r])&&(i=r);for(p[t]=i,m(a,o[i]),m(o,o[i]),r=0;r<h;++r)if(r!==t){for(s=e[r],c=s[i],n=u-1;n!==-1;--n)s[n]-=o[n]*c;for(s=f[r],n=h-1;n!==-1;--n)s[n]-=a[n]*c}}return{I:f,A:e,P:p}},numeric.__solveLP=function(e,t,r,i,n,o,a){var s,c,l,h,u=numeric.sum,f=(numeric.log,numeric.mul),p=numeric.sub,d=numeric.dot,m=numeric.div,v=numeric.add,g=e.length,y=r.length,x=!1,_=0,b=1,w=(numeric.transpose(t),numeric.svd,numeric.transpose),M=(numeric.leq,Math.sqrt),S=Math.abs,A=(numeric.muleq,numeric.norminf,numeric.any,Math.min),C=numeric.all,T=numeric.gt,E=Array(g),L=Array(y),P=(numeric.rep([y],1),numeric.solve),R=p(r,d(t,o)),D=d(e,e);for(l=_;l<n;++l){var V,F;for(V=y-1;V!==-1;--V)L[V]=m(t[V],R[V]);var U=w(L);for(V=g-1;V!==-1;--V)E[V]=u(U[V]);b=.25*S(D/d(e,E));var N=100*M(D/d(E,E));for((!isFinite(b)||b>N)&&(b=N),h=v(e,f(b,E)),c=d(U,L),V=g-1;V!==-1;--V)c[V][V]+=1;F=P(c,m(h,b),!0);var O=m(R,d(t,F)),k=1;for(V=y-1;V!==-1;--V)O[V]<0&&(k=A(k,-.999*O[V]));if(s=p(o,f(F,k)),R=p(r,d(t,s)),!C(T(R,0)))return{solution:o,message:"",iterations:l};if(o=s,b<i)return{solution:s,message:"",iterations:l};if(a){var B=d(e,h),z=d(t,h);for(x=!0,V=y-1;V!==-1;--V)if(B*z[V]<0){x=!1;break}}else x=!(o[g-1]>=0);if(x)return{solution:s,message:"Unbounded",iterations:l}}return{solution:o,message:"maximum iteration count exceeded",iterations:l}},numeric._solveLP=function(e,t,r,i,n){var o,a=e.length,s=r.length,c=(numeric.sum,numeric.log,numeric.mul,numeric.sub),l=numeric.dot,h=(numeric.div,numeric.add,numeric.rep([a],0).concat([1])),u=numeric.rep([s,1],-1),f=numeric.blockMatrix([[t,u]]),p=r,o=numeric.rep([a],0).concat(Math.max(0,numeric.sup(numeric.neg(r)))+1),d=numeric.__solveLP(h,f,p,i,n,o,!1),m=numeric.clone(d.solution);m.length=a;var v=numeric.inf(c(r,l(t,m)));if(v<0)return{solution:NaN,message:"Infeasible",iterations:d.iterations};var g=numeric.__solveLP(e,t,r,i,n-d.iterations,m,!0);return g.iterations+=d.iterations,g},numeric.solveLP=function(e,t,r,i,n,o,a){if("undefined"==typeof a&&(a=1e3),"undefined"==typeof o&&(o=numeric.epsilon),"undefined"==typeof i)return numeric._solveLP(e,t,r,o,a);var s,c=i.length,l=i[0].length,h=t.length,u=numeric.echelonize(i),f=numeric.rep([l],0),p=u.P,d=[];for(s=p.length-1;s!==-1;--s)f[p[s]]=1;for(s=l-1;s!==-1;--s)0===f[s]&&d.push(s);var m=numeric.getRange,v=numeric.linspace(0,c-1),g=numeric.linspace(0,h-1),y=m(i,v,d),x=m(t,g,p),_=m(t,g,d),b=numeric.dot,w=numeric.sub,M=b(x,u.I),S=w(_,b(M,y)),A=w(r,b(M,n)),C=Array(p.length),T=Array(d.length);for(s=p.length-1;s!==-1;--s)C[s]=e[p[s]];for(s=d.length-1;s!==-1;--s)T[s]=e[d[s]];var E=w(T,b(C,b(u.I,y))),L=numeric._solveLP(E,S,A,o,a),P=L.solution;if(P!==P)return L;var R=b(u.I,w(n,b(y,P))),D=Array(e.length);for(s=p.length-1;s!==-1;--s)D[p[s]]=R[s];for(s=d.length-1;s!==-1;--s)D[d[s]]=P[s];return{solution:D,message:L.message,iterations:L.iterations}},numeric.MPStoLP=function(e){function t(t){throw new Error("MPStoLP: "+t+"\nLine "+r+": "+e[r]+"\nCurrent state: "+s[a]+"\n")}e instanceof String&&e.split("\n");var r,i,n,o,a=0,s=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],c=e.length,l=0,h={},u=[],f=0,p={},d=0,m=[],v=[],g=[];for(r=0;r<c;++r){n=e[r];var y=n.match(/\S*/g),x=[];for(i=0;i<y.length;++i)""!==y[i]&&x.push(y[i]);if(0!==x.length){for(i=0;i<s.length&&n.substr(0,s[i].length)!==s[i];++i);if(i<s.length){if(a=i,1===i&&(o=x[1]),6===i)return{name:o,c:m,A:numeric.transpose(v),b:g,rows:h,vars:p}}else switch(a){case 0:case 1:t("Unexpected line");case 2:switch(x[0]){case"N":0===l?l=x[1]:t("Two or more N rows");break;case"L":h[x[1]]=f,u[f]=1,g[f]=0,++f;break;case"G":h[x[1]]=f,u[f]=-1,g[f]=0,++f;break;case"E":h[x[1]]=f,u[f]=0,g[f]=0,++f;break;default:t("Parse error "+numeric.prettyPrint(x))}break;case 3:p.hasOwnProperty(x[0])||(p[x[0]]=d,m[d]=0,v[d]=numeric.rep([f],0),++d);var _=p[x[0]];for(i=1;i<x.length;i+=2)if(x[i]!==l){var b=h[x[i]];v[_][b]=(u[b]<0?-1:1)*parseFloat(x[i+1])}else m[_]=parseFloat(x[i+1]);break;case 4:for(i=1;i<x.length;i+=2)g[h[x[i]]]=(u[h[x[i]]]<0?-1:1)*parseFloat(x[i+1]);break;case 5:break;case 6:t("Internal error")}}}t("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,r,i,n,o,a){function s(e){var t,i,n=this,o=e.length,a=0,s=n.i=n.j=n.m=0;for(n.S=[],n.c=[],o||(e=[o++]);a<r;)n.S[a]=a++;for(a=0;a<r;a++)t=n.S[a],s=h(s+t+e[a%o]),i=n.S[s],n.S[a]=i,n.S[s]=t;n.g=function(e){var t=n.S,i=h(n.i+1),o=t[i],a=h(n.j+o),s=t[a];t[i]=s,t[a]=o;for(var c=t[h(o+s)];--e;)i=h(i+1),o=t[i],a=h(a+o),s=t[a],t[i]=s,t[a]=o,c=c*r+t[h(o+s)];return n.i=i,n.j=a,c},n.g(r)}function c(e,t,r,i,n){if(r=[],n=typeof e,t&&"object"==n)for(i in e)if(i.indexOf("S")<5)try{r.push(c(e[i],t-1))}catch(o){}return r.length?r:e+("string"!=n?"\0":"")}function l(e,t,r,i){for(e+="",r=0,i=0;i<e.length;i++)t[h(i)]=h((r^=19*t[h(i)])+e.charCodeAt(i));e="";for(i in t)e+=String.fromCharCode(t[i]);return e}function h(e){return e&r-1}t.seedrandom=function(h,u){var f,p=[];return h=l(c(u?[h,e]:arguments.length?h:[(new Date).getTime(),e,window],3),p),f=new s(p),l(f.S,e),t.random=function(){for(var e=f.g(i),t=a,s=0;e<n;)e=(e+s)*r,t*=r,s=f.g(1);for(;e>=o;)e/=2,t/=2,s>>>=1;return(e+s)/t},h},a=t.pow(r,i),n=t.pow(2,n),o=2*n,l(t.random(),e)}([],numeric.seedrandom,256,6,52),function(e){function t(e){if("object"!=typeof e)return e;var r,i=[],n=e.length;for(r=0;r<n;r++)i[r+1]=t(e[r]);return i}function r(e){if("object"!=typeof e)return e;var t,i=[],n=e.length;for(t=1;t<n;t++)i[t-1]=r(e[t]);return i}function i(e,t,r){var i,n,o,a,s;for(o=1;o<=r;o+=1){for(e[o][o]=1/e[o][o],s=-e[o][o],i=1;i<o;i+=1)e[i][o]=s*e[i][o];if(a=o+1,r<a)break;for(n=a;n<=r;n+=1)for(s=e[o][n],e[o][n]=0,i=1;i<=o;i+=1)e[i][n]=e[i][n]+s*e[i][o]}}function n(e,t,r,i){var n,o,a,s;for(o=1;o<=r;o+=1){for(s=0,n=1;n<o;n+=1)s+=e[n][o]*i[n];i[o]=(i[o]-s)/e[o][o]}for(a=1;a<=r;a+=1)for(o=r+1-a,i[o]=i[o]/e[o][o],s=-i[o],n=1;n<o;n+=1)i[n]=i[n]+s*e[n][o]}function o(e,t,r,i){var n,o,a,s,c,l;for(o=1;o<=r;o+=1){if(i[1]=o,l=0,a=o-1,a<1){if(l=e[o][o]-l,l<=0)break;e[o][o]=Math.sqrt(l)}else{for(s=1;s<=a;s+=1){for(c=e[s][o],n=1;n<s;n+=1)c-=e[n][o]*e[n][s];c/=e[s][s],e[s][o]=c,l+=c*c}if(l=e[o][o]-l,l<=0)break;e[o][o]=Math.sqrt(l)}i[1]=0}}function a(e,t,r,a,s,c,l,h,u,f,p,d,m,v,g,y){function x(){for(v[1]=v[1]+1,C=V,S=1;S<=f;S+=1){for(C+=1,B=-h[S],A=1;A<=a;A+=1)B+=l[A][S]*s[A];if(Math.abs(B)<q&&(B=0),S>p)g[C]=B;else if(g[C]=-Math.abs(B),B>0){for(A=1;A<=a;A+=1)l[A][S]=-l[A][S];h[S]=-h[S]}}for(S=1;S<=m;S+=1)g[V+d[S]]=0;for(U=0,k=0,S=1;S<=f;S+=1)g[V+S]<k*g[O+S]&&(U=S,k=g[V+S]/g[O+S]);return 0===U?999:0}function _(){for(S=1;S<=a;S+=1){for(B=0,A=1;A<=a;A+=1)B+=e[A][S]*l[A][U];g[S]=B}for(T=P,S=1;S<=a;S+=1)g[T+S]=0;for(A=m+1;A<=a;A+=1)for(S=1;S<=a;S+=1)g[T+S]=g[T+S]+e[S][A]*g[A];for(W=!0,S=m;S>=1;S-=1){for(B=g[S],C=D+S*(S+3)/2,T=C-S,A=S+1;A<=m;A+=1)B-=g[C]*g[R+A],C+=A;if(B/=g[T],g[R+S]=B,d[S]<p)break;if(B<0)break;W=!1,L=S}if(!W)for(z=g[F+L]/g[R+L],S=1;S<=m&&!(d[S]<p)&&!(g[R+S]<0);S+=1)k=g[F+S]/g[R+S],k<z&&(z=k,L=S);for(B=0,S=P+1;S<=P+a;S+=1)B+=g[S]*g[S];if(Math.abs(B)<=q){if(W)return y[1]=1,999;for(S=1;S<=m;S+=1)g[F+S]=g[F+S]-z*g[R+S];return g[F+m+1]=g[F+m+1]+z,700}for(B=0,S=1;S<=a;S+=1)B+=g[P+S]*l[S][U];for(I=-g[V+U]/B,X=!0,W||z<I&&(I=z,X=!1),S=1;S<=a;S+=1)s[S]=s[S]+I*g[P+S],Math.abs(s[S])<q&&(s[S]=0);for(c[1]=c[1]+I*B*(I/2+g[F+m+1]),S=1;S<=m;S+=1)g[F+S]=g[F+S]-I*g[R+S];if(g[F+m+1]=g[F+m+1]+I,!X){for(B=-h[U],A=1;A<=a;A+=1)B+=s[A]*l[A][U];if(U>p)g[V+U]=B;else if(g[V+U]=-Math.abs(B),B>0){for(A=1;A<=a;A+=1)l[A][U]=-l[A][U];h[U]=-h[U]}return 700}for(m+=1,d[m]=U,C=D+(m-1)*m/2+1,S=1;S<=m-1;S+=1)g[C]=g[S],C+=1;if(m===a)g[C]=g[a];else{for(S=a;S>=m+1&&0!==g[S]&&(G=Math.max(Math.abs(g[S-1]),Math.abs(g[S])),j=Math.min(Math.abs(g[S-1]),Math.abs(g[S])),k=g[S-1]>=0?Math.abs(G*Math.sqrt(1+j*j/(G*G))):-Math.abs(G*Math.sqrt(1+j*j/(G*G))),G=g[S-1]/k,j=g[S]/k,1!==G);S-=1)if(0===G)for(g[S-1]=j*k,A=1;A<=a;A+=1)k=e[A][S-1],e[A][S-1]=e[A][S],e[A][S]=k;else for(g[S-1]=k,H=j/(1+G),A=1;A<=a;A+=1)k=G*e[A][S-1]+j*e[A][S],e[A][S]=H*(e[A][S-1]+k)-e[A][S],e[A][S-1]=k;g[C]=g[m]}return 0}function b(){if(C=D+L*(L+1)/2+1,T=C+L,0===g[T])return 798;if(G=Math.max(Math.abs(g[T-1]),Math.abs(g[T])),j=Math.min(Math.abs(g[T-1]),Math.abs(g[T])),k=g[T-1]>=0?Math.abs(G*Math.sqrt(1+j*j/(G*G))):-Math.abs(G*Math.sqrt(1+j*j/(G*G))),G=g[T-1]/k,j=g[T]/k,1===G)return 798;if(0===G){for(S=L+1;S<=m;S+=1)k=g[T-1],g[T-1]=g[T],g[T]=k,T+=S;for(S=1;S<=a;S+=1)k=e[S][L],e[S][L]=e[S][L+1],e[S][L+1]=k}else{for(H=j/(1+G),S=L+1;S<=m;S+=1)k=G*g[T-1]+j*g[T],g[T]=H*(g[T-1]+k)-g[T],g[T-1]=k,T+=S;for(S=1;S<=a;S+=1)k=G*e[S][L]+j*e[S][L+1],e[S][L+1]=H*(e[S][L]+k)-e[S][L+1],e[S][L]=k}return 0}function w(){for(T=C-L,S=1;S<=L;S+=1)g[T]=g[C],C+=1,T+=1;return g[F+L]=g[F+L+1],d[L]=d[L+1],L+=1,L<m?797:0}function M(){return g[F+m]=g[F+m+1],g[F+m+1]=0,d[m]=0,m-=1,v[2]=v[2]+1,0}var S,A,C,T,E,L,P,R,D,V,F,U,N,O,k,B,z,I,G,j,H,W,X,q,Y,K,Q;N=Math.min(a,f),C=2*a+N*(N+5)/2+2*f+1,q=1e-60;do q+=q,Y=1+.1*q,K=1+.2*q;while(Y<=1||K<=1);for(S=1;S<=a;S+=1)g[S]=t[S];for(S=a+1;S<=C;S+=1)g[S]=0;for(S=1;S<=f;S+=1)d[S]=0;if(E=[],0===y[1]){if(o(e,r,a,E),0!==E[1])return void(y[1]=2);n(e,r,a,t),i(e,r,a)}else{for(A=1;A<=a;A+=1)for(s[A]=0,S=1;S<=A;S+=1)s[A]=s[A]+e[S][A]*t[S];for(A=1;A<=a;A+=1)for(t[A]=0,S=A;S<=a;S+=1)t[A]=t[A]+e[A][S]*s[S]}for(c[1]=0,A=1;A<=a;A+=1)for(s[A]=t[A],c[1]=c[1]+g[A]*s[A],g[A]=0,S=A+1;S<=a;S+=1)e[S][A]=0;for(c[1]=-c[1]/2,y[1]=0,P=a,R=P+a,F=R+N,D=F+N+1,V=D+N*(N+1)/2,O=V+f,S=1;S<=f;S+=1){for(B=0,A=1;A<=a;A+=1)B+=l[A][S]*l[A][S];g[O+S]=Math.sqrt(B)}for(m=0,v[1]=0,v[2]=0,Q=0;;){if(Q=x(),999===Q)return;for(;;){if(Q=_(),0===Q)break;if(999===Q)return;if(700===Q)if(L===m)M();else{for(;;)if(b(),Q=w(),797!==Q)break;M()}}}}function s(e,i,n,o,s,c){e=t(e),i=t(i),n=t(n);var l,h,u,f,p,d,m=[],v=[],g=[],y=[],x=[];if(s=s||0,c=c?t(c):[void 0,0],o=o?t(o):[],h=e.length-1,u=n[1].length-1,!o)for(l=1;l<=u;l+=1)o[l]=0;for(l=1;l<=u;l+=1)v[l]=0;for(f=0,p=Math.min(h,u),l=1;l<=h;l+=1)g[l]=0;for(m[1]=0,l=1;l<=2*h+p*(p+5)/2+2*u+1;l+=1)y[l]=0;for(l=1;l<=2;l+=1)x[l]=0;return a(e,i,h,h,g,m,n,o,h,u,s,v,f,x,y,c),d="",1===c[1]&&(d="constraints are inconsistent, no solution!"),2===c[1]&&(d="matrix D in quadratic function is not positive definite!"),{solution:r(g),value:r(m),unconstrained_solution:r(i),iterations:r(x),iact:r(v),message:d}}e.solveQP=s}(numeric),numeric.svd=function(e){function t(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var r,i=numeric.epsilon,n=1e-64/i,o=50,a=0,s=0,c=0,l=0,h=0,u=numeric.clone(e),f=u.length,p=u[0].length;if(f<p)throw"Need more rows than columns";var d=new Array(p),m=new Array(p);for(s=0;s<p;s++)d[s]=m[s]=0;var v=numeric.rep([p,p],0),g=0,y=0,x=0,_=0,b=0,w=0,M=0;for(s=0;s<p;s++){for(d[s]=y,M=0,h=s+1,c=s;c<f;c++)M+=u[c][s]*u[c][s];if(M<=n)y=0;else for(g=u[s][s],y=Math.sqrt(M),g>=0&&(y=-y),x=g*y-M,u[s][s]=g-y,c=h;c<p;c++){for(M=0,l=s;l<f;l++)M+=u[l][s]*u[l][c];for(g=M/x,l=s;l<f;l++)u[l][c]+=g*u[l][s]}for(m[s]=y,M=0,c=h;c<p;c++)M+=u[s][c]*u[s][c];if(M<=n)y=0;else{for(g=u[s][s+1],y=Math.sqrt(M),g>=0&&(y=-y),x=g*y-M,u[s][s+1]=g-y,c=h;c<p;c++)d[c]=u[s][c]/x;for(c=h;c<f;c++){for(M=0,l=h;l<p;l++)M+=u[c][l]*u[s][l];for(l=h;l<p;l++)u[c][l]+=M*d[l]}}b=Math.abs(m[s])+Math.abs(d[s]),b>_&&(_=b)}for(s=p-1;s!=-1;s+=-1){if(0!=y){for(x=y*u[s][s+1],c=h;c<p;c++)v[c][s]=u[s][c]/x;for(c=h;c<p;c++){for(M=0,l=h;l<p;l++)M+=u[s][l]*v[l][c];for(l=h;l<p;l++)v[l][c]+=M*v[l][s]}}for(c=h;c<p;c++)v[s][c]=0,v[c][s]=0;v[s][s]=1,y=d[s],h=s}for(s=p-1;s!=-1;s+=-1){for(h=s+1,y=m[s],c=h;c<p;c++)u[s][c]=0;if(0!=y){for(x=u[s][s]*y,c=h;c<p;c++){for(M=0,l=h;l<f;l++)M+=u[l][s]*u[l][c];for(g=M/x,l=s;l<f;l++)u[l][c]+=g*u[l][s]}for(c=s;c<f;c++)u[c][s]=u[c][s]/y}else for(c=s;c<f;c++)u[c][s]=0;u[s][s]+=1}for(i*=_,l=p-1;l!=-1;l+=-1)for(var S=0;S<o;S++){var A=!1;for(h=l;h!=-1;h+=-1){if(Math.abs(d[h])<=i){A=!0;break}if(Math.abs(m[h-1])<=i)break}if(!A){a=0,M=1;var C=h-1;for(s=h;s<l+1&&(g=M*d[s],d[s]=a*d[s],!(Math.abs(g)<=i));s++)for(y=m[s],x=t(g,y),m[s]=x,a=y/x,M=-g/x,c=0;c<f;c++)b=u[c][C],w=u[c][s],u[c][C]=b*a+w*M,u[c][s]=-b*M+w*a}if(w=m[l],h==l){if(w<0)for(m[l]=-w,c=0;c<p;c++)v[c][l]=-v[c][l];break}if(S>=o-1)throw"Error: no convergence.";for(_=m[h],b=m[l-1],y=d[l-1],x=d[l],g=((b-w)*(b+w)+(y-x)*(y+x))/(2*x*b),y=t(g,1),g=g<0?((_-w)*(_+w)+x*(b/(g-y)-x))/_:((_-w)*(_+w)+x*(b/(g+y)-x))/_,a=1,M=1,s=h+1;s<l+1;s++){for(y=d[s],b=m[s],x=M*y,y=a*y,w=t(g,x),d[s-1]=w,a=g/w,M=x/w,g=_*a+y*M,y=-_*M+y*a,x=b*M,b*=a,c=0;c<p;c++)_=v[c][s-1],w=v[c][s],v[c][s-1]=_*a+w*M,v[c][s]=-_*M+w*a;for(w=t(g,x),m[s-1]=w,a=g/w,M=x/w,g=a*y+M*b,_=-M*y+a*b,c=0;c<f;c++)b=u[c][s-1],w=u[c][s],u[c][s-1]=b*a+w*M,u[c][s]=-b*M+w*a}d[h]=0,d[l]=g,m[l]=_}for(s=0;s<m.length;s++)m[s]<i&&(m[s]=0);for(s=0;s<p;s++)for(c=s-1;c>=0;c--)if(m[c]<m[s]){for(a=m[c],m[c]=m[s],m[s]=a,l=0;l<u.length;l++)r=u[l][s],u[l][s]=u[l][c],u[l][c]=r;for(l=0;l<v.length;l++)r=v[l][s],v[l][s]=v[l][c],v[l][c]=r;s=c}return{U:u,S:m,V:v}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],40:[function(e,t,r){t.exports=function(){var e=0,t=arguments[0],r=1,i=!1;arguments[1]&&("inclusive"==arguments[1]?i=!0:(e=arguments[0],t=arguments[1])),
arguments[2]&&("inclusive"==arguments[2]?i=!0:r=arguments[2]),arguments[3]&&"inclusive"==arguments[3]&&(i=!0);var n=[];if(e>=t){i&&--t;for(var o=e;o>t;o-=r)n.push(o)}else if(e<=t){i&&++t;for(var o=e;o<t;o+=r)n.push(o)}return n}},{}],41:[function(e,t,r){var i=i||{},n={REVISION:"66.81"};i.console=i.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!i.requestAnimationFrame;++r)i.requestAnimationFrame=i[t[r]+"RequestAnimationFrame"],i.cancelAnimationFrame=i[t[r]+"CancelAnimationFrame"]||i[t[r]+"CancelRequestAnimationFrame"];void 0===i.requestAnimationFrame&&void 0!==i.setTimeout&&(i.requestAnimationFrame=function(t){var r=Date.now(),n=Math.max(0,16-(r-e)),o=i.setTimeout(function(){t(r+n)},n);return e=r+n,o}),void 0===i.cancelAnimationFrame&&void 0!==i.clearTimeout&&(i.cancelAnimationFrame=function(e){i.clearTimeout(e)})}(),n.ExceptionErrorHandler=function(e,t){console.error(e),console.error(t);var r=new Error(e);throw r.optionalData=t,r},n.ConsoleErrorHandler=function(e,t){console.error(e),console.error(t)},n.ConsoleWarningHandler=function(e,t){console.warn(e),console.warn(t)},n.NullHandler=function(e,t){},n.onerror=n.ExceptionErrorHandler,n.onwarning=n.ConsoleWarningHandler,n.CullFaceNone=0,n.CullFaceBack=1,n.CullFaceFront=2,n.CullFaceFrontBack=3,n.FrontFaceDirectionCW=0,n.FrontFaceDirectionCCW=1,n.BasicShadowMap=0,n.PCFShadowMap=1,n.PCFSoftShadowMap=2,n.FrontSide=0,n.BackSide=1,n.DoubleSide=2,n.NoShading=0,n.FlatShading=1,n.SmoothShading=2,n.NoColors=0,n.FaceColors=1,n.VertexColors=2,n.NoBlending=0,n.NormalBlending=1,n.AdditiveBlending=2,n.SubtractiveBlending=3,n.MultiplyBlending=4,n.CustomBlending=5,n.AddEquation=100,n.SubtractEquation=101,n.ReverseSubtractEquation=102,n.ZeroFactor=200,n.OneFactor=201,n.SrcColorFactor=202,n.OneMinusSrcColorFactor=203,n.SrcAlphaFactor=204,n.OneMinusSrcAlphaFactor=205,n.DstAlphaFactor=206,n.OneMinusDstAlphaFactor=207,n.DstColorFactor=208,n.OneMinusDstColorFactor=209,n.SrcAlphaSaturateFactor=210,n.MultiplyOperation=0,n.MixOperation=1,n.AddOperation=2,n.UVMapping=function(){},n.CubeReflectionMapping=function(){},n.CubeRefractionMapping=function(){},n.SphericalReflectionMapping=function(){},n.SphericalRefractionMapping=function(){},n.RepeatWrapping=1e3,n.ClampToEdgeWrapping=1001,n.MirroredRepeatWrapping=1002,n.NearestFilter=1003,n.NearestMipMapNearestFilter=1004,n.NearestMipMapLinearFilter=1005,n.LinearFilter=1006,n.LinearMipMapNearestFilter=1007,n.LinearMipMapLinearFilter=1008,n.Linear=3e3,n.sRGB=3001,n.RGBE=3002,n.LogLUV=3003,n.RGBM7=3004,n.RGBM16=3005,n.UnsignedByteType=1009,n.ByteType=1010,n.ShortType=1011,n.UnsignedShortType=1012,n.IntType=1013,n.UnsignedIntType=1014,n.FloatType=1015,n.HalfType=2005,n.UnsignedShort4444Type=1016,n.UnsignedShort5551Type=1017,n.UnsignedShort565Type=1018,n.AlphaFormat=1019,n.RGBFormat=1020,n.RGBAFormat=1021,n.LuminanceFormat=1022,n.LuminanceAlphaFormat=1023,n.RGB_S3TC_DXT1_Format=2001,n.RGBA_S3TC_DXT1_Format=2002,n.RGBA_S3TC_DXT3_Format=2003,n.RGBA_S3TC_DXT5_Format=2004,n.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},n.Color.prototype={constructor:n.Color,r:1,g:1,b:1,set:function(e){return e instanceof n.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var i=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e},n=r<=.5?r*(1+t):r+t-r*t,o=2*r-n;this.r=i(o,n,e+1/3),this.g=i(o,n,e),this.b=i(o,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(n.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,i=e||{h:0,s:0,l:0},n=this.r,o=this.g,a=this.b,s=Math.max(n,o,a),c=Math.min(n,o,a),l=(c+s)/2;if(c===s)t=0,r=0;else{var h=s-c;switch(r=l<=.5?h/(s+c):h/(2-s-c),s){case n:t=(o-a)/h+(o<a?6:0);break;case o:t=(a-n)/h+2;break;case a:t=(n-o)/h+4}t/=6}return i.h=t,i.s=r,i.l=l,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new n.Color).setRGB(this.r,this.g,this.b)}},n.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},n.Quaternion=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1},n.Quaternion.prototype={constructor:n.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(e){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){if(!(e instanceof n.Euler))return n.onerror("expecting a Euler",e);var r=Math.cos(e._x/2),i=Math.cos(e._y/2),o=Math.cos(e._z/2),a=Math.sin(e._x/2),s=Math.sin(e._y/2),c=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=a*i*o+r*s*c,this._y=r*s*o-a*i*c,this._z=r*i*c+a*s*o,this._w=r*i*o-a*s*c):"YXZ"===e.order?(this._x=a*i*o+r*s*c,this._y=r*s*o-a*i*c,this._z=r*i*c-a*s*o,this._w=r*i*o+a*s*c):"ZXY"===e.order?(this._x=a*i*o-r*s*c,this._y=r*s*o+a*i*c,this._z=r*i*c+a*s*o,this._w=r*i*o-a*s*c):"ZYX"===e.order?(this._x=a*i*o-r*s*c,this._y=r*s*o+a*i*c,this._z=r*i*c-a*s*o,this._w=r*i*o+a*s*c):"YZX"===e.order?(this._x=a*i*o+r*s*c,this._y=r*s*o+a*i*c,this._z=r*i*c-a*s*o,this._w=r*i*o-a*s*c):"XZY"===e.order&&(this._x=a*i*o-r*s*c,this._y=r*s*o-a*i*c,this._z=r*i*c+a*s*o,this._w=r*i*o+a*s*c),t!==!1&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._updateEuler(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],c=r[9],l=r[2],h=r[6],u=r[10],f=i+s+u;return f>0?(t=.5/Math.sqrt(f+1),this._w=.25/t,this._x=(h-c)*t,this._y=(o-l)*t,this._z=(a-n)*t):i>s&&i>u?(t=2*Math.sqrt(1+i-s-u),this._w=(h-c)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+l)/t):s>u?(t=2*Math.sqrt(1+s-i-u),this._w=(o-l)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(c+h)/t):(t=2*Math.sqrt(1+u-i-s),this._w=(a-n)/t,this._x=(o+l)/t,this._y=(c+h)/t,this._z=.25*t),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},add:function(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this},sub:function(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this},multiplyScalar:function(e){return this._x*=e,this._y*=e,this._z*=e,this._w*=e,this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,o=e._w,a=t._x,s=t._y,c=t._z,l=t._w;return this._x=r*l+o*a+i*c-n*s,this._y=i*l+o*s+n*a-r*c,this._z=n*l+o*c+r*s-i*a,this._w=o*l-r*a-i*s-n*c,this._updateEuler(),this},multiplyVector3:function(e){return n.onwarning("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var r=this._x,i=this._y,n=this._z,o=this._w,a=o*e._w+r*e._x+i*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=n,this;var s=Math.acos(a),c=Math.sqrt(1-a*a);if(Math.abs(c)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(n+this._z),this;var l=Math.sin((1-t)*s)/c,h=Math.sin(t*s)/c;return this._w=o*l+this._w*h,this._x=r*l+this._x*h,this._y=i*l+this._y*h,this._z=n*l+this._z*h,this._updateEuler(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new n.Quaternion(this._x,this._y,this._z,this._w)}},n.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},n.Vector2=function(e,t){this.x=e||0,this.y=t||0},n.Vector2.prototype={constructor:n.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:return n.onerror("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:return n.onerror("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new n.Vector2,t=new n.Vector2),e.set(r,r),t.set(i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new n.Vector2(this.x,this.y)}},n.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},n.Vector3.prototype={constructor:n.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:return n.onerror("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:return n.onerror("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(n.onwarningn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof n.Euler?(void 0===e&&(e=new n.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this):n.onerror("expecting an Euler",t)}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new n.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,c=s*t+o*i-a*r,l=s*r+a*t-n*i,h=s*i+n*r-o*t,u=-n*t-o*r-a*i;return this.x=c*s+u*-n+l*-a-h*-o,this.y=l*s+u*-o+h*-n-c*-a,this.z=h*s+u*-a+c*-o-l*-n,this},transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new n.Vector3,t=new n.Vector3),e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return n.onwarning("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,o=this.z;return this.x=i*e.z-o*e.y,this.y=o*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-n*a,this.y=n*o-r*s,this.z=r*a-i*o,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new n.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new n.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new n.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(n.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){n.onerror("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){n.onerror("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return n.onwarning("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return n.onwarning("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return n.onwarning("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new n.Vector3(this.x,this.y,this.z)}},n.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},n.Vector4.prototype={constructor:n.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:return n.onerror("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:return n.onerror("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=.01,a=.1,s=e.elements,c=s[0],l=s[4],h=s[8],u=s[1],f=s[5],p=s[9],d=s[2],m=s[6],v=s[10];if(Math.abs(l-u)<o&&Math.abs(h-d)<o&&Math.abs(p-m)<o){if(Math.abs(l+u)<a&&Math.abs(h+d)<a&&Math.abs(p+m)<a&&Math.abs(c+f+v-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var g=(c+1)/2,y=(f+1)/2,x=(v+1)/2,_=(l+u)/4,b=(h+d)/4,w=(p+m)/4;return g>y&&g>x?g<o?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(g),i=_/r,n=b/r):y>x?y<o?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(y),r=_/i,n=w/i):x<o?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(x),r=b/n,i=w/n),this.set(r,i,n,t),this}var M=Math.sqrt((m-p)*(m-p)+(h-d)*(h-d)+(u-l)*(u-l));return Math.abs(M)<.001&&(M=1),this.x=(m-p)/M,this.y=(h-d)/M,this.z=(u-l)/M,this.w=Math.acos((c+f+v-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new n.Vector4,t=new n.Vector4),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new n.Vector4(this.x,this.y,this.z,this.w)}},n.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||n.Euler.DefaultOrder},n.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n.Euler.DefaultOrder="XYZ",n.Euler.prototype={constructor:n.Euler,_x:0,_y:0,_z:0,_order:n.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this._updateQuaternion(),this},setFromVector:function(e,t){return this._x=e.x,this._y=e.y,this._z=e.z,this._order=t||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t,r){function i(e){return Math.min(Math.max(e,-1),1)}var o=e.elements,a=o[0],s=o[4],c=o[8],l=o[1],h=o[5],u=o[9],f=o[2],p=o[6],d=o[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(c)),Math.abs(c)<.99999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(p,h),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(c,d),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-f,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(p)),Math.abs(p)<.99999?(this._y=Math.atan2(-f,d),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-i(f)),Math.abs(f)<.99999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===t?(this._z=Math.asin(i(l)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-f,a)):(this._x=0,this._y=Math.atan2(c,d))):"XZY"===t?(this._z=Math.asin(-i(s)),Math.abs(s)<.99999?(this._x=Math.atan2(p,h),this._y=Math.atan2(c,a)):(this._x=Math.atan2(-u,d),this._y=0)):n.onwarning("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,r!==!1&&this._updateQuaternion(),this},setFromQuaternion:function(){var e=null;return function(t,r,i){return e=e||new n.Matrix4,e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,i),
this}}(),reorder:function(){var e=new n.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new n.Vector3(this._x,this._y,this._z)},clone:function(){return new n.Euler(this._x,this._y,this._z,this._order)}},n.Line3=function(e,t){this.start=void 0!==e?e:new n.Vector3,this.end=void 0!==t?t:new n.Vector3},n.Line3.prototype={constructor:n.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new n.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new n.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new n.Vector3,t=new n.Vector3;return function(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var o=t.dot(t),a=t.dot(e),s=a/o;return i&&(s=n.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),o=r||new n.Vector3;return this.delta(o).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new n.Line3).copy(this)}},n.Box2=function(e,t){this.min=void 0!==e?e:new n.Vector2(1/0,1/0),this.max=void 0!==t?t:new n.Vector2((-(1/0)),(-(1/0)))},n.Box2.prototype={constructor:n.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;r<i;r++)t=e[r],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new n.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new n.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){var r=t||new n.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){var r=t||new n.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new n.Box2).copy(this)}},n.Box3=function(e,t){this.min=void 0!==e?e:new n.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new n.Vector3((-(1/0)),(-(1/0)),(-(1/0)))},n.Box3.prototype={constructor:n.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;r<i;r++)this.addPoint(e[r])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new n.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new n.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var i=t.geometry.vertices,n=0,o=i.length;n<o;n++)e.copy(i[n]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){var r=t||new n.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){var r=t||new n.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new n.Vector3;return function(t){var r=t||new n.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new n.Box3).copy(this)}},n.Matrix3=function(e,t,r,i,n,o,a,s,c){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,r||0,i||0,void 0!==n?n:1,o||0,a||0,s||0,void 0!==c?c:1)},n.Matrix3.prototype={constructor:n.Matrix3,set:function(e,t,r,i,n,o,a,s,c){var l=this.elements;return l[0]=e,l[3]=t,l[6]=r,l[1]=i,l[4]=n,l[7]=o,l[2]=a,l[5]=s,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return n.onwarning("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new n.Vector3;return function(t){for(var r=0,i=t.length;r<i;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyMatrix3(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],c=e[7],l=e[8];return t*o*l-t*a*c-r*n*l+r*a*s+i*n*c-i*o*s},getInverse:function(e,t){if(!(e instanceof n.Matrix4))return n.onerror("expecting a Matrix4",e);var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var o=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];return 0===o?t===!0?n.onerror("Matrix3.getInverse(): can't invert matrix, determinant is 0",this):(this.identity(),this):(this.multiplyScalar(1/o),this)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new n.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},n.Matrix4=function(e,t,r,i,n,o,a,s,c,l,h,u,f,p,d,m){this.elements=new Float32Array(16);var v=this.elements;v[0]=void 0!==e?e:1,v[4]=t||0,v[8]=r||0,v[12]=i||0,v[1]=n||0,v[5]=void 0!==o?o:1,v[9]=a||0,v[13]=s||0,v[2]=c||0,v[6]=l||0,v[10]=void 0!==h?h:1,v[14]=u||0,v[3]=f||0,v[7]=p||0,v[11]=d||0,v[15]=void 0!==m?m:1},n.Matrix4.prototype={constructor:n.Matrix4,set:function(e,t,r,i,n,o,a,s,c,l,h,u,f,p,d,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=i,v[1]=n,v[5]=o,v[9]=a,v[13]=s,v[2]=c,v[6]=l,v[10]=h,v[14]=u,v[3]=f,v[7]=p,v[11]=d,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return n.onwarning("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),r.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,r){this.identity();var i=this.elements;return i.elements[0]=e.x,i.elements[1]=e.y,i.elements[2]=e.z,i.elements[4]=t.x,i.elements[5]=t.y,i.elements[6]=t.z,i.elements[8]=r.x,i.elements[9]=r.y,i.elements[10]=r.z,this},extractRotation:function(){var e=new n.Vector3;return function(t){var r=this.elements,i=t.elements,n=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[4]=i[4]*o,r[5]=i[5]*o,r[6]=i[6]*o,r[8]=i[8]*a,r[9]=i[9]*a,r[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){if(!(e instanceof n.Euler))return n.onerror("expecting a Euler",e);var t=this.elements,r=e.x,i=e.y,o=e.z,a=Math.cos(r),s=Math.sin(r),c=Math.cos(i),l=Math.sin(i),h=Math.cos(o),u=Math.sin(o);if("XYZ"===e.order){var f=a*h,p=a*u,d=s*h,m=s*u;t[0]=c*h,t[4]=-c*u,t[8]=l,t[1]=p+d*l,t[5]=f-m*l,t[9]=-s*c,t[2]=m-f*l,t[6]=d+p*l,t[10]=a*c}else if("YXZ"===e.order){var v=c*h,g=c*u,y=l*h,x=l*u;t[0]=v+x*s,t[4]=y*s-g,t[8]=a*l,t[1]=a*u,t[5]=a*h,t[9]=-s,t[2]=g*s-y,t[6]=x+v*s,t[10]=a*c}else if("ZXY"===e.order){var v=c*h,g=c*u,y=l*h,x=l*u;t[0]=v-x*s,t[4]=-a*u,t[8]=y+g*s,t[1]=g+y*s,t[5]=a*h,t[9]=x-v*s,t[2]=-a*l,t[6]=s,t[10]=a*c}else if("ZYX"===e.order){var f=a*h,p=a*u,d=s*h,m=s*u;t[0]=c*h,t[4]=d*l-p,t[8]=f*l+m,t[1]=c*u,t[5]=m*l+f,t[9]=p*l-d,t[2]=-l,t[6]=s*c,t[10]=a*c}else if("YZX"===e.order){var _=a*c,b=a*l,w=s*c,M=s*l;t[0]=c*h,t[4]=M-_*u,t[8]=w*u+b,t[1]=u,t[5]=a*h,t[9]=-s*h,t[2]=-l*h,t[6]=b*u+w,t[10]=_-M*u}else if("XZY"===e.order){var _=a*c,b=a*l,w=s*c,M=s*l;t[0]=c*h,t[4]=-u,t[8]=l*h,t[1]=_*u+M,t[5]=a*h,t[9]=b*u-w,t[2]=w*u-b,t[6]=s*h,t[10]=M*u+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return n.onwarning("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,o=e.w,a=r+r,s=i+i,c=n+n,l=r*a,h=r*s,u=r*c,f=i*s,p=i*c,d=n*c,m=o*a,v=o*s,g=o*c;return t[0]=1-(f+d),t[4]=h-g,t[8]=u+v,t[1]=h+g,t[5]=1-(l+d),t[9]=p-m,t[2]=u-v,t[6]=p+m,t[10]=1-(l+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(i,n,o){var a=this.elements;return r.subVectors(i,n).normalize(),0===r.length()&&(r.z=1),e.crossVectors(o,r).normalize(),0===e.length()&&(r.x+=1e-4,e.crossVectors(o,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(n.onwarning("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyList:function(e){for(var t=0,r=e.length;t<r;t++)this.multiplyMatrices(this,e[t]);return this},multiplyMatricesList:function(e){return e.length>0?(this.copy(e[0]),this.multiplyList(e.slice(1))):this.identity(),this},multiplyMatrices:function(e,t){if(!(e instanceof n.Matrix4))return n.onerror("expecting a Matrix4",e);if(!(t instanceof n.Matrix4))return n.onerror("expecting a Matrix4",t);var r=e.elements,i=t.elements,o=this.elements,a=r[0],s=r[4],c=r[8],l=r[12],h=r[1],u=r[5],f=r[9],p=r[13],d=r[2],m=r[6],v=r[10],g=r[14],y=r[3],x=r[7],_=r[11],b=r[15],w=i[0],M=i[4],S=i[8],A=i[12],C=i[1],T=i[5],E=i[9],L=i[13],P=i[2],R=i[6],D=i[10],V=i[14],F=i[3],U=i[7],N=i[11],O=i[15];return o[0]=a*w+s*C+c*P+l*F,o[4]=a*M+s*T+c*R+l*U,o[8]=a*S+s*E+c*D+l*N,o[12]=a*A+s*L+c*V+l*O,o[1]=h*w+u*C+f*P+p*F,o[5]=h*M+u*T+f*R+p*U,o[9]=h*S+u*E+f*D+p*N,o[13]=h*A+u*L+f*V+p*O,o[2]=d*w+m*C+v*P+g*F,o[6]=d*M+m*T+v*R+g*U,o[10]=d*S+m*E+v*D+g*N,o[14]=d*A+m*L+v*V+g*O,o[3]=y*w+x*C+_*P+b*F,o[7]=y*M+x*T+_*R+b*U,o[11]=y*S+x*E+_*D+b*N,o[15]=y*A+x*L+_*V+b*O,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return n.onwarning("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return n.onwarning("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new n.Vector3;return function(t){for(var r=0,i=t.length;r<i;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyProjection(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),rotateAxis:function(e){n.onwarning("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return n.onwarning("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],c=e[13],l=e[2],h=e[6],u=e[10],f=e[14],p=e[3],d=e[7],m=e[11],v=e[15];return p*(+n*s*h-i*c*h-n*a*u+r*c*u+i*a*f-r*s*f)+d*(+t*s*f-t*c*u+n*o*u-i*o*f+i*c*l-n*s*l)+m*(+t*c*h-t*a*f-n*o*h+r*o*f+n*a*l-r*c*l)+v*(-i*a*l-t*s*h+t*a*u+i*o*h-r*o*u+r*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new n.Vector3;return function(){n.onwarning("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,o=i[0],a=i[4],s=i[8],c=i[12],l=i[1],h=i[5],u=i[9],f=i[13],p=i[2],d=i[6],m=i[10],v=i[14],g=i[3],y=i[7],x=i[11],_=i[15];r[0]=u*v*y-f*m*y+f*d*x-h*v*x-u*d*_+h*m*_,r[4]=c*m*y-s*v*y-c*d*x+a*v*x+s*d*_-a*m*_,r[8]=s*f*y-c*u*y+c*h*x-a*f*x-s*h*_+a*u*_,r[12]=c*u*d-s*f*d-c*h*m+a*f*m+s*h*v-a*u*v,r[1]=f*m*g-u*v*g-f*p*x+l*v*x+u*p*_-l*m*_,r[5]=s*v*g-c*m*g+c*p*x-o*v*x-s*p*_+o*m*_,r[9]=c*u*g-s*f*g-c*l*x+o*f*x+s*l*_-o*u*_,r[13]=s*f*p-c*u*p+c*l*m-o*f*m-s*l*v+o*u*v,r[2]=h*v*g-f*d*g+f*p*y-l*v*y-h*p*_+l*d*_,r[6]=c*d*g-a*v*g-c*p*y+o*v*y+a*p*_-o*d*_,r[10]=a*f*g-c*h*g+c*l*y-o*f*y-a*l*_+o*h*_,r[14]=c*h*p-a*f*p-c*l*d+o*f*d+a*l*v-o*h*v,r[3]=u*d*g-h*m*g-u*p*y+l*m*y+h*p*x-l*d*x,r[7]=a*m*g-s*d*g+s*p*y-o*m*y-a*p*x+o*d*x,r[11]=s*h*g-a*u*g-s*l*y+o*u*y+a*l*x-o*h*x,r[15]=a*u*p-s*h*p+s*l*d-o*u*d-a*l*m+o*h*m;var b=o*r[0]+l*r[4]+p*r[8]+g*r[12];return 0==b?t===!0?n.onerror("Matrix4.getInverse(): can't invert matrix, determinant is 0",this):(this.identity(),this):(this.multiplyScalar(1/b),this)},translate:function(e){n.onerror("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){n.onerror("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){n.onerror("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){n.onerror("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){n.onerror("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,c=n*o,l=n*a;return this.set(c*o+r,c*a-i*s,c*s+i*a,0,c*a+i*s,l*a+r,l*s-i*o,0,c*s-i*a,l*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t){var r=e.x,i=e.y,n=e.z;return t?this.set(1,0,0,0,r,1,0,0,i,n,1,0,0,0,0,1):this.set(1,r,i,0,0,1,n,0,0,0,1,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new n.Vector3,t=new n.Matrix4;return function(r,i,n){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),c=e.set(o[8],o[9],o[10]).length(),l=this.determinant();l<0&&(a=-a),r.x=o[12],r.y=o[13],r.z=o[14],t.elements.set(this.elements);var h=1/a,u=1/s,f=1/c;return t.elements[0]*=h,t.elements[1]*=h,t.elements[2]*=h,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=f,t.elements[9]*=f,t.elements[10]*=f,i.setFromRotationMatrix(t),n.x=a,n.y=s,n.z=c,this}}(),makeFrustum:function(e,t,r,i,n,o,a,s){var c=this.elements,l=2*n/(t-e),h=2*n/(i-r),u=(t+e)/(t-e),f=(i+r)/(i-r),p=-(o+n)/(o-n),d=-2*o*n/(o-n);return c[0]=l,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=h,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=d,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,a&&s&&(0!==s.x&&(c[8]+=2*a.x/s.x),0!==s.y&&(c[9]+=2*a.y/s.y)),this},makePerspective:function(e,t,r,i,o,a){var s=r*Math.tan(n.Math.degToRad(.5*e)),c=-s,l=c*t,h=s*t;return this.makeFrustum(l,h,c,s,r,i,o,a)},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=t-e,c=r-i,l=o-n,h=(t+e)/s,u=(r+i)/c,f=(o+n)/l;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2/c,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/l,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new n.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},n.Ray=function(e,t){this.origin=void 0!==e?e:new n.Vector3,this.direction=void 0!==t?t:new n.Vector3},n.Ray.prototype={constructor:n.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new n.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new n.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new n.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return i<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,r,i){var n,o,a,s,c=e.clone().add(t).multiplyScalar(.5),l=t.clone().sub(e).normalize(),h=.5*e.distanceTo(t),u=this.origin.clone().sub(c),f=-this.direction.dot(l),p=u.dot(this.direction),d=-u.dot(l),m=u.lengthSq(),v=Math.abs(1-f*f);if(v>=0)if(n=f*d-p,o=f*p-d,s=h*v,n>=0)if(o>=-s)if(o<=s){var g=1/v;n*=g,o*=g,a=n*(n+f*o+2*p)+o*(f*n+o+2*d)+m}else o=h,n=Math.max(0,-(f*o+p)),a=-n*n+o*(o+2*d)+m;else o=-h,n=Math.max(0,-(f*o+p)),a=-n*n+o*(o+2*d)+m;else o<=-s?(n=Math.max(0,-(-f*h+p)),o=n>0?-h:Math.min(Math.max(-h,-d),h),a=-n*n+o*(o+2*d)+m):o<=s?(n=0,o=Math.min(Math.max(-h,-d),h),a=o*(o+2*d)+m):(n=Math.max(0,-(f*h+p)),o=n>0?h:Math.min(Math.max(-h,-d),h),a=-n*n+o*(o+2*d)+m);else o=f>0?-h:h,n=Math.max(0,-(f*o+p)),a=-n*n+o*(o+2*d)+m;return r&&r.copy(this.direction.clone().multiplyScalar(n).add(this.origin)),i&&i.copy(l.clone().multiplyScalar(o).add(c)),a},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return r*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:function(){var e=new n.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var r,i,n,o,a,s,c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(r=(e.min.x-u.x)*c,i=(e.max.x-u.x)*c):(r=(e.max.x-u.x)*c,i=(e.min.x-u.x)*c),l>=0?(n=(e.min.y-u.y)*l,o=(e.max.y-u.y)*l):(n=(e.max.y-u.y)*l,o=(e.min.y-u.y)*l),r>o||n>i?null:((n>r||r!==r)&&(r=n),(o<i||i!==i)&&(i=o),h>=0?(a=(e.min.z-u.z)*h,s=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,s=(e.min.z-u.z)*h),r>s||a>i?null:((a>r||r!==r)&&(r=a),(s<i||i!==i)&&(i=s),i<0?null:this.at(r>=0?r:i,t)))},intersectTriangle:function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3,i=new n.Vector3;return function(n,o,a,s,c){t.subVectors(o,n),r.subVectors(a,n),i.crossVectors(t,r);var l,h=this.direction.dot(i);if(h>0){if(s)return null;l=1}else{if(!(h<0))return null;l=-1,h=-h}e.subVectors(this.origin,n);var u=l*this.direction.dot(r.crossVectors(e,r));if(u<0)return null;var f=l*this.direction.dot(t.cross(e));if(f<0)return null;if(u+f>h)return null;var p=-l*e.dot(i);return p<0?null:this.at(p/h,c)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new n.Ray).copy(this)}},n.Sphere=function(e,t){this.center=void 0!==e?e:new n.Vector3,this.radius=void 0!==t?t:0},n.Sphere.prototype={constructor:n.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new n.Box3;return function(t,r){var i=this.center;void 0!==r?i.copy(r):e.setFromPoints(t).center(i);for(var n=0,o=i.x,a=i.y,s=i.z,c=0,l=t.length;c<l;c++){var h=t[c],u=o-h.x,f=a-h.y,p=s-h.z,d=u*u+f*f+p*p;n=Math.max(n,d)}return this.radius=Math.sqrt(n),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new n.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new n.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new n.Sphere).copy(this)}},n.Frustum=function(e,t,r,i,o,a){this.planes=[void 0!==e?e:new n.Plane,void 0!==t?t:new n.Plane,void 0!==r?r:new n.Plane,void 0!==i?i:new n.Plane,void 0!==o?o:new n.Plane,void 0!==a?a:new n.Plane]},n.Frustum.prototype={constructor:n.Frustum,set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],c=r[5],l=r[6],h=r[7],u=r[8],f=r[9],p=r[10],d=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(a-i,h-s,d-u,y-m).normalize(),t[1].setComponents(a+i,h+s,d+u,y+m).normalize(),t[2].setComponents(a+n,h+c,d+f,y+v).normalize(),t[3].setComponents(a-n,h-c,d-f,y-v).normalize(),t[4].setComponents(a-o,h-l,d-p,y-g).normalize(),t[5].setComponents(a+o,h+l,d+p,y+g).normalize(),this},intersectsObject:function(){var e=new n.Sphere;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){var o=t[n].distanceToPoint(r);if(o<i)return!1}return!0},intersectsBox:function(){var e=new n.Vector3,t=new n.Vector3;return function(r){for(var i=this.planes,n=0;n<6;n++){var o=i[n];e.x=o.normal.x>0?r.min.x:r.max.x,t.x=o.normal.x>0?r.max.x:r.min.x,e.y=o.normal.y>0?r.min.y:r.max.y,t.y=o.normal.y>0?r.max.y:r.min.y,e.z=o.normal.z>0?r.min.z:r.max.z,t.z=o.normal.z>0?r.max.z:r.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new n.Frustum).copy(this)}},n.Plane=function(e,t){this.normal=void 0!==e?e:new n.Vector3(1,0,0),this.constant=void 0!==t?t:0},n.Plane.prototype={constructor:n.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new n.Vector3,t=new n.Vector3;return function(r,i,n){var o=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i=t||new n.Vector3;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectLine:function(){var e=new n.Vector3;return function(t,r){var i=r||new n.Vector3,o=t.delta(e),a=this.normal.dot(o);if(0!=a){var s=-(t.start.dot(this.normal)+this.constant)/a;if(!(s<0||s>1))return i.copy(o).multiplyScalar(s).add(t.start)}else if(0==this.distanceToPoint(t.start))return i.copy(t.start)}}(),coplanarPoint:function(e){var t=e||new n.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Matrix3;return function(i,o){if(!(i instanceof n.Matrix4))return n.onerror("expecting a Matrix4",i);var a=o||r.getNormalMatrix(i),s=e.copy(this.normal).applyMatrix3(a),c=this.coplanarPoint(t);return c.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(s,c),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new n.Plane).copy(this)}},n.Math={PI2:2*Math.PI,DegreeToRadiansFactor:Math.PI/180,
RadianToDegreesFactor:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;return function(){for(var n=0;n<36;n++)8==n||13==n||18==n||23==n?r[n]="-":14==n?r[n]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[n]=t[19==n?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return e<t?t:e>r?r:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(e){return e*this.DegreeToRadiansFactor},radToDeg:function(e){return e*this.RadianToDegreesFactor},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e}},n.Spline=function(e){function t(e,t,r,i,n,o,a){var s=.5*(r-e),c=.5*(i-t);return(2*(t-r)+s+c)*a+(-3*(t-r)-2*s-c)*o+s*n+t}this.points=e;var r,i,o,a,s,c,l,h,u,f=[],p={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),o=r-i,f[0]=0===i?i:i-1,f[1]=i,f[2]=i>this.points.length-2?this.points.length-1:i+1,f[3]=i>this.points.length-3?this.points.length-1:i+2,c=this.points[f[0]],l=this.points[f[1]],h=this.points[f[2]],u=this.points[f[3]],a=o*o,s=o*a,p.x=t(c.x,l.x,h.x,u.x,o,a,s),p.y=t(c.y,l.y,h.y,u.y,o,a,s),p.z=t(c.z,l.z,h.z,u.z,o,a,s),p},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;e<r;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,o,a=0,s=0,c=0,l=new n.Vector3,h=new n.Vector3,u=[],f=0;for(u[0]=0,e||(e=100),i=this.points.length*e,l.copy(this.points[0]),t=1;t<i;t++)r=t/i,o=this.getPoint(r),h.copy(o),f+=h.distanceTo(l),l.copy(o),a=(this.points.length-1)*r,s=Math.floor(a),s!=c&&(u[s]=f,c=s);return u[u.length]=f,{chunks:u,total:f}},this.reparametrizeByArcLength=function(e){var t,r,i,o,a,s,c,l,h=[],u=new n.Vector3,f=this.getLength();for(h.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=f.chunks[t]-f.chunks[t-1],c=Math.ceil(e*s/f.total),o=(t-1)/(this.points.length-1),a=t/(this.points.length-1),r=1;r<c-1;r++)i=o+r*(1/c)*(a-o),l=this.getPoint(i),h.push(u.copy(l).clone());h.push(u.copy(this.points[t]).clone())}this.points=h}},n.Triangle=function(e,t,r){this.a=void 0!==e?e:new n.Vector3,this.b=void 0!==t?t:new n.Vector3,this.c=void 0!==r?r:new n.Vector3},n.Triangle.normal=function(){var e=new n.Vector3;return function(t,r,i,o){var a=o||new n.Vector3;a.subVectors(i,r),e.subVectors(t,r),a.cross(e);var s=a.lengthSq();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),n.Triangle.barycoordFromPoint=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(i,o,a,s,c){e.subVectors(s,o),t.subVectors(a,o),r.subVectors(i,o);var l=e.dot(e),h=e.dot(t),u=e.dot(r),f=t.dot(t),p=t.dot(r),d=l*f-h*h,m=c||new n.Vector3;if(0==d)return m.set(-2,-1,-1);var v=1/d,g=(f*u-h*p)*v,y=(l*p-h*u)*v;return m.set(1-g-y,y,g)}}(),n.Triangle.containsPoint=function(){var e=new n.Vector3;return function(t,r,i,o){var a=n.Triangle.barycoordFromPoint(t,r,i,o,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),n.Triangle.prototype={constructor:n.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new n.Vector3,t=new n.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new n.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return n.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new n.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return n.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return n.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new n.Triangle).copy(this)}},n.Vertex=function(e){return n.onerror("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")},n.UV=function(e,t){return n.onerror("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new n.Vector2(e,t)},n.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},n.Clock.prototype={constructor:n.Clock,start:function(){this.startTime=void 0!==i.performance&&void 0!==i.performance.now?i.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==i.performance&&void 0!==i.performance.now?i.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},n.EventDispatcher=function(){},n.EventDispatcher.prototype={constructor:n.EventDispatcher,apply:function(e){e.addEventListener=n.EventDispatcher.prototype.addEventListener,e.hasEventListener=n.EventDispatcher.prototype.hasEventListener,e.removeEventListener=n.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=n.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&r[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,i=r[e];if(void 0!==i){var n=i.indexOf(t);n!==-1&&i.splice(n,1)}}},dispatchEvent:function(){var e=[];return function(t){if(void 0!==this._listeners){var r=this._listeners,i=r[t.type];if(void 0!==i){t.target=this;for(var n=i.length,o=0;o<n;o++)e[o]=i[o];for(var o=0;o<n;o++)e[o].call(this,t)}}}}()},function(e){e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r),this.near=i||0,this.far=n||1/0};var t=new e.Sphere,r=new e.Ray,i=(new e.Plane,new e.Vector3,new e.Vector3),n=new e.Matrix4,o=function(e,t){return e.distance-t.distance},a=new e.Vector3,s=new e.Vector3,c=new e.Vector3,l=function(o,h,u){if(o instanceof e.Sprite){i.setFromMatrixPosition(o.matrixWorld);var f=h.ray.distanceToPoint(i);if(f>o.scale.x)return u;u.push({distance:f,point:o.position,face:null,object:o})}else if(o instanceof e.LOD){i.setFromMatrixPosition(o.matrixWorld);var f=h.ray.origin.distanceTo(i);l(o.getObjectForDistance(f),h,u)}else if(o instanceof e.Mesh){var p=o.geometry;if(null===p.boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(o.matrixWorld),h.ray.isIntersectionSphere(t)===!1)return u;if(n.getInverse(o.matrixWorld),r.copy(h.ray).applyMatrix4(n),null!==p.boundingBox&&r.isIntersectionBox(p.boundingBox)===!1)return u;if(p instanceof e.BufferGeometry){var d=o.material;if(void 0===d)return u;var m,v,g,y=p.attributes,x=h.precision;if(void 0!==y.index)for(var _=p.offsets,b=y.index.array,w=y.position.array,M=0,S=_.length;M<S;++M)for(var A=_[M].start,C=_[M].count,T=_[M].index,E=A,L=A+C;E<L;E+=3){if(m=T+b[E],v=T+b[E+1],g=T+b[E+2],a.set(w[3*m],w[3*m+1],w[3*m+2]),s.set(w[3*v],w[3*v+1],w[3*v+2]),c.set(w[3*g],w[3*g+1],w[3*g+2]),d.side===e.BackSide)var P=r.intersectTriangle(c,s,a,!0);else var P=r.intersectTriangle(a,s,c,d.side!==e.DoubleSide);if(null!==P){P.applyMatrix4(o.matrixWorld);var f=h.ray.origin.distanceTo(P);f<x||f<h.near||f>h.far||u.push({distance:f,point:P,indices:[m,v,g],face:null,faceIndex:null,object:o})}}else for(var _=p.offsets,w=y.position.array,E=0,L=y.position.array.length;E<L;E+=3){if(m=E,v=E+1,g=E+2,a.set(w[3*m],w[3*m+1],w[3*m+2]),s.set(w[3*v],w[3*v+1],w[3*v+2]),c.set(w[3*g],w[3*g+1],w[3*g+2]),d.side===e.BackSide)var P=r.intersectTriangle(c,s,a,!0);else var P=r.intersectTriangle(a,s,c,d.side!==e.DoubleSide);if(null!==P){P.applyMatrix4(o.matrixWorld);var f=h.ray.origin.distanceTo(P);f<x||f<h.near||f>h.far||u.push({distance:f,point:P,indices:[m,v,g],face:null,faceIndex:null,object:o})}}}else if(p instanceof e.Geometry)for(var m,v,g,R=o.material instanceof e.MeshFaceMaterial,D=R===!0?o.material.materials:null,x=h.precision,V=p.vertices,F=0,U=p.faces.length;F<U;F++){var N=p.faces[F],d=R===!0?D[N.materialIndex]:o.material;if(void 0!==d){if(m=V[N.a],v=V[N.b],g=V[N.c],d.morphTargets===!0){var O=p.morphTargets,k=o.morphTargetInfluences;a.set(0,0,0),s.set(0,0,0),c.set(0,0,0);for(var B=0,z=O.length;B<z;B++){var I=k[B];if(0!==I){var G=O[B].vertices;a.x+=(G[N.a].x-m.x)*I,a.y+=(G[N.a].y-m.y)*I,a.z+=(G[N.a].z-m.z)*I,s.x+=(G[N.b].x-v.x)*I,s.y+=(G[N.b].y-v.y)*I,s.z+=(G[N.b].z-v.z)*I,c.x+=(G[N.c].x-g.x)*I,c.y+=(G[N.c].y-g.y)*I,c.z+=(G[N.c].z-g.z)*I}}a.add(m),s.add(v),c.add(g),m=a,v=s,g=c}if(d.side===e.BackSide)var P=r.intersectTriangle(g,v,m,!0);else var P=r.intersectTriangle(m,v,g,d.side!==e.DoubleSide);if(null!==P){P.applyMatrix4(o.matrixWorld);var f=h.ray.origin.distanceTo(P);f<x||f<h.near||f>h.far||u.push({distance:f,point:P,face:N,faceIndex:F,object:o})}}}}else if(o instanceof e.Line){var x=h.linePrecision,j=x*x,p=o.geometry;if(null===p.boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(o.matrixWorld),h.ray.isIntersectionSphere(t)===!1)return u;if(n.getInverse(o.matrixWorld),r.copy(h.ray).applyMatrix4(n),p instanceof e.Geometry)for(var V=p.vertices,H=V.length,W=new e.Vector3,X=new e.Vector3,q=o.type===e.LineStrip?1:2,E=0;E<H-1;E+=q){var Y=r.distanceSqToSegment(V[E],V[E+1],X,W);if(!(Y>j)){var f=r.origin.distanceTo(X);f<h.near||f>h.far||u.push({distance:f,point:W.clone().applyMatrix4(o.matrixWorld),face:null,faceIndex:null,object:o})}}}},h=function(e,t,r){for(var i=e.getDescendants(),n=0,o=i.length;n<o;n++)l(i[n],t,r)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var r=[];return t===!0&&h(e,this,r),l(e,this,r),r.sort(o),r},e.Raycaster.prototype.intersectObjects=function(e,t){for(var r=[],i=0,n=e.length;i<n;i++)l(e[i],this,r),t===!0&&h(e[i],this,r);return r.sort(o),r}}(n),n.Object3D=function(){this.id=n.Object3DIdCount++,this.uuid=n.Math.generateUUID(),this.className="Object3D",this.name="",this.parent=void 0,this.children=[],this.up=new n.Vector3(0,1,0),this.position=new n.Vector3,this._rotation=new n.Euler,this._quaternion=new n.Quaternion,this.scale=new n.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},n.Object3D.prototype={constructor:n.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return n.onwarning("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){n.onwarning("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){n.onwarning("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){n.onwarning("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new n.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new n.Vector3;return function(t,r){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return n.onwarning("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new n.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new n.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this)return void n.onwarning("THREE.Object3D.add: An object can't be added as a child of itself.");if(e instanceof n.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof n.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof n.Scene&&r.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,r=this.children.length;t<r;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];if(n.id===e)return n;if(t===!0&&(n=n.getObjectById(e,t),void 0!==n))return n}},getObjectByName:function(e,t){for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];if(n.name===e)return n;if(t===!0&&(n=n.getObjectByName(e,t),void 0!==n))return n}},getChildByName:function(e,t){return n.onwarning("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,r=this.children.length;t<r;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&e!==!0||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){if(void 0===e&&(e=new n.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var r=0;r<this.children.length;r++){var i=this.children[r];e.add(i.clone())}return e}},n.EventDispatcher.prototype.apply(n.Object3D.prototype),n.Object3DIdCount=0,n.Projector=function(){function e(){if(l===_){var e=new n.RenderableObject;return x.push(e),_++,l++,e}return x[l++]}function t(){if(u===w){var e=new n.RenderableVertex;return b.push(e),w++,u++,e}return b[u++]}function r(){if(p===S){var e=new n.RenderableFace;return M.push(e),S++,p++,e}return M[p++]}function i(){if(m===C){var e=new n.RenderableLine;return A.push(e),C++,m++,e}return A[m++]}function o(){if(g===E){var e=new n.RenderableSprite;return T.push(e),E++,g++,e}return T[g++]}function a(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function s(e,t){var r=0,i=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?r=Math.max(r,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?r=Math.max(r,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<r)&&(e.lerp(t,r),t.lerp(e,1-i),!0))}var c,l,h,u,f,p,d,m,v,g,y,x=[],_=0,b=[],w=0,M=[],S=0,A=[],C=0,T=[],E=0,L={objects:[],lights:[],elements:[]},P=new n.Vector3,R=new n.Vector3,D=new n.Vector3,V=new n.Vector3,F=new n.Vector4,U=new n.Box3(new n.Vector3((-1),(-1),(-1)),new n.Vector3(1,1,1)),N=new n.Box3,O=new Array(3),k=(new Array(4),new n.Matrix4),B=new n.Matrix4,z=new n.Matrix4,I=new n.Matrix3,G=new n.Frustum,j=new n.Vector4,H=new n.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(B)},this.unprojectVector=function(){var e=new n.Matrix4;return function(t,r){return e.getInverse(r.projectionMatrix),B.multiplyMatrices(r.matrixWorld,e),t.applyProjection(B)}}(),this.pickingRay=function(e,t){e.z=-1;var r=new n.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new n.Raycaster(e,r)};var W=function(t){if(t.visible!==!1){t instanceof n.Light?L.lights.push(t):(t instanceof n.Mesh||t instanceof n.Line||t instanceof n.Sprite)&&(t.frustumCulled!==!1&&G.intersectsObject(t)!==!0||(c=e(),c.id=t.id,c.object=t,null!==t.renderDepth?c.z=t.renderDepth:(V.setFromMatrixPosition(t.matrixWorld),V.applyProjection(B),c.z=V.z),L.objects.push(c)));for(var r=0,i=t.children.length;r<i;r++)W(t.children[r])}},X=function(e,t){l=0,L.objects.length=0,L.lights.length=0,W(e),t===!0&&L.objects.sort(a)},q=function(){var e=[],o=null,a=new n.Matrix3,s=function(t){o=t,a.getNormalMatrix(o.matrixWorld),e.length=0},c=function(e){var t=e.position,r=e.positionWorld,i=e.positionScreen;r.copy(t).applyMatrix4(y),i.copy(r).applyMatrix4(B);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1},l=function(e,r,i){h=t(),h.position.set(e,r,i),c(h)},u=function(t,r,i){e.push(t,r,i)},p=function(e,t,r){return O[0]=e.positionScreen,O[1]=t.positionScreen,O[2]=r.positionScreen,!(e.visible!==!0&&t.visible!==!0&&r.visible!==!0&&!U.isIntersectionBox(N.setFromPoints(O)))&&(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},m=function(e,t){var r=b[e],n=b[t];d=i(),d.id=o.id,d.v1.copy(r),d.v2.copy(n),d.z=(r.positionScreen.z+n.positionScreen.z)/2,d.material=o.material,L.elements.push(d)},v=function(t,i,n){var s=b[t],c=b[i],l=b[n];if(p(s,c,l)===!0){f=r(),f.id=o.id,f.v1.copy(s),f.v2.copy(c),f.v3.copy(l),f.z=(s.positionScreen.z+c.positionScreen.z+l.positionScreen.z)/3;for(var h=0;h<3;h++){var u=3*arguments[h],d=f.vertexNormalsModel[h];d.set(e[u+0],e[u+1],e[u+2]),d.applyMatrix3(a).normalize()}f.vertexNormalsLength=3,f.material=o.material,L.elements.push(f)}};return{setObject:s,projectVertex:c,checkTriangleVisibility:p,pushVertex:l,pushNormal:u,pushLine:m,pushTriangle:v}},Y=new q;this.projectScene=function(e,c,l,h){var x,_,w,M,S,A,C,T,E,V;p=0,m=0,g=0,L.elements.length=0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===c.parent&&c.updateMatrixWorld(),k.copy(c.matrixWorldInverse.getInverse(c.matrixWorld)),B.multiplyMatrices(c.projectionMatrix,k),G.setFromMatrix(B),X(e,l);for(var U=0,N=L.objects.length;U<N;U++)if(x=L.objects[U].object,_=x.geometry,Y.setObject(x),y=x.matrixWorld,u=0,x instanceof n.Mesh){if(_ instanceof n.BufferGeometry){var O=_.attributes,W=_.offsets;if(void 0===O.position)continue;for(var q=O.position.array,K=0,Q=q.length;K<Q;K+=3)Y.pushVertex(q[K],q[K+1],q[K+2]);for(var Z=O.normal.array,K=0,Q=Z.length;K<Q;K+=3)Y.pushNormal(Z[K],Z[K+1],Z[K+2]);if(void 0!==O.index){var J=O.index.array;if(W.length>0)for(var U=0;U<W.length;U++)for(var $=W[U],ee=$.index,K=$.start,Q=$.start+$.count;K<Q;K+=3)Y.pushTriangle(J[K]+ee,J[K+1]+ee,J[K+2]+ee);else for(var K=0,Q=J.length;K<Q;K+=3)Y.pushTriangle(J[K],J[K+1],J[K+2])}else for(var K=0,Q=q.length/3;K<Q;K+=3)Y.pushTriangle(K,K+1,K+2)}else if(_ instanceof n.Geometry){w=_.vertices,M=_.faces,C=_.faceVertexUvs,I.getNormalMatrix(y),E=x.material instanceof n.MeshFaceMaterial,V=E===!0?x.material:null;for(var te=0,re=w.length;te<re;te++){var ie=w[te];Y.pushVertex(ie.x,ie.y,ie.z)}for(var ne=0,oe=M.length;ne<oe;ne++){S=M[ne];var ae=E===!0?V.materials[S.materialIndex]:x.material;if(void 0!==ae){var se=ae.side,ce=b[S.a],le=b[S.b],he=b[S.c];if(ae.morphTargets===!0){var ue=_.morphTargets,fe=x.morphTargetInfluences,pe=ce.position,de=le.position,me=he.position;P.set(0,0,0),R.set(0,0,0),D.set(0,0,0);for(var ve=0,ge=ue.length;ve<ge;ve++){var ye=fe[ve];if(0!==ye){var xe=ue[ve].vertices;P.x+=(xe[S.a].x-pe.x)*ye,P.y+=(xe[S.a].y-pe.y)*ye,P.z+=(xe[S.a].z-pe.z)*ye,R.x+=(xe[S.b].x-de.x)*ye,R.y+=(xe[S.b].y-de.y)*ye,R.z+=(xe[S.b].z-de.z)*ye,D.x+=(xe[S.c].x-me.x)*ye,D.y+=(xe[S.c].y-me.y)*ye,D.z+=(xe[S.c].z-me.z)*ye}}ce.position.add(P),le.position.add(R),he.position.add(D),Y.projectVertex(ce),Y.projectVertex(le),Y.projectVertex(he)}var _e=Y.checkTriangleVisibility(ce,le,he);if(!(_e===!1&&se===n.FrontSide||_e===!0&&se===n.BackSide)){f=r(),f.id=x.id,f.v1.copy(ce),f.v2.copy(le),f.v3.copy(he),f.normalModel.copy(S.normal),_e!==!1||se!==n.BackSide&&se!==n.DoubleSide||f.normalModel.negate(),f.normalModel.applyMatrix3(I).normalize(),f.centroidModel.copy(S.centroid).applyMatrix4(y),A=S.vertexNormals;for(var be=0,we=Math.min(A.length,3);be<we;be++){var Me=f.vertexNormalsModel[be];Me.copy(A[be]),_e!==!1||se!==n.BackSide&&se!==n.DoubleSide||Me.negate(),Me.applyMatrix3(I).normalize()}f.vertexNormalsLength=A.length;for(var Se=0,Ae=Math.min(C.length,3);Se<Ae;Se++)if(T=C[Se][ne],void 0!==T)for(var Ce=0,Te=T.length;Ce<Te;Ce++)f.uvs[Se][Ce]=T[Ce];f.color=S.color,f.material=ae,f.z=(ce.positionScreen.z+le.positionScreen.z+he.positionScreen.z)/3,L.elements.push(f)}}}}}else if(x instanceof n.Line){if(_ instanceof n.BufferGeometry){var O=_.attributes;if(void 0!==O.position){for(var q=O.position.array,K=0,Q=q.length;K<Q;K+=3)Y.pushVertex(q[K],q[K+1],q[K+2]);if(void 0!==O.index)for(var J=O.index.array,K=0,Q=J.length;K<Q;K+=2)Y.pushLine(J[K],J[K+1]);else for(var K=0,Q=q.length/3-1;K<Q;K++)Y.pushLine(K,K+1)}}else if(_ instanceof n.Geometry){if(z.multiplyMatrices(B,y),w=x.geometry.vertices,0===w.length)continue;ce=t(),ce.positionScreen.copy(w[0]).applyMatrix4(z);for(var Ee=x.type===n.LinePieces?2:1,te=1,re=w.length;te<re;te++)ce=t(),ce.positionScreen.copy(w[te]).applyMatrix4(z),(te+1)%Ee>0||(le=b[u-2],j.copy(ce.positionScreen),H.copy(le.positionScreen),s(j,H)===!0&&(j.multiplyScalar(1/j.w),H.multiplyScalar(1/H.w),d=i(),d.id=x.id,d.v1.positionScreen.copy(j),d.v2.positionScreen.copy(H),d.z=Math.max(j.z,H.z),d.material=x.material,x.material.vertexColors===n.VertexColors&&(d.vertexColors[0].copy(x.geometry.colors[te]),d.vertexColors[1].copy(x.geometry.colors[te-1])),L.elements.push(d)))}}else if(x instanceof n.Sprite){F.set(y.elements[12],y.elements[13],y.elements[14],1),F.applyMatrix4(B);var Le=1/F.w;F.z*=Le,F.z>=-1&&F.z<=1&&(v=o(),v.id=x.id,v.x=F.x*Le,v.y=F.y*Le,v.z=F.z,v.object=x,v.rotation=x.rotation,v.scale.x=x.scale.x*Math.abs(v.x-(F.x+c.projectionMatrix.elements[0])/(F.w+c.projectionMatrix.elements[12])),v.scale.y=x.scale.y*Math.abs(v.y-(F.y+c.projectionMatrix.elements[5])/(F.w+c.projectionMatrix.elements[13])),v.material=x.material,L.elements.push(v))}return h===!0&&L.elements.sort(a),L}},n.Face3=function(e,t,r,i,o,a){this.a=e,this.b=t,this.c=r,this.normal=i instanceof n.Vector3?i:new n.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=o instanceof n.Color?o:new n.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new n.Vector3},n.Face3.prototype={constructor:n.Face3,clone:function(){var e=new n.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,r;for(t=0,r=this.vertexNormals.length;t<r;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;t<r;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;t<r;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},n.Face4=function(e,t,r,i,o,a,s){return n.onwarning("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new n.Face3(e,t,r,o,a,s)},n.BufferGeometry=function(){this.id=n.GeometryIdCount++,this.uuid=n.Math.generateUUID(),this.className="BufferGeometry",this.name="",this.attributes={},this.offsets=[],this.boundingBox=null,this.boundingSphere=null},n.BufferGeometry.prototype={constructor:n.BufferGeometry,addAttribute:function(e,t,r,i){return this.attributes[e]={array:new t(r*i),itemSize:i},this.attributes[e]},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.multiplyVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var i=(new n.Matrix3).getNormalMatrix(e);i.multiplyVector3Array(r.array),r.needsUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new n.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;e.length>=3&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var r=3,i=e.length;r<i;r+=3){var o=e[r],a=e[r+1],s=e[r+2];o<t.min.x?t.min.x=o:o>t.max.x&&(t.max.x=o),a<t.min.y?t.min.y=a:a>t.max.y&&(t.max.y=a),s<t.min.z?t.min.z=s:s>t.max.z&&(t.max.z=s)}}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new n.Box3,t=new n.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var i=this.boundingSphere.center,o=0,a=r.length;o<a;o+=3)t.set(r[o],r[o+1],r[o+2]),e.addPoint(t);e.center(i);for(var s=0,o=0,a=r.length;o<a;o+=3)t.set(r[o],r[o+1],r[o+2]),s=Math.max(s,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,t,r,i,o=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(o)};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var a,s,c,l,h,u,f=this.attributes.position.array,p=this.attributes.normal.array,d=new n.Vector3,m=new n.Vector3,v=new n.Vector3,g=new n.Vector3,y=new n.Vector3;if(this.attributes.index){var x=this.attributes.index.array,_=this.offsets;for(r=0,i=_.length;r<i;++r){var b=_[r].start,w=_[r].count,M=_[r].index;for(e=b,t=b+w;e<t;e+=3)a=M+x[e],s=M+x[e+1],c=M+x[e+2],l=f[3*a],h=f[3*a+1],u=f[3*a+2],d.set(l,h,u),l=f[3*s],h=f[3*s+1],u=f[3*s+2],m.set(l,h,u),l=f[3*c],h=f[3*c+1],u=f[3*c+2],v.set(l,h,u),g.subVectors(v,m),y.subVectors(d,m),g.cross(y),p[3*a]+=g.x,p[3*a+1]+=g.y,p[3*a+2]+=g.z,p[3*s]+=g.x,p[3*s+1]+=g.y,p[3*s+2]+=g.z,p[3*c]+=g.x,p[3*c+1]+=g.y,p[3*c+2]+=g.z}}else for(e=0,t=f.length;e<t;e+=9)l=f[e],h=f[e+1],u=f[e+2],d.set(l,h,u),l=f[e+3],h=f[e+4],u=f[e+5],m.set(l,h,u),l=f[e+6],h=f[e+7],u=f[e+8],v.set(l,h,u),g.subVectors(v,m),y.subVectors(d,m),g.cross(y),p[e]=g.x,p[e+1]=g.y,p[e+2]=g.z,p[e+3]=g.x,p[e+4]=g.y,p[e+5]=g.z,p[e+6]=g.x,p[e+7]=g.y,p[e+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,r,i,n=this.attributes.normal.array,o=0,a=n.length;o<a;o+=3)e=n[o],t=n[o+1],r=n[o+2],i=1/Math.sqrt(e*e+t*t+r*r),n[o]*=i,n[o+1]*=i,n[o+2]*=i},computeTangents:function(){function e(e,t,r){p=i[3*e],d=i[3*e+1],m=i[3*e+2],v=i[3*t],g=i[3*t+1],y=i[3*t+2],x=i[3*r],_=i[3*r+1],b=i[3*r+2],w=a[2*e],M=a[2*e+1],S=a[2*t],A=a[2*t+1],C=a[2*r],T=a[2*r+1],E=v-p,L=x-p,P=g-d,R=_-d,D=y-m,V=b-m,F=S-w,U=C-w,N=A-M,O=T-M,k=1/(F*O-U*N),X.set((O*E-N*L)*k,(O*P-N*R)*k,(O*D-N*V)*k),q.set((F*L-U*E)*k,(F*R-U*P)*k,(F*V-U*D)*k),h[e].add(X),h[t].add(X),h[r].add(X),u[e].add(q),u[t].add(q),u[r].add(q)}function t(e){ie.x=o[3*e],ie.y=o[3*e+1],ie.z=o[3*e+2],ne.copy(ie),$=h[e],te.copy($),te.sub(ie.multiplyScalar(ie.dot($))).normalize(),re.crossVectors(ne,$),ee=re.dot(u[e]),J=ee<0?-1:1,l[4*e]=te.x,l[4*e+1]=te.y,l[4*e+2]=te.z,l[4*e+3]=J}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void n.onwarning("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var r=this.attributes.index.array,i=this.attributes.position.array,o=this.attributes.normal.array,a=this.attributes.uv.array,s=i.length/3;if(void 0===this.attributes.tangent){var c=4*s;this.attributes.tangent={itemSize:4,array:new Float32Array(c)}}for(var l=this.attributes.tangent.array,h=[],u=[],f=0;f<s;f++)h[f]=new n.Vector3,u[f]=new n.Vector3;var p,d,m,v,g,y,x,_,b,w,M,S,A,C,T,E,L,P,R,D,V,F,U,N,O,k,B,z,I,G,j,H,W,X=new n.Vector3,q=new n.Vector3,Y=this.offsets;for(I=0,G=Y.length;I<G;++I){var K=Y[I].start,Q=Y[I].count,Z=Y[I].index;for(B=K,z=K+Q;B<z;B+=3)j=Z+r[B],H=Z+r[B+1],W=Z+r[B+2],e(j,H,W)}var J,$,ee,te=new n.Vector3,re=new n.Vector3,ie=new n.Vector3,ne=new n.Vector3;for(I=0,G=Y.length;I<G;++I){var K=Y[I].start,Q=Y[I].count,Z=Y[I].index;for(B=K,z=K+Q;B<z;B+=3)j=Z+r[B],H=Z+r[B+1],W=Z+r[B+2],t(j),t(H),t(W)}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535);for(var r=(Date.now(),this.attributes.index.array),i=this.attributes.position.array,n=(i.length/3,r.length/3),o=new Uint16Array(r.length),a=0,s=0,c=[{start:0,count:0,index:0}],l=c[0],h=0,u=0,f=new Int32Array(6),p=new Int32Array(i.length),d=new Int32Array(i.length),m=0;m<i.length;m++)p[m]=-1,d[m]=-1;for(var v=0;v<n;v++){u=0;for(var g=0;g<3;g++){var y=r[3*v+g];p[y]==-1?(f[2*g]=y,f[2*g+1]=-1,u++):p[y]<l.index?(f[2*g]=y,f[2*g+1]=-1,h++):(f[2*g]=y,f[2*g+1]=p[y])}var x=s+u;if(x>l.index+t){var _={start:a,count:0,index:s};c.push(_),l=_;for(var b=0;b<6;b+=2){var w=f[b+1];w>-1&&w<l.index&&(f[b+1]=-1)}}for(var b=0;b<6;b+=2){var y=f[b],w=f[b+1];w===-1&&(w=s++),p[y]=w,d[w]=y,o[a++]=w-l.index,l.count++}}return this.reorderBuffers(o,d,s),this.offsets=c,c},reorderBuffers:function(e,t,r){var i={},n=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var o in this.attributes)if("index"!=o)for(var a=this.attributes[o].array,s=0,c=n.length;s<c;s++){var l=n[s];if(a instanceof l){i[o]=new l(this.attributes[o].itemSize*r);break}}for(var h=0;h<r;h++){
var u=t[h];for(var o in this.attributes)if("index"!=o)for(var f=this.attributes[o].array,p=this.attributes[o].itemSize,d=i[o],m=0;m<p;m++)d[h*p+m]=f[u*p+m]}this.attributes.index.array=e;for(var o in this.attributes)"index"!=o&&(this.attributes[o].array=i[o],this.attributes[o].numItems=this.attributes[o].itemSize*r)},clone:function(){var e=new n.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var r in this.attributes){for(var i=this.attributes[r],o=i.array,a={itemSize:i.itemSize,array:null},s=0,c=t.length;s<c;s++){var l=t[s];if(o instanceof l){a.array=new l(o);break}}e.attributes[r]=a}for(var s=0,c=this.offsets.length;s<c;s++){var h=this.offsets[s];e.offsets.push({start:h.start,index:h.index,count:h.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.BufferGeometry.prototype),n.Geometry=function(){this.id=n.GeometryIdCount++,this.uuid=n.Math.generateUUID(),this.className="Geometry",this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!0,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},n.Geometry.prototype={constructor:n.Geometry,applyMatrix:function(e){for(var t=(new n.Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){var o=this.vertices[r];o.applyMatrix4(e)}for(var r=0,i=this.faces.length;r<i;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var s=0,c=a.vertexNormals.length;s<c;s++)a.vertexNormals[s].applyMatrix3(t).normalize();a.centroid.applyMatrix4(e)}this.boundingBox instanceof n.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof n.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,r;for(e=0,t=this.faces.length;e<t;e++)r=this.faces[e],r.centroid.set(0,0,0),r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.divideScalar(3)},computeFaceNormals:function(){for(var e=new n.Vector3,t=new n.Vector3,r=0,i=this.faces.length;r<i;r++){var o=this.faces[r],a=this.vertices[o.a],s=this.vertices[o.b],c=this.vertices[o.c];e.subVectors(c,s),t.subVectors(a,s),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,o,a,s;for(s=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)s[t]=new n.Vector3;if(e){var c,l,h,u=new n.Vector3,f=new n.Vector3;new n.Vector3,new n.Vector3,new n.Vector3;for(i=0,o=this.faces.length;i<o;i++)a=this.faces[i],c=this.vertices[a.a],l=this.vertices[a.b],h=this.vertices[a.c],u.subVectors(h,l),f.subVectors(c,l),u.cross(f),s[a.a].add(u),s[a.b].add(u),s[a.c].add(u)}else for(i=0,o=this.faces.length;i<o;i++)a=this.faces[i],s[a.a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)s[t].normalize();for(i=0,o=this.faces.length;i<o;i++)a=this.faces[i],a.vertexNormals[0]=s[a.a].clone(),a.vertexNormals[1]=s[a.b].clone(),a.vertexNormals[2]=s[a.c].clone()},computeMorphNormals:function(){var e,t,r,i,o;for(r=0,i=this.faces.length;r<i;r++)for(o=this.faces[r],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var a=new n.Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s,c,l=this.morphNormals[e].faceNormals,h=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s=new n.Vector3,c={a:new n.Vector3,b:new n.Vector3,c:new n.Vector3},l.push(s),h.push(c)}var u=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var s,c;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s=u.faceNormals[r],c=u.vertexNormals[r],s.copy(o.normal),c.a.copy(o.vertexNormals[0]),c.b.copy(o.vertexNormals[1]),c.c.copy(o.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){function e(e,t,r,i,n,o,a){h=e.vertices[t],u=e.vertices[r],f=e.vertices[i],p=l[n],d=l[o],m=l[a],v=u.x-h.x,g=f.x-h.x,y=u.y-h.y,x=f.y-h.y,_=u.z-h.z,b=f.z-h.z,w=d.x-p.x,M=m.x-p.x,S=d.y-p.y,A=m.y-p.y,C=1/(w*A-M*S),D.set((A*v-S*g)*C,(A*y-S*x)*C,(A*_-S*b)*C),V.set((w*g-M*v)*C,(w*x-M*y)*C,(w*b-M*_)*C),P[t].add(D),P[r].add(D),P[i].add(D),R[t].add(V),R[r].add(V),R[i].add(V)}var t,r,i,o,a,s,c,l,h,u,f,p,d,m,v,g,y,x,_,b,w,M,S,A,C,T,E,L,P=[],R=[],D=new n.Vector3,V=new n.Vector3,F=new n.Vector3,U=new n.Vector3,N=new n.Vector3;for(i=0,o=this.vertices.length;i<o;i++)P[i]=new n.Vector3,R[i]=new n.Vector3;for(t=0,r=this.faces.length;t<r;t++)c=this.faces[t],l=this.faceVertexUvs[0][t],e(this,c.a,c.b,c.c,0,1,2);var O=["a","b","c","d"];for(t=0,r=this.faces.length;t<r;t++)for(c=this.faces[t],a=0;a<Math.min(c.vertexNormals.length,3);a++)N.copy(c.vertexNormals[a]),s=c[O[a]],T=P[s],F.copy(T),F.sub(N.multiplyScalar(N.dot(T))).normalize(),U.crossVectors(c.vertexNormals[a],T),E=U.dot(R[s]),L=E<0?-1:1,c.vertexTangents[a]=new n.Vector4(F.x,F.y,F.z,L);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;r<i;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e,t,r,i,n,o,a,s,c={},l=[],h=[],u=4,f=Math.pow(10,u);for(r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],t=Math.round(e.x*f)+"_"+Math.round(e.y*f)+"_"+Math.round(e.z*f),void 0===c[t]?(c[t]=r,l.push(this.vertices[r]),h[r]=l.length-1):h[r]=h[c[t]];var p=[];for(r=0,i=this.faces.length;r<i;r++){n=this.faces[r],n.a=h[n.a],n.b=h[n.b],n.c=h[n.c],o=[n.a,n.b,n.c];for(var d=-1,m=0;m<3;m++)if(o[m]==o[(m+1)%3]){d=m,p.push(r);break}}for(r=p.length-1;r>=0;r--){var v=p[r];for(this.faces.splice(v,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(v,1)}var g=this.vertices.length-l.length;return this.vertices=l,g},makeGroups:function(){var e=0;return function(t){var r,i,n,o,a,s={},c=this.morphTargets.length,l=this.morphNormals.length;for(this.geometryGroups={},r=0,i=this.faces.length;r<i;r++)n=this.faces[r],o=t?n.materialIndex:0,o in s||(s[o]={hash:o,counter:0}),a=s[o].hash+"_"+s[o].counter,a in this.geometryGroups||(this.geometryGroups[a]={faces3:[],materialIndex:o,vertices:0,numMorphTargets:c,numMorphNormals:l}),this.geometryGroups[a].vertices+3>65535&&(s[o].counter+=1,a=s[o].hash+"_"+s[o].counter,a in this.geometryGroups||(this.geometryGroups[a]={faces3:[],materialIndex:o,vertices:0,numMorphTargets:c,numMorphNormals:l})),this.geometryGroups[a].faces3.push(r),this.geometryGroups[a].vertices+=3;this.geometryGroupsList=[];for(var h in this.geometryGroups)this.geometryGroups[h].id=e++,this.geometryGroupsList.push(this.geometryGroups[h])}}(),clone:function(){for(var e=new n.Geometry,t=this.vertices,r=0,i=t.length;r<i;r++)e.vertices.push(t[r].clone());for(var o=this.faces,r=0,i=o.length;r<i;r++)e.faces.push(o[r].clone());for(var a=this.faceVertexUvs[0],r=0,i=a.length;r<i;r++){for(var s=a[r],c=[],l=0,h=s.length;l<h;l++)c.push(new n.Vector2(s[l].x,s[l].y));e.faceVertexUvs[0].push(c)}return e.morphTargets=this.morphTargets.slice(0),e.morphColors=this.morphColors.slice(0),e.morphNormals=this.morphNormals.slice(0),e.skinWeights=this.skinWeights.slice(0),e.skinIndices=this.skinIndices.slice(0),e.lineDistances=this.lineDistances.slice(0),this.boundingBox&&(e.boundingBox=this.boundingBox.clone()),this.boundingSphere&&(e.boundingSphere=this.boundingSphere.clone()),e.hasTangents=this.hasTangents,e.dynamic=this.dynamic,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.Geometry.prototype),n.GeometryIdCount=0,n.Geometry2=function(e){n.BufferGeometry.call(this),this.className="Geometry2",this.vertices=this.addAttribute("position",Float32Array,e,3).array,this.normals=this.addAttribute("normal",Float32Array,e,3).array,this.uvs=this.addAttribute("uv",Float32Array,e,2).array,this.boundingBox=null,this.boundingSphere=null},n.Geometry2.prototype=Object.create(n.BufferGeometry.prototype),n.Camera=function(){n.Object3D.call(this),this.matrixWorldInverse=new n.Matrix4,this.projectionMatrix=new n.Matrix4,this.normalizedViewport={x:0,y:0,width:1,height:1}},n.Camera.prototype=Object.create(n.Object3D.prototype),n.Camera.prototype.lookAt=function(){var e=new n.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),n.Camera.prototype.clone=function(e){return void 0===e&&(e=new n.Camera),n.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e.normalizedViewport={x:this.normalizedViewport.x,y:this.normalizedViewport.y,width:this.normalizedViewport.width,height:this.normalizedViewport.height},e},n.OrthographicCamera=function(e,t,r,i,o,a){n.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},n.OrthographicCamera.prototype=Object.create(n.Camera.prototype),n.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far);var e=new n.Matrix4;e.elements[0]*=this.normalizedViewport.width,e.elements[1]*=this.normalizedViewport.height,e.elements[12]+=this.normalizedViewport.x,e.elements[13]+=this.normalizedViewport.y,this.projectionMatrix=e.multiply(this.projectionMatrix)},n.OrthographicCamera.prototype.clone=function(){var e=new n.OrthographicCamera;return n.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},n.PerspectiveCamera=function(e,t,r,i,o,a){n.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.filmSize=void 0!==o?o:new n.Vector2(1,1),this.filmOffset=void 0!==a?a:new n.Vector2(0,0),this.updateProjectionMatrix()},n.PerspectiveCamera.prototype=Object.create(n.Camera.prototype),n.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*n.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=o,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(n.Math.degToRad(.5*this.fov))*this.near,r=-t,i=e*r,o=e*t,a=Math.abs(o-i),s=Math.abs(t-r);this.projectionMatrix.makeFrustum(i+this.x*a/this.fullWidth,i+(this.x+this.width)*a/this.fullWidth,t-(this.y+this.height)*s/this.fullHeight,t-this.y*s/this.fullHeight,this.near,this.far,this.filmOffset,this.filmSize)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far,this.filmOffset,this.filmSize);var c=new n.Matrix4;c.elements[0]*=this.normalizedViewport.width,c.elements[1]*=this.normalizedViewport.height,c.elements[12]+=this.normalizedViewport.x,c.elements[13]+=this.normalizedViewport.y,this.projectionMatrix=c.multiply(this.projectionMatrix)},n.PerspectiveCamera.prototype.clone=function(){var e=new n.PerspectiveCamera;return n.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.filmSize=this.filmSize,e.filmOffset=this.filmOffset,e},n.Light=function(e){n.Object3D.call(this),this.color=new n.Color(e)},n.Light.prototype=Object.create(n.Object3D.prototype),n.Light.prototype.clone=function(e){return void 0===e&&(e=new n.Light),n.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},n.AmbientLight=function(e){n.Light.call(this,e)},n.AmbientLight.prototype=Object.create(n.Light.prototype),n.AmbientLight.prototype.clone=function(){var e=new n.AmbientLight;return n.Light.prototype.clone.call(this,e),e},n.AreaLight=function(e,t,r,i,o){n.Light.call(this,e),this.position.set(0,1,0),this.target=new n.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decayExponent=void 0!==i?i:0,this.physicalFalloff=void 0!==o&&o,this.width=1,this.height=1},n.AreaLight.prototype=Object.create(n.Light.prototype),n.AreaLight.prototype.clone=function(){var e=new n.AreaLight;return n.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.decayExponent=this.decayExponent,e.physicalFalloff=this.physicalFalloff,e.width=this.width,e.height=this.height,e},n.DirectionalLight=function(e,t){n.Light.call(this,e),this.position.set(0,1,0),this.target=new n.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new n.Vector3(0,0,(-1e3)),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.DirectionalLight.prototype=Object.create(n.Light.prototype),n.DirectionalLight.prototype.clone=function(){var e=new n.DirectionalLight;return n.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},n.HemisphereLight=function(e,t,r){n.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new n.Color(t),this.intensity=void 0!==r?r:1},n.HemisphereLight.prototype=Object.create(n.Light.prototype),n.HemisphereLight.prototype.clone=function(){var e=new n.HemisphereLight;return n.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},n.PointLight=function(e,t,r,i,o){n.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decayExponent=void 0!==i?i:0,this.physicalFalloff=void 0!==o&&o},n.PointLight.prototype=Object.create(n.Light.prototype),n.PointLight.prototype.clone=function(){var e=new n.PointLight;return n.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decayExponent=this.decayExponent,e.physicalFalloff=this.physicalFalloff,e},n.SpotLight=function(e,t,r,i,o,a,s){n.Light.call(this,e),this.position.set(0,1,0),this.target=new n.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decayExponent=void 0!==a?a:0,this.physicalFalloff=void 0!==s&&s,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==o?o:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.SpotLight.prototype=Object.create(n.Light.prototype),n.SpotLight.prototype.clone=function(){var e=new n.SpotLight;return n.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decayExponent=this.decayExponent,e.physicalFalloff=this.physicalFalloff,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},n.Loader=function(e){this.showStatus=e,this.statusDomElement=e?n.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},n.Loader.prototype={constructor:n.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var r=[],i=0;i<e.length;++i)r[i]=n.Loader.prototype.createMaterial(e[i],t);return r},needsTangents:function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t];if(i instanceof n.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function r(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function o(e,t){var n=new Image;n.onload=function(){if(r(this.width)&&r(this.height))e.image=this;else{var t=i(this.width),n=i(this.height);e.image.width=t,e.image.height=n,e.image.getContext("2d").drawImage(this,0,0,t,n)}e.needsUpdate=!0},void 0!==c.crossOrigin&&(n.crossOrigin=c.crossOrigin),n.src=t}function a(e,r,i,a,s,c,l){var h=/\.dds$/i.test(i),u=t+i;if(h){var f=n.ImageUtils.loadCompressedTexture(u);e[r]=f}else{var f=document.createElement("canvas");e[r]=new n.Texture(f)}if(e[r].sourceFile=i,a&&(e[r].repeat.set(a[0],a[1]),1!==a[0]&&(e[r].wrapS=n.RepeatWrapping),1!==a[1]&&(e[r].wrapT=n.RepeatWrapping)),s&&e[r].offset.set(s[0],s[1]),c){var p={repeat:n.RepeatWrapping,mirror:n.MirroredRepeatWrapping};void 0!==p[c[0]]&&(e[r].wrapS=p[c[0]]),void 0!==p[c[1]]&&(e[r].wrapT=p[c[1]])}l&&(e[r].anisotropy=l),h||o(e[r],u)}function s(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var c=this,l="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var u=e.shading.toLowerCase();"phong"===u?l="MeshPhongMaterial":"basic"===u?l="MeshBasicMaterial":"physical"===u&&(l="MeshPhysicalMaterial")}if(void 0!==e.blending&&void 0!==n[e.blending]&&(h.blending=n[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(h.transparent=e.transparent),void 0!==e.depthTest&&(h.depthTest=e.depthTest),void 0!==e.depthWrite&&(h.depthWrite=e.depthWrite),void 0!==e.visible&&(h.visible=e.visible),void 0!==e.flipSided&&(h.side=n.BackSide),void 0!==e.doubleSided&&(h.side=n.DoubleSide),void 0!==e.wireframe&&(h.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?h.vertexColors=n.FaceColors:e.vertexColors&&(h.vertexColors=n.VertexColors)),e.colorDiffuse?h.color=s(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor),e.colorSpecular&&(h.specular=s(e.colorSpecular)),e.colorAmbient&&(h.ambient=s(e.colorAmbient)),e.transparency&&(h.opacity=e.transparency),e.specularCoef&&(h.shininess=e.specularCoef),e.mapDiffuse&&t&&a(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&a(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&a(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&a(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&a(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(h.bumpScale=e.mapBumpScale),e.mapNormal){var f=n.ShaderLib.normalmap,p=n.UniformsUtils.clone(f.uniforms);p.tNormal.value=h.normalMap,e.mapNormalFactor&&p.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),h.map&&(p.tDiffuse.value=h.map,p.enableDiffuse.value=!0),h.specularMap&&(p.tSpecular.value=h.specularMap,p.enableSpecular.value=!0),h.lightMap&&(p.tAO.value=h.lightMap,p.enableAO.value=!0),p.diffuse.value.setHex(h.color),p.specular.value.setHex(h.specular),p.ambient.value.setHex(h.ambient),p.shininess.value=h.shininess,void 0!==h.opacity&&(p.opacity.value=h.opacity);var d={fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:p,lights:!0,fog:!0},m=new n.ShaderMaterial(d);h.transparent&&(m.transparent=!0)}else var m=new n[l](h);return void 0!==e.DbgName&&(m.name=e.DbgName),m}},n.XHRLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.XHRLoader.prototype={constructor:n.XHRLoader,load:function(e,t,r,i){var n=this,o=new XMLHttpRequest;void 0!==t&&o.addEventListener("load",function(r){t(r.target.responseText),n.manager.itemEnd(e)},!1),void 0!==r&&o.addEventListener("progress",function(e){r(e)},!1),void 0!==i&&o.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.open("GET",e,!0),o.send(null),n.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},n.ImageLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.ImageLoader.prototype={constructor:n.ImageLoader,load:function(e,t,r,i){var n=this,o=document.createElement("img");return void 0!==t&&o.addEventListener("load",function(r){n.manager.itemEnd(e),t(this)},!1),void 0!==r&&o.addEventListener("progress",function(e){r(e)},!1),void 0!==i&&o.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.src=e,n.manager.itemStart(e),o},setCrossOrigin:function(e){this.crossOrigin=e}},n.JSONLoader=function(e){n.Loader.call(this,e),this.withCredentials=!1},n.JSONLoader.prototype=Object.create(n.Loader.prototype),n.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},n.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,o){var a=new XMLHttpRequest,s=0;a.onreadystatechange=function(){if(a.readyState===a.DONE)if(200===a.status||0===a.status){if(a.responseText){var c=JSON.parse(a.responseText);if("scene"===c.metadata.type)return void n.onerror('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');var l=e.parse(c,i);r(l.geometry,l.materials)}else n.onerror('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else n.onerror("THREE.JSONLoader: Couldn't load \""+t+'" ('+a.status+")");else a.readyState===a.LOADING?o&&(0===s&&(s=a.getResponseHeader("Content-Length")),o({total:s,loaded:a.responseText.length})):a.readyState===a.HEADERS_RECEIVED&&void 0!==o&&(s=a.getResponseHeader("Content-Length"))},a.open("GET",t,!0),a.withCredentials=this.withCredentials,a.send(null)},n.JSONLoader.prototype.parse=function(e,t){function r(t){function r(e,t){return e&1<<t}var i,o,s,c,l,h,u,f,p,d,m,v,g,y,x,_,b,w,M,S,A,C,T,E,L,P,R,D=e.faces,V=e.vertices,F=e.normals,U=e.colors,N=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&N++;for(i=0;i<N;i++)a.faceVertexUvs[i]=[]}for(c=0,l=V.length;c<l;)w=new n.Vector3,w.x=V[c++]*t,w.y=V[c++]*t,w.z=V[c++]*t,a.vertices.push(w);for(c=0,l=D.length;c<l;)if(d=D[c++],m=r(d,0),v=r(d,1),g=r(d,3),y=r(d,4),x=r(d,5),_=r(d,6),b=r(d,7),m){if(S=new n.Face3,S.a=D[c],S.b=D[c+1],S.c=D[c+3],A=new n.Face3,A.a=D[c+1],A.b=D[c+2],A.c=D[c+3],c+=4,v&&(p=D[c++],S.materialIndex=p,A.materialIndex=p),s=a.faces.length,g)for(i=0;i<N;i++)for(E=e.uvs[i],a.faceVertexUvs[i][s]=[],a.faceVertexUvs[i][s+1]=[],o=0;o<4;o++)f=D[c++],P=E[2*f],R=E[2*f+1],L=new n.Vector2(P,R),2!==o&&a.faceVertexUvs[i][s].push(L),0!==o&&a.faceVertexUvs[i][s+1].push(L);if(y&&(u=3*D[c++],S.normal.set(F[u++],F[u++],F[u]),A.normal.copy(S.normal)),x)for(i=0;i<4;i++)u=3*D[c++],T=new n.Vector3(F[u++],F[u++],F[u]),2!==i&&S.vertexNormals.push(T),0!==i&&A.vertexNormals.push(T);if(_&&(h=D[c++],C=U[h],S.color.setHex(C),A.color.setHex(C)),b)for(i=0;i<4;i++)h=D[c++],C=U[h],2!==i&&S.vertexColors.push(new n.Color(C)),0!==i&&A.vertexColors.push(new n.Color(C));a.faces.push(S),a.faces.push(A)}else{if(M=new n.Face3,M.a=D[c++],M.b=D[c++],M.c=D[c++],v&&(p=D[c++],M.materialIndex=p),s=a.faces.length,g)for(i=0;i<N;i++)for(E=e.uvs[i],a.faceVertexUvs[i][s]=[],o=0;o<3;o++)f=D[c++],P=E[2*f],R=E[2*f+1],L=new n.Vector2(P,R),a.faceVertexUvs[i][s].push(L);if(y&&(u=3*D[c++],M.normal.set(F[u++],F[u++],F[u])),x)for(i=0;i<3;i++)u=3*D[c++],T=new n.Vector3(F[u++],F[u++],F[u]),M.vertexNormals.push(T);if(_&&(h=D[c++],M.color.setHex(U[h])),b)for(i=0;i<3;i++)h=D[c++],M.vertexColors.push(new n.Color(U[h]));a.faces.push(M)}}function i(){if(e.skinWeights)for(var t=0,r=e.skinWeights.length;t<r;t+=2){var i=e.skinWeights[t],o=e.skinWeights[t+1],s=0,c=0;a.skinWeights.push(new n.Vector4(i,o,s,c))}if(e.skinIndices)for(var t=0,r=e.skinIndices.length;t<r;t+=2){var l=e.skinIndices[t],h=e.skinIndices[t+1],u=0,f=0;a.skinIndices.push(new n.Vector4(l,h,u,f))}a.bones=e.bones,a.bones&&a.bones.length>0&&(a.skinWeights.length!==a.skinIndices.length||a.skinIndices.length!==a.vertices.length)&&n.onwarning("When skinning, number of vertices ("+a.vertices.length+"), skinIndices ("+a.skinIndices.length+"), and skinWeights ("+a.skinWeights.length+") should match."),a.animation=e.animation,a.animations=e.animations}function o(t){if(void 0!==e.morphTargets){var r,i,o,s,c,l;for(r=0,i=e.morphTargets.length;r<i;r++)for(a.morphTargets[r]={},a.morphTargets[r].name=e.morphTargets[r].name,a.morphTargets[r].vertices=[],c=a.morphTargets[r].vertices,l=e.morphTargets[r].vertices,o=0,s=l.length;o<s;o+=3){var h=new n.Vector3;h.x=l[o]*t,h.y=l[o+1]*t,h.z=l[o+2]*t,c.push(h)}}if(void 0!==e.morphColors){var r,i,u,f,p,d,m;for(r=0,i=e.morphColors.length;r<i;r++)for(a.morphColors[r]={},a.morphColors[r].name=e.morphColors[r].name,a.morphColors[r].colors=[],p=a.morphColors[r].colors,d=e.morphColors[r].colors,u=0,f=d.length;u<f;u+=3)m=new n.Color(16755200),m.setRGB(d[u],d[u+1],d[u+2]),p.push(m)}}var a=new n.Geometry,s=void 0!==e.scale?1/e.scale:1;if(r(s),i(),o(s),a.computeCentroids(),a.computeFaceNormals(),a.computeBoundingSphere(),void 0===e.materials)return{geometry:a};var c=this.initMaterials(e.materials,t);return this.needsTangents(c)&&a.computeTangents(),{geometry:a,materials:c}},n.LoadingManager=function(e,t,r){var i=this,n=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++},this.itemEnd=function(e){n++,void 0!==i.onProgress&&i.onProgress(e,n,o),n===o&&void 0!==i.onLoad&&i.onLoad()}},n.DefaultLoadingManager=new n.LoadingManager,n.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.BufferGeometryLoader.prototype={constructor:n.BufferGeometryLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader;a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n.BufferGeometry,r=e.attributes,o=e.offsets,a=e.boundingSphere;for(var s in r){var c=r[s];t.attributes[s]={itemSize:c.itemSize,array:new i[c.type](c.array)}}return void 0!==o&&(t.offsets=JSON.parse(JSON.stringify(o))),void 0!==a&&(t.boundingSphere=new n.Sphere((new n.Vector3).fromArray(void 0!==a.center?a.center:[0,0,0]),a.radius)),t}},n.Geometry2Loader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.Geometry2Loader.prototype={constructor:n.Geometry2Loader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader;a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n.Geometry2(e.vertices.length/3),r=["vertices","normals","uvs"],i=e.boundingSphere;for(var o in r){var a=r[o];t[a].set(e[a])}return void 0!==i&&(t.boundingSphere=new n.Sphere((new n.Vector3).fromArray(void 0!==i.center?i.center:[0,0,0]),i.radius)),t}},n.MaterialLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.MaterialLoader.prototype={constructor:n.MaterialLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader;a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new n[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.falloff&&(t.falloff=e.falloff),void 0!==e.falloffColor&&t.falloffColor.setHex(e.falloffColor),void 0!==e.roughness&&(t.roughness=e.roughness),void 0!==e.metallic&&(t.metallic=e.metallic),void 0!==e.clearCoat&&(t.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(t.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(t.anisotropyRotation=e.anisotropyRotation),void 0!==e.translucency&&t.translucency.setHex(e.translucency),void 0!==e.translucencyNormalAlpha&&(t.translucencyNormalAlpha=e.translucencyNormalAlpha),void 0!==e.translucencyNormalPower&&(t.translucencyNormalPower=e.translucencyNormalPower),void 0!==e.translucencyViewAlpha&&(t.translucencyViewAlpha=e.translucencyViewAlpha),void 0!==e.translucencyViewPower&&(t.translucencyViewPower=e.translucencyViewPower),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var r=0,i=e.materials.length;r<i;r++)t.materials.push(this.parse(e.materials[r]));return t}},n.ObjectLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.ObjectLoader.prototype={constructor:n.ObjectLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),r=this.parseMaterials(e.materials),i=this.parseObject(e.object,t,r);return i},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new n.JSONLoader,i=new n.Geometry2Loader,o=new n.BufferGeometryLoader,a=0,s=e.length;a<s;a++){var c,l=e[a];switch(l.type){case"PlaneGeometry":c=new n.PlaneGeometry(l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"CubeGeometry":c=new n.BoxGeometry(l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":c=new n.CircleGeometry(l.radius,l.segments);break;case"CylinderGeometry":c=new n.CylinderGeometry(l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded);break;case"SphereGeometry":c=new n.SphereGeometry(l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"IcosahedronGeometry":c=new n.IcosahedronGeometry(l.radius,l.detail);break;case"TorusGeometry":c=new n.TorusGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":c=new n.TorusKnotGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.p,l.q,l.heightScale);break;case"BufferGeometry":c=o.parse(l.data);break;case"Geometry2":c=i.parse(l.data);break;
case"Geometry":c=r.parse(l.data).geometry}c.uuid=l.uuid,void 0!==l.name&&(c.name=l.name),t[l.uuid]=c}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var r=new n.MaterialLoader,i=0,o=e.length;i<o;i++){var a=e[i],s=r.parse(a);s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),t[a.uuid]=s}return t},parseObject:function(){var e=new n.Matrix4;return function(t,r,i){var o;switch(t.type){case"Scene":o=new n.Scene;break;case"PerspectiveCamera":o=new n.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":o=new n.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new n.AmbientLight(t.color);break;case"DirectionalLight":o=new n.DirectionalLight(t.color,t.intensity);break;case"PointLight":o=new n.PointLight(t.color,t.intensity,t.distance,t.decay,t.physicalFalloff);break;case"SpotLight":o=new n.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay,t.physicalFalloff);break;case"HemisphereLight":o=new n.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"AreaLight":o=new n.AreaLight(t.color,t.intensity,t.distance,t.decayExponent,t.decay,t.physicalFalloff),o.width=t.width||1,o.height=t.height||1;break;case"Mesh":var a=r[t.geometry],s=i[t.material];void 0===a&&n.onerror("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===s&&n.onerror("THREE.ObjectLoader: Undefined material "+t.material),o=new n.Mesh(a,s);break;case"Sprite":var s=i[t.material];void 0===s&&n.onerror("THREE.ObjectLoader: Undefined material "+t.material),o=new n.Sprite(s);break;default:o=new n.Object3D}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var c in t.children)o.add(this.parseObject(t.children[c],r,i));return o}}()},n.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",n.JSONLoader)},n.SceneLoader.prototype={constructor:n.SceneLoader,load:function(e,t,r,i){var o=this,a=new n.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(r){o.parse(JSON.parse(r),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,r){function i(e,t){return"relativeToHTML"==t?e:E+e}function o(){a(C.scene,P.objects)}function a(e,t){var r,o,s,c,l;for(var u in t){var f=C.objects[u],p=t[u];if(void 0===f){if(p.type&&p.type in T.hierarchyHandlers){if(void 0===p.loading){var d={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},y={};for(var x in p)x in d||(y[x]=p[x]);v=C.materials[p.material],p.loading=!0;var _=T.hierarchyHandlers[p.type].loaderObject;_.options?_.load(i(p.url,P.urlBaseType),h(u,e,v,p)):_.load(i(p.url,P.urlBaseType),h(u,e,v,p),y)}}else if(void 0!==p.geometry){if(m=C.geometries[p.geometry]){var w=!1;if(v=C.materials[p.material],w=v instanceof n.ShaderMaterial,o=p.position,s=p.rotation,c=p.scale,r=p.matrix,l=p.quaternion,p.material||(v=new n.MeshFaceMaterial(C.face_materials[p.geometry])),v instanceof n.MeshFaceMaterial&&0===v.materials.length&&(v=new n.MeshFaceMaterial(C.face_materials[p.geometry])),v instanceof n.MeshFaceMaterial)for(var M=0;M<v.materials.length;M++)w=w||v.materials[M]instanceof n.ShaderMaterial;w&&m.computeTangents(),p.skin?f=new n.SkinnedMesh(m,v):p.morph?(f=new n.MorphAnimMesh(m,v),void 0!==p.duration&&(f.duration=p.duration),void 0!==p.time&&(f.time=p.time),void 0!==p.mirroredLoop&&(f.mirroredLoop=p.mirroredLoop),v.morphNormals&&m.computeMorphNormals()):f=new n.Mesh(m,v),f.name=u,r?(f.matrixAutoUpdate=!1,f.matrix.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])):(f.position.fromArray(o),l?f.quaternion.fromArray(l):f.rotation.fromArray(s),f.scale.fromArray(c)),f.visible=p.visible,f.castShadow=p.castShadow,f.receiveShadow=p.receiveShadow,e.add(f),C.objects[u]=f}}else if("AmbientLight"===p.type||"PointLight"===p.type||"DirectionalLight"===p.type||"SpotLight"===p.type||"HemisphereLight"===p.type||"AreaLight"===p.type){var S=p.color,A=p.intensity,E=p.distance,L=p.position,R=p.rotation;switch(p.type){case"AmbientLight":b=new n.AmbientLight(S);break;case"PointLight":b=new n.PointLight(S,A,E),b.position.fromArray(L);break;case"DirectionalLight":b=new n.DirectionalLight(S,A),b.position.fromArray(p.direction);break;case"SpotLight":b=new n.SpotLight(S,A,E,1),b.angle=p.angle,b.position.fromArray(L),b.target.set(L[0],L[1]-E,L[2]),b.target.applyEuler(new n.Euler(R[0],R[1],R[2],"XYZ"));break;case"HemisphereLight":b=new n.DirectionalLight(S,A,E),b.target.set(L[0],L[1]-E,L[2]),b.target.applyEuler(new n.Euler(R[0],R[1],R[2],"XYZ"));break;case"AreaLight":b=new n.AreaLight(S,A),b.position.fromArray(L),b.width=p.size,b.height=p.size_y}e.add(b),b.name=u,C.lights[u]=b,C.objects[u]=b}else"PerspectiveCamera"===p.type||"OrthographicCamera"===p.type?(o=p.position,s=p.rotation,l=p.quaternion,"PerspectiveCamera"===p.type?g=new n.PerspectiveCamera(p.fov,p.aspect,p.near,p.far):"OrthographicCamera"===p.type&&(g=new n.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far)),g.name=u,g.position.fromArray(o),void 0!==l?g.quaternion.fromArray(l):void 0!==s&&g.rotation.fromArray(s),e.add(g),C.cameras[u]=g,C.objects[u]=g):(o=p.position,s=p.rotation,c=p.scale,l=p.quaternion,f=new n.Object3D,f.name=u,f.position.fromArray(o),l?f.quaternion.fromArray(l):f.rotation.fromArray(s),f.scale.fromArray(c),f.visible=void 0!==p.visible&&p.visible,e.add(f),C.objects[u]=f,C.empties[u]=f);if(f){if(void 0!==p.userData)for(var D in p.userData){var V=p.userData[D];f.userData[D]=V}if(void 0!==p.groups)for(var M=0;M<p.groups.length;M++){var F=p.groups[M];void 0===C.groups[F]&&(C.groups[F]=[]),C.groups[F].push(u)}}}void 0!==f&&void 0!==p.children&&a(f,p.children)}}function s(e,t,r){C.geometries[r]=e,C.face_materials[r]=t,o()}function c(e,t,r,i,n){var a=n.position,s=n.rotation,c=n.quaternion,l=n.scale;e.position.fromArray(a),c?e.quaternion.fromArray(c):e.rotation.fromArray(s),e.scale.fromArray(l),i&&e.traverse(function(e){e.material=i});var h=void 0===n.visible||n.visible;e.traverse(function(e){e.visible=h}),r.add(e),e.name=t,C.objects[t]=e,o()}function l(e){return function(t,r){t.name=e,s(t,r,e),w-=1,T.onLoadComplete(),f()}}function h(e,t,r,i){return function(n){var o;o=n.content?n.content:n.dae?n.scene:n,c(o,e,t,r,i),w-=1,T.onLoadComplete(),f()}}function u(e){return function(t,r){t.name=e,C.geometries[e]=t,C.face_materials[e]=r}}function f(){var e={totalModels:S,totalTextures:A,loadedModels:S-w,loadedTextures:A-M};T.callbackProgress(e,C),T.onLoadProgress(),0===w&&0===M&&(p(),t(C))}function p(){for(var e=0;e<L.length;e++){var t=L[e],r=C.objects[t.targetName];r?t.object.target=r:(t.object.target=new n.Object3D,C.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}function d(e,t){if(t(e),void 0!==e.children)for(var r in e.children)d(e.children[r],t)}var m,v,g,y,x,_,b,w,M,S,A,C,T=this,E=n.Loader.prototype.extractUrlBase(r),L=[],P=e;for(var R in this.geometryHandlers){var D=this.geometryHandlers[R].loaderClass;this.geometryHandlers[R].loaderObject=new D}for(var R in this.hierarchyHandlers){var D=this.hierarchyHandlers[R].loaderClass;this.hierarchyHandlers[R].loaderObject=new D}if(w=0,M=0,C={scene:new n.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},P.transform){var V=P.transform.position,F=P.transform.rotation,U=P.transform.scale;V&&C.scene.position.fromArray(V),F&&C.scene.rotation.fromArray(F),U&&C.scene.scale.fromArray(U),(V||F||U)&&(C.scene.updateMatrix(),C.scene.updateMatrixWorld())}var N,O,k=function(e){M-=e,f(),T.onLoadComplete()},B=function(e){return function(){k(e)}};for(N in P.fogs)O=P.fogs[N],"linear"===O.type?y=new n.Fog(0,O.near,O.far):"exp2"===O.type&&(y=new n.FogExp2(0,O.density)),_=O.color,y.color.setRGB(_[0],_[1],_[2]),C.fogs[N]=y;var z,I;for(z in P.geometries)I=P.geometries[z],I.type in this.geometryHandlers&&(w+=1,T.onLoadStart());for(var G in P.objects)d(P.objects[G],function(e){e.type&&e.type in T.hierarchyHandlers&&(w+=1,T.onLoadStart())});S=w;for(z in P.geometries)if(I=P.geometries[z],"cube"===I.type)m=new n.BoxGeometry(I.width,I.height,I.depth,I.widthSegments,I.heightSegments,I.depthSegments),m.name=z,C.geometries[z]=m;else if("plane"===I.type)m=new n.PlaneGeometry(I.width,I.height,I.widthSegments,I.heightSegments),m.name=z,C.geometries[z]=m;else if("sphere"===I.type)m=new n.SphereGeometry(I.radius,I.widthSegments,I.heightSegments),m.name=z,C.geometries[z]=m;else if("cylinder"===I.type)m=new n.CylinderGeometry(I.topRad,I.botRad,I.height,I.radSegs,I.heightSegs),m.name=z,C.geometries[z]=m;else if("torus"===I.type)m=new n.TorusGeometry(I.radius,I.tube,I.segmentsR,I.segmentsT),m.name=z,C.geometries[z]=m;else if("icosahedron"===I.type)m=new n.IcosahedronGeometry(I.radius,I.subdivisions),m.name=z,C.geometries[z]=m;else if(I.type in this.geometryHandlers){var j={};for(var H in I)"type"!==H&&"url"!==H&&(j[H]=I[H]);var W=this.geometryHandlers[I.type].loaderObject;W.load(i(I.url,P.urlBaseType),l(z),j)}else if("embedded"===I.type){var X=P.embeds[I.id],q="";if(X.metadata=P.metadata,X){var Y=this.geometryHandlers.ascii.loaderObject,K=Y.parse(X,q);u(z)(K.geometry,K.materials)}}var Q,Z;for(Q in P.textures)if(Z=P.textures[Q],Z.url instanceof Array){M+=Z.url.length;for(var J=0;J<Z.url.length;J++)T.onLoadStart()}else M+=1,T.onLoadStart();A=M;for(Q in P.textures){if(Z=P.textures[Q],void 0!==Z.mapping&&void 0!==n[Z.mapping]&&(Z.mapping=new n[Z.mapping]),Z.url instanceof Array){for(var $=Z.url.length,ee=[],te=0;te<$;te++)ee[te]=i(Z.url[te],P.urlBaseType);var re=/\.dds$/i.test(ee[0]);x=re?n.ImageUtils.loadCompressedTextureCube(ee,Z.mapping,B($)):n.ImageUtils.loadTextureCube(ee,Z.mapping,B($))}else{var re=/\.dds$/i.test(Z.url),ie=i(Z.url,P.urlBaseType),ne=B(1);if(x=re?n.ImageUtils.loadCompressedTexture(ie,Z.mapping,ne):n.ImageUtils.loadTexture(ie,Z.mapping,ne),void 0!==n[Z.minFilter]&&(x.minFilter=n[Z.minFilter]),void 0!==n[Z.magFilter]&&(x.magFilter=n[Z.magFilter]),Z.anisotropy&&(x.anisotropy=Z.anisotropy),Z.repeat&&(x.repeat.set(Z.repeat[0],Z.repeat[1]),1!==Z.repeat[0]&&(x.wrapS=n.RepeatWrapping),1!==Z.repeat[1]&&(x.wrapT=n.RepeatWrapping)),Z.offset&&x.offset.set(Z.offset[0],Z.offset[1]),Z.wrap){var oe={repeat:n.RepeatWrapping,mirror:n.MirroredRepeatWrapping};void 0!==oe[Z.wrap[0]]&&(x.wrapS=oe[Z.wrap[0]]),void 0!==oe[Z.wrap[1]]&&(x.wrapT=oe[Z.wrap[1]])}}C.textures[Q]=x}var ae,se,ce;for(ae in P.materials){se=P.materials[ae];for(ce in se.parameters)if("envMap"===ce||"map"===ce||"lightMap"===ce||"bumpMap"===ce)se.parameters[ce]=C.textures[se.parameters[ce]];else if("shading"===ce)se.parameters[ce]="flat"===se.parameters[ce]?n.FlatShading:n.SmoothShading;else if("side"===ce)"double"==se.parameters[ce]?se.parameters[ce]=n.DoubleSide:"back"==se.parameters[ce]?se.parameters[ce]=n.BackSide:se.parameters[ce]=n.FrontSide;else if("blending"===ce)se.parameters[ce]=se.parameters[ce]in n?n[se.parameters[ce]]:n.NormalBlending;else if("combine"===ce)se.parameters[ce]=se.parameters[ce]in n?n[se.parameters[ce]]:n.MultiplyOperation;else if("vertexColors"===ce)"face"==se.parameters[ce]?se.parameters[ce]=n.FaceColors:se.parameters[ce]&&(se.parameters[ce]=n.VertexColors);else if("wrapRGB"===ce){var le=se.parameters[ce];se.parameters[ce]=new n.Vector3(le[0],le[1],le[2])}if(void 0!==se.parameters.opacity&&se.parameters.opacity<1&&(se.parameters.transparent=!0),se.parameters.normalMap){var he=n.ShaderLib.normalmap,ue=n.UniformsUtils.clone(he.uniforms),fe=se.parameters.color,pe=se.parameters.specular,de=se.parameters.ambient,me=se.parameters.shininess;ue.tNormal.value=C.textures[se.parameters.normalMap],se.parameters.normalScale&&ue.uNormalScale.value.set(se.parameters.normalScale[0],se.parameters.normalScale[1]),se.parameters.map&&(ue.tDiffuse.value=se.parameters.map,ue.enableDiffuse.value=!0),se.parameters.envMap&&(ue.tCube.value=se.parameters.envMap,ue.enableReflection.value=!0,ue.reflectivity.value=se.parameters.reflectivity),se.parameters.lightMap&&(ue.tAO.value=se.parameters.lightMap,ue.enableAO.value=!0),se.parameters.specularMap&&(ue.tSpecular.value=C.textures[se.parameters.specularMap],ue.enableSpecular.value=!0),se.parameters.displacementMap&&(ue.tDisplacement.value=C.textures[se.parameters.displacementMap],ue.enableDisplacement.value=!0,ue.uDisplacementBias.value=se.parameters.displacementBias,ue.uDisplacementScale.value=se.parameters.displacementScale),ue.diffuse.value.setHex(fe),ue.specular.value.setHex(pe),ue.ambient.value.setHex(de),ue.shininess.value=me,se.parameters.opacity&&(ue.opacity.value=se.parameters.opacity);var ve={fragmentShader:he.fragmentShader,vertexShader:he.vertexShader,uniforms:ue,lights:!0,fog:!0};v=new n.ShaderMaterial(ve)}else v=new n[se.type](se.parameters);v.name=ae,C.materials[ae]=v}for(ae in P.materials)if(se=P.materials[ae],se.parameters.materials){for(var ge=[],te=0;te<se.parameters.materials.length;te++){var ye=se.parameters.materials[te];ge.push(C.materials[ye])}C.materials[ae].materials=ge}o(),C.cameras&&P.defaults.camera&&(C.currentCamera=C.cameras[P.defaults.camera]),C.fogs&&P.defaults.fog&&(C.scene.fog=C.fogs[P.defaults.fog]),T.callbackSync(C),f()}},n.TextureLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.TextureLoader.prototype={constructor:n.TextureLoader,load:function(e,t,r,i){var o=this,a=new n.ImageLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){var r=new n.Texture(e);r.needsUpdate=!0,void 0!==t&&t(r)})},setCrossOrigin:function(e){this.crossOrigin=e}},n.Material=function(){this.id=n.MaterialIdCount++,this.uuid=n.Math.generateUUID(),this.name="",this.side=n.FrontSide,this.opacity=1,this.transparent=!1,this.blending=n.NormalBlending,this.blendSrc=n.SrcAlphaFactor,this.blendDst=n.OneMinusSrcAlphaFactor,this.blendEquation=n.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},n.Material.prototype={constructor:n.Material,setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var i=this[t];i instanceof n.Color?i.set(r):i instanceof n.Vector3&&r instanceof n.Vector3?i.copy(r):"overdraw"==t?this[t]=Number(r):this[t]=r}}else n.onwarning("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new n.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.Material.prototype),n.MaterialIdCount=0,n.LineBasicMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.LineBasicMaterial.prototype=Object.create(n.Material.prototype),n.LineBasicMaterial.prototype.clone=function(){var e=new n.LineBasicMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},n.LineDashedMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.LineDashedMaterial.prototype=Object.create(n.Material.prototype),n.LineDashedMaterial.prototype.clone=function(){var e=new n.LineDashedMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},n.MeshBasicMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},n.MeshBasicMaterial.prototype=Object.create(n.Material.prototype),n.MeshBasicMaterial.prototype.clone=function(){var e=new n.MeshBasicMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},n.MeshLambertMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.ambient=new n.Color(16777215),this.emissive=new n.Color(0),this.wrapAround=!1,this.wrapRGB=new n.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshLambertMaterial.prototype=Object.create(n.Material.prototype),n.MeshLambertMaterial.prototype.clone=function(){var e=new n.MeshLambertMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},n.MeshPhongMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.ambient=new n.Color(0),this.emissive=new n.Color(0),this.specular=new n.Color(16777215),this.shininess=30,this.wrapAround=!1,this.wrapRGB=new n.Vector3(1,1,1),this.map=null,this.opacityMap=null,this.lightMap=null,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshPhongMaterial.prototype=Object.create(n.Material.prototype),n.MeshPhongMaterial.prototype.clone=function(){var e=new n.MeshPhongMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.opacityMap=this.opacityMap,e.lightMap=this.lightMap,e.emissiveMap=this.emissiveMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},n.MeshPhysicalMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.opacityMap=null,this.fog=!0,this.falloff=!1,this.falloffColor=new n.Color(16777215),this.falloffMap=null,this.falloffBlendParams=new n.Vector4(1,0,0,1),this.specular=new n.Color(16777215),this.specularMap=null,this.roughness=.5,this.roughnessMap=null,this.metallic=0,this.metallicMap=null,this.clearCoat=0,this.clearCoatRoughness=.2,this.anisotropy=0,this.anisotropyMap=null,this.anisotropyRotation=0,this.anisotropyRotationMap=null,this.translucency=new n.Color(0),this.translucencyMap=null,this.translucencyNormalAlpha=.75,this.translucencyNormalPower=1,this.translucencyViewPower=2,this.translucencyViewAlpha=.75,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.emissive=new n.Color(0),this.emissiveMap=null,this.ambient=new n.Color(0),this.lightMap=null,this.envMap=null,this.diffuseEnvMap=null,this.combine=n.AddOperation,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.blending=n.CustomBlending,this.blendSrc=n.OneFactor,this.blendDst=n.OneMinusSrcAlphaFactor,this.blendEquation=n.AddEquation,this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshPhysicalMaterial.prototype=Object.create(n.Material.prototype),n.MeshPhysicalMaterial.prototype.clone=function(){var e=new n.MeshPhysicalMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.opacityMap=this.opacityMap,e.fog=this.fog,e.falloff=this.falloff,e.falloffColor.copy(this.falloffColor),e.falloffMap=this.falloffMap,e.falloffBlendParams.copy(this.falloffBlendParams),e.specular.copy(this.specular),e.specularMap=this.specularMap,e.roughness=this.roughness,e.roughnessMap=this.roughnessMap,e.metallic=this.metallic,e.metallicMap=this.metallicMap,e.shading=this.shading,e.translucency.copy(this.translucency),e.translucencyMap=this.translucencyMap,e.translucencyNormalAlpha=this.translucencyNormalAlpha,e.translucencyNormalPower=this.translucencyNormalPower,e.translucencyViewPower=this.translucencyViewPower,e.translucencyViewAlpha=this.translucencyViewAlpha,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.emissive.copy(this.emissive),e.emissiveMap=this.emissiveMap,e.ambient.copy(this.ambient),e.lightMap=this.lightMap,e.envMap=this.envMap,e.diffuseEnvMap=this.diffuseEnvMap,e.combine=this.combine,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},n.MeshDepthMaterial=function(e){n.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},n.MeshDepthMaterial.prototype=Object.create(n.Material.prototype),n.MeshDepthMaterial.prototype.clone=function(){var e=new n.MeshDepthMaterial;return n.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},n.MeshNormalMaterial=function(e){n.Material.call(this,e),this.shading=n.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},n.MeshNormalMaterial.prototype=Object.create(n.Material.prototype),n.MeshNormalMaterial.prototype.clone=function(){var e=new n.MeshNormalMaterial;return n.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},n.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},n.MeshFaceMaterial.prototype.clone=function(){for(var e=new n.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},n.ParticleSystemMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.ParticleSystemMaterial.prototype=Object.create(n.Material.prototype),n.ParticleSystemMaterial.prototype.clone=function(){var e=new n.ParticleSystemMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},n.ParticleBasicMaterial=n.ParticleSystemMaterial,n.ShaderMaterial=function(e){n.Material.call(this),this.shaderID=null,this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=n.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)},n.ShaderMaterial.prototype=Object.create(n.Material.prototype),n.ShaderMaterial.prototype.clone=function(){var e=new n.ShaderMaterial;return n.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=n.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},n.SpriteMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},n.SpriteMaterial.prototype=Object.create(n.Material.prototype),n.SpriteMaterial.prototype.clone=function(){var e=new n.SpriteMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},n.SpriteCanvasMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.program=function(e,t){},this.setValues(e)},n.SpriteCanvasMaterial.prototype=Object.create(n.Material.prototype),n.SpriteCanvasMaterial.prototype.clone=function(){var e=new n.SpriteCanvasMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},n.ParticleCanvasMaterial=n.SpriteCanvasMaterial,n.Texture=function(e,t,r,i,o,a,s,c,l){this.id=n.TextureIdCount++,this.uuid=n.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new n.UVMapping,this.wrapS=void 0!==r?r:n.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:n.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:n.LinearFilter,this.minFilter=void 0!==a?a:n.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:n.RGBAFormat,this.type=void 0!==c?c:n.UnsignedByteType,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.invert=!1,this.gainPivot=0,this.gain=1,this.brightness=0,this.encoding=n.sRGB,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},n.Texture.prototype={constructor:n.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new n.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.invert=this.invert,e.gainPivot=this.gainPivot,e.gain=this.gain,e.brightness=this.brightness,e.encoding=this.encoding,e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.Texture.prototype),n.TextureIdCount=0,n.CompressedTexture=function(e,t,r,i,o,a,s,c,l,h,u){n.Texture.call(this,null,a,s,c,l,h,i,o,u),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},n.CompressedTexture.prototype=Object.create(n.Texture.prototype),n.CompressedTexture.prototype.clone=function(){var e=new n.CompressedTexture;return n.Texture.prototype.clone.call(this,e),e},n.DataTexture=function(e,t,r,i,o,a,s,c,l,h,u){n.Texture.call(this,null,a,s,c,l,h,i,o,u),this.image={data:e,width:t,height:r}},n.DataTexture.prototype=Object.create(n.Texture.prototype),n.DataTexture.prototype.clone=function(){var e=new n.DataTexture;return n.Texture.prototype.clone.call(this,e),e},n.ParticleSystem=function(e,t){n.Object3D.call(this),this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.ParticleSystemMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1},n.ParticleSystem.prototype=Object.create(n.Object3D.prototype),n.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new n.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,n.Object3D.prototype.clone.call(this,e),e},n.Line=function(e,t,r){n.Object3D.call(this),this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:n.LineStrip},n.LineStrip=0,n.LinePieces=1,n.Line.prototype=Object.create(n.Object3D.prototype),n.Line.prototype.clone=function(e){return void 0===e&&(e=new n.Line(this.geometry,this.material,this.type)),n.Object3D.prototype.clone.call(this,e),e},n.Mesh=function(e,t){n.Object3D.call(this),this.geometry=void 0!==e?e:new n.Geometry,this.material=void 0!==t?t:new n.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},n.Mesh.prototype=Object.create(n.Object3D.prototype),n.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},n.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(n.onwarning("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},n.Mesh.prototype.clone=function(e){return void 0===e&&(e=new n.Mesh(this.geometry,this.material)),n.Object3D.prototype.clone.call(this,e),
e},n.Bone=function(e){n.Object3D.call(this),this.skin=e,this.skinMatrix=new n.Matrix4},n.Bone.prototype=Object.create(n.Object3D.prototype),n.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,i=this.children.length;for(r=0;r<i;r++)this.children[r].update(this.skinMatrix,t)},n.SkinnedMesh=function(e,t,r){n.Mesh.call(this,e,t),this.useVertexTexture=void 0===r||r,this.identityMatrix=new n.Matrix4,this.bones=[],this.boneMatrices=[];var i,o,a,s,c,l;if(this.geometry&&void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)a=this.geometry.bones[i],s=a.pos,c=a.rotq,l=a.scl,o=this.addBone(),o.name=a.name,o.position.set(s[0],s[1],s[2]),o.quaternion.set(c[0],c[1],c[2],c[3]),void 0!==l?o.scale.set(l[0],l[1],l[2]):o.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)a=this.geometry.bones[i],o=this.bones[i],a.parent===-1?this.add(o):this.bones[a.parent].add(o);var h=this.bones.length;if(this.useVertexTexture){var u;u=h>256?64:h>64?32:h>16?16:8,this.boneTextureWidth=u,this.boneTextureHeight=u,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new n.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,n.RGBAFormat,n.FloatType),this.boneTexture.minFilter=n.NearestFilter,this.boneTexture.magFilter=n.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*h);this.pose()}},n.SkinnedMesh.prototype=Object.create(n.Mesh.prototype),n.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new n.Bone(this)),this.bones.push(e),e},n.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new n.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var r=0,i=this.children.length;r<i;r++){var o=this.children[r];o instanceof n.Bone?o.update(this.identityMatrix,!1):o.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var a=0,s=this.bones.length;a<s;a++){var c=new n.Matrix4;c.getInverse(this.bones[a].skinMatrix),this.boneInverses.push(c)}}for(var a=0,s=this.bones.length;a<s;a++)e.multiplyMatrices(this.bones[a].skinMatrix,this.boneInverses[a]),e.flattenToArrayOffset(this.boneMatrices,16*a);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),n.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},n.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof n.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},n.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new n.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),n.Mesh.prototype.clone.call(this,e),e},n.MorphAnimMesh=function(e,t){n.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},n.MorphAnimMesh.prototype=Object.create(n.Mesh.prototype),n.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},n.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},n.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},n.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,i=/([a-z]+)(\d+)/,n=0,o=e.morphTargets.length;n<o;n++){var a=e.morphTargets[n],s=a.name.match(i);if(s&&s.length>1){var c=s[1];s[2];r[c]||(r[c]={start:1/0,end:-(1/0)});var l=r[c];n<l.start&&(l.start=n),n>l.end&&(l.end=n),t||(t=c)}}e.firstAnimation=t},n.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},n.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=1e3*((r.end-r.start)/t),this.time=0):n.onwarning("animation["+e+"] undefined")},n.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+n.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},n.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new n.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,n.Mesh.prototype.clone.call(this,e),e},n.LOD=function(){n.Object3D.call(this),this.objects=[]},n.LOD.prototype=Object.create(n.Object3D.prototype),n.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},n.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;t<r&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},n.LOD.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var n=1,o=this.objects.length;n<o&&i>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;n<o;n++)this.objects[n].object.visible=!1}}}(),n.LOD.prototype.clone=function(e){void 0===e&&(e=new n.LOD),n.Object3D.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;t<r;t++){var i=this.objects[t].object.clone();i.visible=0===t,e.addLevel(i,this.objects[t].distance)}return e},n.Sprite=function(){var e=new n.Geometry2(3);return e.vertices.set([-.5,-.5,0,.5,-.5,0,.5,.5,0]),function(t){n.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new n.SpriteMaterial}}(),n.Sprite.prototype=Object.create(n.Object3D.prototype),n.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},n.Sprite.prototype.clone=function(e){return void 0===e&&(e=new n.Sprite(this.material)),n.Object3D.prototype.clone.call(this,e),e},n.Particle=n.Sprite,n.Scene=function(){n.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},n.Scene.prototype=Object.create(n.Object3D.prototype),n.Scene.prototype.__addObject=function(e){if(e instanceof n.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof n.Camera||e instanceof n.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(t,1)}this.dispatchEvent({type:"objectAdded",object:e}),e.dispatchEvent({type:"addedToScene",scene:this});for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])},n.Scene.prototype.__removeObject=function(e){if(e instanceof n.Light){var t=this.__lights.indexOf(e);if(t!==-1&&this.__lights.splice(t,1),e.shadowCascadeArray)for(var r=0;r<e.shadowCascadeArray.length;r++)this.__removeObject(e.shadowCascadeArray[r])}else if(!(e instanceof n.Camera)){this.__objectsRemoved.push(e);var t=this.__objectsAdded.indexOf(e);t!==-1&&this.__objectsAdded.splice(t,1)}this.dispatchEvent({type:"objectRemoved",object:e}),e.dispatchEvent({type:"removedFromScene",scene:this});for(var i=0;i<e.children.length;i++)this.__removeObject(e.children[i])},n.Scene.prototype.clone=function(e){return void 0===e&&(e=new n.Scene),n.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},n.Fog=function(e,t,r){this.name="",this.color=new n.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},n.Fog.prototype.clone=function(){return new n.Fog(this.color.getHex(),this.near,this.far)},n.FogExp2=function(e,t){this.name="",this.color=new n.Color(e),this.density=void 0!==t?t:25e-5},n.FogExp2.prototype.clone=function(){return new n.FogExp2(this.color.getHex(),this.density)},n.CanvasRenderer=function(e){function t(){De.setRGB(0,0,0),Ve.setRGB(0,0,0),Fe.setRGB(0,0,0);for(var e=0,t=E.length;e<t;e++){var r=E[e],i=r.color;r instanceof n.AmbientLight?De.add(i):r instanceof n.DirectionalLight?Ve.add(i):r instanceof n.PointLight&&Fe.add(i)}}function r(e,t,r){for(var i=0,o=E.length;i<o;i++){var a=E[i];if(Te.copy(a.color),a instanceof n.DirectionalLight){var s=Ue.setFromMatrixPosition(a.matrixWorld).normalize(),c=t.dot(s);if(c<=0)continue;c*=a.intensity,r.add(Te.multiplyScalar(c))}else if(a instanceof n.PointLight){var s=Ue.setFromMatrixPosition(a.matrixWorld),c=t.dot(Ue.subVectors(s,e).normalize());if(c<=0)continue;if(c*=0==a.distance?1:1-Math.min(e.distanceTo(s)/a.distance,1),0==c)continue;c*=a.intensity,r.add(Te.multiplyScalar(c))}}}function o(e,t,r){g(r.opacity),y(r.blending);var i=t.scale.x*ae,o=t.scale.y*se,a=.5*Math.sqrt(i*i+o*o);if(Re.min.set(e.x-a,e.y-a),Re.max.set(e.x+a,e.y+a),r instanceof n.SpriteMaterial||r instanceof n.ParticleSystemMaterial){var s=r.map;if(null!==s){s.hasEventListener("update",u)===!1&&(void 0!==s.image&&s.image.width>0&&f(s),s.addEventListener("update",u));var c=Ee[s.id];M(void 0!==c?c:"rgba( 0, 0, 0, 1 )");var l=s.image,h=l.width*s.offset.x,p=l.height*s.offset.y,d=l.width*s.repeat.x,m=l.height*s.repeat.y,v=i/d,x=o/m;ce.save(),ce.translate(e.x,e.y),0!==r.rotation&&ce.rotate(r.rotation),ce.translate(-i/2,-o/2),ce.scale(v,x),ce.translate(-h,-p),ce.fillRect(h,p,d,m),ce.restore()}else M(r.color.getStyle()),ce.save(),ce.translate(e.x,e.y),0!==r.rotation&&ce.rotate(r.rotation),ce.scale(i,-o),ce.fillRect(-.5,-.5,1,1),ce.restore()}else r instanceof n.SpriteCanvasMaterial&&(w(r.color.getStyle()),M(r.color.getStyle()),ce.save(),ce.translate(e.x,e.y),0!==r.rotation&&ce.rotate(r.rotation),ce.scale(i,o),r.program(ce),ce.restore())}function a(e,t,r,i){if(g(i.opacity),y(i.blending),ce.beginPath(),ce.moveTo(e.positionScreen.x,e.positionScreen.y),ce.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof n.LineBasicMaterial){if(x(i.linewidth),_(i.linecap),b(i.linejoin),i.vertexColors!==n.VertexColors)w(i.color.getStyle());else{var o=r.vertexColors[0].getStyle(),a=r.vertexColors[1].getStyle();if(o===a)w(o);else{try{var s=ce.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);s.addColorStop(0,o),s.addColorStop(1,a)}catch(c){s=o}w(s)}}ce.stroke(),Re.expandByScalar(2*i.linewidth)}else i instanceof n.LineDashedMaterial&&(x(i.linewidth),_(i.linecap),b(i.linejoin),w(i.color.getStyle()),S(i.dashSize,i.gapSize),ce.stroke(),Re.expandByScalar(2*i.linewidth),S(null,null))}function s(e,t,i,o,a,s,u,f){te.info.render.vertices+=3,te.info.render.faces++,g(f.opacity),y(f.blending),V=e.positionScreen.x,F=e.positionScreen.y,U=t.positionScreen.x,N=t.positionScreen.y,O=i.positionScreen.x,k=i.positionScreen.y,c(V,F,U,N,O,k),(f instanceof n.MeshLambertMaterial||f instanceof n.MeshPhongMaterial||f instanceof n.MeshPhysicalMaterial)&&null===f.map?(Ae.copy(f.color),Ce.copy(f.emissive),f.vertexColors===n.FaceColors&&Ae.multiply(u.color),f.wireframe===!1&&f.shading===n.SmoothShading&&3===u.vertexNormalsLength?(be.copy(De),we.copy(De),Me.copy(De),r(u.v1.positionWorld,u.vertexNormalsModel[0],be),r(u.v2.positionWorld,u.vertexNormalsModel[1],we),r(u.v3.positionWorld,u.vertexNormalsModel[2],Me),be.multiply(Ae).add(Ce),we.multiply(Ae).add(Ce),Me.multiply(Ae).add(Ce),Se.addColors(we,Me).multiplyScalar(.5),I=m(be,we,Me,Se),d(V,F,U,N,O,k,0,0,1,0,0,1,I)):(_e.copy(De),r(u.centroidModel,u.normalModel,_e),_e.multiply(Ae).add(Ce),f.wireframe===!0?l(_e,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):h(_e))):f instanceof n.MeshBasicMaterial||f instanceof n.MeshLambertMaterial||f instanceof n.MeshPhongMaterial?null!==f.map?f.map.mapping instanceof n.UVMapping&&(G=u.uvs[0],p(V,F,U,N,O,k,G[o].x,G[o].y,G[a].x,G[a].y,G[s].x,G[s].y,f.map)):null!==f.envMap?f.envMap.mapping instanceof n.SphericalReflectionMapping&&(Ne.copy(u.vertexNormalsModel[o]).applyMatrix3(Oe),j=.5*Ne.x+.5,H=.5*Ne.y+.5,Ne.copy(u.vertexNormalsModel[a]).applyMatrix3(Oe),W=.5*Ne.x+.5,X=.5*Ne.y+.5,Ne.copy(u.vertexNormalsModel[s]).applyMatrix3(Oe),q=.5*Ne.x+.5,Y=.5*Ne.y+.5,p(V,F,U,N,O,k,j,H,W,X,q,Y,f.envMap)):(_e.copy(f.color),f.vertexColors===n.FaceColors&&_e.multiply(u.color),f.wireframe===!0?l(_e,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):h(_e)):f instanceof n.MeshDepthMaterial?(B=L.near,z=L.far,be.r=be.g=be.b=1-A(e.positionScreen.z*e.positionScreen.w,B,z),we.r=we.g=we.b=1-A(t.positionScreen.z*t.positionScreen.w,B,z),Me.r=Me.g=Me.b=1-A(i.positionScreen.z*i.positionScreen.w,B,z),Se.addColors(we,Me).multiplyScalar(.5),I=m(be,we,Me,Se),d(V,F,U,N,O,k,0,0,1,0,0,1,I)):f instanceof n.MeshNormalMaterial&&(f.shading===n.FlatShading?(Ne.copy(u.normalModel).applyMatrix3(Oe),_e.setRGB(Ne.x,Ne.y,Ne.z).multiplyScalar(.5).addScalar(.5),f.wireframe===!0?l(_e,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):h(_e)):f.shading===n.SmoothShading&&(Ne.copy(u.vertexNormalsModel[o]).applyMatrix3(Oe),be.setRGB(Ne.x,Ne.y,Ne.z).multiplyScalar(.5).addScalar(.5),Ne.copy(u.vertexNormalsModel[a]).applyMatrix3(Oe),we.setRGB(Ne.x,Ne.y,Ne.z).multiplyScalar(.5).addScalar(.5),Ne.copy(u.vertexNormalsModel[s]).applyMatrix3(Oe),Me.setRGB(Ne.x,Ne.y,Ne.z).multiplyScalar(.5).addScalar(.5),Se.addColors(we,Me).multiplyScalar(.5),I=m(be,we,Me,Se),d(V,F,U,N,O,k,0,0,1,0,0,1,I)))}function c(e,t,r,i,n,o){ce.beginPath(),ce.moveTo(e,t),ce.lineTo(r,i),ce.lineTo(n,o),ce.closePath()}function l(e,t,r,i){x(t),_(r),b(i),w(e.getStyle()),ce.stroke(),Re.expandByScalar(2*t)}function h(e){M(e.getStyle()),ce.fill()}function u(e){f(e.target)}function f(e){var t=e.wrapS===n.RepeatWrapping,r=e.wrapT===n.RepeatWrapping,i=e.image,o=document.createElement("canvas");o.width=i.width,o.height=i.height;var a=o.getContext("2d");a.setTransform(1,0,0,-1,0,i.height),a.drawImage(i,0,0),Ee[e.id]=ce.createPattern(o,t===!0&&r===!0?"repeat":t===!0&&r===!1?"repeat-x":t===!1&&r===!0?"repeat-y":"no-repeat")}function p(e,t,r,i,o,a,s,c,l,h,p,d,m){if(!(m instanceof n.DataTexture)){m.hasEventListener("update",u)===!1&&(void 0!==m.image&&m.image.width>0&&f(m),m.addEventListener("update",u));var v=Ee[m.id];if(void 0===v)return M("rgba(0,0,0,1)"),void ce.fill();M(v);var g,y,x,_,b,w,S,A,C=m.offset.x/m.repeat.x,T=m.offset.y/m.repeat.y,E=m.image.width*m.repeat.x,L=m.image.height*m.repeat.y;s=(s+C)*E,c=(c+T)*L,l=(l+C)*E,h=(h+T)*L,p=(p+C)*E,d=(d+T)*L,r-=e,i-=t,o-=e,a-=t,l-=s,h-=c,p-=s,d-=c,S=l*d-p*h,0!==S&&(A=1/S,g=(d*r-h*o)*A,y=(d*i-h*a)*A,x=(l*o-p*r)*A,_=(l*a-p*i)*A,b=e-g*s-x*c,w=t-y*s-_*c,ce.save(),ce.transform(g,y,x,_,b,w),ce.fill(),ce.restore())}}function d(e,t,r,i,n,o,a,s,c,l,h,u,f){var p,d,m,v,g,y,x,_,b=f.width-1,w=f.height-1;a*=b,s*=w,c*=b,l*=w,h*=b,u*=w,r-=e,i-=t,n-=e,o-=t,c-=a,l-=s,h-=a,u-=s,x=c*u-h*l,_=1/x,p=(u*r-l*n)*_,d=(u*i-l*o)*_,m=(c*n-h*r)*_,v=(c*o-h*i)*_,g=e-p*a-m*s,y=t-d*a-v*s,ce.save(),ce.transform(p,d,m,v,g,y),ce.clip(),ce.drawImage(f,0,0),ce.restore()}function m(e,t,r,i){return J[0]=255*e.r|0,J[1]=255*e.g|0,J[2]=255*e.b|0,J[4]=255*t.r|0,J[5]=255*t.g|0,J[6]=255*t.b|0,J[8]=255*r.r|0,J[9]=255*r.g|0,J[10]=255*r.b|0,J[12]=255*i.r|0,J[13]=255*i.g|0,J[14]=255*i.b|0,Q.putImageData(Z,0,0),ee.drawImage(K,0,0),$}function v(e,t,r){var i,n=t.x-e.x,o=t.y-e.y,a=n*n+o*o;0!==a&&(i=r/Math.sqrt(a),n*=i,o*=i,t.x+=n,t.y+=o,e.x-=n,e.y-=o)}function g(e){ue!==e&&(ce.globalAlpha=e,ue=e)}function y(e){fe!==e&&(e===n.NormalBlending?ce.globalCompositeOperation="source-over":e===n.AdditiveBlending?ce.globalCompositeOperation="lighter":e===n.SubtractiveBlending&&(ce.globalCompositeOperation="darker"),fe=e)}function x(e){me!==e&&(ce.lineWidth=e,me=e)}function _(e){ve!==e&&(ce.lineCap=e,ve=e)}function b(e){ge!==e&&(ce.lineJoin=e,ge=e)}function w(e){pe!==e&&(ce.strokeStyle=e,pe=e)}function M(e){de!==e&&(ce.fillStyle=e,de=e)}function S(e,t){ye===e&&xe===t||(ce.setLineDash([e,t]),ye=e,xe=t)}console.log("THREE.CanvasRenderer",n.REVISION);var A=n.Math.smoothstep;e=e||{};var C,T,E,L,P,R,D,V,F,U,N,O,k,B,z,I,G,j,H,W,X,q,Y,K,Q,Z,J,$,ee,te=this,re=new n.Projector,ie=void 0!==e.canvas?e.canvas:document.createElement("canvas"),ne=ie.width,oe=ie.height,ae=Math.floor(ne/2),se=Math.floor(oe/2),ce=ie.getContext("2d",{alpha:e.alpha===!0}),le=new n.Color(0),he=0,ue=1,fe=0,pe=null,de=null,me=null,ve=null,ge=null,ye=null,xe=0,_e=(new n.RenderableVertex,new n.RenderableVertex,new n.Color),be=new n.Color,we=new n.Color,Me=new n.Color,Se=new n.Color,Ae=new n.Color,Ce=new n.Color,Te=new n.Color,Ee={},Le=new n.Box2,Pe=new n.Box2,Re=new n.Box2,De=new n.Color,Ve=new n.Color,Fe=new n.Color,Ue=new n.Vector3,Ne=new n.Vector3,Oe=new n.Matrix3,ke=16;K=document.createElement("canvas"),K.width=K.height=2,Q=K.getContext("2d"),Q.fillStyle="rgba(0,0,0,1)",Q.fillRect(0,0,2,2),Z=Q.getImageData(0,0,2,2),J=Z.data,$=document.createElement("canvas"),$.width=$.height=ke,ee=$.getContext("2d"),ee.translate(-ke/2,-ke/2),ee.scale(ke,ke),ke--,void 0===ce.setLineDash&&(void 0!==ce.mozDash?ce.setLineDash=function(e){ce.mozDash=null!==e[0]?e:null}:ce.setLineDash=function(){}),this.domElement=ie,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==i.devicePixelRatio?i.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,r){ne=e*this.devicePixelRatio,oe=t*this.devicePixelRatio,ae=Math.floor(ne/2),se=Math.floor(oe/2),ie.width=ne,ie.height=oe,1!==this.devicePixelRatio&&r!==!1&&(ie.style.width=e+"px",ie.style.height=t+"px"),Le.min.set(-ae,-se),Le.max.set(ae,se),Pe.min.set(-ae,-se),Pe.max.set(ae,se),ue=1,fe=0,pe=null,de=null,me=null,ve=null,ge=null},this.setClearColor=function(e,t){le.set(e),he=void 0!==t?t:1,Pe.min.set(-ae,-se),Pe.max.set(ae,se)},this.setClearColorHex=function(e,t){n.onwarning("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ce.setTransform(1,0,0,-1,ae,se),Pe.empty()===!1&&(Pe.intersect(Le),Pe.expandByScalar(2),he<1&&ce.clearRect(0|Pe.min.x,0|Pe.min.y,Pe.max.x-Pe.min.x|0,Pe.max.y-Pe.min.y|0),he>0&&(y(n.NormalBlending),g(1),M("rgba("+Math.floor(255*le.r)+","+Math.floor(255*le.g)+","+Math.floor(255*le.b)+","+he+")"),ce.fillRect(0|Pe.min.x,0|Pe.min.y,Pe.max.x-Pe.min.x|0,Pe.max.y-Pe.min.y|0)),Pe.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,r){if(r instanceof n.Camera==!1)return void n.onerror("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),ce.setTransform(1,0,0,-1,ae,se),te.info.render.vertices=0,te.info.render.faces=0,C=re.projectScene(e,r,this.sortObjects,this.sortElements),T=C.elements,E=C.lights,L=r,Oe.getNormalMatrix(r.matrixWorldInverse),t();for(var i=0,c=T.length;i<c;i++){var l=T[i],h=l.material;if(void 0!==h&&h.visible!==!1){if(Re.makeEmpty(),l instanceof n.RenderableSprite)P=l,P.x*=ae,P.y*=se,o(P,l,h);else if(l instanceof n.RenderableLine)P=l.v1,R=l.v2,P.positionScreen.x*=ae,P.positionScreen.y*=se,R.positionScreen.x*=ae,R.positionScreen.y*=se,Re.setFromPoints([P.positionScreen,R.positionScreen]),Le.isIntersectionBox(Re)===!0&&a(P,R,l,h);else if(l instanceof n.RenderableFace){if(P=l.v1,R=l.v2,D=l.v3,P.positionScreen.z<-1||P.positionScreen.z>1)continue;if(R.positionScreen.z<-1||R.positionScreen.z>1)continue;if(D.positionScreen.z<-1||D.positionScreen.z>1)continue;P.positionScreen.x*=ae,P.positionScreen.y*=se,R.positionScreen.x*=ae,R.positionScreen.y*=se,D.positionScreen.x*=ae,D.positionScreen.y*=se,h.overdraw>0&&(v(P.positionScreen,R.positionScreen,h.overdraw),v(R.positionScreen,D.positionScreen,h.overdraw),v(D.positionScreen,P.positionScreen,h.overdraw)),Re.setFromPoints([P.positionScreen,R.positionScreen,D.positionScreen]),Le.isIntersectionBox(Re)===!0&&s(P,R,D,0,1,2,l,h)}Pe.union(Re)}}ce.setTransform(1,0,0,1,0,0)}},n.ShaderChunk={common:["#define PI 3.14159","#define PI2 6.28318","#define LOG2 1.442695","#define ENCODING_Linear 3000","#define ENCODING_sRGB 3001","#define ENCODING_RGBE 3002","#define ENCODING_RGBM7 3004","#define ENCODING_RGBM16 3005","#define SPECULAR_COEFF 0.18","float square( float a ) { return a*a; }","vec2  square( vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }","vec3  square( vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }","vec4  square( vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }","float saturate( float a ) { return clamp( a, 0.0, 1.0 ); }","vec2  saturate( vec2 a )  { return clamp( a, 0.0, 1.0 ); }","vec3  saturate( vec3 a )  { return clamp( a, 0.0, 1.0 ); }","vec4  saturate( vec4 a )  { return clamp( a, 0.0, 1.0 ); }","float average( float a ) { return a; }","float average( vec2 a )  { return ( a.x + a.y) * 0.5; }","float average( vec3 a )  { return ( a.x + a.y + a.z) * 0.3333333333; }","float average( vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }","float whiteCompliment( float a ) { return saturate( 1.0 - a ); }","vec2  whiteCompliment( vec2 a )  { return saturate( vec2(1.0) - a ); }","vec3  whiteCompliment( vec3 a )  { return saturate( vec3(1.0) - a ); }","vec4  whiteCompliment( vec4 a )  { return saturate( vec4(1.0) - a ); }","vec3 projectOnPlane( vec3 point, vec3 pointOnPlane, vec3 planeNormal) {","float distance = dot( planeNormal, point-pointOnPlane );","return point - distance * planeNormal;","}","float sideOfPlane( vec3 point, vec3 pointOnPlane, vec3 planeNormal ) {","return sign( dot( point - pointOnPlane, planeNormal ) );","}","vec2 applyUVOffsetRepeat( vec2 uv, vec4 offsetRepeat ) {","return uv * offsetRepeat.zw + offsetRepeat.xy;","}","vec3 linePlaneIntersect( vec3 pointOnLine, vec3 lineDirection, vec3 pointOnPlane, vec3 planeNormal ) {","return pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );","}","vec4 applyGainBrightness( vec4 texel, vec4 gainBrightnessCoeff ) {","if( gainBrightnessCoeff.w < 0.0 ) {","texel.xyz = whiteCompliment( texel.xyz );","}","texel.xyz = ( texel.xyz - vec3( gainBrightnessCoeff.x ) ) * gainBrightnessCoeff.y + vec3( gainBrightnessCoeff.z + gainBrightnessCoeff.x );","return texel;","}","vec4 texelDecode( vec4 texel, int encoding ) {","if( encoding == 3001 ) {","texel = vec4( pow( max( texel.xyz, vec3( 0.0 ) ), vec3( 2.2 ) ), texel.w );","}","else if( encoding == 3002 ) {","texel = vec4( texel.xyz * pow( 2.0, texel.w*256.0 - 128.0 ), 1.0 );","}","else if( encoding == 3004 ) {","texel = vec4( texel.xyz * texel.w * 7.0, 1.0 );","}","else if( encoding == 3005 ) {","texel = vec4( texel.xyz * texel.w * 16.0, 1.0 );","}","return texel;","}"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","float fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );","fogFactor = 1.0 - saturate( fogFactor );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),diffuseenvmap_pars_fragment:["#if defined( USE_DIFFUSEENVMAP )","uniform samplerCube diffuseEnvMap;","uniform int diffuseEnvEncoding;","#endif"].join("\n"),envmap_pars_fragment:["#if defined( USE_DIFFUSEENVMAP ) || defined( USE_ENVMAP )","uniform float flipEnvMap;","#endif","#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform int combine;","uniform int envEncoding;","#endif"].join("\n"),envmap_fragment:["#if defined( USE_ENVMAP ) && ! defined( PHYSICAL )","vec3 worldNormal = vec3( normalize( ( vec4( normal, 0.0 ) * viewMatrix ).xyz ) );","vec3 worldView = -vec3( normalize( ( vec4( viewDirection, 0.0 ) * viewMatrix ).xyz ) );","vec3 reflectVec = reflect( worldView, worldNormal );","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","cubeColor = texelDecode( cubeColor, envEncoding );","float fresnelReflectivity = saturate( reflectivity );","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, fresnelReflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * fresnelReflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, fresnelReflectivity );","}","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texelDecode( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ), ENCODING_sRGB );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","varying vec2 vUv;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","uniform vec4 gainBrightness;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","vUv = uv;","#endif"].join("\n"),map_fragment:["#if defined( USE_MAP ) || defined( USE_FALLOFFMAP )","vec2 vUvLocal = applyUVOffsetRepeat( vUv, offsetRepeat );","#endif","#ifdef USE_MAP","vec4 texelColor = clamp( applyGainBrightness( texelDecode( texture2D( map, vUvLocal ), ENCODING_sRGB ), gainBrightness ), vec4(0.0), vec4(1.0) );","gl_FragColor = gl_FragColor * texelColor;","#if defined( PHYSICAL ) || defined( PHONG )","diffuseColor *= texelColor.xyz;","#endif","#endif"].join("\n"),falloffmap_pars_fragment:["#ifdef USE_FALLOFFMAP","uniform sampler2D falloffMap;","#endif"].join("\n"),opacitymap_pars_fragment:["#ifdef USE_OPACITYMAP","uniform sampler2D opacityMap;","uniform vec4 opacityOffsetRepeat;","uniform vec4 opacityGainBrightness;","#endif"].join("\n"),opacitymap_fragment:["#ifdef USE_OPACITYMAP","vec2 vOpacityUv = applyUVOffsetRepeat( vUv, opacityOffsetRepeat );","vec4 texelOpacity = applyGainBrightness( texture2D( opacityMap, vOpacityUv ), opacityGainBrightness );","gl_FragColor.w = clamp( gl_FragColor.w * texelOpacity.r, 0.0, 1.0 );","#endif"].join("\n"),translucencymap_pars_fragment:["#ifdef USE_TRANSLUCENCYMAP","uniform sampler2D translucencyMap;","uniform vec4 translucencyOffsetRepeat;","uniform vec4 translucencyGainBrightness;","#endif"].join("\n"),translucencymap_fragment:["#ifdef USE_TRANSLUCENCYMAP","vec2 vTranslucencyUv = applyUVOffsetRepeat( vUv, translucencyOffsetRepeat );","vec4 texelTranslucency = applyGainBrightness( texture2D( translucencyMap, vTranslucencyUv ), translucencyGainBrightness );","translucencyColor.xyz = clamp( translucencyColor.xyz * texelTranslucency.xyz, vec3( 0.0 ), vec3( 1.0 ) );","#endif"].join("\n"),lightmap_pars_fragment:["#if defined( USE_LIGHTMAP ) || defined( USE_EMISSIVEMAP )","varying vec2 vUv2;","#endif","#if defined( USE_LIGHTMAP )","uniform sampler2D lightMap;","#endif","#if defined( USE_EMISSIVEMAP )","uniform sampler2D emissiveMap;","#endif"].join("\n"),lightmap_pars_vertex:["#if defined( USE_LIGHTMAP ) || defined( USE_EMISSIVEMAP )","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","#endif"].join("\n"),lightmap_vertex:["#if defined( USE_LIGHTMAP ) || defined( USE_EMISSIVEMAP )","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform vec4 bumpOffsetRepeat;","uniform float bumpScale;","vec2 dHdxy_fwd() {","#ifdef GL_OES_standard_derivatives","vec2 vBumpUv = applyUVOffsetRepeat( vUv, bumpOffsetRepeat );","vec2 dSTdx = dFdx( vBumpUv );","vec2 dSTdy = dFdy( vBumpUv );","float Hll = bumpScale * texture2D( bumpMap, vBumpUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vBumpUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vBumpUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","#else","return vec2( 0.0, 0.0 );","#endif","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","#ifdef GL_OES_standard_derivatives","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","#else","return surf_norm;","#endif","}","#endif"].join("\n"),lightattenuation_func_fragment:["float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 && cutoffDistance > 0.0 ) {","return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","else if ( decayExponent < 0.0 ) {","float numerator = 1.0;","if( cutoffDistance > 0.0 ) {","numerator = ( saturate( 1.0 - pow( lightDistance / cutoffDistance, 4.0 ) ) );","numerator *= numerator;","} ","return numerator / ( ( lightDistance * lightDistance ) + 1.0 );","}","else {","return 1.0;","}","}"].join("\n"),
normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec4 normalOffsetRepeat;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","#ifdef GL_OES_standard_derivatives","vec2 vNormalUv = applyUVOffsetRepeat( vUv, normalOffsetRepeat );","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vNormalUv.st );","vec2 st1 = dFdy( vNormalUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vNormalUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","#else","return surf_norm;","#endif","}","#endif"].join("\n"),anisotropymap_pars_fragment:["#ifdef USE_ANISOTROPYMAP","uniform sampler2D anisotropyMap;","uniform vec4 anisotropyGainBrightness;","uniform vec4 anisotropyOffsetRepeat;","#endif"].join("\n"),anisotropymap_fragment:["#ifdef USE_ANISOTROPYMAP","vec2 vAnisotropyUv = applyUVOffsetRepeat( vUv, anisotropyOffsetRepeat );","#else","#ifdef ANISOTROPY","#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","vec2 vAnisotropyUv = vUv;","#else","vec2 vAnisotropyUv = vec2( 0, 0 );","#endif","#endif","#endif","float anisotropyStrength = anisotropy;","#ifdef USE_ANISOTROPYMAP","vec4 texelAnisotropy = applyGainBrightness( texture2D( anisotropyMap, vAnisotropyUv ), anisotropyGainBrightness );","anisotropyStrength = clamp( anisotropyStrength + texelAnisotropy.r, -1.0, 1.0 );","#endif"].join("\n"),anisotropyrotationmap_pars_fragment:["#ifdef USE_ANISOTROPYROTATIONMAP","uniform sampler2D anisotropyRotationMap;","uniform vec4 anisotropyRotationGainBrightness;","uniform vec4 anisotropyRotationOffsetRepeat;","#endif"].join("\n"),anisotropyrotationmap_fragment:["float anisotropyRotationStrength = anisotropyRotation;","#ifdef USE_ANISOTROPYROTATIONMAP","vec2 vAnisotropyRotationUv = applyUVOffsetRepeat( vUv, anisotropyRotationOffsetRepeat );","vec4 texelAnisotropyRotation = applyGainBrightness( texture2D( anisotropyRotationMap, vAnisotropyRotationUv ), anisotropyRotationGainBrightness );","anisotropyRotationStrength += texelAnisotropyRotation.r;","#endif"].join("\n"),metallicmap_pars_fragment:["#ifdef USE_METALLICMAP","uniform sampler2D metallicMap;","uniform vec4 metallicGainBrightness;","uniform vec4 metallicOffsetRepeat;","#endif"].join("\n"),metallicmap_fragment:["float metallicStrength = metallic;","#ifdef USE_METALLICMAP","vec2 vMetallicUv = applyUVOffsetRepeat( vUv, metallicOffsetRepeat );","vec4 texelMetallic = applyGainBrightness( texture2D( metallicMap, vMetallicUv ), metallicGainBrightness );","metallicStrength = clamp( metallicStrength * texelMetallic.r, 0.0, 1.0 );","#endif"].join("\n"),roughnessmap_pars_fragment:["#ifdef USE_ROUGHNESSMAP","uniform sampler2D roughnessMap;","uniform vec4 roughnessOffsetRepeat;","uniform vec4 roughnessGainBrightness;","#endif"].join("\n"),roughnessmap_fragment:["float roughnessStrength = roughness;","#ifdef USE_ROUGHNESSMAP","vec2 vRoughnessUv = applyUVOffsetRepeat( vUv, roughnessOffsetRepeat );","vec4 texelRoughness = applyGainBrightness( texture2D( roughnessMap, vRoughnessUv ), roughnessGainBrightness );","roughnessStrength = clamp( roughnessStrength * texelRoughness.r, 0.0, 1.0 );","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","uniform vec4 specularGainBrightness;","uniform vec4 specularOffsetRepeat;","#endif"].join("\n"),specularmap_fragment:["#ifdef PHYSICAL","vec3 specularColor = specular;","#else","float specularStrength = 1.0;","#endif","#ifdef USE_SPECULARMAP","vec2 vSpecularUv = applyUVOffsetRepeat( vUv, specularOffsetRepeat );","vec4 texelSpecular = applyGainBrightness( texelDecode( texture2D( specularMap, vSpecularUv ), ENCODING_sRGB ), specularGainBrightness );","#ifdef PHYSICAL","specularColor.rgb = clamp( specularColor.rgb * texelSpecular.rgb, vec3( 0.0 ), vec3( 1.0 ) );","#else","specularStrength = clamp( specularStrength * texelSpecular.r, 0.0, 1.0 );","#endif","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","uniform float pointLightDecayExponent[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDecayExponent[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_AREA_LIGHTS > 0","uniform vec3 areaLightColor[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightPosition[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightWidth[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightHeight[ MAX_AREA_LIGHTS ];","uniform float areaLightDistance[ MAX_AREA_LIGHTS ];","uniform float areaLightDecayExponent[ MAX_AREA_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecayExponent[i] );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * distanceAttenuation;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * distanceAttenuation;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecayExponent[i] );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * distanceAttenuation * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * distanceAttenuation * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = ( vLightFront + ambientLightColor + ambient) * diffuse + emissive;","#ifdef DOUBLE_SIDED","vLightBack = ( vLightFront + ambientLightColor + ambient) * diffuse + emissive;","#endif"].join("\n"),lights_physical_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_physical_vertex:["#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","vWorldPosition = worldPosition.xyz;","#endif","#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );"].join("\n"),lights_physical_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","uniform float pointLightDecayExponent[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightDecayExponent[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_AREA_LIGHTS > 0","uniform vec3 areaLightColor[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightPosition[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightWidth[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightHeight[ MAX_AREA_LIGHTS ];","uniform float areaLightDistance[ MAX_AREA_LIGHTS ];","uniform float areaLightDecayExponent[ MAX_AREA_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","vec3 Fresnel_Schlick_SpecularBlendToWhite(vec3 specularColor, float hDotV) {","float Fc = pow(max( 1.0 - hDotV, 0.0 ), 5.0);","return saturate( 50.0 * average( specularColor ) ) * Fc + (1.0 - Fc) * specularColor;","}","vec3 Fresnel_Schlick_SpecularBlendToWhiteRoughness(vec3 specularColor, float hDotV, float roughness) {","float Fc = pow(max( 1.0 - hDotV, 0.0 ), 5.0) / ( 1.0 + 3.0 * roughness );","return mix( specularColor, vec3( saturate( 50.0 * average( specularColor ) ) ), Fc );","}","float Distribution_GGX( float roughness2, float nDotH ) {","float denom = nDotH * nDotH * (roughness2 - 1.0) + 1.0;","return roughness2 / ( PI * square( denom ) + 0.0000001 );","}","float Distribution_GGXAniso( vec2 anisotropicM, vec2 xyDotH, float nDotH ) {","float anisoTerm = ( xyDotH.x * xyDotH.x / ( anisotropicM.x * anisotropicM.x ) + xyDotH.y * xyDotH.y / ( anisotropicM.y * anisotropicM.y ) + nDotH * nDotH );","return 1.0 / ( PI * anisotropicM.x * anisotropicM.y * anisoTerm * anisoTerm + 0.0000001 );","}","float Visibility_Kelemen( float vDotH ) {","return 1.0 / ( 4.0 * vDotH * vDotH + 0.0000001 );","}","float Visibility_Schlick( float roughness2, float nDotL, float nDotV) {","float termL = (nDotL + sqrt(roughness2 + (1.0 - roughness2) * nDotL * nDotL));","float termV = (nDotV + sqrt(roughness2 + (1.0 - roughness2) * nDotV * nDotV));","return 1.0 / ( abs( termL * termV ) + 0.0000001 );","}","float Diffuse_Lambert() {","return 1.0 / PI;","}","float Diffuse_OrenNayer( float m2, float nDotV, float nDotL, float vDotH ) {","float termA = 1.0 - 0.5 * m2 / (m2 + 0.33);","float Cosri = 2.0 * vDotH - 1.0 - nDotV * nDotL;","float termB = 0.45 * m2 / (m2 + 0.09) * Cosri * ( Cosri >= 0.0 ? min( 1.0, nDotL / nDotV ) : nDotL );","return 1.0 / PI * ( nDotL * termA + termB );","}","mat2 createRotationMat2( float rads) {","float cos_rads = cos( rads );","float sin_rads = sin( rads );","return mat2( vec2( cos_rads, sin_rads ), vec2( -sin_rads, cos_rads ) );","}","vec2 calcAnisotropyUV( float anisotropyLocal) {","float oneMinusAbsAnisotropy = 1.0 - min( abs( anisotropyLocal ) * 0.9, 0.9 );","vec2 anisotropyUV = vec2 ( 1.0 / oneMinusAbsAnisotropy, oneMinusAbsAnisotropy );","if( anisotropy < 0.0 ) {","anisotropyUV.xy = anisotropyUV.yx;","}","return anisotropyUV;","}"].join("\n"),lights_physical_fragment:["mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normal );","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#endif","#if defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef FALLOFF","vec3 modulatedFalloffColor = falloffColor;","#ifdef USE_FALLOFFMAP","vec4 falloffTexelColor = texelDecode( texture2D( falloffMap, vUvLocal ), ENCODING_sRGB );","modulatedFalloffColor = modulatedFalloffColor * falloffTexelColor.xyz;","#endif","float fm = abs( dot( normal, viewDirection ) );","fm = /*falloffBlendParams.x * fm + falloffBlendParams.y * */ ( fm * fm * ( 3.0 - 2.0 * fm ) );","diffuseColor = mix( modulatedFalloffColor, diffuseColor, fm );","#endif","float nDotV = saturate( dot( normal, viewDirection ) );","float m2 = pow( clamp( roughnessStrength, 0.02, 1.0 ), 4.0 );","float m2ClearCoat = pow( clamp( clearCoatRoughness, 0.02, 1.0 ), 4.0 );","specularColor = mix( specularColor * SPECULAR_COEFF, diffuseColor, metallicStrength );","diffuseColor *= ( 1.0 - metallicStrength );","#ifdef ANISOTROPY","vec2 anisotropicM = calcAnisotropyUV( anisotropyStrength ) * sqrt( m2 );","#ifdef ANISOTROPYROTATION","mat2 anisotropicRotationMatrix = createRotationMat2( anisotropyRotationStrength * 2.0 * PI );","#endif","vec3 anisotropicS = tsb[1];","vec3 anisotropicT = tsb[0];","#endif","vec3 totalLighting  = vec3( 0.0 );","#if ( defined( USE_ENVMAP ) || defined( USE_DIFFUSEENVMAP ) ) && defined( PHYSICAL )","{","vec3 worldNormal = vec3( normalize( ( vec4( normal, 0.0 ) * viewMatrix ).xyz ) );","vec3 worldView = -vec3( normalize( ( vec4( viewDirection, 0.0 ) * viewMatrix ).xyz ) );","vec3 reflectVec = reflect( worldView, worldNormal );","vec3 hVector = normal;//normalize( viewDirection.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, normal ) );","float hDotV = saturate( dot( normal, viewDirection ) );","float nDotL = hDotV;//saturate( dot( normal, lVector ) );","vec3 queryVector = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );","#ifdef DOUBLE_SIDED","queryVector *= ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","vec3 worldEnvNormal = vec3( normalize( ( vec4( normal, 0.0 ) * viewMatrix ).xyz ) );","worldEnvNormal = vec3( flipEnvMap * worldEnvNormal.x, worldEnvNormal.yz );","#ifdef DOUBLE_SIDED","worldEnvNormal *= ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","vec4 diffuseEnvColor = vec4( 0.0, 0.0, 0.0, 1.0 );","#if defined( USE_DIFFUSEENVMAP )","diffuseEnvColor = texelDecode( textureCube( diffuseEnvMap, worldEnvNormal ), diffuseEnvEncoding );","#elif defined( USE_ENVMAP )","#if defined( TEXTURE_CUBE_LOD_EXT )","diffuseEnvColor = texelDecode( textureCubeLodEXT( envMap, worldEnvNormal, 9.5 ), envEncoding );","#else","diffuseEnvColor = texelDecode( textureCube( envMap, worldEnvNormal, 10.0 ), envEncoding );","#endif","#endif","vec4 specularEnvColor = vec4( 0.0, 0.0, 0.0, 1.0 );","#if defined( USE_ENVMAP )","#if defined( TEXTURE_CUBE_LOD_EXT )","specularEnvColor = texelDecode( textureCubeLodEXT( envMap, queryVector, roughnessStrength * 9.5 ), envEncoding );","#else","specularEnvColor = mix( texelDecode( textureCube( envMap, queryVector ), envEncoding ), texelDecode( textureCube( envMap, queryVector, 10.0 ), envEncoding ), roughnessStrength );","#endif","#endif","vec3 specClearCoat = vec3(0, 0, 0);","#if defined( CLEARCOAT ) && defined( USE_ENVMAP )","#if defined( TEXTURE_CUBE_LOD_EXT )","vec4 specularClearCoatEnvColor = texelDecode( textureCubeLodEXT( envMap, queryVector, clearCoatRoughness * 9.5 ), envEncoding );","#else","vec4 specularClearCoatEnvColor = mix( texelDecode( textureCube( envMap, queryVector ), envEncoding ), texelDecode( textureCube( envMap, queryVector, 10.0 ), envEncoding ), clearCoatRoughness );","#endif","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhiteRoughness( vec3( SPECULAR_COEFF ), nDotL, m2ClearCoat );","specClearCoat = specularClearCoatEnvColor.rgb * fresnelClearCoat;","#endif","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhiteRoughness( specularColor, nDotL, m2 );","vec3 spec = fresnelColor * specularEnvColor.rgb;","vec3 diff = diffuseColor * diffuseEnvColor.rgb;","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += shadingResult;","}","#endif","#if MAX_POINT_LIGHTS > 0","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecayExponent[i] );","vec3 incidentLight = pointLightColor[ i ] * distanceAttenuation;","lVector = normalize( lVector );","vec3 hVector = normalize( viewDirection.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewDirection ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( SPECULAR_COEFF ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","vec3 diff = nDotL * Diffuse_Lambert() * diffuseColor;","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += incidentLight * shadingResult;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewDirection.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecayExponent[i] );","vec3 incidentLight = spotLightColor[ i ] * distanceAttenuation;","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] );","incidentLight *= spotEffect;","vec3 hVector = normalize( viewDirection.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewDirection ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( SPECULAR_COEFF ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","vec3 diff = nDotL * Diffuse_Lambert() * diffuseColor;","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += incidentLight * shadingResult;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewDirection.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","vec3 incidentLight = directionalLightColor[ i ];","vec3 hVector = normalize( viewDirection.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewDirection ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( SPECULAR_COEFF ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","vec3 diff = nDotL * Diffuse_Lambert() * diffuseColor;","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += incidentLight * shadingResult;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewDirection.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float nDotL = dot( normal, lVector );","vec3 hemiColor = ( PI / 2.0 ) * ( ( 1.0 + nDotL ) * hemisphereLightSkyColor[ i ] + ( 1.0 - nDotL ) * hemisphereLightGroundColor[ i ] );","totalLighting += diffuseColor * hemiColor;","}","#endif","#if MAX_AREA_LIGHTS > 0","for( int i = 0; i < MAX_AREA_LIGHTS; i ++ ) {","vec3 lPosition = ( viewMatrix * vec4( areaLightPosition[ i ], 1.0 ) ).xyz;","vec3 width = areaLightWidth[ i ];","vec3 height = areaLightHeight[ i ];","vec3 up = normalize( ( viewMatrix * vec4( height, 0.0 ) ).xyz );","vec3 right = normalize( ( viewMatrix * vec4( width, 0.0 ) ).xyz );","vec3 pnormal = normalize( cross( right, up ) );","float widthScalar = length( width );","float heightScalar = length( height );","vec3 projection = projectOnPlane( -vViewPosition.xyz, lPosition, pnormal );","vec3 dir = projection - lPosition;","vec2 diagonal = vec2( dot( dir, right ), dot( dir, up ) );","vec2 nearest2D = vec2( clamp( diagonal.x, -widthScalar, widthScalar ), clamp( diagonal.y, -heightScalar, heightScalar ) );","vec3 nearestPointInside = lPosition + ( right *nearest2D.x + up * nearest2D.y );","vec3 lVector = ( nearestPointInside + vViewPosition.xyz );","float distanceAttenuation = calcLightAttenuation( length( lVector ), areaLightDistance[ i ], areaLightDecayExponent[i] );","lVector = normalize( lVector );","vec3 incidentLight = areaLightColor[ i ] * distanceAttenuation * 0.01;","float nDotLDiffuse = saturate( dot( normal, lVector ) );","vec3 diff = Diffuse_Lambert() * diffuseColor * widthScalar * heightScalar;","vec3 viewReflection = reflect( viewDirection.xyz, normal );","vec3 reflectionLightPlaneIntersection = linePlaneIntersect( -vViewPosition.xyz, viewReflection, lPosition, pnormal );","float specAngle = dot( viewReflection, pnormal );","if ( specAngle < 0.0 ) {","vec3 dirSpec = reflectionLightPlaneIntersection - lPosition;","vec2 dirSpec2D = vec2( dot( dirSpec, right ), dot( dirSpec, up ) );","vec2 nearestSpec2D = vec2( clamp( dirSpec2D.x, -widthScalar, widthScalar ), clamp( dirSpec2D.y, -heightScalar, heightScalar ) );","lVector = normalize( lPosition + ( right *nearestSpec2D.x + up * nearestSpec2D.y ) + vViewPosition.xyz );","} else { ","lVector = vec3( 0 );","}","vec3 hVector = normalize( viewDirection.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewDirection ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( SPECULAR_COEFF ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","#ifdef CLEARCOAT","diff = mix( diff, specClearCoat, clearCoat );","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","totalLighting  += incidentLight * spec;","totalLighting  += incidentLight * nDotLDiffuse * diff;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewDirection.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","#endif","#ifdef CLEARCOAT","totalLighting += diffuseColor * ( ambientLightColor * ( 1.0 - clearCoat ) );","#else","totalLighting += diffuseColor * ambientLightColor;","#endif","gl_FragColor.xyz += totalLighting;","vec3 emissiveLocal = emissive;","#ifdef USE_EMISSIVEMAP","vec3 emissiveColor = texture2D( emissiveMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","emissiveColor *= emissiveColor;","#endif","emissiveLocal *= emissiveColor;","#endif","gl_FragColor.xyz += emissiveLocal;","vec3 ambientLocal = ambient;","#ifdef USE_LIGHTMAP","vec3 ambientColor = texture2D( lightMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","ambientColor *= ambientColor;","#endif","ambientLocal *= ambientColor;","#ifdef CLEARCOAT","ambientLocal *= ( 1.0 - clearCoat );","#endif","#endif","gl_FragColor.xyz += diffuseColor * ambientLocal;"].join("\n"),lights_phong_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),
lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","uniform float pointLightDecayExponent[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightDecayExponent[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_AREA_LIGHTS > 0","uniform vec3 areaLightColor[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightPosition[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightWidth[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightHeight[ MAX_AREA_LIGHTS ];","uniform float areaLightDistance[ MAX_AREA_LIGHTS ];","uniform float areaLightDecayExponent[ MAX_AREA_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewDirection = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecayExponent[i] );","lVector = normalize( lVector );","float dotProduct = dot( normal, lVector );","float pointDiffuseWeight = max( dotProduct, 0.0 );","pointDiffuse  += pointLightColor[ i ] * pointDiffuseWeight * distanceAttenuation;","vec3 pointHalfVector = normalize( lVector + viewDirection );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * pow( max( pointDotNormalHalf, 0.0 ), shininess );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * distanceAttenuation * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecayExponent[i] );","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += spotLightColor[ i ] * spotDiffuseWeight * distanceAttenuation * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewDirection );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * pow( max( spotDotNormalHalf, 0.0 ), shininess );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * distanceAttenuation * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewDirection );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * pow( max( dirDotNormalHalf, 0.0 ), shininess );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewDirection );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * pow( max( hemiDotNormalHalfSky, 0.0 ), shininess );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewDirection );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * pow( max( hemiDotNormalHalfGround, 0.0 ), shininess );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","#if MAX_AREA_LIGHTS > 0","vec3 areaDiffuse  = vec3( 0.0 );","vec3 areaSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_AREA_LIGHTS; i ++ ) {","vec3 lPosition = ( viewMatrix * vec4( areaLightPosition[ i ], 1.0 ) ).xyz;","vec3 width = areaLightWidth[ i ];","vec3 height = areaLightHeight[ i ];","vec3 up = normalize( ( viewMatrix * vec4( height, 0.0 ) ).xyz );","vec3 right = normalize( ( viewMatrix * vec4( width, 0.0 ) ).xyz );","vec3 pnormal = normalize( cross( right, up ) );","float widthScalar = length( width );","float heightScalar = length( height );","vec3 projection = projectOnPlane( -vViewPosition.xyz, lPosition, pnormal );","vec3 dir = projection - lPosition;","vec2 diagonal = vec2( dot( dir, right ), dot( dir, up ) );","vec2 nearest2D = vec2( clamp( diagonal.x, -widthScalar, widthScalar ), clamp( diagonal.y, -heightScalar, heightScalar ) );","vec3 nearestPointInside = lPosition + ( right *nearest2D.x + up * nearest2D.y );","vec3 lVector = ( nearestPointInside + vViewPosition.xyz );","float distanceAttenuation = calcLightAttenuation( length( lVector ), areaLightDistance[ i ], areaLightDecayExponent[i] );","lVector = normalize( lVector );","float nDotLDiffuse = saturate( dot( normal, lVector ) );","vec3 viewReflection = reflect( viewDirection.xyz, normal );","vec3 reflectionLightPlaneIntersection = linePlaneIntersect( -vViewPosition.xyz, viewReflection, lPosition, pnormal );","float specAngle = dot( viewReflection, pnormal );","if ( specAngle < 0.0 ) {","vec3 dirSpec = reflectionLightPlaneIntersection - lPosition;","vec2 dirSpec2D = vec2( dot( dirSpec, right ), dot( dirSpec, up ) );","vec2 nearestSpec2D = vec2( clamp( dirSpec2D.x, -widthScalar, widthScalar ), clamp( dirSpec2D.y, -heightScalar, heightScalar ) );","lVector = normalize( lPosition + ( right *nearestSpec2D.x + up * nearestSpec2D.y ) + vViewPosition.xyz );","} else { ","lVector = vec3( 0 );","}","float dotProduct = nDotLDiffuse;","float areaDiffuseWeight = max( dotProduct, 0.0 );","areaDiffuse  += areaLightColor[ i ] * areaDiffuseWeight * distanceAttenuation * widthScalar * heightScalar * 0.01;","vec3 areaHalfVector = normalize( lVector + viewDirection );","float areaDotNormalHalf = max( dot( normal, areaHalfVector ), 0.0 );","float areaSpecularWeight = specularStrength * pow( max( areaDotNormalHalf, 0.0 ), shininess );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, areaHalfVector ), 0.0 ), 5.0 );","areaSpecular += schlick * areaLightColor[ i ] * areaSpecularWeight * areaDiffuseWeight * distanceAttenuation * specularNormalization * 0.01;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#if MAX_AREA_LIGHTS > 0","totalDiffuse += areaDiffuse;","totalSpecular += areaSpecular;","#endif","vec3 ambientLocal = ambient;","#ifdef USE_LIGHTMAP","vec3 ambientColor = texture2D( lightMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","ambientColor *= ambientColor;","#endif","ambientLocal *= ambientColor;","#endif","gl_FragColor.xyz = diffuseColor * ( totalDiffuse + ambientLightColor + ambientLocal ) + totalSpecular;","vec3 emissiveLocal = emissive;","#ifdef USE_EMISSIVEMAP","vec3 emissiveColor = texture2D( emissiveMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","emissiveColor *= emissiveColor;","#endif","emissiveLocal *= emissiveColor;","#endif","gl_FragColor.xyz += emissiveLocal.xyz;"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned      += boneMatY * skinVertex * skinWeight.y;","skinned      += boneMatZ * skinVertex * skinWeight.z;","skinned      += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},n.UniformsUtils={merge:function(e){var t,r,i,n={};for(t=0;t<e.length;t++){i=this.clone(e[t]);for(r in i)n[r]=i[r]}return n},clone:function(e){var t,r,i,o={};for(t in e){o[t]={};for(r in e[t])i=e[t][r],i instanceof n.Color||i instanceof n.Vector2||i instanceof n.Vector3||i instanceof n.Vector4||i instanceof n.Matrix4||i instanceof n.Texture?o[t][r]=i.clone():i instanceof Array?o[t][r]=i.slice():o[t][r]=i}return o}},n.UniformsLib={common:{diffuse:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},gainBrightness:{type:"v4",value:new n.Vector4(0,1,0,1)},lightMap:{type:"t",value:null},emissiveMap:{type:"t",value:null},envMap:{type:"t",value:null},envEncoding:{type:"i",value:0},diffuseEnvMap:{type:"t",value:null},diffuseEnvEncoding:{type:"i",value:0},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},specularmap:{specularMap:{type:"t",value:null},specularOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},specularGainBrightness:{type:"v4",value:new n.Vector4(0,1,0,1)}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)}},opacitymap:{opacityMap:{type:"t",value:null},opacityOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},opacityGainBrightness:{type:"v4",value:new n.Vector4(0,1,0,1)}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new n.Vector2(1,1)},normalOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecayExponent:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightDecayExponent:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},areaLightColor:{type:"fv",value:[]},areaLightPosition:{type:"fv",value:[]},areaLightDistance:{type:"fv1",value:[]},areaLightDecayExponent:{type:"fv1",value:[]},areaLightWidth:{type:"fv",value:[]},areaLightHeight:{type:"fv",value:[]}},particle:{psColor:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},n.ShaderLib={physical:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.bumpmap,n.UniformsLib.normalmap,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,n.UniformsLib.opacitymap,n.UniformsLib.specularmap,{ambient:{type:"c",value:new n.Color(16777215)},emissive:{type:"c",value:new n.Color(0)},specular:{type:"c",value:new n.Color(16777215)},falloffColor:{type:"c",value:new n.Color(16777215)},falloffMap:{type:"t",value:null},falloffBlendParams:{type:"v4",value:new n.Vector4(1,0,0,1)},clearCoat:{type:"f",value:0},clearCoatRoughness:{type:"f",value:.25},roughness:{type:"f",value:.5},roughnessMap:{type:"t",value:null},roughnessOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},roughnessGainBrightness:{type:"v4",value:new n.Vector4(0,1,0,1)},metallic:{type:"f",value:.5},metallicMap:{type:"t",value:null},metallicOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},metallicGainBrightness:{type:"v4",value:new n.Vector4(0,1,0,1)},anisotropy:{type:"f",value:0},anisotropyMap:{type:"t",value:null},anisotropyOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},anisotropyGainBrightness:{type:"v4",value:new n.Vector4(0,1,0,1)},anisotropyRotation:{type:"f",value:0},anisotropyRotationMap:{type:"t",value:null},anisotropyRotationOffsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},anisotropyRotationGainBrightness:{type:"v4",value:new n.Vector4(0,1,0,1)},translucency:{type:"c",value:new n.Color(0)},translucencyMap:{type:"t",value:null},translucencyNormalAlpha:{type:"f",value:.75},translucencyNormalPower:{type:"f",value:2},translucencyViewAlpha:{type:"f",value:.75},translucencyViewPower:{type:"f",value:2}}]),vertexShader:["attribute vec4 tangent;","#define PHONG","#define PHYSICAL","varying vec3 vViewPosition;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;",n.ShaderChunk.common,n.ShaderChunk.map_pars_vertex,n.ShaderChunk.normalmap_pars_vertex,n.ShaderChunk.roughnessmap_pars_vertex,n.ShaderChunk.specularmap_pars_vertex,n.ShaderChunk.opacitymap_pars_vertex,n.ShaderChunk.anisotropymap_pars_vertex,n.ShaderChunk.anisotropyrotationmap_pars_vertex,n.ShaderChunk.metallicmap_pars_vertex,n.ShaderChunk.translucencymap_pars_vertex,n.ShaderChunk.bumpmap_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.lights_physical_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.normalmap_vertex,n.ShaderChunk.roughnessmap_vertex,n.ShaderChunk.opacitymap_vertex,n.ShaderChunk.specularmap_vertex,n.ShaderChunk.anisotropymap_vertex,n.ShaderChunk.anisotropyrotationmap_vertex,n.ShaderChunk.metallicmap_vertex,n.ShaderChunk.translucencymap_vertex,n.ShaderChunk.bumpmap_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.lights_physical_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#ifdef TEXTURE_CUBE_LOD_EXT","#extension GL_EXT_shader_texture_lod : enable","#endif","#define PHYSICAL","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 falloffColor;","uniform vec4 falloffBlendParams;","uniform vec3 specular;","uniform float roughness;","uniform float metallic;","uniform float clearCoat;","uniform float clearCoatRoughness;","uniform vec3 translucency;","uniform float translucencyNormalAlpha;","uniform float translucencyNormalPower;","uniform float translucencyViewPower;","uniform float translucencyViewAlpha;","uniform float anisotropy;","uniform float anisotropyRotation;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.falloffmap_pars_fragment,n.ShaderChunk.opacitymap_pars_fragment,n.ShaderChunk.translucencymap_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.diffuseenvmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.lights_physical_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.bumpmap_pars_fragment,n.ShaderChunk.normalmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,n.ShaderChunk.anisotropymap_pars_fragment,n.ShaderChunk.anisotropyrotationmap_pars_fragment,n.ShaderChunk.metallicmap_pars_fragment,n.ShaderChunk.roughnessmap_pars_fragment,n.ShaderChunk.reflectivitymap_pars_fragment,n.ShaderChunk.lightattenuation_func_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 0.0 ), opacity );","vec3 diffuseColor = diffuse;","vec3 translucencyColor = translucency;","vec3 normal = normalize( vNormal );","vec3 viewDirection = normalize( vViewPosition );",n.ShaderChunk.map_fragment,n.ShaderChunk.opacitymap_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.anisotropymap_fragment,n.ShaderChunk.anisotropyrotationmap_fragment,n.ShaderChunk.roughnessmap_fragment,n.ShaderChunk.metallicmap_fragment,n.ShaderChunk.translucencymap_fragment,n.ShaderChunk.reflectivitymap_fragment,n.ShaderChunk.lights_physical_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"gl_FragColor.xyz *= gl_FragColor.w;","}"].join("\n")},basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,n.UniformsLib.shadowmap]),vertexShader:[n.ShaderChunk.common,n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"#endif",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{ambient:{type:"c",value:new n.Color(16777215)},emissive:{type:"c",value:new n.Color(0)},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",n.ShaderChunk.common,n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.lights_lambert_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,n.ShaderChunk.lightattenuation_func_fragment,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.lights_lambert_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.bumpmap,n.UniformsLib.normalmap,n.UniformsLib.specularmap,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,n.UniformsLib.opacitymap,{ambient:{type:"c",value:new n.Color(16777215)},emissive:{type:"c",value:new n.Color(0)},specular:{type:"c",value:new n.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",n.ShaderChunk.common,n.ShaderChunk.map_pars_vertex,n.ShaderChunk.normalmap_pars_vertex,n.ShaderChunk.bumpmap_pars_vertex,n.ShaderChunk.specularmap_pars_vertex,n.ShaderChunk.opacitymap_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.lights_phong_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.normalmap_vertex,n.ShaderChunk.bumpmap_vertex,n.ShaderChunk.opacitymap_vertex,n.ShaderChunk.specularmap_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.lights_phong_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.opacitymap_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.lights_phong_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.bumpmap_pars_fragment,n.ShaderChunk.normalmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,n.ShaderChunk.lightattenuation_func_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","vec3 diffuseColor = diffuse;",n.ShaderChunk.map_fragment,n.ShaderChunk.opacitymap_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.lights_phong_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.particle,n.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",n.ShaderChunk.common,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_particle_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",n.ShaderChunk.map_particle_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",n.ShaderChunk.common,n.ShaderChunk.color_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",n.ShaderChunk.color_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = clamp( ( depth - mNear ) / ( mFar - mNear ), 0.0, 1.0 );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",n.ShaderChunk.common,n.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:n.UniformsUtils.merge([n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new n.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new n.Color(16777215)},specular:{type:"c",value:new n.Color(1118481)},ambient:{type:"c",value:new n.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new n.Vector2(0,0)},uRepeat:{type:"v2",value:new n.Vector2(1,1)},wrapRGB:{type:"v3",value:new n.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",n.ShaderChunk.common,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), opacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewDirection = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewDirection );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewDirection );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewDirection );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewDirection );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewDirection );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","}",n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",n.ShaderChunk.common,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1},tEncoding:{type:"i",value:0},blurring:{type:"f",value:0}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#ifdef TEXTURE_CUBE_LOD_EXT","#extension GL_EXT_shader_texture_lod : enable","#endif",n.ShaderChunk.common,"uniform samplerCube tCube;","uniform float tFlip;","uniform int tEncoding;","uniform float blurring;","varying vec3 vWorldPosition;","void main() {","vec3 queryVector = vec3( tFlip * vWorldPosition.x, vWorldPosition.yz );","#if defined( TEXTURE_CUBE_LOD_EXT )","vec4 color = textureCubeLodEXT( tCube, queryVector, blurring );","#else","vec4 color = textureCube( tCube, queryVector );","#endif","color = texelDecode( color, tEncoding );","#ifdef GAMMA_OUTPUT","color.xyz = sqrt( color.xyz );","#endif","gl_FragColor = color;","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[n.ShaderChunk.common,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,"void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const float depth ) {","\t\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")},linearDepthRGBA:{uniforms:{zNear:{type:"f",value:.5},zFar:{type:"f",value:1e3}},vertexShader:[n.ShaderChunk.common,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,"varying vec3 vViewPosition;","void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;","}"].join("\n"),fragmentShader:["uniform float zNear;","uniform float zFar;","varying vec3 vViewPosition;","vec4 pack_depth( const float depth ) {","\t\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {","gl_FragColor = pack_depth( clamp( ( vViewPosition.z - zNear ) / ( zFar - zNear ), 0.0, 1.0 ) );","}"].join("\n")}},n.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Ne.createBuffer(),e.__webglColorBuffer=Ne.createBuffer(),je.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Ne.createBuffer(),e.__webglColorBuffer=Ne.createBuffer(),e.__webglLineDistanceBuffer=Ne.createBuffer(),je.info.memory.geometries++}function o(e){e.__webglVertexBuffer=Ne.createBuffer(),e.__webglNormalBuffer=Ne.createBuffer(),e.__webglTangentBuffer=Ne.createBuffer(),e.__webglColorBuffer=Ne.createBuffer(),e.__webglUVBuffer=Ne.createBuffer(),e.__webglUV2Buffer=Ne.createBuffer(),e.__webglSkinIndicesBuffer=Ne.createBuffer(),e.__webglSkinWeightsBuffer=Ne.createBuffer(),e.__webglFaceBuffer=Ne.createBuffer(),e.__webglLineBuffer=Ne.createBuffer();var t,r;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;t<r;t++)e.__webglMorphTargetsBuffers.push(Ne.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;t<r;t++)e.__webglMorphNormalsBuffers.push(Ne.createBuffer());je.info.memory.geometries++}function a(e,t){var r=e.vertices.length,i=t.material;if(i.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var n in i.attributes){var o=i.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(r*a),o.buffer=Ne.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function s(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__sortArray=[],e.__webglParticleCount=r,a(e,t)}function c(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,a(e,t)}function l(e,t){var r=t.geometry,i=e.faces3,n=3*i.length,o=1*i.length,a=3*i.length,s=h(t,e),c=d(s),l=f(s),u=p(s);e.__vertexArray=new Float32Array(3*n),l&&(e.__normalArray=new Float32Array(3*n)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*n)),u&&(e.__colorArray=new Float32Array(3*n)),c&&(r.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*n)),r.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*n))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*n),e.__skinWeightArray=new Float32Array(4*n)),e.__faceArray=new Uint16Array(3*o),e.__lineArray=new Uint16Array(2*a);var m,v;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],m=0,v=e.numMorphTargets;m<v;m++)e.__morphTargetsArrays.push(new Float32Array(3*n));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],m=0,v=e.numMorphNormals;m<v;m++)e.__morphNormalsArrays.push(new Float32Array(3*n));if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var g in s.attributes){var y=s.attributes[g],x={};for(var _ in y)x[_]=y[_];if(!x.__webglInitialized||x.createUniqueBuffers){x.__webglInitialized=!0;var b=1;"v2"===x.type?b=2:"v3"===x.type?b=3:"v4"===x.type?b=4:"c"===x.type&&(b=3),x.size=b,x.array=new Float32Array(n*b),x.buffer=Ne.createBuffer(),x.buffer.belongsToAttribute=g,y.needsUpdate=!0,x.__original=y}e.__webglCustomAttributesList.push(x)}}e.__inittedArrays=!0}function h(e,t){return e.material instanceof n.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function u(e){return e&&void 0!==e.shading&&e.shading===n.SmoothShading}function f(e){return!(e instanceof n.MeshBasicMaterial&&!e.envMap||e instanceof n.MeshDepthMaterial)&&(u(e)?n.SmoothShading:n.FlatShading)}function p(e){return!!e.vertexColors&&e.vertexColors}function d(e){return e.map||e.opacityMap||e.lightMap||e.emissiveMap||e.bumpMap||e.normalMap||e.specularMap||e.reflectivityMap||e.roughnessMap||e.falloffMap||e.anisotropyMap||e.anisotropyRotationMap||e.metallicMap||e.translucencyMap||e.anisotropy&&0!==e.anisotropy||e instanceof n.ShaderMaterial,!0}function m(e){var t,r,i;for(t in e.attributes)i="index"===t?Ne.ELEMENT_ARRAY_BUFFER:Ne.ARRAY_BUFFER,r=e.attributes[t],r.buffer=Ne.createBuffer(),Ne.bindBuffer(i,r.buffer),Ne.bufferData(i,r.array,Ne.STATIC_DRAW)}function v(e,t,r){var i,n,o,a,s,c,l,h,u,f,p,d,m=e.vertices,v=m.length,g=e.colors,y=g.length,x=e.__vertexArray,_=e.__colorArray,b=e.__sortArray,w=e.verticesNeedUpdate,M=(e.elementsNeedUpdate,e.colorsNeedUpdate),S=e.__webglCustomAttributesList;if(r.sortParticles){for(xt.copy(yt),xt.multiply(r.matrixWorld),i=0;i<v;i++)o=m[i],_t.copy(o),_t.applyProjection(xt),b[i]=[_t.z,i];for(b.sort(A),i=0;i<v;i++)o=m[b[i][1]],a=3*i,x[a]=o.x,x[a+1]=o.y,x[a+2]=o.z;for(n=0;n<y;n++)a=3*n,c=g[b[n][1]],_[a]=c.r,_[a+1]=c.g,_[a+2]=c.b;if(S)for(l=0,h=S.length;l<h;l++)if(d=S[l],void 0===d.boundTo||"vertices"===d.boundTo)if(a=0,f=d.value.length,1===d.size)for(u=0;u<f;u++)s=b[u][1],d.array[u]=d.value[s];else if(2===d.size)for(u=0;u<f;u++)s=b[u][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(u=0;u<f;u++)s=b[u][1],p=d.value[s],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(u=0;u<f;u++)s=b[u][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(u=0;u<f;u++)s=b[u][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4}else{if(w)for(i=0;i<v;i++)o=m[i],a=3*i,x[a]=o.x,x[a+1]=o.y,x[a+2]=o.z;if(M)for(n=0;n<y;n++)c=g[n],a=3*n,_[a]=c.r,_[a+1]=c.g,_[a+2]=c.b;if(S)for(l=0,h=S.length;l<h;l++)if(d=S[l],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo))if(f=d.value.length,a=0,1===d.size)for(u=0;u<f;u++)d.array[u]=d.value[u];else if(2===d.size)for(u=0;u<f;u++)p=d.value[u],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(u=0;u<f;u++)p=d.value[u],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(u=0;u<f;u++)p=d.value[u],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(u=0;u<f;u++)p=d.value[u],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4}if((w||r.sortParticles)&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,x,t)),(M||r.sortParticles)&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,_,t)),S)for(l=0,h=S.length;l<h;l++)d=S[l],(d.needsUpdate||r.sortParticles)&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,d.buffer),Ne.bufferData(Ne.ARRAY_BUFFER,d.array,t))}function g(e,t){var r,i,n,o,a,s,c,l,h,u,f,p,d=e.vertices,m=e.colors,v=e.lineDistances,g=d.length,y=m.length,x=v.length,_=e.__vertexArray,b=e.__colorArray,w=e.__lineDistanceArray,M=e.verticesNeedUpdate,S=e.colorsNeedUpdate,A=e.lineDistancesNeedUpdate,C=e.__webglCustomAttributesList;if(M){for(r=0;r<g;r++)o=d[r],a=3*r,_[a]=o.x,_[a+1]=o.y,_[a+2]=o.z;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,_,t)}if(S){for(i=0;i<y;i++)s=m[i],a=3*i,b[a]=s.r,b[a+1]=s.g,b[a+2]=s.b;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,b,t)}if(A){for(n=0;n<x;n++)w[n]=v[n];Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,w,t)}if(C)for(c=0,l=C.length;c<l;c++)if(p=C[c],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(a=0,u=p.value.length,1===p.size)for(h=0;h<u;h++)p.array[h]=p.value[h];else if(2===p.size)for(h=0;h<u;h++)f=p.value[h],
p.array[a]=f.x,p.array[a+1]=f.y,a+=2;else if(3===p.size)if("c"===p.type)for(h=0;h<u;h++)f=p.value[h],p.array[a]=f.r,p.array[a+1]=f.g,p.array[a+2]=f.b,a+=3;else for(h=0;h<u;h++)f=p.value[h],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,a+=3;else if(4===p.size)for(h=0;h<u;h++)f=p.value[h],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,p.array[a+3]=f.w,a+=4;Ne.bindBuffer(Ne.ARRAY_BUFFER,p.buffer),Ne.bufferData(Ne.ARRAY_BUFFER,p.array,t)}}function y(e,t,r,i,o){if(e.__inittedArrays){var a,s,c,l,h,u,m,v,g,y,x,_,b,w,M,S,A,C,T,E,L,P,R,D,V,F,U,N,O,k,B,z,I,G,j,H,W,X,q,Y,K,Q,Z=f(o),J=p(o),$=d(o),ee=Z===n.SmoothShading,te=0,re=0,ie=0,ne=0,oe=0,ae=0,se=0,ce=0,le=0,he=0,ue=0,fe=0,pe=0,de=e.__vertexArray,me=e.__uvArray,ve=e.__uv2Array,ge=e.__normalArray,ye=e.__tangentArray,xe=e.__colorArray,_e=e.__skinIndexArray,be=e.__skinWeightArray,we=e.__morphTargetsArrays,Me=e.__morphNormalsArrays,Se=e.__webglCustomAttributesList,Ae=e.__faceArray,Ce=e.__lineArray,Te=t.geometry,Ee=Te.verticesNeedUpdate,Le=Te.elementsNeedUpdate,Pe=Te.uvsNeedUpdate,Re=Te.normalsNeedUpdate,De=Te.tangentsNeedUpdate,Ve=Te.colorsNeedUpdate,Fe=Te.morphTargetsNeedUpdate,Ue=Te.vertices,Oe=e.faces3,ke=Te.faces,Be=Te.faceVertexUvs[0],ze=Te.faceVertexUvs[1],Ie=(Te.colors,Te.skinIndices),Ge=Te.skinWeights,je=Te.morphTargets,He=Te.morphNormals;if(Ee){for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],_=Ue[l.a],b=Ue[l.b],w=Ue[l.c],de[re]=_.x,de[re+1]=_.y,de[re+2]=_.z,de[re+3]=b.x,de[re+4]=b.y,de[re+5]=b.z,de[re+6]=w.x,de[re+7]=w.y,de[re+8]=w.z,re+=9;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,de,r)}if(Fe)for(j=0,H=je.length;j<H;j++){for(ue=0,a=0,s=Oe.length;a<s;a++)q=Oe[a],l=ke[q],_=je[j].vertices[l.a],b=je[j].vertices[l.b],w=je[j].vertices[l.c],W=we[j],W[ue]=_.x,W[ue+1]=_.y,W[ue+2]=_.z,W[ue+3]=b.x,W[ue+4]=b.y,W[ue+5]=b.z,W[ue+6]=w.x,W[ue+7]=w.y,W[ue+8]=w.z,o.morphNormals&&(ee?(Y=He[j].vertexNormals[q],C=Y.a,T=Y.b,E=Y.c):(C=He[j].faceNormals[q],T=C,E=C),X=Me[j],X[ue]=C.x,X[ue+1]=C.y,X[ue+2]=C.z,X[ue+3]=T.x,X[ue+4]=T.y,X[ue+5]=T.z,X[ue+6]=E.x,X[ue+7]=E.y,X[ue+8]=E.z),ue+=9;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[j]),Ne.bufferData(Ne.ARRAY_BUFFER,we[j],r),o.morphNormals&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[j]),Ne.bufferData(Ne.ARRAY_BUFFER,Me[j],r))}if(Ge.length){for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],D=Ge[l.a],V=Ge[l.b],F=Ge[l.c],be[he]=D.x,be[he+1]=D.y,be[he+2]=D.z,be[he+3]=D.w,be[he+4]=V.x,be[he+5]=V.y,be[he+6]=V.z,be[he+7]=V.w,be[he+8]=F.x,be[he+9]=F.y,be[he+10]=F.z,be[he+11]=F.w,U=Ie[l.a],N=Ie[l.b],O=Ie[l.c],_e[he]=U.x,_e[he+1]=U.y,_e[he+2]=U.z,_e[he+3]=U.w,_e[he+4]=N.x,_e[he+5]=N.y,_e[he+6]=N.z,_e[he+7]=N.w,_e[he+8]=O.x,_e[he+9]=O.y,_e[he+10]=O.z,_e[he+11]=O.w,he+=12;he>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,_e,r),Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,be,r))}if(Ve&&J){for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],m=l.vertexColors,v=l.color,3===m.length&&J===n.VertexColors?(L=m[0],P=m[1],R=m[2]):(L=v,P=v,R=v),xe[le]=L.r,xe[le+1]=L.g,xe[le+2]=L.b,xe[le+3]=P.r,xe[le+4]=P.g,xe[le+5]=P.b,xe[le+6]=R.r,xe[le+7]=R.g,xe[le+8]=R.b,le+=9;le>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,xe,r))}if(De&&Te.hasTangents){var We=new n.Vector3(0,0,0);for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],g=l.vertexTangents,M=g[0]||We,S=g[1]||We,A=g[2]||We,ye[se]=M.x,ye[se+1]=M.y,ye[se+2]=M.z,ye[se+3]=M.w,ye[se+4]=S.x,ye[se+5]=S.y,ye[se+6]=S.z,ye[se+7]=S.w,ye[se+8]=A.x,ye[se+9]=A.y,ye[se+10]=A.z,ye[se+11]=A.w,se+=12;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglTangentBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,ye,r)}if(Re&&Z){for(a=0,s=Oe.length;a<s;a++)if(l=ke[Oe[a]],h=l.vertexNormals,u=l.normal,3===h.length&&ee)for(k=0;k<3;k++)z=h[k],ge[ae]=z.x,ge[ae+1]=z.y,ge[ae+2]=z.z,ae+=3;else for(k=0;k<3;k++)ge[ae]=u.x,ge[ae+1]=u.y,ge[ae+2]=u.z,ae+=3;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglNormalBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,ge,r)}if(Pe&&Be&&$){for(a=0,s=Oe.length;a<s;a++)if(c=Oe[a],y=Be[c],void 0!==y)for(k=0;k<3;k++)I=y[k],me[ie]=I.x,me[ie+1]=I.y,ie+=2;ie>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglUVBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,me,r))}if(Pe&&ze&&$){for(a=0,s=Oe.length;a<s;a++)if(c=Oe[a],x=ze[c],void 0!==x)for(k=0;k<3;k++)G=x[k],ve[ne]=G.x,ve[ne+1]=G.y,ne+=2;ne>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglUV2Buffer),Ne.bufferData(Ne.ARRAY_BUFFER,ve,r))}if(Le){for(a=0,s=Oe.length;a<s;a++)Ae[oe]=te,Ae[oe+1]=te+1,Ae[oe+2]=te+2,oe+=3,Ce[ce]=te,Ce[ce+1]=te+1,Ce[ce+2]=te,Ce[ce+3]=te+2,Ce[ce+4]=te+1,Ce[ce+5]=te+2,ce+=6,te+=3;Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Ne.bufferData(Ne.ELEMENT_ARRAY_BUFFER,Ae,r),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Ne.bufferData(Ne.ELEMENT_ARRAY_BUFFER,Ce,r)}if(Se)for(k=0,B=Se.length;k<B;k++)if(Q=Se[k],Q.__original.needsUpdate){if(fe=0,pe=0,1===Q.size){if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],Q.array[fe]=Q.value[l.a],Q.array[fe+1]=Q.value[l.b],Q.array[fe+2]=Q.value[l.c],fe+=3;else if("faces"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)K=Q.value[Oe[a]],Q.array[fe]=K,Q.array[fe+1]=K,Q.array[fe+2]=K,fe+=3}else if(2===Q.size){if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],_=Q.value[l.a],b=Q.value[l.b],w=Q.value[l.c],Q.array[fe]=_.x,Q.array[fe+1]=_.y,Q.array[fe+2]=b.x,Q.array[fe+3]=b.y,Q.array[fe+4]=w.x,Q.array[fe+5]=w.y,fe+=6;else if("faces"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)K=Q.value[Oe[a]],_=K,b=K,w=K,Q.array[fe]=_.x,Q.array[fe+1]=_.y,Q.array[fe+2]=b.x,Q.array[fe+3]=b.y,Q.array[fe+4]=w.x,Q.array[fe+5]=w.y,fe+=6}else if(3===Q.size){var Xe;if(Xe="c"===Q.type?["r","g","b"]:["x","y","z"],void 0===Q.boundTo||"vertices"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],_=Q.value[l.a],b=Q.value[l.b],w=Q.value[l.c],Q.array[fe]=_[Xe[0]],Q.array[fe+1]=_[Xe[1]],Q.array[fe+2]=_[Xe[2]],Q.array[fe+3]=b[Xe[0]],Q.array[fe+4]=b[Xe[1]],Q.array[fe+5]=b[Xe[2]],Q.array[fe+6]=w[Xe[0]],Q.array[fe+7]=w[Xe[1]],Q.array[fe+8]=w[Xe[2]],fe+=9;else if("faces"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)K=Q.value[Oe[a]],_=K,b=K,w=K,Q.array[fe]=_[Xe[0]],Q.array[fe+1]=_[Xe[1]],Q.array[fe+2]=_[Xe[2]],Q.array[fe+3]=b[Xe[0]],Q.array[fe+4]=b[Xe[1]],Q.array[fe+5]=b[Xe[2]],Q.array[fe+6]=w[Xe[0]],Q.array[fe+7]=w[Xe[1]],Q.array[fe+8]=w[Xe[2]],fe+=9;else if("faceVertices"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)K=Q.value[Oe[a]],_=K[0],b=K[1],w=K[2],Q.array[fe]=_[Xe[0]],Q.array[fe+1]=_[Xe[1]],Q.array[fe+2]=_[Xe[2]],Q.array[fe+3]=b[Xe[0]],Q.array[fe+4]=b[Xe[1]],Q.array[fe+5]=b[Xe[2]],Q.array[fe+6]=w[Xe[0]],Q.array[fe+7]=w[Xe[1]],Q.array[fe+8]=w[Xe[2]],fe+=9}else if(4===Q.size)if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)l=ke[Oe[a]],_=Q.value[l.a],b=Q.value[l.b],w=Q.value[l.c],Q.array[fe]=_.x,Q.array[fe+1]=_.y,Q.array[fe+2]=_.z,Q.array[fe+3]=_.w,Q.array[fe+4]=b.x,Q.array[fe+5]=b.y,Q.array[fe+6]=b.z,Q.array[fe+7]=b.w,Q.array[fe+8]=w.x,Q.array[fe+9]=w.y,Q.array[fe+10]=w.z,Q.array[fe+11]=w.w,fe+=12;else if("faces"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)K=Q.value[Oe[a]],_=K,b=K,w=K,Q.array[fe]=_.x,Q.array[fe+1]=_.y,Q.array[fe+2]=_.z,Q.array[fe+3]=_.w,Q.array[fe+4]=b.x,Q.array[fe+5]=b.y,Q.array[fe+6]=b.z,Q.array[fe+7]=b.w,Q.array[fe+8]=w.x,Q.array[fe+9]=w.y,Q.array[fe+10]=w.z,Q.array[fe+11]=w.w,fe+=12;else if("faceVertices"===Q.boundTo)for(a=0,s=Oe.length;a<s;a++)K=Q.value[Oe[a]],_=K[0],b=K[1],w=K[2],Q.array[fe]=_.x,Q.array[fe+1]=_.y,Q.array[fe+2]=_.z,Q.array[fe+3]=_.w,Q.array[fe+4]=b.x,Q.array[fe+5]=b.y,Q.array[fe+6]=b.z,Q.array[fe+7]=b.w,Q.array[fe+8]=w.x,Q.array[fe+9]=w.y,Q.array[fe+10]=w.z,Q.array[fe+11]=w.w,fe+=12;Ne.bindBuffer(Ne.ARRAY_BUFFER,Q.buffer),Ne.bufferData(Ne.ARRAY_BUFFER,Q.array,r)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function x(e,t,r,i){var n,o,a,s;for(o in t)a=t[o],n=r[o],a>=0&&(n?(s=n.itemSize,Ne.bindBuffer(Ne.ARRAY_BUFFER,n.buffer),b(a),Ne.vertexAttribPointer(a,s,Ne.FLOAT,!1,0,i*s*4)):e.defaultAttributeValues&&(2===e.defaultAttributeValues[o].length?Ne.vertexAttrib2fv(a,e.defaultAttributeValues[o]):3===e.defaultAttributeValues[o].length&&Ne.vertexAttrib3fv(a,e.defaultAttributeValues[o])))}function _(e,t){var r,i,n=e.attributes;for(r in n)i=n[r],i.needsUpdate&&("index"===r?(Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,i.buffer),Ne.bufferData(Ne.ELEMENT_ARRAY_BUFFER,i.array,t)):(Ne.bindBuffer(Ne.ARRAY_BUFFER,i.buffer),Ne.bufferData(Ne.ARRAY_BUFFER,i.array,t)),i.needsUpdate=!1)}function b(e){0===vt[e]&&(Ne.enableVertexAttribArray(e),vt[e]=1)}function w(){for(var e in vt)1===vt[e]&&(Ne.disableVertexAttribArray(e),vt[e]=0)}function M(e,t,r){var i=e.program.attributes;if(r.morphTargetBase!==-1&&i.position>=0?(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),b(i.position),Ne.vertexAttribPointer(i.position,3,Ne.FLOAT,!1,0,0)):i.position>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglVertexBuffer),b(i.position),Ne.vertexAttribPointer(i.position,3,Ne.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var n=0,o=r.morphTargetForcedOrder,a=r.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)i["morphTarget"+n]>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[n]]),b(i["morphTarget"+n]),Ne.vertexAttribPointer(i["morphTarget"+n],3,Ne.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[n]]),b(i["morphNormal"+n]),Ne.vertexAttribPointer(i["morphNormal"+n],3,Ne.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[o[n]],n++;else{var s,c,l=[],a=r.morphTargetInfluences,h=a.length;for(c=0;c<h;c++)s=a[c],s>0&&l.push([s,c]);l.length>e.numSupportedMorphTargets?(l.sort(A),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(A):0===l.length&&l.push([0,0]);for(var u,n=0;n<e.numSupportedMorphTargets;)l[n]?(u=l[n][1],i["morphTarget"+n]>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),b(i["morphTarget"+n]),Ne.vertexAttribPointer(i["morphTarget"+n],3,Ne.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),b(i["morphNormal"+n]),Ne.vertexAttribPointer(i["morphNormal"+n],3,Ne.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[u]):r.__webglMorphTargetInfluences[n]=0,n++}null!==e.program.uniforms.morphTargetInfluences&&Ne.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}function S(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function A(e,t){return t[0]-e[0]}function C(e,t,r){if(e.length)for(var i=0,n=e.length;i<n;i++)Xe=null,Qe=null,et=-1,nt=-1,ot=-1,Je=-1,$e=-1,Ke=-1,Ye=-1,St=!0,e[i].render(t,r,dt,mt),Xe=null,Qe=null,et=-1,nt=-1,ot=-1,Je=-1,$e=-1,Ke=-1,Ye=-1,St=!0}function T(e,t,r,i,o,a,s,c){var l,h,u,f,p,d,m;t?(p=e.length-1,d=-1,m=-1):(p=0,d=e.length,m=1);for(var v=p;v!==d;v+=m)if(l=e[v],l.render){if(h=l.object,u=l.buffer,c)f=c;else{if(f=l[r],!f)continue;s&&je.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),je.setDepthTest(f.depthTest),je.setDepthWrite(f.depthWrite),oe(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}je.setMaterialFaces(f),u instanceof n.BufferGeometry?je.renderBufferDirect(i,o,a,f,u,h):je.renderBuffer(i,o,a,f,u,h)}}function E(e,t,r,i,n,o,a){for(var s,c,l,h=0,u=e.length;h<u;h++)if(s=e[h],c=s.object,c.visible){if(a)l=a;else{if(l=s[t],!l)continue;o&&je.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),je.setDepthTest(l.depthTest),je.setDepthWrite(l.depthWrite),oe(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}je.renderImmediateObject(r,i,n,l,c)}}function L(e){var t=e.object,r=t.material;r.transparent?(e.transparent=r,e.opaque=null):(e.opaque=r,e.transparent=null)}function P(e){var t=e.object,r=e.buffer,i=t.geometry,o=t.material;if(o instanceof n.MeshFaceMaterial){var a=i instanceof n.BufferGeometry?0:r.materialIndex;o=o.materials[a],o.transparent?(e.transparent=o,e.opaque=null):(e.opaque=o,e.transparent=null)}else o&&(o.transparent?(e.transparent=o,e.opaque=null):(e.opaque=o,e.transparent=null))}function R(e,i){var a,h,u,f;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new n.Matrix4,e._normalMatrix=new n.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",kt)),h=e.geometry,void 0===h);else if(h instanceof n.BufferGeometry)m(h);else if(e instanceof n.Mesh){u=e.material,void 0===h.geometryGroups&&h.makeGroups(u instanceof n.MeshFaceMaterial);for(a in h.geometryGroups)f=h.geometryGroups[a],f.__webglVertexBuffer||(o(f),l(f,e),h.verticesNeedUpdate=!0,h.morphTargetsNeedUpdate=!0,h.elementsNeedUpdate=!0,h.uvsNeedUpdate=!0,h.normalsNeedUpdate=!0,h.tangentsNeedUpdate=!0,h.colorsNeedUpdate=!0)}else e instanceof n.Line?h.__webglVertexBuffer||(r(h),c(h,e),h.verticesNeedUpdate=!0,h.colorsNeedUpdate=!0,h.lineDistancesNeedUpdate=!0):e instanceof n.ParticleSystem&&(h.__webglVertexBuffer||(t(h),s(h,e),h.verticesNeedUpdate=!0,h.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof n.Mesh){if(h=e.geometry,h instanceof n.BufferGeometry)D(i.__webglObjects,h,e);else if(h instanceof n.Geometry)for(a in h.geometryGroups)f=h.geometryGroups[a],D(i.__webglObjects,f,e)}else e instanceof n.Line||e instanceof n.ParticleSystem?(h=e.geometry,D(i.__webglObjects,h,e)):e instanceof n.ImmediateRenderObject||e.immediateRenderCallback?V(i.__webglObjectsImmediate,e):e instanceof n.Sprite?i.__webglSprites.push(e):e instanceof n.LensFlare&&i.__webglFlares.push(e);e.__webglActive=!0}}function D(e,t,r){e.push({id:null,buffer:t,object:r,opaque:null,transparent:null,z:0})}function V(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function F(e){var t,r,i,o=e.geometry;if(o instanceof n.BufferGeometry)_(o,Ne.DYNAMIC_DRAW);else if(e instanceof n.Mesh){for(var a=0,s=o.geometryGroupsList.length;a<s;a++)t=o.geometryGroupsList[a],i=h(e,t),o.buffersNeedUpdate&&l(t,e),r=i.attributes&&U(i),(o.verticesNeedUpdate||o.morphTargetsNeedUpdate||o.elementsNeedUpdate||o.uvsNeedUpdate||o.normalsNeedUpdate||o.colorsNeedUpdate||o.tangentsNeedUpdate||r)&&y(t,e,Ne.DYNAMIC_DRAW,!o.dynamic,i);o.verticesNeedUpdate=!1,o.morphTargetsNeedUpdate=!1,o.elementsNeedUpdate=!1,o.uvsNeedUpdate=!1,o.normalsNeedUpdate=!1,o.colorsNeedUpdate=!1,o.tangentsNeedUpdate=!1,o.buffersNeedUpdate=!1,i.attributes&&N(i)}else e instanceof n.Line?(i=h(e,o),r=i.attributes&&U(i),(o.verticesNeedUpdate||o.colorsNeedUpdate||o.lineDistancesNeedUpdate||r)&&g(o,Ne.DYNAMIC_DRAW),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,o.lineDistancesNeedUpdate=!1,i.attributes&&N(i)):e instanceof n.ParticleSystem&&(i=h(e,o),r=i.attributes&&U(i),(o.verticesNeedUpdate||o.colorsNeedUpdate||e.sortParticles||r)&&v(o,Ne.DYNAMIC_DRAW,e),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,i.attributes&&N(i))}function U(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function N(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function O(e,t){e instanceof n.Mesh||e instanceof n.ParticleSystem||e instanceof n.Line?k(t.__webglObjects,e):e instanceof n.Sprite?B(t.__webglSprites,e):e instanceof n.LensFlare?B(t.__webglFlares,e):(e instanceof n.ImmediateRenderObject||e.immediateRenderCallback)&&k(t.__webglObjectsImmediate,e),delete e.__webglActive}function k(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function B(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)}function z(e,t){e.uniforms=n.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function I(e,t,r,i,o){if(Ze=0,i.needsUpdate){var a=i.program;je.initMaterial(i,t,r,o),i.needsUpdate=!1,a&&Xt(i,a)}i.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(je.maxMorphTargets)));var s=!1,c=i.program,l=c.uniforms,h=i.uniforms;if(c!==Xe&&(Ne.useProgram(c),Xe=c,s=!0),i.id!==Ye&&(Ye=i.id,s=!0),(s||e!==Qe)&&(Ne.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),e!==Qe&&(Qe=e)),i.skinning)if(Rt&&o.useVertexTexture){if(null!==l.boneTexture){var u=$();Ne.uniform1i(l.boneTexture,u),je.setTexture(o.boneTexture,u)}null!==l.boneTextureWidth&&Ne.uniform1i(l.boneTextureWidth,o.boneTextureWidth),null!==l.boneTextureHeight&&Ne.uniform1i(l.boneTextureHeight,o.boneTextureHeight)}else null!==l.boneGlobalMatrices&&Ne.uniformMatrix4fv(l.boneGlobalMatrices,!1,o.boneMatrices);return s&&(r&&i.fog&&X(h,r),(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshPhysicalMaterial||i.lights)&&(St&&(ie(c,t),St=!1),Q(h,At)),(i instanceof n.MeshBasicMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshPhysicalMaterial||i instanceof n.MeshPhongMaterial)&&G(h,i),i instanceof n.LineBasicMaterial?j(h,i):i instanceof n.LineDashedMaterial?(j(h,i),H(h,i)):i instanceof n.ParticleSystemMaterial?W(h,i):i instanceof n.MeshPhongMaterial?q(h,i):i instanceof n.MeshPhysicalMaterial?Y(h,i):i instanceof n.MeshLambertMaterial?K(h,i):i instanceof n.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=i.opacity):i instanceof n.MeshNormalMaterial&&(h.opacity.value=i.opacity),o.receiveShadow&&!i._shadowPass&&Z(h,t),ee(c,i.uniformsList),(i instanceof n.ShaderMaterial||i instanceof n.MeshPhongMaterial||i instanceof n.MeshPhysicalMaterial||i.envMap||i.diffuseEnvMap)&&null!==l.cameraPosition&&(_t.setFromMatrixPosition(e.matrixWorld),Ne.uniform3f(l.cameraPosition,_t.x,_t.y,_t.z)),(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshPhysicalMaterial||i instanceof n.ShaderMaterial||i.skinning)&&null!==l.viewMatrix&&Ne.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements)),J(l,o),null!==l.modelMatrix&&Ne.uniformMatrix4fv(l.modelMatrix,!1,o.matrixWorld.elements),c}function G(e,t){if(e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.emissiveMap.value=t.emissiveMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.map){var r=t.map;e.offsetRepeat.value.set(r.offset.x,r.offset.y,r.repeat.x,r.repeat.y),e.gainBrightness.value.set(r.gainPivot,r.gain,r.brightness,r.invert?-1:1)}if(t.specularMap){var i=t.specularMap;e.specularMap.value=i,e.specularOffsetRepeat.value.set(i.offset.x,i.offset.y,i.repeat.x,i.repeat.y),e.specularGainBrightness.value.set(i.gainPivot,i.gain,i.brightness,i.invert?-1:1)}if(t.opacityMap){var o=t.opacityMap;e.opacityMap.value=o,e.opacityOffsetRepeat.value.set(o.offset.x,o.offset.y,o.repeat.x,o.repeat.y),e.opacityGainBrightness.value.set(o.gainPivot,o.gain,o.brightness,o.invert?-1:1)}if(t.bumpMap){var a=t.bumpMap;e.bumpOffsetRepeat.value.set(a.offset.x,a.offset.y,a.repeat.x,a.repeat.y)}if(t.normalMap){var s=t.normalMap;e.normalOffsetRepeat.value.set(s.offset.x,s.offset.y,s.repeat.x,s.repeat.y)}if(t.anisotropyMap){var c=t.anisotropyMap;e.anisotropyOffsetRepeat.value.set(c.offset.x,c.offset.y,c.repeat.x,c.repeat.y),e.anisotropyGainBrightness.value.set(c.gainPivot,c.gain,c.brightness,c.invert?-1:1)}if(t.anisotropyRotationMap){var l=t.anisotropyRotationMap;e.anisotropyRotationOffsetRepeat.value.set(l.offset.x,l.offset.y,l.repeat.x,l.repeat.y),e.anisotropyRotationGainBrightness.value.set(l.gainPivot,l.gain,l.brightness,l.invert?-1:1)}if(t.roughnessMap){var h=t.roughnessMap;e.roughnessOffsetRepeat.value.set(h.offset.x,h.offset.y,h.repeat.x,h.repeat.y),e.roughnessGainBrightness.value.set(h.gainPivot,h.gain,h.brightness,h.invert?-1:1)}if(t.metallicMap){var u=t.metallicMap;e.metallicOffsetRepeat.value.set(u.offset.x,u.offset.y,u.repeat.x,u.repeat.y),e.metallicGainBrightness.value.set(u.gainPivot,u.gain,u.brightness,u.invert?-1:1)}if(t.translucencyMap){var f=t.translucencyMap;e.translucencyMap.value=f}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof n.WebGLRenderTargetCube?1:-1,e.envEncoding.value=t.envMap?t.envMap.encoding:0,e.diffuseEnvMap.value=t.diffuseEnvMap,e.diffuseEnvEncoding.value=t.diffuseEnvMap?t.diffuseEnvMap.encoding:0,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof n.CubeRefractionMapping}function j(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function H(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function W(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Ce.height/2,e.map.value=t.map}function X(e,t){e.fogColor.value=t.color,t instanceof n.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof n.FogExp2&&(e.fogDensity.value=t.density)}function q(e,t){e.opacityMap.value=t.opacityMap,e.shininess.value=t.shininess,e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Y(e,t){e.opacityMap.value=t.opacityMap,e.falloffBlendParams.value=t.falloffBlendParams,e.falloffMap.value=t.falloffMap,e.roughness.value=t.roughness,e.metallic.value=t.metallic,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,e.roughnessMap.value=t.roughnessMap,e.metallicMap.value=t.metallicMap,e.translucencyMap.value=t.translucencyMap,e.translucencyNormalAlpha.value=t.translucencyNormalAlpha,e.translucencyNormalPower.value=t.translucencyNormalPower,e.translucencyViewAlpha.value=t.translucencyViewAlpha,e.translucencyViewPower.value=t.translucencyViewPower,e.anisotropyMap.value=t.anisotropyMap,e.anisotropy.value=t.anisotropy,e.anisotropyRotation.value=t.anisotropyRotation,e.anisotropyRotationMap.value=t.anisotropyRotationMap,e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.falloffColor.value=t.falloffColor,e.specular.value=t.specular,e.translucency.value=t.translucency}function K(e,t){e.ambient.value=t.ambient,e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Q(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecayExponent.value=t.point.decayExponents,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDecayExponent.value=t.spot.decayExponents,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions,e.areaLightColor.value=t.area.colors,e.areaLightPosition.value=t.area.positions,e.areaLightDistance.value=t.area.distances,e.areaLightDecayExponent.value=t.area.decayExponents,e.areaLightWidth.value=t.area.widths,e.areaLightHeight.value=t.area.heights}function Z(e,t){if(e.shadowMatrix)for(var r=0,i=0,o=t.length;i<o;i++){var a=t[i];a.castShadow&&(a instanceof n.SpotLight||a instanceof n.DirectionalLight&&!a.shadowCascade)&&(e.shadowMap.value[r]=a.shadowMap,e.shadowMapSize.value[r]=a.shadowMapSize,e.shadowMatrix.value[r]=a.shadowMatrix,e.shadowDarkness.value[r]=a.shadowDarkness,e.shadowBias.value[r]=a.shadowBias,r++)}}function J(e,t){Ne.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Ne.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function $(){var e=Ze;return e>=Ct&&n.onwarning("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Ct),Ze+=1,e}function ee(e,t){var r,i,o,a,s,c,l,h,u,f,p;for(u=0,f=t.length;u<f;u++)if(a=e.uniforms[t[u][1]])if(r=t[u][0],o=r.type,i=r.value,"i"===o)Ne.uniform1i(a,i);else if("f"===o)Ne.uniform1f(a,i);else if("v2"===o)Ne.uniform2f(a,i.x,i.y);else if("v3"===o)Ne.uniform3f(a,i.x,i.y,i.z);else if("v4"===o)Ne.uniform4f(a,i.x,i.y,i.z,i.w);else if("c"===o)Ne.uniform3f(a,i.r,i.g,i.b);else if("iv1"===o)Ne.uniform1iv(a,i);else if("iv"===o)Ne.uniform3iv(a,i);else if("fv1"===o)Ne.uniform1fv(a,i);else if("fv"===o)Ne.uniform3fv(a,i);else if("v2v"===o){for(void 0===r._array&&(r._array=new Float32Array(2*i.length)),l=0,h=i.length;l<h;l++)p=2*l,r._array[p]=i[l].x,r._array[p+1]=i[l].y;Ne.uniform2fv(a,r._array)}else if("v3v"===o){for(void 0===r._array&&(r._array=new Float32Array(3*i.length)),l=0,h=i.length;l<h;l++)p=3*l,r._array[p]=i[l].x,r._array[p+1]=i[l].y,r._array[p+2]=i[l].z;Ne.uniform3fv(a,r._array)}else if("v4v"===o){for(void 0===r._array&&(r._array=new Float32Array(4*i.length)),l=0,h=i.length;l<h;l++)p=4*l,r._array[p]=i[l].x,r._array[p+1]=i[l].y,r._array[p+2]=i[l].z,r._array[p+3]=i[l].w;Ne.uniform4fv(a,r._array)}else if("m4"===o)void 0===r._array&&(r._array=new Float32Array(16)),i.flattenToArray(r._array),Ne.uniformMatrix4fv(a,!1,r._array);else if("m4v"===o){for(void 0===r._array&&(r._array=new Float32Array(16*i.length)),l=0,h=i.length;l<h;l++)i[l].flattenToArrayOffset(r._array,16*l);Ne.uniformMatrix4fv(a,!1,r._array)}else if("t"===o){if(s=i,c=$(),Ne.uniform1i(a,c),!s)continue;s.image instanceof Array&&6===s.image.length?de(s,c):s instanceof n.WebGLRenderTargetCube?me(s,c):je.setTexture(s,c)}else if("tv"===o){for(void 0===r._array&&(r._array=[]),l=0,h=r.value.length;l<h;l++)r._array[l]=$();for(Ne.uniform1iv(a,r._array),l=0,h=r.value.length;l<h;l++)s=r.value[l],c=r._array[l],s&&je.setTexture(s,c)}else n.onwarning("THREE.WebGLRenderer: Unknown uniform type: "+o)}function te(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function re(e,t,r,i){e[t]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function ie(e,t){var r,i,o,a,s,c,l,h,u=0,f=0,p=0,d=At,m=d.directional.colors,v=d.directional.positions,g=d.point.colors,y=d.point.positions,x=d.point.distances,_=d.point.decayExponents,b=d.spot.colors,w=d.spot.positions,M=d.spot.distances,S=d.spot.decayExponents,A=d.spot.directions,C=d.spot.anglesCos,T=d.spot.exponents,E=d.hemi.skyColors,L=d.hemi.groundColors,P=d.hemi.positions,R=d.area.colors,D=d.area.positions,V=d.area.distances,F=d.area.decayExponents,U=d.area.widths,N=d.area.heights,O=0,k=0,B=0,z=0,I=0,G=0,j=0,H=0,W=0,X=0,q=0,Y=0,K=0,Q=0,Z=0;for(r=0,i=t.length;r<i;r++)if(o=t[r],!o.onlyShadow)if(a=o.color,l=o.intensity,h=o.distance,o instanceof n.AmbientLight){if(!o.visible)continue;u+=a.r,f+=a.g,p+=a.b}else if(o instanceof n.DirectionalLight){if(G+=1,!o.visible)continue;if(Mt.setFromMatrixPosition(o.matrixWorld),_t.setFromMatrixPosition(o.target.matrixWorld),Mt.sub(_t),Mt.normalize(),0===Mt.x&&0===Mt.y&&0===Mt.z)continue;q=3*O,v[q]=Mt.x,v[q+1]=Mt.y,v[q+2]=Mt.z,re(m,q,a,l),O+=1}else if(o instanceof n.PointLight){if(j+=1,!o.visible)continue;Y=3*k,re(g,Y,a,l),_t.setFromMatrixPosition(o.matrixWorld),y[Y]=_t.x,y[Y+1]=_t.y,y[Y+2]=_t.z,x[k]=h,o.physicalFalloff?_[k]=-1:_[k]=0===h?0:o.decayExponent,k+=1}else if(o instanceof n.SpotLight){if(H+=1,!o.visible)continue;K=3*B,re(b,K,a,l),_t.setFromMatrixPosition(o.matrixWorld),w[K]=_t.x,w[K+1]=_t.y,w[K+2]=_t.z,M[B]=h,o.physicalFalloff?S[k]=-1:S[k]=0===h?0:o.decayExponent,Mt.copy(_t),_t.setFromMatrixPosition(o.target.matrixWorld),Mt.sub(_t),Mt.normalize(),A[K]=Mt.x,A[K+1]=Mt.y,A[K+2]=Mt.z,C[B]=Math.cos(o.angle),T[B]=o.exponent,B+=1}else if(o instanceof n.HemisphereLight){if(W+=1,!o.visible)continue;if(Mt.setFromMatrixPosition(o.matrixWorld),Mt.normalize(),0===Mt.x&&0===Mt.y&&0===Mt.z)continue;Q=3*z,P[Q]=Mt.x,P[Q+1]=Mt.y,P[Q+2]=Mt.z,s=o.color,c=o.groundColor,re(E,Q,s,l),re(L,Q,c,l),z+=1}else if(o instanceof n.AreaLight){if(X+=1,!o.visible)continue;Z=3*I,re(R,Z,a,l),_t.setFromMatrixPosition(o.matrixWorld),D[Z]=_t.x,D[Z+1]=_t.y,D[Z+2]=_t.z,V[I]=h,F[I]=o.decayExponent,o.matrixWorld.extractBasis(bt,wt,_t),bt.multiplyScalar(o.width),wt.multiplyScalar(o.height),U[Z]=bt.x,U[Z+1]=bt.y,U[Z+2]=bt.z,N[Z]=wt.x,N[Z+1]=wt.y,N[Z+2]=wt.z,I+=1}for(r=3*O,i=Math.max(m.length,3*G);r<i;r++)m[r]=0;for(r=3*k,i=Math.max(g.length,3*j);r<i;r++)g[r]=0;for(r=3*B,i=Math.max(b.length,3*H);r<i;r++)b[r]=0;for(r=3*z,i=Math.max(E.length,3*W);r<i;r++)E[r]=0;for(r=3*z,i=Math.max(L.length,3*W);r<i;r++)L[r]=0;for(r=3*I,i=Math.max(R.length,3*X);r<i;r++)R[r]=0;d.directional.length=O,d.point.length=k,d.spot.length=B,d.hemi.length=z,d.area.length=I,d.ambient[0]=u,d.ambient[1]=f,d.ambient[2]=p}function ne(e){e!==lt&&(Ne.lineWidth(e),lt=e)}function oe(e,t,r){at!==e&&(e?Ne.enable(Ne.POLYGON_OFFSET_FILL):Ne.disable(Ne.POLYGON_OFFSET_FILL),at=e),!e||st===t&&ct===r||(Ne.polygonOffset(t,r),st=t,ct=r)}function ae(e){var t,r,i=[];for(var n in e)t=e[n],t!==!1&&(r="#define "+n+" "+t,i.push(r));return i.join("\n")}function se(e,t,r,i,o,a,s,c){var l,h,u,f,p,d=[],m=[];e?(m.push(e),d.push(e)):(m.push(t),m.push(r));for(u in a)m.push(u),m.push(a[u]),d.push(u),d.push(a[u]);for(l in s)m.push(l),m.push(s[l]),d.push(l),d.push(s[l]);p=m.join();var v=d.join();for(l=0,h=He.length;l<h;l++){var g=He[l];if(g.code.length===p.length&&g.code===p)return g.usedTimes++,g.program}var y="SHADOWMAP_TYPE_BASIC";s.shadowMapType===n.PCFShadowMap?y="SHADOWMAP_TYPE_PCF":s.shadowMapType===n.PCFSoftShadowMap&&(y="SHADOWMAP_TYPE_PCF_SOFT");var x=ae(a);f=Ne.createProgram();var _=null!==ze,b=["precision "+Ee+" float;","precision "+Ee+" int;",x,Pt?"#define VERTEX_TEXTURES":"",je.gammaInput?"#define GAMMA_INPUT":"",je.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_AREA_LIGHTS "+s.maxAreaLights,"#define MAX_SHADOWS "+s.maxShadows,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.opacityMap?"#define USE_OPACITYMAP":"",s.falloffMap?"#define USE_FALLOFFMAP":"",s.translucencyMap?"#define USE_TRANSLUCENCYMAP":"",s.envMap?"#define USE_ENVMAP":"",s.diffuseEnvMap?"#define USE_DIFFUSEENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.reflectivityMap?"#define USE_REFLECTIVITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metallicMap?"#define USE_METALLICMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.clearCoat?"#define CLEARCOAT":"",s.anisotropy?"#define ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.anisotropy&&s.anisotropyRotation?"#define ANISOTROPYROTATION":"",s.anisotropy&&s.anisotropyRotationMap?"#define USE_ANISOTROPYROTATIONMAP":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals?"#define USE_MORPHNORMALS":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+y:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),w=["precision "+Ee+" float;","precision "+Ee+" int;",s.bumpMap||s.normalMap?"#extension GL_OES_standard_derivatives : enable":"",x,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_AREA_LIGHTS "+s.maxAreaLights,"#define MAX_SHADOWS "+s.maxShadows,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"",je.gammaInput?"#define GAMMA_INPUT":"",je.gammaOutput?"#define GAMMA_OUTPUT":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.opacityMap?"#define USE_OPACITYMAP":"",s.falloffMap?"#define USE_FALLOFFMAP":"",s.translucencyMap?"#define USE_TRANSLUCENCYMAP":"",s.envMap?"#define USE_ENVMAP":"",s.diffuseEnvMap?"#define USE_DIFFUSEENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.reflectivityMap?"#define USE_REFLECTIVITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metallicMap?"#define USE_METALLICMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.clearCoat?"#define CLEARCOAT":"",s.translucency?"#define TRANSLUCENCY":"",s.anisotropy?"#define ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.anisotropy&&s.anisotropyRotation?"#define ANISOTROPYROTATION":"",s.anisotropy&&s.anisotropyRotationMap?"#define USE_ANISOTROPYROTATIONMAP":"",s.falloff?"#define FALLOFF":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+y:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",_?"#define TEXTURE_CUBE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),M=ue("vertex",b+r,e,v),S=ue("fragment",w+t,e,v);
Ne.attachShader(f,M,p),Ne.attachShader(f,S,p),void 0!==c&&Ne.bindAttribLocation(f,0,c),Ne.linkProgram(f);var A=Ne.getProgramInfoLog(f);if(Ne.getProgramParameter(f,Ne.LINK_STATUS)===!1){var C=Ne.getError();n.onerror(e+" shader program error: "+C+"\n "+A,{shaderID:e,programInfo:A,glError:C,vertexShader:b+r,fragmentShader:w+t,getProgramParameter_LINK_STATUS:Ne.getProgramParameter(f,Ne.LINK_STATUS),getProgramParameter_VALIDATE_STATUS:Ne.getProgramParameter(f,Ne.VALIDATE_STATUS),getProgramParameter_ATTACHED_SHADERS:Ne.getProgramParameter(f,Ne.ATTACHED_SHADERS),getProgramParameter_ACTIVE_ATTRIBUTES:Ne.getProgramParameter(f,Ne.ACTIVE_ATTRIBUTES),getProgramParameter_ACTIVE_UNIFORMS:Ne.getProgramParameter(f,Ne.ACTIVE_UNIFORMS),gl_MAX_VARYING_VECTORS:Ne.getParameter(Ne.MAX_VARYING_VECTORS),gl_MAX_VERTEX_ATTRIBS:Ne.getParameter(Ne.MAX_VERTEX_ATTRIBS),gl_MAX_VERTEX_UNIFORM_VECTORS:Ne.getParameter(Ne.MAX_VERTEX_UNIFORM_VECTORS),gl_MAX_VERTEX_TEXTURE_IMAGE_UNITS:Ne.getParameter(Ne.MAX_VERTEX_TEXTURE_IMAGE_UNITS),gl_MAX_FRAGMENT_UNIFORM_VECTORS:Ne.getParameter(Ne.MAX_FRAGMENT_UNIFORM_VECTORS),gl_MAX_TEXTURE_IMAGE_UNITS:Ne.getParameter(Ne.MAX_TEXTURE_IMAGE_UNITS)})}Ne.deleteShader(S),Ne.deleteShader(M),f.uniforms={},f.attributes={};var T,E,L,P;T=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],s.useVertexTexture?(T.push("boneTexture"),T.push("boneTextureWidth"),T.push("boneTextureHeight")):T.push("boneGlobalMatrices");for(E in i)T.push(E);for(ce(f,T),T=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],P=0;P<s.maxMorphTargets;P++)T.push("morphTarget"+P);for(P=0;P<s.maxMorphNormals;P++)T.push("morphNormal"+P);for(L in o)T.push(L);return le(f,T),f.id=We++,He.push({program:f,code:p,usedTimes:1}),je.info.memory.programs=He.length,f}function ce(e,t){var r,i,n;for(r=0,i=t.length;r<i;r++)n=t[r],e.uniforms[n]=Ne.getUniformLocation(e,n)}function le(e,t){var r,i,n;for(r=0,i=t.length;r<i;r++)n=t[r],e.attributes[n]=Ne.getAttribLocation(e,n)}function he(e){for(var t=e.split("\n"),r=0,i=t.length;r<i;r++)t[r]=r+1+": "+t[r];return t.join("\n")}function ue(e,t,r,i){var o;return"fragment"===e?o=Ne.createShader(Ne.FRAGMENT_SHADER):"vertex"===e&&(o=Ne.createShader(Ne.VERTEX_SHADER)),Ne.shaderSource(o,t),Ne.compileShader(o),Ne.getShaderParameter(o,Ne.COMPILE_STATUS)?o:(n.onerror("shader error: "+r+"."+e,{getShaderParameter:Ne.getShaderParameter(o,Ne.COMPILE_STATUS),shaderInfoLog:Ne.getShaderInfoLog(o),shaderCode:he(t),getError:Ne.getError(),simpleCode:i,gl_MAX_VARYING_VECTORS:Ne.getParameter(Ne.MAX_VARYING_VECTORS),gl_MAX_VERTEX_ATTRIBS:Ne.getParameter(Ne.MAX_VERTEX_ATTRIBS),gl_MAX_VERTEX_UNIFORM_VECTORS:Ne.getParameter(Ne.MAX_VERTEX_UNIFORM_VECTORS),gl_MAX_VERTEX_TEXTURE_IMAGE_UNITS:Ne.getParameter(Ne.MAX_VERTEX_TEXTURE_IMAGE_UNITS),gl_MAX_FRAGMENT_UNIFORM_VECTORS:Ne.getParameter(Ne.MAX_FRAGMENT_UNIFORM_VECTORS),gl_MAX_TEXTURE_IMAGE_UNITS:Ne.getParameter(Ne.MAX_TEXTURE_IMAGE_UNITS)}),null)}function fe(e,t,r){r?(Ne.texParameteri(e,Ne.TEXTURE_WRAP_S,_e(t.wrapS)),Ne.texParameteri(e,Ne.TEXTURE_WRAP_T,_e(t.wrapT)),Ne.texParameteri(e,Ne.TEXTURE_MAG_FILTER,_e(t.magFilter)),Ne.texParameteri(e,Ne.TEXTURE_MIN_FILTER,_e(t.minFilter))):(Ne.texParameteri(e,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),Ne.texParameteri(e,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),Ne.texParameteri(e,Ne.TEXTURE_MAG_FILTER,xe(t.magFilter)),Ne.texParameteri(e,Ne.TEXTURE_MIN_FILTER,xe(t.minFilter))),Ie&&t.type!==n.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Ne.texParameterf(e,Ie.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Lt)),t.__oldAnisotropy=t.anisotropy)}function pe(e,t){if(e.width<=t&&e.height<=t)return e;var r=Math.max(e.width,e.height),i=Math.floor(e.width*t/r),n=Math.floor(e.height*t/r),o=document.createElement("canvas");o.width=i,o.height=n;var a=o.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,i,n),o}function de(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Bt),e.image.__webglTextureCube=Ne.createTexture(),je.info.memory.textures++),Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Ne.pixelStorei(Ne.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof n.CompressedTexture,i=[],o=0;o<6;o++)je.autoScaleCubemaps&&!r?i[o]=pe(e.image[o],Et):i[o]=e.image[o];var a=i[0],s=n.Math.isPowerOfTwo(a.width)&&n.Math.isPowerOfTwo(a.height),c=_e(e.format),l=_e(e.type);fe(Ne.TEXTURE_CUBE_MAP,e,s);for(var o=0;o<6;o++)if(r)for(var h,u=i[o].mipmaps,f=0,p=u.length;f<p;f++)h=u[f],e.format!==n.RGBAFormat?Ne.compressedTexImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,c,h.width,h.height,0,h.data):Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,c,h.width,h.height,0,c,l,h.data);else Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,c,c,l,i[o]);e.generateMipmaps&&s&&Ne.generateMipmap(Ne.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function me(e,t){Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.__webglTexture)}function ve(e,t,r){Ne.bindFramebuffer(Ne.FRAMEBUFFER,e),Ne.framebufferTexture2D(Ne.FRAMEBUFFER,Ne.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function ge(e,t){Ne.bindRenderbuffer(Ne.RENDERBUFFER,e);var r="";if(t.depthBuffer&&!t.stencilBuffer?(Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.DEPTH_COMPONENT16,t.width,t.height),Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_ATTACHMENT,Ne.RENDERBUFFER,e),r="renderTarget: "+t.width+"+"+t.height+" DEPTH_ATTACHMENT"):t.depthBuffer&&t.stencilBuffer?(Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.DEPTH_STENCIL,t.width,t.height),Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_STENCIL_ATTACHMENT,Ne.RENDERBUFFER,e),r="renderTarget: "+t.width+"+"+t.height+" DEPTH_STENCIL_ATTACHMENT"):(Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.RGBA4,t.width,t.height),r="renderTarget: "+t.width+"+"+t.height+" RGBA4"),Ne.checkFramebufferStatus(Ne.FRAMEBUFFER)!=Ne.FRAMEBUFFER_COMPLETE)throw console.log(t),new Error("(A) Rendering to this texture is not supported (incomplete framebuffer) "+r)}function ye(e){e instanceof n.WebGLRenderTargetCube?(Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.__webglTexture),Ne.generateMipmap(Ne.TEXTURE_CUBE_MAP),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,null)):(Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture),Ne.generateMipmap(Ne.TEXTURE_2D),Ne.bindTexture(Ne.TEXTURE_2D,null))}function xe(e){return e===n.NearestFilter||e===n.NearestMipMapNearestFilter||e===n.NearestMipMapLinearFilter?Ne.NEAREST:Ne.LINEAR}function _e(e){if(e===n.RepeatWrapping)return Ne.REPEAT;if(e===n.ClampToEdgeWrapping)return Ne.CLAMP_TO_EDGE;if(e===n.MirroredRepeatWrapping)return Ne.MIRRORED_REPEAT;if(e===n.NearestFilter)return Ne.NEAREST;if(e===n.NearestMipMapNearestFilter)return Ne.NEAREST_MIPMAP_NEAREST;if(e===n.NearestMipMapLinearFilter)return Ne.NEAREST_MIPMAP_LINEAR;if(e===n.LinearFilter)return Ne.LINEAR;if(e===n.LinearMipMapNearestFilter)return Ne.LINEAR_MIPMAP_NEAREST;if(e===n.LinearMipMapLinearFilter)return Ne.LINEAR_MIPMAP_LINEAR;if(e===n.UnsignedByteType)return Ne.UNSIGNED_BYTE;if(e===n.UnsignedShort4444Type)return Ne.UNSIGNED_SHORT_4_4_4_4;if(e===n.UnsignedShort5551Type)return Ne.UNSIGNED_SHORT_5_5_5_1;if(e===n.UnsignedShort565Type)return Ne.UNSIGNED_SHORT_5_6_5;if(e===n.ByteType)return Ne.BYTE;if(e===n.ShortType)return Ne.SHORT;if(e===n.UnsignedShortType)return Ne.UNSIGNED_SHORT;if(e===n.IntType)return Ne.INT;if(e===n.UnsignedIntType)return Ne.UNSIGNED_INT;if(e===n.FloatType)return Ne.FLOAT;if(e===n.HalfType)return 36193;if(e===n.AlphaFormat)return Ne.ALPHA;if(e===n.RGBFormat)return Ne.RGB;if(e===n.RGBAFormat)return Ne.RGBA;if(e===n.LuminanceFormat)return Ne.LUMINANCE;if(e===n.LuminanceAlphaFormat)return Ne.LUMINANCE_ALPHA;if(e===n.AddEquation)return Ne.FUNC_ADD;if(e===n.SubtractEquation)return Ne.FUNC_SUBTRACT;if(e===n.ReverseSubtractEquation)return Ne.FUNC_REVERSE_SUBTRACT;if(e===n.ZeroFactor)return Ne.ZERO;if(e===n.OneFactor)return Ne.ONE;if(e===n.SrcColorFactor)return Ne.SRC_COLOR;if(e===n.OneMinusSrcColorFactor)return Ne.ONE_MINUS_SRC_COLOR;if(e===n.SrcAlphaFactor)return Ne.SRC_ALPHA;if(e===n.OneMinusSrcAlphaFactor)return Ne.ONE_MINUS_SRC_ALPHA;if(e===n.DstAlphaFactor)return Ne.DST_ALPHA;if(e===n.OneMinusDstAlphaFactor)return Ne.ONE_MINUS_DST_ALPHA;if(e===n.DstColorFactor)return Ne.DST_COLOR;if(e===n.OneMinusDstColorFactor)return Ne.ONE_MINUS_DST_COLOR;if(e===n.SrcAlphaSaturateFactor)return Ne.SRC_ALPHA_SATURATE;if(void 0!==Ge){if(e===n.RGB_S3TC_DXT1_Format)return Ge.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT1_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===n.RGBA_S3TC_DXT3_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===n.RGBA_S3TC_DXT5_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function be(e){if(Rt&&e&&e.useVertexTexture)return 1024;var t=Ne.getParameter(Ne.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((t-20)/4),i=r;return void 0!==e&&e instanceof n.SkinnedMesh&&(i=Math.min(e.bones.length,i),i<e.bones.length&&n.onwarning("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),i}function we(e){for(var t=0,r=0,i=0,o=0,a=0,s=0,c=e.length;s<c;s++){var l=e[s];l.onlyShadow||l.visible===!1||(l instanceof n.DirectionalLight&&t++,l instanceof n.PointLight&&r++,l instanceof n.SpotLight&&i++,l instanceof n.HemisphereLight&&o++,l instanceof n.AreaLight&&a++)}return{directional:t,point:r,spot:i,hemi:o,area:a}}function Me(e){for(var t=0,r=0,i=e.length;r<i;r++){var o=e[r];o.castShadow&&(o instanceof n.SpotLight&&t++,o instanceof n.DirectionalLight&&!o.shadowCascade&&t++)}return t}function Se(){try{var e={alpha:Le,premultipliedAlpha:Pe,antialias:Re,stencil:De,preserveDrawingBuffer:Ve};Ne=Te||Ce.getContext("webgl",e)||Ce.getContext("experimental-webgl",e),null===Ne&&n.onerror("Error creating WebGL context.")}catch(t){n.onerror(t)}Oe=Ne.getExtension("OES_texture_float"),ke=Ne.getExtension("OES_texture_float_linear"),Be=Ne.getExtension("OES_standard_derivatives"),ze=Ne.getExtension("EXT_shader_texture_lod"),Ie=Ne.getExtension("EXT_texture_filter_anisotropic")||Ne.getExtension("MOZ_EXT_texture_filter_anisotropic")||Ne.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Ge=Ne.getExtension("WEBGL_compressed_texture_s3tc")||Ne.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Ne.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Oe||console.log("THREE.WebGLRenderer: Float textures not supported."),Be||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),ze||console.log("THREE.WebGLRenderer: Shader texture LOD not supported."),Ie||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Ge||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Ne.getShaderPrecisionFormat&&(Ne.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function Ae(){Ne.clearColor(0,0,0,1),Ne.clearDepth(1),Ne.clearStencil(0),Ne.enable(Ne.DEPTH_TEST),Ne.depthFunc(Ne.LEQUAL),Ne.frontFace(Ne.CCW),Ne.cullFace(Ne.BACK),Ne.enable(Ne.CULL_FACE),Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),Ne.viewport(ht,ut,ft,pt),Ne.clearColor(Fe.r,Fe.g,Fe.b,Ue)}console.log("THREE.WebGLRenderer",n.REVISION),e=e||{};var Ce=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Te=void 0!==e.context?e.context:null,Ee=void 0!==e.precision?e.precision:"mediump",Le=void 0!==e.alpha&&e.alpha,Pe=void 0===e.premultipliedAlpha||e.premultipliedAlpha,Re=void 0!==e.antialias&&e.antialias,De=void 0===e.stencil||e.stencil,Ve=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,Fe=new n.Color(0),Ue=0;this.domElement=Ce,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==i.devicePixelRatio?i.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!0,this.gammaOutput=!0,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=n.PCFShadowMap,this.shadowMapCullFace=n.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Ne,Oe,ke,Be,ze,Ie,Ge,je=this,He=[],We=0,Xe=null,qe=null,Ye=-1,Ke=null,Qe=null,Ze=0,Je=-1,$e=-1,et=-1,tt=-1,rt=-1,it=-1,nt=-1,ot=-1,at=null,st=null,ct=null,lt=null,ht=0,ut=0,ft=Ce.width,pt=Ce.height,dt=0,mt=0,vt=new Uint8Array(16),gt=new n.Frustum,yt=new n.Matrix4,xt=new n.Matrix4,_t=new n.Vector3,bt=new n.Vector3,wt=new n.Vector3,Mt=new n.Vector3,St=!0,At={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array,decayExponents:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,decayExponents:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array},area:{length:0,colors:new Array,positions:new Array,distances:new Array,decayExponents:new Array,widths:new Array,heights:new Array}};Se(),Ae(),this.context=Ne;var Ct=Ne.getParameter(Ne.MAX_TEXTURE_IMAGE_UNITS),Tt=Ne.getParameter(Ne.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Et=(Ne.getParameter(Ne.MAX_TEXTURE_SIZE),Ne.getParameter(Ne.MAX_CUBE_MAP_TEXTURE_SIZE)),Lt=Ie?Ne.getParameter(Ie.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Pt=Tt>0,Rt=Pt&&Oe,Dt=(Ge?Ne.getParameter(Ne.COMPRESSED_TEXTURE_FORMATS):[],Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.HIGH_FLOAT)),Vt=Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.MEDIUM_FLOAT),Ft=(Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.LOW_FLOAT),Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.HIGH_FLOAT)),Ut=Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.MEDIUM_FLOAT),Nt=(Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.LOW_FLOAT),Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.HIGH_INT),Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.MEDIUM_INT),Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.LOW_INT),Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.HIGH_INT),Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.MEDIUM_INT),Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.LOW_INT),Dt.precision>0&&Ft.precision>0),Ot=Vt.precision>0&&Ut.precision>0;"highp"!==Ee||Nt||(Ot?(Ee="mediump",n.onwarning("WebGLRenderer: highp not supported, using mediump")):(Ee="lowp",n.onwarning("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==Ee||Ot||(Ee="lowp",n.onwarning("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Ne},this.supportsVertexTextures=function(){return Pt},this.supportsFloatTextures=function(){return Oe},this.supportsStandardDerivatives=function(){return Be},this.supportsCompressedTextureS3TC=function(){return Ge},this.getMaxAnisotropy=function(){return Lt},this.getPrecision=function(){return Ee},this.setSize=function(e,t,r){Ce.width=e*this.devicePixelRatio,Ce.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&r!==!1&&(Ce.style.width=e+"px",Ce.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){ht=e*this.devicePixelRatio,ut=t*this.devicePixelRatio,ft=r*this.devicePixelRatio,pt=i*this.devicePixelRatio,Ne.viewport(ht,ut,ft,pt)},this.setScissor=function(e,t,r,i){Ne.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,r*this.devicePixelRatio,i*this.devicePixelRatio)},this.enableScissorTest=function(e){e?Ne.enable(Ne.SCISSOR_TEST):Ne.disable(Ne.SCISSOR_TEST)},this.setClearColor=function(e,t){Fe.set(e),Ue=void 0!==t?t:1,Ne.clearColor(Fe.r,Fe.g,Fe.b,Ue)},this.setClearColorHex=function(e,t){n.onwarning("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return Fe},this.getClearAlpha=function(){return Ue},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=Ne.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Ne.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=Ne.STENCIL_BUFFER_BIT),Ne.clear(i)},this.clearColor=function(){Ne.clear(Ne.COLOR_BUFFER_BIT)},this.clearDepth=function(){Ne.clear(Ne.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Ne.clear(Ne.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Xe=null,et=-1,nt=-1,ot=-1,Ke=-1,Ye=-1,St=!0,Je=-1,$e=-1,this.shadowMapPlugin.update(e,t)};var kt=function(e){var t=e.target;t.removeEventListener("dispose",kt),jt(t)},Bt=function(e){var t=e.target;t.removeEventListener("dispose",Bt),Ht(t),je.info.memory.textures--},zt=function(e){var t=e.target;t.removeEventListener("dispose",zt),Wt(t),je.info.memory.textures--},It=function(e){var t=e.target;t.removeEventListener("dispose",It),Xt(t)},Gt=function(e){if(void 0!==e.__webglVertexBuffer&&Ne.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Ne.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Ne.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Ne.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Ne.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Ne.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Ne.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Ne.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Ne.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Ne.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Ne.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Ne.deleteBuffer(e.__webglCustomAttributesList[t].buffer);je.info.memory.geometries--},jt=function(e){if(e.__webglInit=void 0,e instanceof n.BufferGeometry){var t=e.attributes;for(var r in t)void 0!==t[r].buffer&&Ne.deleteBuffer(t[r].buffer);je.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(var i in e.geometryGroups){var o=e.geometryGroups[i];if(void 0!==o.numMorphTargets)for(var a=0,s=o.numMorphTargets;a<s;a++)Ne.deleteBuffer(o.__webglMorphTargetsBuffers[a]);if(void 0!==o.numMorphNormals)for(var a=0,s=o.numMorphNormals;a<s;a++)Ne.deleteBuffer(o.__webglMorphNormalsBuffers[a]);Gt(o)}else Gt(e)},Ht=function(e){if(e.image&&e.image.__webglTextureCube)Ne.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Ne.deleteTexture(e.__webglTexture)}},Wt=function(e){if(e&&e.__webglTexture)if(Ne.deleteTexture(e.__webglTexture),e instanceof n.WebGLRenderTargetCube)for(var t=0;t<6;t++)Ne.deleteFramebuffer(e.__webglFramebuffer[t]),Ne.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Ne.deleteFramebuffer(e.__webglFramebuffer),Ne.deleteRenderbuffer(e.__webglRenderbuffer)},Xt=function(e,t){var r=t||e.program;if(void 0!==r){t||(e.program=void 0);var i,n,o,a=!1;for(i=0,n=He.length;i<n;i++)if(o=He[i],o.program===r){o.usedTimes--,0===o.usedTimes&&(a=!0);break}if(a===!0){var s=[];for(i=0,n=He.length;i<n;i++)o=He[i],o.program!==r&&s.push(o);He=s,Ne.deleteProgram(r),je.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,r){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Ne.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Ne.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Ne.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Ne.createBuffer()),e.hasPositions&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,e.positionArray,Ne.DYNAMIC_DRAW),Ne.enableVertexAttribArray(t.attributes.position),Ne.vertexAttribPointer(t.attributes.position,3,Ne.FLOAT,!1,0,0)),e.hasNormals){if(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===n.FlatShading){var i,o,a,s,c,l,h,u,f,p,d,m,v,g,y=3*e.count;for(g=0;g<y;g+=9)v=e.normalArray,s=v[g],h=v[g+1],p=v[g+2],c=v[g+3],u=v[g+4],d=v[g+5],l=v[g+6],f=v[g+7],m=v[g+8],i=(s+c+l)/3,o=(h+u+f)/3,a=(p+d+m)/3,v[g]=i,v[g+1]=o,v[g+2]=a,v[g+3]=i,v[g+4]=o,v[g+5]=a,v[g+6]=i,v[g+7]=o,v[g+8]=a}Ne.bufferData(Ne.ARRAY_BUFFER,e.normalArray,Ne.DYNAMIC_DRAW),Ne.enableVertexAttribArray(t.attributes.normal),Ne.vertexAttribPointer(t.attributes.normal,3,Ne.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglUvBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,e.uvArray,Ne.DYNAMIC_DRAW),Ne.enableVertexAttribArray(t.attributes.uv),Ne.vertexAttribPointer(t.attributes.uv,2,Ne.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==n.NoColors&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,e.colorArray,Ne.DYNAMIC_DRAW),Ne.enableVertexAttribArray(t.attributes.color),Ne.vertexAttribPointer(t.attributes.color,3,Ne.FLOAT,!1,0,0)),Ne.drawArrays(Ne.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,o,a){if(i.visible!==!1){var s,c,l,h,u=I(e,t,r,i,a),f=u.attributes,p=o.attributes,d=!1,m=i.wireframe?1:0,v=16777215*o.id+2*u.id+m;if(v!==Ke&&(Ke=v,d=!0),d&&w(),a instanceof n.Mesh){var g=p.index;if(g){var y=o.offsets;y.length>1&&(d=!0);for(var _=0,M=y.length;_<M;_++){var S=y[_].index;if(d){for(c in f)l=f[c],s=p[c],l>=0&&(s?(h=s.itemSize,Ne.bindBuffer(Ne.ARRAY_BUFFER,s.buffer),b(l),Ne.vertexAttribPointer(l,h,Ne.FLOAT,!1,0,S*h*4)):i.defaultAttributeValues&&(2===i.defaultAttributeValues[c].length?Ne.vertexAttrib2fv(l,i.defaultAttributeValues[c]):3===i.defaultAttributeValues[c].length&&Ne.vertexAttrib3fv(l,i.defaultAttributeValues[c])));Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,g.buffer)}Ne.drawElements(Ne.TRIANGLES,y[_].count,Ne.UNSIGNED_SHORT,2*y[_].start),je.info.render.calls++,je.info.render.vertices+=y[_].count,je.info.render.faces+=y[_].count/3}}else{if(d)for(c in f)"index"!==c&&(l=f[c],s=p[c],l>=0&&(s?(h=s.itemSize,Ne.bindBuffer(Ne.ARRAY_BUFFER,s.buffer),b(l),Ne.vertexAttribPointer(l,h,Ne.FLOAT,!1,0,0)):i.defaultAttributeValues&&i.defaultAttributeValues[c]&&(2===i.defaultAttributeValues[c].length?Ne.vertexAttrib2fv(l,i.defaultAttributeValues[c]):3===i.defaultAttributeValues[c].length&&Ne.vertexAttrib3fv(l,i.defaultAttributeValues[c]))));var A=o.attributes.position;Ne.drawArrays(Ne.TRIANGLES,0,A.array.length/3),je.info.render.calls++,je.info.render.vertices+=A.array.length/3,je.info.render.faces+=A.array.length/3/3}}else if(a instanceof n.ParticleSystem){if(d)for(c in f)l=f[c],s=p[c],l>=0&&(s?(h=s.itemSize,Ne.bindBuffer(Ne.ARRAY_BUFFER,s.buffer),b(l),Ne.vertexAttribPointer(l,h,Ne.FLOAT,!1,0,0)):i.defaultAttributeValues&&i.defaultAttributeValues[c]&&(2===i.defaultAttributeValues[c].length?Ne.vertexAttrib2fv(l,i.defaultAttributeValues[c]):3===i.defaultAttributeValues[c].length&&Ne.vertexAttrib3fv(l,i.defaultAttributeValues[c])));var A=p.position;Ne.drawArrays(Ne.POINTS,0,A.array.length/3),je.info.render.calls++,je.info.render.points+=A.array.length/3}else if(a instanceof n.Line){var C=a.type===n.LineStrip?Ne.LINE_STRIP:Ne.LINES;ne(i.linewidth);var g=p.index;if(g){var y=o.offsets;y.length>1&&(d=!0);for(var _=0,M=y.length;_<M;_++){var S=y[_].index;d&&(x(i,f,p,S),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,g.buffer)),Ne.drawElements(Ne.LINES,y[_].count,Ne.UNSIGNED_SHORT,2*y[_].start),je.info.render.calls++,je.info.render.vertices+=y[_].count}}else{d&&x(i,f,p,0);var A=p.position;Ne.drawArrays(C,0,A.array.length/3),je.info.render.calls++,je.info.render.points+=A.array.length}}}},this.renderBuffer=function(e,t,r,i,o,a){if(i.visible!==!1){var s,c,l,h=I(e,t,r,i,a),u=h.attributes,f=!1,p=i.wireframe?1:0,d=16777215*o.id+2*h.id+p;if(d!==Ke&&(Ke=d,f=!0),f&&w(),!i.morphTargets&&u.position>=0?f&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglVertexBuffer),b(u.position),Ne.vertexAttribPointer(u.position,3,Ne.FLOAT,!1,0,0)):a.morphTargetBase&&M(i,o,a),f){if(o.__webglCustomAttributesList)for(c=0,l=o.__webglCustomAttributesList.length;c<l;c++)s=o.__webglCustomAttributesList[c],u[s.buffer.belongsToAttribute]>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,s.buffer),b(u[s.buffer.belongsToAttribute]),Ne.vertexAttribPointer(u[s.buffer.belongsToAttribute],s.size,Ne.FLOAT,!1,0,0));u.color>=0&&(a.geometry.colors.length>0||a.geometry.faces.length>0?(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglColorBuffer),b(u.color),Ne.vertexAttribPointer(u.color,3,Ne.FLOAT,!1,0,0)):i.defaultAttributeValues&&Ne.vertexAttrib3fv(u.color,i.defaultAttributeValues.color)),u.normal>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglNormalBuffer),b(u.normal),Ne.vertexAttribPointer(u.normal,3,Ne.FLOAT,!1,0,0)),u.tangent>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglTangentBuffer),b(u.tangent),Ne.vertexAttribPointer(u.tangent,4,Ne.FLOAT,!1,0,0)),u.uv>=0&&(a.geometry.faceVertexUvs[0]?(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglUVBuffer),b(u.uv),Ne.vertexAttribPointer(u.uv,2,Ne.FLOAT,!1,0,0)):i.defaultAttributeValues&&Ne.vertexAttrib2fv(u.uv,i.defaultAttributeValues.uv)),u.uv2>=0&&(a.geometry.faceVertexUvs[1]?(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglUV2Buffer),b(u.uv2),Ne.vertexAttribPointer(u.uv2,2,Ne.FLOAT,!1,0,0)):i.defaultAttributeValues&&Ne.vertexAttrib2fv(u.uv2,i.defaultAttributeValues.uv2)),i.skinning&&u.skinIndex>=0&&u.skinWeight>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),b(u.skinIndex),Ne.vertexAttribPointer(u.skinIndex,4,Ne.FLOAT,!1,0,0),Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),b(u.skinWeight),Ne.vertexAttribPointer(u.skinWeight,4,Ne.FLOAT,!1,0,0)),u.lineDistance>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglLineDistanceBuffer),b(u.lineDistance),Ne.vertexAttribPointer(u.lineDistance,1,Ne.FLOAT,!1,0,0))}if(a instanceof n.Mesh)i.wireframe?(ne(i.wireframeLinewidth),f&&Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),Ne.drawElements(Ne.LINES,o.__webglLineCount,Ne.UNSIGNED_SHORT,0)):(f&&Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),Ne.drawElements(Ne.TRIANGLES,o.__webglFaceCount,Ne.UNSIGNED_SHORT,0)),je.info.render.calls++,je.info.render.vertices+=o.__webglFaceCount,je.info.render.faces+=o.__webglFaceCount/3;else if(a instanceof n.Line){var m=a.type===n.LineStrip?Ne.LINE_STRIP:Ne.LINES;ne(i.linewidth),Ne.drawArrays(m,0,o.__webglLineCount),je.info.render.calls++}else a instanceof n.ParticleSystem&&(Ne.drawArrays(Ne.POINTS,0,o.__webglParticleCount),je.info.render.calls++,je.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,r,i){if(t instanceof n.Camera==!1)return void n.onerror("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o,a,s,c,l,h=e.__lights,u=e.fog;for(Ye=-1,St=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),yt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),gt.setFromMatrix(yt),this.autoUpdateObjects&&this.initWebGLObjects(e),C(this.renderPluginsPre,e,t),je.info.render.calls=0,je.info.render.vertices=0,je.info.render.faces=0,je.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),l=e.__webglObjects,o=0,a=l.length;o<a;o++)s=l[o],c=s.object,s.id=o,s.render=!1,c.visible&&((c instanceof n.Mesh||c instanceof n.ParticleSystem)&&c.frustumCulled&&!gt.intersectsObject(c)||(te(c,t),P(s),s.render=!0,this.sortObjects===!0&&(null!==c.renderDepth?s.z=c.renderDepth:(_t.setFromMatrixPosition(c.matrixWorld),_t.applyProjection(yt),s.z=_t.z))));for(this.sortObjects&&l.sort(S),l=e.__webglObjectsImmediate,o=0,a=l.length;o<a;o++)s=l[o],c=s.object,c.visible&&(te(c,t),L(s));if(e.overrideMaterial){var f=e.overrideMaterial;this.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),this.setDepthTest(f.depthTest),this.setDepthWrite(f.depthWrite),oe(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits),T(e.__webglObjects,!1,"",t,h,u,!0,f),E(e.__webglObjectsImmediate,"",t,h,u,!1,f)}else{var f=null;this.setBlending(n.NoBlending),T(e.__webglObjects,!0,"opaque",t,h,u,!1,f),E(e.__webglObjectsImmediate,"opaque",t,h,u,!1,f),T(e.__webglObjects,!1,"transparent",t,h,u,!0,f),E(e.__webglObjectsImmediate,"transparent",t,h,u,!0,f)}C(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==n.NearestFilter&&r.minFilter!==n.LinearFilter&&n.isPowerOfTwo(r.width)&&n.isPowerOfTwo(r.height)&&ye(r),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,r,i,n){var o=I(e,t,r,i,n);Ke=-1,je.setMaterialFaces(i),n.immediateRenderCallback?n.immediateRenderCallback(o,Ne,gt):n.render(function(e){je.renderBufferImmediate(e,o,i)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)R(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)O(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,r=e.__webglObjects.length;t<r;t++){var i=e.__webglObjects[t].object;void 0===i.__webglInit&&(void 0!==i.__webglActive&&O(i,e),R(i,e)),F(i)}},this.initMaterial=function(e,t,r,i){e.addEventListener("dispose",It);var o,a,s,c,l,h,u;e instanceof n.MeshDepthMaterial?u="depth":e instanceof n.MeshNormalMaterial?u="normal":e instanceof n.MeshBasicMaterial?u="basic":e instanceof n.MeshLambertMaterial?u="lambert":e instanceof n.MeshPhongMaterial?u="phong":e instanceof n.MeshPhysicalMaterial?u="physical":e instanceof n.LineBasicMaterial?u="basic":e instanceof n.LineDashedMaterial?u="dashed":e instanceof n.ParticleSystemMaterial&&(u="particle_basic"),u&&n.ShaderLib[u]&&z(e,n.ShaderLib[u]),u||(u=e.shaderID),c=we(t),h=Me(t),l=be(i),s={map:!!e.map,opacityMap:!!e.opacityMap,envMap:!!e.envMap,diffuseEnvMap:!!e.diffuseEnvMap,lightMap:!!e.lightMap,emissiveMap:!!e.emissiveMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,reflectivityMap:!!e.reflectivityMap,roughnessMap:!!e.roughnessMap,translucencyMap:!!e.translucencyMap,metallicMap:!!e.metallicMap,falloffMap:!!e.falloffMap,clearCoat:void 0!==e.clearCoat&&0!==e.clearCoat,anisotropy:void 0!==e.anisotropy&&0!==e.anisotropy||!!e.anisotropyMap,anisotropyMap:!!e.anisotropyMap,anisotropyRotation:void 0!==e.anisotropyRotation&&0!==e.anisotropyRotation||!!e.anisotropyRotationMap,anisotropyRotationMap:!!e.anisotropyRotationMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof n.FogExp2,sizeAttenuation:!!e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:Rt&&i&&i.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:c.directional,maxPointLights:c.point,maxSpotLights:c.spot,maxHemiLights:c.hemi,maxAreaLights:c.area,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow&&h>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,translucency:e.translucency&&e.translucency.getHex()>0,alphaTest:e.alphaTest,falloff:e.falloff||!1,wrapAround:e.wrapAround,doubleSided:e.side===n.DoubleSide,flipSided:e.side===n.BackSide},e.program=se(u,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,s,e.index0AttributeName);var f=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var p,d="morphTarget";for(a=0;a<this.maxMorphTargets;a++)p=d+a,f[p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var p,d="morphNormal";for(a=0;a<this.maxMorphNormals;a++)p=d+a,f[p]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(o in e.uniforms)e.uniformsList.push([e.uniforms[o],o])},this.setFaceCulling=function(e,t){e===n.CullFaceNone?Ne.disable(Ne.CULL_FACE):(t===n.FrontFaceDirectionCW?Ne.frontFace(Ne.CW):Ne.frontFace(Ne.CCW),e===n.CullFaceBack?Ne.cullFace(Ne.BACK):e===n.CullFaceFront?Ne.cullFace(Ne.FRONT):Ne.cullFace(Ne.FRONT_AND_BACK),
Ne.enable(Ne.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===n.DoubleSide,r=e.side===n.BackSide;Je!==t&&(t?Ne.disable(Ne.CULL_FACE):Ne.enable(Ne.CULL_FACE),Je=t),$e!==r&&(r?Ne.frontFace(Ne.CW):Ne.frontFace(Ne.CCW),$e=r)},this.setDepthTest=function(e){nt!==e&&(e?Ne.enable(Ne.DEPTH_TEST):Ne.disable(Ne.DEPTH_TEST),nt=e)},this.setDepthWrite=function(e){ot!==e&&(Ne.depthMask(e),ot=e)},this.setBlending=function(e,t,r,i){e!==et&&(e===n.NoBlending?Ne.disable(Ne.BLEND):e===n.AdditiveBlending?(Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.SRC_ALPHA,Ne.ONE)):e===n.SubtractiveBlending?(Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.ZERO,Ne.ONE_MINUS_SRC_COLOR)):e===n.MultiplyBlending?(Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.ZERO,Ne.SRC_COLOR)):e===n.CustomBlending?Ne.enable(Ne.BLEND):(Ne.enable(Ne.BLEND),Ne.blendEquationSeparate(Ne.FUNC_ADD,Ne.FUNC_ADD),Ne.blendFuncSeparate(Ne.SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA)),et=e),e===n.CustomBlending?(t!==tt&&(Ne.blendEquation(_e(t)),tt=t),r===rt&&i===it||(Ne.blendFunc(_e(r),_e(i)),rt=r,it=i)):(tt=null,rt=null,it=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Bt),e.__webglTexture=Ne.createTexture(),je.info.memory.textures++),Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture),Ne.pixelStorei(Ne.UNPACK_FLIP_Y_WEBGL,e.flipY),Ne.pixelStorei(Ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Ne.pixelStorei(Ne.UNPACK_ALIGNMENT,e.unpackAlignment);var r=e.image,i=n.Math.isPowerOfTwo(r.width)&&n.Math.isPowerOfTwo(r.height),o=_e(e.format),a=_e(e.type);fe(Ne.TEXTURE_2D,e,i);var s,c=e.mipmaps;if(e instanceof n.DataTexture)if(c.length>0&&i){for(var l=0,h=c.length;l<h;l++)s=c[l],Ne.texImage2D(Ne.TEXTURE_2D,l,o,s.width,s.height,0,o,a,s.data);e.generateMipmaps=!1}else Ne.texImage2D(Ne.TEXTURE_2D,0,o,r.width,r.height,0,o,a,r.data);else if(e instanceof n.CompressedTexture)for(var l=0,h=c.length;l<h;l++)s=c[l],e.format!==n.RGBAFormat?Ne.compressedTexImage2D(Ne.TEXTURE_2D,l,o,s.width,s.height,0,s.data):Ne.texImage2D(Ne.TEXTURE_2D,l,o,s.width,s.height,0,o,a,s.data);else if(c.length>0&&i){for(var l=0,h=c.length;l<h;l++)s=c[l],Ne.texImage2D(Ne.TEXTURE_2D,l,o,o,a,s);e.generateMipmaps=!1}else Ne.texImage2D(Ne.TEXTURE_2D,0,o,o,a,e.image);e.generateMipmaps&&i&&Ne.generateMipmap(Ne.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof n.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",zt),e.__webglTexture=Ne.createTexture(),je.info.memory.textures++;var r=n.Math.isPowerOfTwo(e.width)&&n.Math.isPowerOfTwo(e.height),i=_e(e.format),o=_e(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.__webglTexture),fe(Ne.TEXTURE_CUBE_MAP,e,r);for(var a=0;a<6;a++)e.__webglFramebuffer[a]=Ne.createFramebuffer(),e.__webglRenderbuffer[a]=Ne.createRenderbuffer(),Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,i,e.width,e.height,0,i,o,null),ve(e.__webglFramebuffer[a],e,Ne.TEXTURE_CUBE_MAP_POSITIVE_X+a),ge(e.__webglRenderbuffer[a],e);r&&Ne.generateMipmap(Ne.TEXTURE_CUBE_MAP)}else{if(e.__webglFramebuffer=Ne.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=Ne.createRenderbuffer(),Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture),fe(Ne.TEXTURE_2D,e,r),Ne.texImage2D(Ne.TEXTURE_2D,0,i,e.width,e.height,0,i,o,null),ve(e.__webglFramebuffer,e,Ne.TEXTURE_2D),e.shareDepthFrom){var s="glFormat: "+i+" glType: "+o;if(e.depthBuffer&&!e.stencilBuffer?(Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_ATTACHMENT,Ne.RENDERBUFFER,e.__webglRenderbuffer),s=" renderTarget: "+e.width+"+"+e.height+" DEPTH_ATTACHMENT"):e.depthBuffer&&e.stencilBuffer&&(Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_STENCIL_ATTACHMENT,Ne.RENDERBUFFER,e.__webglRenderbuffer),s=" renderTarget: "+e.width+"+"+e.height+" DEPTH_STENCIL_ATTACHMENT"),Ne.checkFramebufferStatus(Ne.FRAMEBUFFER)!=Ne.FRAMEBUFFER_COMPLETE)throw new Error("(B) Rendering to this texture is not supported (incomplete framebuffer) "+s)}else ge(e.__webglRenderbuffer,e);r&&Ne.generateMipmap(Ne.TEXTURE_2D)}t?Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,null):Ne.bindTexture(Ne.TEXTURE_2D,null),Ne.bindRenderbuffer(Ne.RENDERBUFFER,null),Ne.bindFramebuffer(Ne.FRAMEBUFFER,null)}var c,l,h,u,f;e?(c=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,l=e.width,h=e.height,u=0,f=0):(c=null,l=ft,h=pt,u=ht,f=ut),c!==qe&&(Ne.bindFramebuffer(Ne.FRAMEBUFFER,c),Ne.viewport(u,f,l,h),qe=c),dt=l,mt=h},this.shadowMapPlugin=new n.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new n.SpritePlugin),this.addPostPlugin(new n.LensFlarePlugin)},n.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:n.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:n.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:n.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:n.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.format=void 0!==r.format?r.format:n.RGBAFormat,this.type=void 0!==r.type?r.type:n.UnsignedByteType,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.shareDepthFrom=null},n.WebGLRenderTarget.prototype={constructor:n.WebGLRenderTarget,clone:function(){var e=new n.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.WebGLRenderTarget.prototype),n.WebGLRenderTargetCube=function(e,t,r){n.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},n.WebGLRenderTargetCube.prototype=Object.create(n.WebGLRenderTarget.prototype),n.RenderableVertex=function(){this.position=new n.Vector3,this.positionWorld=new n.Vector3,this.positionScreen=new n.Vector4,this.visible=!0},n.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},n.RenderableFace=function(){this.id=0,this.v1=new n.RenderableVertex,this.v2=new n.RenderableVertex,this.v3=new n.RenderableVertex,this.centroidModel=new n.Vector3,this.normalModel=new n.Vector3,this.vertexNormalsModel=[new n.Vector3,new n.Vector3,new n.Vector3],this.vertexNormalsLength=0,this.color=null,this.material=null,this.uvs=[[]],this.z=0},n.RenderableObject=function(){this.id=0,this.object=null,this.z=0},n.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new n.Vector2,this.material=null},n.RenderableLine=function(){this.id=0,this.v1=new n.RenderableVertex,this.v2=new n.RenderableVertex,this.vertexColors=[new n.Color,new n.Color],this.material=null,this.z=0},n.GeometryUtils={merge:function(e,t,r){var i,o,a=e.vertices.length,s=(e.faceVertexUvs[0].length,t instanceof n.Mesh?t.geometry:t),c=e.vertices,l=s.vertices,h=e.faces,u=s.faces,f=e.faceVertexUvs[0],p=s.faceVertexUvs[0];void 0===r&&(r=0),t instanceof n.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,o=(new n.Matrix3).getNormalMatrix(i));for(var d=0,m=l.length;d<m;d++){var v=l[d],g=v.clone();i&&g.applyMatrix4(i),c.push(g)}for(d=0,m=u.length;d<m;d++){var y,x,_,b=u[d],w=b.vertexNormals,M=b.vertexColors;y=new n.Face3(b.a+a,b.b+a,b.c+a),y.normal.copy(b.normal),o&&y.normal.applyMatrix3(o).normalize();for(var S=0,A=w.length;S<A;S++)x=w[S].clone(),o&&x.applyMatrix3(o).normalize(),y.vertexNormals.push(x);y.color.copy(b.color);for(var S=0,A=M.length;S<A;S++)_=M[S],y.vertexColors.push(_.clone());y.materialIndex=b.materialIndex+r,y.centroid.copy(b.centroid),i&&y.centroid.applyMatrix4(i),h.push(y)}for(d=0,m=p.length;d<m;d++){for(var C=p[d],T=[],S=0,A=C.length;S<A;S++)T.push(new n.Vector2(C[S].x,C[S].y));f.push(T)}},randomPointInTriangle:function(){var e=new n.Vector3;return function(t,r,i){var o=new n.Vector3,a=n.Math.random16(),s=n.Math.random16();a+s>1&&(a=1-a,s=1-s);var c=1-a-s;return o.copy(t),o.multiplyScalar(a),e.copy(r),e.multiplyScalar(s),o.add(e),e.copy(i),e.multiplyScalar(c),o.add(e),o}}(),randomPointInFace:function(e,t,r){var i,o,a;return i=t.vertices[e.a],o=t.vertices[e.b],a=t.vertices[e.c],n.GeometryUtils.randomPointInTriangle(i,o,a)},randomPointsInGeometry:function(e,t){function r(e){function t(r,i){if(i<r)return r;var n=r+Math.floor((i-r)/2);return p[n]>e?t(r,n-1):p[n]<e?t(n+1,i):n}var r=t(0,p.length-1);return r}var i,o,a,s,c,l=e.faces,h=e.vertices,u=l.length,f=0,p=[];for(o=0;o<u;o++)i=l[o],a=h[i.a],s=h[i.b],c=h[i.c],i._area=n.GeometryUtils.triangleArea(a,s,c),f+=i._area,p[o]=f;var d,m,v=[],g={};for(o=0;o<t;o++)d=n.Math.random16()*f,m=r(d),v[o]=n.GeometryUtils.randomPointInFace(l[m],e,!0),g[m]?g[m]+=1:g[m]=1;return v},triangleArea:function(){var e=new n.Vector3,t=new n.Vector3;return function(r,i,n){return e.subVectors(i,r),t.subVectors(n,r),e.cross(t),.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox,r=new n.Vector3;return r.addVectors(t.min,t.max),r.multiplyScalar(-.5),e.applyMatrix((new n.Matrix4).makeTranslation(r.x,r.y,r.z)),e.computeBoundingBox(),r},triangulateQuads:function(e){var t,r,i,n,o=[],a=[];for(t=0,r=e.faceVertexUvs.length;t<r;t++)a[t]=[];for(t=0,r=e.faces.length;t<r;t++){var s=e.faces[t];for(o.push(s),i=0,n=e.faceVertexUvs.length;i<n;i++)a[i].push(e.faceVertexUvs[i][t])}e.faces=o,e.faceVertexUvs=a,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()}},n.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,i){var o=new n.ImageLoader;o.crossOrigin=this.crossOrigin;var a=new n.Texture((void 0),t),s=o.load(e,function(){a.needsUpdate=!0,r&&r(a)});return a.image=s,a.sourceFile=e,a},loadCompressedTexture:function(e,t,r,i){var o=new n.CompressedTexture;o.mapping=t;var a=new XMLHttpRequest;return a.onload=function(){var e=a.response,t=n.ImageUtils.parseDDS(e,!0);o.format=t.format,o.mipmaps=t.mipmaps,o.image.width=t.width,o.image.height=t.height,o.generateMipmaps=!1,o.needsUpdate=!0,r&&r(o)},a.onerror=i,a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null),o},loadTextureCube:function(e,t,r,i){var o=[];o.loadCount=0;var a=new n.Texture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1;for(var s=0,c=e.length;s<c;++s){var l=new Image;o[s]=l,l.onload=function(){o.loadCount+=1,6===o.loadCount&&(a.needsUpdate=!0,r&&r(a))},l.onerror=i,l.crossOrigin=this.crossOrigin,l.src=e[s]}return a},loadCompressedTextureCube:function(e,t,r,i){var o=[];o.loadCount=0;var a=new n.CompressedTexture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1,a.generateMipmaps=!1;var s=function(e,t){return function(){var i=e.response,s=n.ImageUtils.parseDDS(i,!0);t.format=s.format,t.mipmaps=s.mipmaps,t.width=s.width,t.height=s.height,o.loadCount+=1,6===o.loadCount&&(a.format=s.format,a.needsUpdate=!0,r&&r(a))}};if(e instanceof Array)for(var c=0,l=e.length;c<l;++c){var h={};o[c]=h;var u=new XMLHttpRequest;u.onload=s(u,h),u.onerror=i;var f=e[c];u.open("GET",f,!0),u.responseType="arraybuffer",u.send(null)}else{var f=e,u=new XMLHttpRequest;u.onload=function(){var e=u.response,t=n.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,s=0;s<i;s++){o[s]={mipmaps:[]};for(var c=0;c<t.mipmapCount;c++)o[s].mipmaps.push(t.mipmaps[s*t.mipmapCount+c]),o[s].format=t.format,o[s].width=t.width,o[s].height=t.height}a.format=t.format,a.needsUpdate=!0,r&&r(a)}},u.onerror=i,u.open("GET",f,!0),u.responseType="arraybuffer",u.send(null)}return a},loadDDSTexture:function(e,t,r,i){var o=[];o.loadCount=0;var a=new n.CompressedTexture;a.image=o,void 0!==t&&(a.mapping=t),a.flipY=!1,a.generateMipmaps=!1;var s=new XMLHttpRequest;return s.onload=function(){var e=s.response,t=n.ImageUtils.parseDDS(e,!0);if(t.isCubemap)for(var i=t.mipmaps.length/t.mipmapCount,c=0;c<i;c++){o[c]={mipmaps:[]};for(var l=0;l<t.mipmapCount;l++)o[c].mipmaps.push(t.mipmaps[c*t.mipmapCount+l]),o[c].format=t.format,o[c].width=t.width,o[c].height=t.height}else a.image.width=t.width,a.image.height=t.height,a.mipmaps=t.mipmaps;a.format=t.format,a.needsUpdate=!0,r&&r(a)},s.onerror=i,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),a},parseDDS:function(e,t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function o(e,t,r,i){for(var n=r*i*4,o=new Uint8Array(e,t,n),a=new Uint8Array(n),s=0,c=0,l=0;l<i;l++)for(var h=0;h<r;h++){var u=o[c];c++;var f=o[c];c++;var p=o[c];c++;var d=o[c];c++,a[s]=p,s++,a[s]=f,s++,a[s]=u,s++,a[s]=d,s++}return a}var a={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=542327876,c=131072,l=512,h=4,u=r("DXT1"),f=r("DXT3"),p=r("DXT5"),d=31,m=0,v=1,g=2,y=3,x=4,_=7,b=20,w=21,M=22,S=23,A=24,C=25,T=26,E=28,L=new Int32Array(e,0,d);if(L[m]!==s)return n.onerror("ImageUtils.parseDDS(): Invalid magic number in DDS header"),a;if(!L[b]&h)return n.onerror("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),a;var P,R=L[w],D=!1;switch(R){case u:P=8,a.format=n.RGB_S3TC_DXT1_Format;break;case f:P=16,a.format=n.RGBA_S3TC_DXT3_Format;break;case p:P=16,a.format=n.RGBA_S3TC_DXT5_Format;break;default:if(!(32==L[M]&&16711680&L[S]&&65280&L[A]&&255&L[C]&&4278190080&L[T]))return n.onerror("ImageUtils.parseDDS(): Unsupported FourCC code: ",i(R)),a;D=!0,P=64,a.format=n.RGBAFormat}a.mipmapCount=1,L[g]&c&&t!==!1&&(a.mipmapCount=Math.max(1,L[_])),a.isCubemap=!!(L[E]&l),a.width=L[x],a.height=L[y];for(var V=L[v]+4,F=a.width,U=a.height,N=a.isCubemap?6:1,O=0;O<N;O++){for(var k=0;k<a.mipmapCount;k++){if(D)var B=o(e,V,F,U),z=B.length;else var z=Math.max(4,F)/4*Math.max(4,U)/4*P,B=new Uint8Array(e,V,z);var I={data:B,width:F,height:U};a.mipmaps.push(I),V+=z,F=Math.max(.5*F,1),U=Math.max(.5*U,1)}F=a.width,U=a.height}return a},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var o=e.width,a=e.height,s=document.createElement("canvas");s.width=o,s.height=a;var c=s.getContext("2d");c.drawImage(e,0,0);for(var l=c.getImageData(0,0,o,a).data,h=c.createImageData(o,a),u=h.data,f=0;f<o;f++)for(var p=0;p<a;p++){var d=p-1<0?0:p-1,m=p+1>a-1?a-1:p+1,v=f-1<0?0:f-1,g=f+1>o-1?o-1:f+1,y=[],x=[0,0,l[4*(p*o+f)]/255*t];y.push([-1,0,l[4*(p*o+v)]/255*t]),y.push([-1,-1,l[4*(d*o+v)]/255*t]),y.push([0,-1,l[4*(d*o+f)]/255*t]),y.push([1,-1,l[4*(d*o+g)]/255*t]),y.push([1,0,l[4*(p*o+g)]/255*t]),y.push([1,1,l[4*(m*o+g)]/255*t]),y.push([0,1,l[4*(m*o+f)]/255*t]),y.push([-1,1,l[4*(m*o+v)]/255*t]);for(var _=[],b=y.length,w=0;w<b;w++){var M=y[w],S=y[(w+1)%b];M=i(M,x),S=i(S,x),_.push(n(r(M,S)))}for(var A=[0,0,0],w=0;w<_.length;w++)A[0]+=_[w][0],A[1]+=_[w][1],A[2]+=_[w][2];A[0]/=_.length,A[1]/=_.length,A[2]/=_.length;var C=4*(p*o+f);u[C]=(A[0]+1)/2*255|0,u[C+1]=(A[1]+1)/2*255|0,u[C+2]=255*A[2]|0,u[C+3]=255}return c.putImageData(h,0,0),s},generateDataTexture:function(e,t,r){for(var i=e*t,o=new Uint8Array(3*i),a=Math.floor(255*r.r),s=Math.floor(255*r.g),c=Math.floor(255*r.b),l=0;l<i;l++)o[3*l]=a,o[3*l+1]=s,o[3*l+2]=c;var h=new n.DataTexture(o,e,t,n.RGBFormat);return h.needsUpdate=!0,h}},n.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new n.Object3D,i=0,o=t.length;i<o;i++)r.add(new n.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new n.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},n.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),r=this;r.faces[t]=r.faces[t]||{},r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{},r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,r=this.getFace(),i=this.size/r.resolution,o=0,a=String(e).split(""),s=a.length,c=[];for(t=0;t<s;t++){var l=new n.Path,h=this.extractGlyphPoints(a[t],r,i,o,l);o+=h.offset,c.push(h.path)}var u=o/2;return{paths:c,offset:u}},extractGlyphPoints:function(e,t,r,i,o){var a,s,c,l,h,u,f,p,d,m,v,g,y,x,_,b,w,M,S,A=[],C=t.glyphs[e]||t.glyphs["?"];if(C){if(C.o)for(l=C._cachedOutline||(C._cachedOutline=C.o.split(" ")),u=l.length,f=r,p=r,a=0;a<u;)switch(h=l[a++]){case"m":d=l[a++]*f+i,m=l[a++]*p,o.moveTo(d,m);break;case"l":d=l[a++]*f+i,m=l[a++]*p,o.lineTo(d,m);break;case"q":if(v=l[a++]*f+i,g=l[a++]*p,_=l[a++]*f+i,b=l[a++]*p,o.quadraticCurveTo(_,b,v,g),S=A[A.length-1])for(y=S.x,x=S.y,s=1,c=this.divisions;s<=c;s++){var T=s/c;n.Shape.Utils.b2(T,y,_,v),n.Shape.Utils.b2(T,x,b,g)}break;case"b":if(v=l[a++]*f+i,g=l[a++]*p,_=l[a++]*f+i,b=l[a++]*-p,w=l[a++]*f+i,M=l[a++]*-p,o.bezierCurveTo(v,g,_,b,w,M),S=A[A.length-1])for(y=S.x,x=S.y,s=1,c=this.divisions;s<=c;s++){var T=s/c;n.Shape.Utils.b3(T,y,_,w,v),n.Shape.Utils.b3(T,x,b,M,g)}}return{offset:C.ha*r,path:o}}}},n.FontUtils.generateShapes=function(e,t){t=t||{};var r=void 0!==t.size?t.size:100,i=void 0!==t.curveSegments?t.curveSegments:4,o=void 0!==t.font?t.font:"helvetiker",a=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";n.FontUtils.size=r,n.FontUtils.divisions=i,n.FontUtils.face=o,n.FontUtils.weight=a,n.FontUtils.style=s;for(var c=n.FontUtils.drawText(e),l=c.paths,h=[],u=0,f=l.length;u<f;u++)Array.prototype.push.apply(h,l[u].toShapes());return h},function(e){var t=1e-10,r=function(e,t){var r=e.length;if(r<3)return null;var a,s,c,l=[],h=[],u=[];if(i(e)>0)for(s=0;s<r;s++)h[s]=s;else for(s=0;s<r;s++)h[s]=r-1-s;var f=r,p=2*f;for(s=f-1;f>2;){if(p--<=0)return n.onwarning("Warning, unable to triangulate polygon!"),t?u:l;if(a=s,f<=a&&(a=0),s=a+1,f<=s&&(s=0),c=s+1,f<=c&&(c=0),o(e,a,s,c,f,h)){var d,m,v,g,y;for(d=h[a],m=h[s],v=h[c],l.push([e[d],e[m],e[v]]),u.push([h[a],h[s],h[c]]),g=s,y=s+1;y<f;g++,y++)h[g]=h[y];f--,p=2*f}}return t?u:l},i=function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},o=function(e,r,i,n,o,a){var s,c,l,h,u,f,p,d,m;if(c=e[a[r]].x,l=e[a[r]].y,h=e[a[i]].x,u=e[a[i]].y,f=e[a[n]].x,p=e[a[n]].y,t>(h-c)*(p-l)-(u-l)*(f-c))return!1;var v,g,y,x,_,b,w,M,S,A,C,T,E,L,P;for(v=f-h,g=p-u,y=c-f,x=l-p,_=h-c,b=u-l,s=0;s<o;s++)if(d=e[a[s]].x,m=e[a[s]].y,!(d===c&&m===l||d===h&&m===u||d===f&&m===p)&&(w=d-c,M=m-l,S=d-h,A=m-u,C=d-f,T=m-p,P=v*A-g*S,E=_*M-b*w,L=y*T-x*C,P>=-t&&L>=-t&&E>=-t))return!1;return!0};return e.Triangulate=r,e.Triangulate.area=i,e}(n.FontUtils),i._typeface_js={faces:n.FontUtils.faces,loadFace:n.FontUtils.loadFace},n.typeface_js=i._typeface_js,n.Curve=function(){},n.Curve.prototype.getPoint=function(e){return n.onwarning("Warning, getPoint() not implemented!"),null},n.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},n.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},n.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},n.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},n.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),o=0;for(i.push(0),r=1;r<=e;r++)t=this.getPoint(r/e),o+=t.distanceTo(n),i.push(o),n=t;return this.cacheArcLengths=i,i},n.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},n.Curve.prototype.getUtoTmapping=function(e,t){var r,i=this.getLengths(),n=0,o=i.length;r=t?t:e*i[o-1];for(var a,s=0,c=o-1;s<=c;)if(n=Math.floor(s+(c-s)/2),a=i[n]-r,a<0)s=n+1;else{if(!(a>0)){c=n;break}c=n-1}if(n=c,i[n]==r){var l=n/(o-1);return l}var h=i[n],u=i[n+1],f=u-h,p=(r-h)/f,l=(n+p)/(o-1);return l},n.Curve.prototype.getTangent=function(e){var t=1e-4,r=e-t,i=e+t;r<0&&(r=0),i>1&&(i=1);var n=this.getPoint(r),o=this.getPoint(i),a=o.clone().sub(n);return a.normalize()},n.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},n.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){var o=6*e*e-6*e,a=3*e*e-4*e+1,s=-6*e*e+6*e,c=3*e*e-2*e;return o+a+s+c},interpolate:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n,c=n*s;return(2*t-2*r+o+a)*c+(-3*t+3*r-2*o-a)*s+o*n+t}},n.Curve.create=function(e,t){return e.prototype=Object.create(n.Curve.prototype),e.prototype.getPoint=t,e},n.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},n.CurvePath.prototype=Object.create(n.Curve.prototype),n.CurvePath.prototype.add=function(e){this.curves.push(e)},n.CurvePath.prototype.checkConnection=function(){},n.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new n.LineCurve(t,e))},n.CurvePath.prototype.getPoint=function(e){for(var t,r,i=e*this.getLength(),n=this.getCurveLengths(),o=0;o<n.length;){if(n[o]>=i){t=n[o]-i,r=this.curves[o];var a=1-t/r.getLength();return r.getPointAt(a)}o++}return null},n.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},n.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,i=this.curves.length;for(e=0;e<i;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t,t},n.CurvePath.prototype.getBoundingBox=function(){var e,t,r,i,o,a,s=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=o=Number.POSITIVE_INFINITY;var c,l,h,u,f=s[0]instanceof n.Vector3;for(u=f?new n.Vector3:new n.Vector2,l=0,h=s.length;l<h;l++)c=s[l],c.x>e?e=c.x:c.x<i&&(i=c.x),c.y>t?t=c.y:c.y<o&&(o=c.y),f&&(c.z>r?r=c.z:c.z<a&&(a=c.z)),u.add(c);var p={minX:i,minY:o,maxX:e,maxY:t,centroid:u.divideScalar(h)};return f&&(p.maxZ=r,p.minZ=a),p},n.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},n.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},n.CurvePath.prototype.createGeometry=function(e){for(var t=new n.Geometry,r=0;r<e.length;r++)t.vertices.push(new n.Vector3(e[r].x,e[r].y,e[r].z||0));return t},n.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},n.CurvePath.prototype.getTransformedPoints=function(e,t){var r,i,n=this.getPoints(e);for(t||(t=this.bends),r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},n.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,i,n=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},n.CurvePath.prototype.getWrapPoints=function(e,t){var r,i,n,o,a,s,c=this.getBoundingBox();for(r=0,i=e.length;r<i;r++){n=e[r],o=n.x,a=n.y,s=o/c.maxX,s=t.getUtoTmapping(s,o);var l=t.getPoint(s),h=t.getTangent(s);h.set(-h.y,h.x).multiplyScalar(a),n.x=l.x+h.x,n.y=l.y+h.y}return e},n.Gyroscope=function(){n.Object3D.call(this)},n.Gyroscope.prototype=Object.create(n.Object3D.prototype),n.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},n.Gyroscope.prototype.translationWorld=new n.Vector3,n.Gyroscope.prototype.translationObject=new n.Vector3,n.Gyroscope.prototype.quaternionWorld=new n.Quaternion,n.Gyroscope.prototype.quaternionObject=new n.Quaternion,n.Gyroscope.prototype.scaleWorld=new n.Vector3,n.Gyroscope.prototype.scaleObject=new n.Vector3,n.Path=function(e){n.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},n.Path.prototype=Object.create(n.CurvePath.prototype),n.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},n.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},n.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:n.PathActions.MOVE_TO,args:r})},n.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,o=i[i.length-2],a=i[i.length-1],s=new n.LineCurve(new n.Vector2(o,a),new n.Vector2(e,t));this.curves.push(s),this.actions.push({action:n.PathActions.LINE_TO,args:r})},n.Path.prototype.quadraticCurveTo=function(e,t,r,i){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,s=a[a.length-2],c=a[a.length-1],l=new n.QuadraticBezierCurve(new n.Vector2(s,c),new n.Vector2(e,t),new n.Vector2(r,i));this.curves.push(l),this.actions.push({action:n.PathActions.QUADRATIC_CURVE_TO,args:o})},n.Path.prototype.bezierCurveTo=function(e,t,r,i,o,a){var s=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,l=c[c.length-2],h=c[c.length-1],u=new n.CubicBezierCurve(new n.Vector2(l,h),new n.Vector2(e,t),new n.Vector2(r,i),new n.Vector2(o,a));this.curves.push(u),this.actions.push({action:n.PathActions.BEZIER_CURVE_TO,args:s})},n.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],o=r[r.length-1],a=[new n.Vector2(i,o)];Array.prototype.push.apply(a,e);var s=new n.SplineCurve(a);this.curves.push(s),this.actions.push({action:n.PathActions.CSPLINE_THRU,args:t})},n.Path.prototype.arc=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],c=a[a.length-1];this.absarc(e+s,t+c,r,i,n,o)},n.Path.prototype.absarc=function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},n.Path.prototype.ellipse=function(e,t,r,i,n,o,a){var s=this.actions[this.actions.length-1].args,c=s[s.length-2],l=s[s.length-1];this.absellipse(e+c,t+l,r,i,n,o,a)},n.Path.prototype.absellipse=function(e,t,r,i,o,a,s){var c=Array.prototype.slice.call(arguments),l=new n.EllipseCurve(e,t,r,i,o,a,s);this.curves.push(l);var h=l.getPoint(1);c.push(h.x),c.push(h.y),this.actions.push({action:n.PathActions.ELLIPSE,args:c})},n.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;i<e;i++)r.push(this.getPoint(i/e));return r},n.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r,i,o,a,s,c,l,h,u,f,p,d,m,v,g,y,x,_,b=[];for(r=0,i=this.actions.length;r<i;r++)switch(o=this.actions[r],a=o.action,s=o.args,a){case n.PathActions.MOVE_TO:b.push(new n.Vector2(s[0],s[1]));break;case n.PathActions.LINE_TO:b.push(new n.Vector2(s[0],s[1]));break;case n.PathActions.QUADRATIC_CURVE_TO:for(c=s[2],l=s[3],f=s[0],p=s[1],b.length>0?(v=b[b.length-1],d=v.x,m=v.y):(v=this.actions[r-1].args,d=v[v.length-2],m=v[v.length-1]),g=1;g<=e;g++)y=g/e,x=n.Shape.Utils.b2(y,d,f,c),_=n.Shape.Utils.b2(y,m,p,l),b.push(new n.Vector2(x,_));break;case n.PathActions.BEZIER_CURVE_TO:for(c=s[4],l=s[5],f=s[0],p=s[1],h=s[2],u=s[3],b.length>0?(v=b[b.length-1],d=v.x,m=v.y):(v=this.actions[r-1].args,d=v[v.length-2],m=v[v.length-1]),g=1;g<=e;g++)y=g/e,x=n.Shape.Utils.b3(y,d,f,h,c),_=n.Shape.Utils.b3(y,m,p,u,l),b.push(new n.Vector2(x,_));break;case n.PathActions.CSPLINE_THRU:v=this.actions[r-1].args;var w=new n.Vector2(v[v.length-2],v[v.length-1]),M=[w],S=e*s[0].length;M=M.concat(s[0]);var A=new n.SplineCurve(M);for(g=1;g<=S;g++)b.push(A.getPointAt(g/S));break;case n.PathActions.ARC:var C,T=s[0],E=s[1],L=s[2],P=s[3],R=s[4],D=!!s[5],V=R-P,F=2*e;for(g=1;g<=F;g++)y=g/F,D||(y=1-y),C=P+y*V,x=T+L*Math.cos(C),_=E+L*Math.sin(C),b.push(new n.Vector2(x,_));break;case n.PathActions.ELLIPSE:var C,T=s[0],E=s[1],U=s[2],N=s[3],P=s[4],R=s[5],D=!!s[6],V=R-P,F=2*e;for(g=1;g<=F;g++)y=g/F,D||(y=1-y),C=P+y*V,x=T+U*Math.cos(C),_=E+N*Math.sin(C),b.push(new n.Vector2(x,_))}var O=b[b.length-1],k=1e-10;return Math.abs(O.x-b[0].x)<k&&Math.abs(O.y-b[0].y)<k&&b.splice(b.length-1,1),t&&b.push(b[0]),b},n.Path.prototype.toShapes=function(e){function t(e,t){for(var r=1e-10,i=t.length,n=!1,o=i-1,a=0;a<i;o=a++){var s=t[o],c=t[a],l=c.x-s.x,h=c.y-s.y;if(Math.abs(h)>r){if(h<0&&(s=t[a],l=-l,c=t[o],h=-h),e.y<s.y||e.y>c.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var u=h*(e.x-s.x)-l*(e.y-s.y);if(0==u)return!0;if(u<0)continue;n=!n}}else{if(e.y!=s.y)continue;if(c.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=c.x)return!0}}return n}var r,i,o,a,s,c=[],l=new n.Path;for(r=0,i=this.actions.length;r<i;r++)o=this.actions[r],s=o.args,a=o.action,a==n.PathActions.MOVE_TO&&0!=l.actions.length&&(c.push(l),l=new n.Path),l[a].apply(l,s);if(0!=l.actions.length&&c.push(l),0==c.length)return[];var h,u,f,p=[];if(1==c.length)return u=c[0],f=new n.Shape,f.actions=u.actions,f.curves=u.curves,p.push(f),p;var d=!n.Shape.Utils.isClockWise(c[0].getPoints());d=e?!d:d;var m,v=[],g=[],y=[],x=0;for(g[x]=void 0,y[x]=[],r=0,i=c.length;r<i;r++)u=c[r],m=u.getPoints(),h=n.Shape.Utils.isClockWise(m),h=e?!h:h,h?(!d&&g[x]&&x++,g[x]={s:new n.Shape,p:m},g[x].s.actions=u.actions,g[x].s.curves=u.curves,d&&x++,y[x]=[]):y[x].push({h:u,p:m[0]});if(g.length>1){for(var _=!1,b=[],w=0,M=g.length;w<M;w++)v[w]=[];for(var w=0,M=g.length;w<M;w++)for(var S=(g[w],y[w]),A=0;A<S.length;A++){for(var C=S[A],T=!0,E=0;E<g.length;E++)t(C.p,g[E].p)&&(w!=E&&b.push({froms:w,tos:E,hole:A}),T?(T=!1,v[E].push(C)):_=!0);T&&v[w].push(C)}b.length>0&&(_||(y=v))}var L,P,R;for(r=0,i=g.length;r<i;r++)for(f=g[r].s,p.push(f),L=y[r],P=0,R=L.length;P<R;P++)f.holes.push(L[P].h);return p},n.Shape=function(){n.Path.apply(this,arguments),this.holes=[]},n.Shape.prototype=Object.create(n.Path.prototype),n.Shape.prototype.extrude=function(e){var t=new n.ExtrudeGeometry(this,e);return t},n.Shape.prototype.makeGeometry=function(e){var t=new n.ShapeGeometry(this,e);return t},n.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},n.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},n.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},n.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},n.Shape.prototype.extractAllSpacedPoints=function(e){return{
shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},n.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){return e.x!=t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function i(e,t,i,n,o){var a=1e-10,s=t.x-e.x,c=t.y-e.y,l=n.x-i.x,h=n.y-i.y,u=e.x-i.x,f=e.y-i.y,p=c*l-s*h,d=c*u-s*f;if(Math.abs(p)>a){var m;if(p>0){if(d<0||d>p)return[];if(m=h*u-l*f,m<0||m>p)return[]}else{if(d>0||d<p)return[];if(m=h*u-l*f,m>0||m<p)return[]}if(0==m)return!o||0!=d&&d!=p?[e]:[];if(m==p)return!o||0!=d&&d!=p?[t]:[];if(0==d)return[i];if(d==p)return[n];var v=m/p;return[{x:e.x+v*s,y:e.y+v*c}]}if(0!=d||h*u!=l*f)return[];var g=0==s&&0==c,y=0==l&&0==h;if(g&&y)return e.x!=i.x||e.y!=i.y?[]:[e];if(g)return r(i,n,e)?[e]:[];if(y)return r(e,t,i)?[i]:[];var x,_,b,w,M,S,A,C;return 0!=s?(e.x<t.x?(x=e,b=e.x,_=t,w=t.x):(x=t,b=t.x,_=e,w=e.x),i.x<n.x?(M=i,A=i.x,S=n,C=n.x):(M=n,A=n.x,S=i,C=i.x)):(e.y<t.y?(x=e,b=e.y,_=t,w=t.y):(x=t,b=t.y,_=e,w=e.y),i.y<n.y?(M=i,A=i.y,S=n,C=n.y):(M=n,A=n.y,S=i,C=i.y)),b<=A?w<A?[]:w==A?o?[]:[M]:w<=C?[M,_]:[M,S]:b>C?[]:b==C?o?[]:[x]:w<=C?[x,_]:[x,S]}function o(e,t,r,i){var n=1e-10,o=t.x-e.x,a=t.y-e.y,s=r.x-e.x,c=r.y-e.y,l=i.x-e.x,h=i.y-e.y,u=o*c-a*s,f=o*h-a*l;if(Math.abs(u)>n){var p=l*c-h*s;return u>0?f>=0&&p>=0:f>=0||p>=0}return f>0}function a(e,t){function r(e,t){var r=y.length-1,i=e-1;i<0&&(i=r);var n=e+1;n>r&&(n=0);var a=o(y[e],y[i],y[n],s[t]);if(!a)return!1;var c=s.length-1,l=t-1;l<0&&(l=c);var h=t+1;return h>c&&(h=0),a=o(s[t],s[l],s[h],y[e]),!!a}function n(e,t){var r,n,o;for(r=0;r<y.length;r++)if(n=r+1,n%=y.length,o=i(e,t,y[r],y[n],!0),o.length>0)return!0;return!1}function a(e,r){var n,o,a,s,c;for(n=0;n<x.length;n++)for(o=t[x[n]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,c=i(e,r,o[a],o[s],!0),c.length>0)return!0;return!1}for(var s,c,l,h,u,f,p,d,m,v,g,y=e.concat(),x=[],_=[],b=0,w=t.length;b<w;b++)x.push(b);for(var M=2*x.length;x.length>0;){if(M--,M<0){console.log("Infinite Loop! Holes left:"+x.length+", Probably Hole outside Shape!");break}for(l=0;l<y.length;l++){h=y[l],c=-1;for(var b=0;b<x.length;b++)if(f=x[b],p=h.x+":"+h.y+":"+f,void 0===_[p]){s=t[f];for(var S=0;S<s.length;S++)if(u=s[S],r(l,S)&&!n(h,u)&&!a(h,u)){c=S,x.splice(b,1),d=y.slice(0,l+1),m=y.slice(l),v=s.slice(c),g=s.slice(0,c+1),y=d.concat(v).concat(g).concat(m);break}if(c>=0)break;_[p]=!0}if(c>=0)break}}return y}for(var s,c,l,h,u,f,p={},d=e.concat(),m=0,v=t.length;m<v;m++)Array.prototype.push.apply(d,t[m]);for(s=0,c=d.length;s<c;s++)u=d[s].x+":"+d[s].y,void 0!==p[u]&&console.log("Duplicate point",u),p[u]=s;var g=a(e,t),y=n.FontUtils.Triangulate(g,!1);for(s=0,c=y.length;s<c;s++)for(h=y[s],l=0;l<3;l++)u=h[l].x+":"+h[l].y,f=p[u],void 0!==f&&(h[l]=f);return y.concat()},isClockWise:function(e){return n.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}},n.LineCurve=function(e,t){this.v1=e,this.v2=t},n.LineCurve.prototype=Object.create(n.Curve.prototype),n.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},n.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},n.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},n.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},n.QuadraticBezierCurve.prototype=Object.create(n.Curve.prototype),n.QuadraticBezierCurve.prototype.getPoint=function(e){var t,r;return t=n.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=n.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new n.Vector2(t,r)},n.QuadraticBezierCurve.prototype.getTangent=function(e){var t,r;t=n.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r=n.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var i=new n.Vector2(t,r);return i.normalize(),i},n.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},n.CubicBezierCurve.prototype=Object.create(n.Curve.prototype),n.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=n.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new n.Vector2(t,r)},n.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=n.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new n.Vector2(t,r);return i.normalize(),i},n.SplineCurve=function(e){this.points=void 0==e?[]:e},n.SplineCurve.prototype=Object.create(n.Curve.prototype),n.SplineCurve.prototype.getPoint=function(e){var t,r,i,o=new n.Vector2,a=[],s=this.points;return t=(s.length-1)*e,r=Math.floor(t),i=t-r,a[0]=0==r?r:r-1,a[1]=r,a[2]=r>s.length-2?s.length-1:r+1,a[3]=r>s.length-3?s.length-1:r+2,o.x=n.Curve.Utils.interpolate(s[a[0]].x,s[a[1]].x,s[a[2]].x,s[a[3]].x,i),o.y=n.Curve.Utils.interpolate(s[a[0]].y,s[a[1]].y,s[a[2]].y,s[a[3]].y,i),o},n.EllipseCurve=function(e,t,r,i,n,o,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a},n.EllipseCurve.prototype=Object.create(n.Curve.prototype),n.EllipseCurve.prototype.getPoint=function(e){var t,r=this.aEndAngle-this.aStartAngle;r<0&&(r+=2*Math.PI),r>2*Math.PI&&(r-=2*Math.PI),t=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-r):this.aStartAngle+e*r;var i=this.aX+this.xRadius*Math.cos(t),o=this.aY+this.yRadius*Math.sin(t);return new n.Vector2(i,o)},n.ArcCurve=function(e,t,r,i,o,a){n.EllipseCurve.call(this,e,t,r,r,i,o,a)},n.ArcCurve.prototype=Object.create(n.EllipseCurve.prototype),n.LineCurve3=n.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new n.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),n.QuadraticBezierCurve3=n.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t,r,i;return t=n.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=n.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),i=n.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new n.Vector3(t,r,i)}),n.CubicBezierCurve3=n.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t,r,i;return t=n.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=n.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new n.Vector3(t,r,i)}),n.SplineCurve3=n.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,i,o=new n.Vector3,a=[],s=this.points;t=(s.length-1)*e,r=Math.floor(t),i=t-r,a[0]=0==r?r:r-1,a[1]=r,a[2]=r>s.length-2?s.length-1:r+1,a[3]=r>s.length-3?s.length-1:r+2;var c=s[a[0]],l=s[a[1]],h=s[a[2]],u=s[a[3]];return o.x=n.Curve.Utils.interpolate(c.x,l.x,h.x,u.x,i),o.y=n.Curve.Utils.interpolate(c.y,l.y,h.y,u.y,i),o.z=n.Curve.Utils.interpolate(c.z,l.z,h.z,u.z,i),o}),n.ClosedSplineCurve3=n.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,i,o=new n.Vector3,a=[],s=this.points;return t=(s.length-0)*e,r=Math.floor(t),i=t-r,r+=r>0?0:(Math.floor(Math.abs(r)/s.length)+1)*s.length,a[0]=(r-1)%s.length,a[1]=r%s.length,a[2]=(r+1)%s.length,a[3]=(r+2)%s.length,o.x=n.Curve.Utils.interpolate(s[a[0]].x,s[a[1]].x,s[a[2]].x,s[a[3]].x,i),o.y=n.Curve.Utils.interpolate(s[a[0]].y,s[a[1]].y,s[a[2]].y,s[a[3]].y,i),o.z=n.Curve.Utils.interpolate(s[a[0]].z,s[a[1]].z,s[a[2]].z,s[a[3]].z,i),o}),n.AnimationHandler=function(){var e=[],t={},r={};r.update=function(t){for(var r=0;r<e.length;r++)e[r].update(t)},r.addToUpdate=function(t){e.indexOf(t)===-1&&e.push(t)},r.removeFromUpdate=function(t){var r=e.indexOf(t);r!==-1&&e.splice(r,1)},r.add=function(e){void 0!==t[e.name]&&n.onwarning("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,o(e)},r.get=function(e){if("string"==typeof e)return t[e]?t[e]:(n.onwarning("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},r.parse=function(e){var t=[];if(e instanceof n.SkinnedMesh)for(var r=0;r<e.bones.length;r++)t.push(e.bones[r]);else i(e,t);return t};var i=function(e,t){t.push(e);for(var r=0;r<e.children.length;r++)i(e.children[r],t)},o=function(e){if(e.initialized!==!0){for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof n.Quaternion)){var i=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=new n.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var o={},r=0;r<e.hierarchy[t].keys.length;r++)for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++){var s=e.hierarchy[t].keys[r].morphTargets[a];o[s]=-1}e.hierarchy[t].usedMorphTargets=o;for(var r=0;r<e.hierarchy[t].keys.length;r++){var c={};for(var s in o){for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++)if(e.hierarchy[t].keys[r].morphTargets[a]===s){c[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[a];break}a===e.hierarchy[t].keys[r].morphTargets.length&&(c[s]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=c}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}e.initialized=!0}};return r.LINEAR=0,r.CATMULLROM=1,r.CATMULLROM_FORWARD=2,r}(),n.Animation=function(e,t){this.root=e,this.data=n.AnimationHandler.get(t),this.hierarchy=n.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=n.AnimationHandler.LINEAR},n.Animation.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying===!1&&(this.isPlaying=!0,this.reset(),this.update(0)),this.isPaused=!1,n.AnimationHandler.addToUpdate(this)},n.Animation.prototype.pause=function(){this.isPaused===!0?n.AnimationHandler.addToUpdate(this):n.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},n.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,n.AnimationHandler.removeFromUpdate(this)},n.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof n.Bone?r.skinMatrix:r.matrix);var i=r.animationCache.prevKey,o=r.animationCache.nextKey;i.pos=this.data.hierarchy[e].keys[0],i.rot=this.data.hierarchy[e].keys[0],i.scl=this.data.hierarchy[e].keys[0],o.pos=this.getNextKeyWith("pos",e,1),o.rot=this.getNextKeyWith("rot",e,1),o.scl=this.getNextKeyWith("scl",e,1)}},n.Animation.prototype.update=function(){var e=[],t=new n.Vector3,r=function(e,t){var r,n,o,a,s,c,l,h,u,f=[],p=[];return r=(e.length-1)*t,n=Math.floor(r),o=r-n,f[0]=0===n?n:n-1,f[1]=n,f[2]=n>e.length-2?n:n+1,f[3]=n>e.length-3?n:n+2,c=e[f[0]],l=e[f[1]],h=e[f[2]],u=e[f[3]],a=o*o,s=o*a,p[0]=i(c[0],l[0],h[0],u[0],o,a,s),p[1]=i(c[1],l[1],h[1],u[1],o,a,s),p[2]=i(c[2],l[2],h[2],u[2],o,a,s),p},i=function(e,t,r,i,n,o,a){var s=.5*(r-e),c=.5*(i-t);return(2*(t-r)+s+c)*a+(-3*(t-r)-2*s-c)*o+s*n+t};return function(i){if(this.isPlaying!==!1){this.currentTime+=i*this.timeScale;var o,a=["pos","rot","scl"],s=this.data.length;if(this.loop===!0&&this.currentTime>s)this.currentTime%=s,this.reset();else if(this.loop===!1&&this.currentTime>s)return void this.stop();this.currentTime=Math.min(this.currentTime,s);for(var c=0,l=this.hierarchy.length;c<l;c++)for(var h=this.hierarchy[c],u=h.animationCache,f=0;f<3;f++){var p=a[f],d=u.prevKey[p],m=u.nextKey[p];if(m.time<=this.currentTime){for(d=this.data.hierarchy[c].keys[0],m=this.getNextKeyWith(p,c,1);m.time<this.currentTime&&m.index>d.index;)d=m,m=this.getNextKeyWith(p,c,m.index+1);u.prevKey[p]=d,u.nextKey[p]=m}h.matrixAutoUpdate=!0,h.matrixWorldNeedsUpdate=!0;var v=(this.currentTime-d.time)/(m.time-d.time),g=d[p],y=m[p];if(v<0&&(v=0),v>1&&(v=1),"pos"===p){if(o=h.position,this.interpolationType===n.AnimationHandler.LINEAR)o.x=g[0]+(y[0]-g[0])*v,o.y=g[1]+(y[1]-g[1])*v,o.z=g[2]+(y[2]-g[2])*v;else if(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",c,d.index-1).pos,e[1]=g,e[2]=y,e[3]=this.getNextKeyWith("pos",c,m.index+1).pos,v=.33*v+.33;var x=r(e,v);if(o.x=x[0],o.y=x[1],o.z=x[2],this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){var _=r(e,1.01*v);t.set(_[0],_[1],_[2]),t.sub(o),t.y=0,t.normalize();var b=Math.atan2(t.x,t.z);h.rotation.set(0,b,0)}}}else"rot"===p?n.Quaternion.slerp(g,y,h.quaternion,v):"scl"===p&&(o=h.scale,o.x=g[0]+(y[0]-g[0])*v,o.y=g[1]+(y[1]-g[1])*v,o.z=g[2]+(y[2]-g[2])*v)}}}}(),n.Animation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD?r=r<i.length-1?r:i.length-1:r%=i.length;r<i.length;r++)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[0]},n.Animation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+i.length;r>=0;r--)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[i.length-1]},n.KeyFrameAnimation=function(e,t){this.root=e,this.data=n.AnimationHandler.get(t),this.hierarchy=n.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var r=0,i=this.hierarchy.length;r<i;r++){var o=this.data.hierarchy[r].keys,a=this.data.hierarchy[r].sids,s=this.hierarchy[r];if(o.length&&a){for(var c=0;c<a.length;c++){var l=a[c],h=this.getNextKeyWith(l,r,0);h&&h.apply(l)}s.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},n.KeyFrameAnimation.prototype.play=function(e){if(this.currentTime=void 0!==e?e:0,this.isPlaying===!1){this.isPlaying=!0;var t,r,i,o=this.hierarchy.length;for(t=0;t<o;t++){r=this.hierarchy[t],i=this.data.hierarchy[t],void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey=null,i.animationCache.nextKey=null,i.animationCache.originalMatrix=r instanceof n.Bone?r.skinMatrix:r.matrix);var a=this.data.hierarchy[t].keys;a.length&&(i.animationCache.prevKey=a[0],i.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,n.AnimationHandler.addToUpdate(this)},n.KeyFrameAnimation.prototype.pause=function(){this.isPaused?n.AnimationHandler.addToUpdate(this):n.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},n.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,n.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;t instanceof n.Bone?(i.copy(t.skinMatrix),t.skinMatrix=i):(i.copy(t.matrix),t.matrix=i),delete r.animationCache}}},n.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying!==!1){this.currentTime+=e*this.timeScale;var t=this.data.length;this.loop===!0&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var r=0,i=this.hierarchy.length;r<i;r++){var n=this.hierarchy[r],o=this.data.hierarchy[r],a=o.keys,s=o.animationCache;if(a.length){var c=s.prevKey,l=s.nextKey;if(l.time<=this.currentTime){for(;l.time<this.currentTime&&l.index>c.index;)c=l,l=a[c.index+1];s.prevKey=c,s.nextKey=l}l.time>=this.currentTime?c.interpolate(l,this.currentTime):c.interpolate(l,l.time),this.data.hierarchy[r].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},n.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r%=i.length;r<i.length;r++)if(i[r].hasTarget(e))return i[r];return i[0]},n.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=r>=0?r:r+i.length;r>=0;r--)if(i[r].hasTarget(e))return i[r];return i[i.length-1]},n.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},n.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var e=0,t=0;return function(r){if(this.isPlaying!==!1){this.currentTime+=r,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var i=this.duration/this.frames,n=Math.floor(this.currentTime/i);n!=t&&(this.mesh.morphTargetInfluences[e]=0,this.mesh.morphTargetInfluences[t]=1,this.mesh.morphTargetInfluences[n]=0,e=t,t=n),this.mesh.morphTargetInfluences[n]=this.currentTime%i/i,this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[n]}}}()},n.CubeCamera=function(e,t,r){n.Object3D.call(this),this.className="CubeCamera";var i=90,o=1,a=new n.PerspectiveCamera(i,o,e,t);a.up.set(0,-1,0),a.lookAt(new n.Vector3(1,0,0)),this.add(a);var s=new n.PerspectiveCamera(i,o,e,t);s.up.set(0,-1,0),s.lookAt(new n.Vector3((-1),0,0)),this.add(s);var c=new n.PerspectiveCamera(i,o,e,t);c.up.set(0,0,1),c.lookAt(new n.Vector3(0,1,0)),this.add(c);var l=new n.PerspectiveCamera(i,o,e,t);l.up.set(0,0,-1),l.lookAt(new n.Vector3(0,(-1),0)),this.add(l);var h=new n.PerspectiveCamera(i,o,e,t);h.up.set(0,-1,0),h.lookAt(new n.Vector3(0,0,1)),this.add(h);var u=new n.PerspectiveCamera(i,o,e,t);u.up.set(0,-1,0),u.lookAt(new n.Vector3(0,0,(-1))),this.add(u),this.renderTarget=new n.WebGLRenderTargetCube(r,r,{format:n.RGBFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,i=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,a,r),r.activeCubeFace=1,e.render(t,s,r),r.activeCubeFace=2,e.render(t,c,r),r.activeCubeFace=3,e.render(t,l,r),r.activeCubeFace=4,e.render(t,h,r),r.generateMipmaps=i,r.activeCubeFace=5,e.render(t,u,r)}},n.CubeCamera.prototype=Object.create(n.Object3D.prototype),n.CombinedCamera=function(e,t,r,i,o,a,s){n.Camera.call(this),this.className="CombinedCamera",this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new n.OrthographicCamera(e/-2,e/2,t/2,t/-2,a,s),this.cameraP=new n.PerspectiveCamera(r,e/t,i,o),this.zoom=1,this.toPerspective()},n.CombinedCamera.prototype=Object.create(n.Camera.prototype),n.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},n.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,r=this.cameraP.near,i=this.cameraP.far,n=(r+i)/2,o=Math.tan(e/2)*n,a=2*o,s=a*t,c=s/2;o/=this.zoom,c/=this.zoom,this.cameraO.left=-c,this.cameraO.right=c,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},n.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},n.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},n.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},n.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*n.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},n.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},n.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},n.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},n.BoxGeometry=function(e,t,r,i,o,a){function s(e,t,r,i,o,a,s,l){var h,u,f,p=c.widthSegments,d=c.heightSegments,m=o/2,v=a/2,g=c.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",d=c.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",p=c.depthSegments);var y=p+1,x=d+1,_=o/p,b=a/d,w=new n.Vector3;for(w[h]=s>0?1:-1,f=0;f<x;f++)for(u=0;u<y;u++){var M=new n.Vector3;M[e]=(u*_-m)*r,M[t]=(f*b-v)*i,M[h]=s,c.vertices.push(M)}for(f=0;f<d;f++)for(u=0;u<p;u++){var S=u+y*f,A=u+y*(f+1),C=u+1+y*(f+1),T=u+1+y*f,E=new n.Vector2(u/p,1-f/d),L=new n.Vector2(u/p,1-(f+1)/d),P=new n.Vector2((u+1)/p,1-(f+1)/d),R=new n.Vector2((u+1)/p,1-f/d),D=new n.Face3(S+g,A+g,T+g);D.normal.copy(w),D.vertexNormals.push(w.clone(),w.clone(),w.clone()),D.materialIndex=l,c.faces.push(D),c.faceVertexUvs[0].push([E,L,R]),D=new n.Face3(A+g,C+g,T+g),D.normal.copy(w),D.vertexNormals.push(w.clone(),w.clone(),w.clone()),D.materialIndex=l,c.faces.push(D),c.faceVertexUvs[0].push([L.clone(),P,R.clone()])}}n.Geometry.call(this),this.className="BoxGeometry";var c=this;this.width=e,this.height=t,this.depth=r,this.widthSegments=i||1,this.heightSegments=o||1,this.depthSegments=a||1;var l=this.width/2,h=this.height/2,u=this.depth/2;s("z","y",-1,-1,this.depth,this.height,l,0),s("z","y",1,-1,this.depth,this.height,-l,1),s("x","z",1,1,this.width,this.depth,h,2),s("x","z",1,-1,this.width,this.depth,-h,3),s("x","y",1,-1,this.width,this.height,u,4),s("x","y",-1,-1,this.width,this.height,-u,5),this.computeCentroids(),this.mergeVertices()},n.BoxGeometry.prototype=Object.create(n.Geometry.prototype),n.CircleGeometry=function(e,t,r,i){n.Geometry.call(this),this.className="CircleGeometry",this.radius=e=e||50,this.segments=t=void 0!==t?Math.max(3,t):8,this.thetaStart=r=void 0!==r?r:0,this.thetaLength=i=void 0!==i?i:2*Math.PI;var o,a=[],s=new n.Vector3,c=new n.Vector2(.5,.5);for(this.vertices.push(s),a.push(c),o=0;o<=t;o++){var l=new n.Vector3,h=r+o/t*i;l.x=e*Math.cos(h),l.y=e*Math.sin(h),this.vertices.push(l),a.push(new n.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var u=new n.Vector3(0,0,1);for(o=1;o<=t;o++){var f=o,p=o+1,d=0;this.faces.push(new n.Face3(f,p,d,[u.clone(),u.clone(),u.clone()])),this.faceVertexUvs[0].push([a[o].clone(),a[o+1].clone(),c.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.CircleGeometry.prototype=Object.create(n.Geometry.prototype),n.CubeGeometry=n.BoxGeometry,n.CylinderGeometry=function(e,t,r,i,o,a){n.Geometry.call(this),this.className="CylinderGeometry",this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=r=void 0!==r?r:100,this.radialSegments=i=i||8,this.heightSegments=o=o||1,this.openEnded=a=void 0!==a&&a;var s,c,l=r/2,h=[],u=[];for(c=0;c<=o;c++){var f=[],p=[],d=c/o,m=d*(t-e)+e;for(s=0;s<=i;s++){var v=s/i,g=new n.Vector3;g.x=m*Math.sin(v*Math.PI*2),g.y=-d*r+l,g.z=m*Math.cos(v*Math.PI*2),this.vertices.push(g),f.push(this.vertices.length-1),p.push(new n.Vector2(v,1-d))}h.push(f),u.push(p)}var y,x,_=(t-e)/r;for(s=0;s<i;s++)for(0!==e?(y=this.vertices[h[0][s]].clone(),x=this.vertices[h[0][s+1]].clone()):(y=this.vertices[h[1][s]].clone(),x=this.vertices[h[1][s+1]].clone()),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*_).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*_).normalize(),c=0;c<o;c++){var b=h[c][s],w=h[c+1][s],M=h[c+1][s+1],S=h[c][s+1],A=y.clone(),C=y.clone(),T=x.clone(),E=x.clone(),L=u[c][s].clone(),P=u[c+1][s].clone(),R=u[c+1][s+1].clone(),D=u[c][s+1].clone();this.faces.push(new n.Face3(b,w,S,[A,C,E])),this.faceVertexUvs[0].push([L,P,D]),this.faces.push(new n.Face3(w,M,S,[C.clone(),T,E.clone()])),this.faceVertexUvs[0].push([P.clone(),R,D.clone()])}if(a===!1&&e>0)for(this.vertices.push(new n.Vector3(0,l,0)),s=0;s<i;s++){var b=h[0][s],w=h[0][s+1],M=this.vertices.length-1,A=new n.Vector3(0,1,0),C=new n.Vector3(0,1,0),T=new n.Vector3(0,1,0),L=u[0][s].clone(),P=u[0][s+1].clone(),R=new n.Vector2(P.x,0);this.faces.push(new n.Face3(b,w,M,[A,C,T])),this.faceVertexUvs[0].push([L,P,R])}if(a===!1&&t>0)for(this.vertices.push(new n.Vector3(0,(-l),0)),s=0;s<i;s++){var b=h[c][s+1],w=h[c][s],M=this.vertices.length-1,A=new n.Vector3(0,(-1),0),C=new n.Vector3(0,(-1),0),T=new n.Vector3(0,(-1),0),L=u[c][s+1].clone(),P=u[c][s].clone(),R=new n.Vector2(P.x,1);this.faces.push(new n.Face3(b,w,M,[A,C,T])),this.faceVertexUvs[0].push([L,P,R])}this.computeCentroids(),this.computeFaceNormals()},n.CylinderGeometry.prototype=Object.create(n.Geometry.prototype),n.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(n.Geometry.call(this),this.className="ExtrudeGeometry",e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),void this.computeFaceNormals())},n.ExtrudeGeometry.prototype=Object.create(n.Geometry.prototype),n.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;i<r;i++){var n=e[i];this.addShape(n,t)}},n.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t?t.clone().multiplyScalar(r).add(e):n.onerror("die, vec not specified")}function i(e,t,r){var i,o,a=1e-10,s=n.Math.sign,c=1,l=e.x-t.x,h=e.y-t.y,u=r.x-e.x,f=r.y-e.y,p=l*l+h*h,d=l*f-h*u;if(Math.abs(d)>a){var m=Math.sqrt(p),v=Math.sqrt(u*u+f*f),g=t.x-h/m,y=t.y+l/m,x=r.x-f/v,_=r.y+u/v,b=((x-g)*f-(_-y)*u)/(l*f-h*u);i=g+l*b-e.x,o=y+h*b-e.y;var w=i*i+o*o;if(w<=2)return new n.Vector2(i,o);c=Math.sqrt(w/2)}else{var M=!1;l>a?u>a&&(M=!0):l<-a?u<-a&&(M=!0):s(h)==s(f)&&(M=!0),M?(i=-h,o=l,c=Math.sqrt(p)):(i=l,o=h,c=Math.sqrt(p/2))}return new n.Vector2(i/c,o/c)}function o(){if(_){var e=0,t=W*e;for(Y=0;Y<X;Y++)H=O[Y],l(H[2]+t,H[1]+t,H[0]+t,!0);for(e=w+2*x,t=W*e,Y=0;Y<X;Y++)H=O[Y],l(H[0]+t,H[1]+t,H[2]+t,!1)}else{for(Y=0;Y<X;Y++)H=O[Y],l(H[2],H[1],H[0],!0);for(Y=0;Y<X;Y++)H=O[Y],l(H[0]+W*w,H[1]+W*w,H[2]+W*w,!1)}}function a(){var e=0;for(s(k,e),e+=k.length,L=0,P=U.length;L<P;L++)E=U[L],s(E,e),e+=E.length}function s(e,t){var r,i;for(Y=e.length;--Y>=0;){r=Y,i=Y-1,i<0&&(i=e.length-1);var n=0,o=w+2*x;for(n=0;n<o;n++){var a=W*n,s=W*(n+1),c=t+r+a,l=t+i+a,u=t+i+s,f=t+r+s;h(c,l,u,f,e,n,o,r,i)}}}function c(e,t,r){R.vertices.push(new n.Vector3(e,t,r))}function l(r,i,o,a){r+=D,i+=D,o+=D,R.faces.push(new n.Face3(r,i,o,null,null,A));var s=a?T.generateBottomUV(R,e,t,r,i,o):T.generateTopUV(R,e,t,r,i,o);R.faceVertexUvs[0].push(s)}function h(r,i,o,a,s,c,l,h,u){r+=D,i+=D,o+=D,a+=D,R.faces.push(new n.Face3(r,i,a,null,null,C)),R.faces.push(new n.Face3(i,o,a,null,null,C));var f=T.generateSideWallUV(R,e,s,t,r,i,o,a,c,l,h,u);R.faceVertexUvs[0].push([f[0],f[1],f[3]]),R.faceVertexUvs[0].push([f[1],f[2],f[3]])}var u,f,p,d,m,v=void 0!==t.amount?t.amount:100,g=void 0!==t.bevelThickness?t.bevelThickness:6,y=void 0!==t.bevelSize?t.bevelSize:g-2,x=void 0!==t.bevelSegments?t.bevelSegments:3,_=void 0===t.bevelEnabled||t.bevelEnabled,b=void 0!==t.curveSegments?t.curveSegments:12,w=void 0!==t.steps?t.steps:1,M=t.extrudePath,S=!1,A=t.material,C=t.extrudeMaterial,T=void 0!==t.UVGenerator?t.UVGenerator:n.ExtrudeGeometry.WorldUVGenerator;this.shapebb;M&&(u=M.getSpacedPoints(w),S=!0,_=!1,f=void 0!==t.frames?t.frames:new n.TubeGeometry.FrenetFrames(M,w,(!1)),p=new n.Vector3,d=new n.Vector3,m=new n.Vector3),_||(x=0,g=0,y=0);var E,L,P,R=this,D=this.vertices.length,V=e.extractPoints(b),F=V.shape,U=V.holes,N=!n.Shape.Utils.isClockWise(F);if(N){for(F=F.reverse(),L=0,P=U.length;L<P;L++)E=U[L],n.Shape.Utils.isClockWise(E)&&(U[L]=E.reverse());N=!1}var O=n.Shape.Utils.triangulateShape(F,U),k=F;for(L=0,P=U.length;L<P;L++)E=U[L],F=F.concat(E);for(var B,z,I,G,j,H,W=F.length,X=O.length,q=(k.length,180/Math.PI,[]),Y=0,K=k.length,Q=K-1,Z=Y+1;Y<K;Y++,Q++,Z++){Q===K&&(Q=0),Z===K&&(Z=0);k[Y],k[Q],k[Z];q[Y]=i(k[Y],k[Q],k[Z])}var J,$=[],ee=q.concat();for(L=0,P=U.length;L<P;L++){for(E=U[L],J=[],Y=0,K=E.length,Q=K-1,Z=Y+1;Y<K;Y++,Q++,Z++)Q===K&&(Q=0),Z===K&&(Z=0),J[Y]=i(E[Y],E[Q],E[Z]);$.push(J),ee=ee.concat(J)}for(B=0;B<x;B++){for(I=B/x,G=g*(1-I),z=y*Math.sin(I*Math.PI/2),Y=0,K=k.length;Y<K;Y++)j=r(k[Y],q[Y],z),c(j.x,j.y,-G);for(L=0,P=U.length;L<P;L++)for(E=U[L],J=$[L],Y=0,K=E.length;Y<K;Y++)j=r(E[Y],J[Y],z),c(j.x,j.y,-G)}for(z=y,Y=0;Y<W;Y++)j=_?r(F[Y],ee[Y],z):F[Y],S?(d.copy(f.normals[0]).multiplyScalar(j.x),p.copy(f.binormals[0]).multiplyScalar(j.y),m.copy(u[0]).add(d).add(p),c(m.x,m.y,m.z)):c(j.x,j.y,0);var te;for(te=1;te<=w;te++)for(Y=0;Y<W;Y++)j=_?r(F[Y],ee[Y],z):F[Y],S?(d.copy(f.normals[te]).multiplyScalar(j.x),p.copy(f.binormals[te]).multiplyScalar(j.y),m.copy(u[te]).add(d).add(p),c(m.x,m.y,m.z)):c(j.x,j.y,v/w*te);for(B=x-1;B>=0;B--){for(I=B/x,G=g*(1-I),z=y*Math.sin(I*Math.PI/2),Y=0,K=k.length;Y<K;Y++)j=r(k[Y],q[Y],z),c(j.x,j.y,v+G);for(L=0,P=U.length;L<P;L++)for(E=U[L],J=$[L],Y=0,K=E.length;Y<K;Y++)j=r(E[Y],J[Y],z),S?c(j.x,j.y+u[w-1].y,u[w-1].x+G):c(j.x,j.y,v+G)}o(),a()},n.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i,o,a){var s=e.vertices[i].x,c=e.vertices[i].y,l=e.vertices[o].x,h=e.vertices[o].y,u=e.vertices[a].x,f=e.vertices[a].y;return[new n.Vector2(s,c),new n.Vector2(l,h),new n.Vector2(u,f)]},generateBottomUV:function(e,t,r,i,n,o){return this.generateTopUV(e,t,r,i,n,o)},generateSideWallUV:function(e,t,r,i,o,a,s,c,l,h,u,f){var p=e.vertices[o].x,d=e.vertices[o].y,m=e.vertices[o].z,v=e.vertices[a].x,g=e.vertices[a].y,y=e.vertices[a].z,x=e.vertices[s].x,_=e.vertices[s].y,b=e.vertices[s].z,w=e.vertices[c].x,M=e.vertices[c].y,S=e.vertices[c].z;return Math.abs(d-g)<.01?[new n.Vector2(p,1-m),new n.Vector2(v,1-y),new n.Vector2(x,1-b),new n.Vector2(w,1-S)]:[new n.Vector2(d,1-m),new n.Vector2(g,1-y),new n.Vector2(_,1-b),new n.Vector2(M,1-S)]}},n.ExtrudeGeometry.__v1=new n.Vector2,n.ExtrudeGeometry.__v2=new n.Vector2,n.ExtrudeGeometry.__v3=new n.Vector2,n.ExtrudeGeometry.__v4=new n.Vector2,n.ExtrudeGeometry.__v5=new n.Vector2,n.ExtrudeGeometry.__v6=new n.Vector2,n.ShapeGeometry=function(e,t){n.Geometry.call(this),this.className="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},n.ShapeGeometry.prototype=Object.create(n.Geometry.prototype),n.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++)this.addShape(e[r],t);return this},n.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,o,a=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,c=void 0===t.UVGenerator?n.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=(this.shapebb,this.vertices.length),h=e.extractPoints(a),u=h.shape,f=h.holes,p=!n.Shape.Utils.isClockWise(u);if(p){for(u=u.reverse(),r=0,i=f.length;r<i;r++)o=f[r],
n.Shape.Utils.isClockWise(o)&&(f[r]=o.reverse());p=!1}var d=n.Shape.Utils.triangulateShape(u,f),m=u;for(r=0,i=f.length;r<i;r++)o=f[r],u=u.concat(o);var v,g,y=u.length,x=d.length;m.length;for(r=0;r<y;r++)v=u[r],this.vertices.push(new n.Vector3(v.x,v.y,0));for(r=0;r<x;r++){g=d[r];var _=g[0]+l,b=g[1]+l,w=g[2]+l;this.faces.push(new n.Face3(_,b,w,null,null,s)),this.faceVertexUvs[0].push(c.generateBottomUV(this,e,t,_,b,w))}},n.LatheGeometry=function(e,t,r,i){n.Geometry.call(this),this.className="LatheGeometry",t=t||12,r=r||0,i=i||2*Math.PI;for(var o=1/(e.length-1),a=1/t,s=0,c=t;s<=c;s++)for(var l=r+s*a*i,h=Math.cos(l),u=Math.sin(l),f=0,p=e.length;f<p;f++){var d=e[f],m=new n.Vector3;m.x=h*d.x-u*d.y,m.y=u*d.x+h*d.y,m.z=d.z,this.vertices.push(m)}for(var v=e.length,s=0,c=t;s<c;s++)for(var f=0,p=e.length-1;f<p;f++){var g=f+v*s,y=g,x=g+v,h=g+1+v,_=g+1,b=s*a,w=f*o,M=b+a,S=w+o;this.faces.push(new n.Face3(y,x,_)),this.faceVertexUvs[0].push([new n.Vector2(b,w),new n.Vector2(M,w),new n.Vector2(b,S)]),this.faces.push(new n.Face3(x,h,_)),this.faceVertexUvs[0].push([new n.Vector2(M,w),new n.Vector2(M,S),new n.Vector2(b,S)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.LatheGeometry.prototype=Object.create(n.Geometry.prototype),n.PlaneGeometry=function(e,t,r,i){n.Geometry.call(this),this.className="PlaneGeometry",this.width=e,this.height=t,this.widthSegments=r||1,this.heightSegments=i||1;var o,a,s=e/2,c=t/2,l=this.widthSegments,h=this.heightSegments,u=l+1,f=h+1,p=this.width/l,d=this.height/h,m=new n.Vector3(0,0,1);for(a=0;a<f;a++)for(o=0;o<u;o++){var v=o*p-s,g=a*d-c;this.vertices.push(new n.Vector3(v,(-g),0))}for(a=0;a<h;a++)for(o=0;o<l;o++){var y=o+u*a,x=o+u*(a+1),_=o+1+u*(a+1),b=o+1+u*a,w=new n.Vector2(o/l,1-a/h),M=new n.Vector2(o/l,1-(a+1)/h),S=new n.Vector2((o+1)/l,1-(a+1)/h),A=new n.Vector2((o+1)/l,1-a/h),C=new n.Face3(y,x,b);C.normal.copy(m),C.vertexNormals.push(m.clone(),m.clone(),m.clone()),this.faces.push(C),this.faceVertexUvs[0].push([w,M,A]),C=new n.Face3(x,_,b),C.normal.copy(m),C.vertexNormals.push(m.clone(),m.clone(),m.clone()),this.faces.push(C),this.faceVertexUvs[0].push([M.clone(),S,A.clone()])}this.computeCentroids()},n.PlaneGeometry.prototype=Object.create(n.Geometry.prototype),n.RingGeometry=function(e,t,r,i,o,a){n.Geometry.call(this),this.className="RingGeometry",e=e||0,t=t||50,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(3,i):8;var s,c,l=[],h=e,u=(t-e)/i;for(s=0;s<=i;s++){for(c=0;c<=r;c++){var f=new n.Vector3,p=o+c/r*a;f.x=h*Math.cos(p),f.y=h*Math.sin(p),this.vertices.push(f),l.push(new n.Vector2((f.x/t+1)/2,(f.y/t+1)/2))}h+=u}var d=new n.Vector3(0,0,1);for(s=0;s<i;s++){var m=s*r;for(c=0;c<=r;c++){var p=c+m,v=p+s,g=p+r+s,y=p+r+1+s;this.faces.push(new n.Face3(v,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()]),v=p+s,g=p+r+1+s,y=p+1+s,this.faces.push(new n.Face3(v,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,h)},n.RingGeometry.prototype=Object.create(n.Geometry.prototype),n.SphereGeometry=function(e,t,r,i,o,a,s){n.Geometry.call(this),this.className="SphereGeometry",this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=r=Math.max(2,Math.floor(r)||6),this.phiStart=i=void 0!==i?i:0,this.phiLength=o=void 0!==o?o:2*Math.PI,this.thetaStart=a=void 0!==a?a:0,this.thetaLength=s=void 0!==s?s:Math.PI;var c,l,h=[],u=[];for(l=0;l<=r;l++){var f=[],p=[];for(c=0;c<=t;c++){var d=c/t,m=l/r,v=new n.Vector3;v.x=-e*Math.cos(i+d*o)*Math.sin(a+m*s),v.y=e*Math.cos(a+m*s),v.z=e*Math.sin(i+d*o)*Math.sin(a+m*s),this.vertices.push(v),f.push(this.vertices.length-1),p.push(new n.Vector2(d,1-m))}h.push(f),u.push(p)}for(l=0;l<this.heightSegments;l++)for(c=0;c<this.widthSegments;c++){var g=h[l][c+1],y=h[l][c],x=h[l+1][c],_=h[l+1][c+1],b=this.vertices[g].clone().normalize(),w=this.vertices[y].clone().normalize(),M=this.vertices[x].clone().normalize(),S=this.vertices[_].clone().normalize(),A=u[l][c+1].clone(),C=u[l][c].clone(),T=u[l+1][c].clone(),E=u[l+1][c+1].clone();Math.abs(this.vertices[g].y)===this.radius?(A.x=(A.x+C.x)/2,this.faces.push(new n.Face3(g,x,_,[b,M,S])),this.faceVertexUvs[0].push([A,T,E])):Math.abs(this.vertices[x].y)===this.radius?(T.x=(T.x+E.x)/2,this.faces.push(new n.Face3(g,y,x,[b,w,M])),this.faceVertexUvs[0].push([A,C,T])):(this.faces.push(new n.Face3(g,y,_,[b,w,S])),this.faceVertexUvs[0].push([A,C,E]),this.faces.push(new n.Face3(y,x,_,[w.clone(),M,S.clone()])),this.faceVertexUvs[0].push([C.clone(),T,E.clone()]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.SphereGeometry.prototype=Object.create(n.Geometry.prototype),n.TextGeometry=function(e,t){this.className="TextGeometry",t=t||{};var r=n.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),n.ExtrudeGeometry.call(this,r,t)},n.TextGeometry.prototype=Object.create(n.ExtrudeGeometry.prototype),n.TorusGeometry=function(e,t,r,i,o){n.Geometry.call(this),this.className="TorusGeometry";this.radius=e||100,this.tube=t||40,this.radialSegments=r||8,this.tubularSegments=i||6,this.arc=o||2*Math.PI;for(var a=new n.Vector3,s=[],c=[],l=0;l<=this.radialSegments;l++)for(var h=0;h<=this.tubularSegments;h++){var u=h/this.tubularSegments*this.arc,f=l/this.radialSegments*Math.PI*2;a.x=this.radius*Math.cos(u),a.y=this.radius*Math.sin(u);var p=new n.Vector3;p.x=(this.radius+this.tube*Math.cos(f))*Math.cos(u),p.y=(this.radius+this.tube*Math.cos(f))*Math.sin(u),p.z=this.tube*Math.sin(f),this.vertices.push(p),s.push(new n.Vector2(h/this.tubularSegments,l/this.radialSegments)),c.push(p.clone().sub(a).normalize())}for(var l=1;l<=this.radialSegments;l++)for(var h=1;h<=this.tubularSegments;h++){var d=(this.tubularSegments+1)*l+h-1,m=(this.tubularSegments+1)*(l-1)+h-1,v=(this.tubularSegments+1)*(l-1)+h,g=(this.tubularSegments+1)*l+h,y=new n.Face3(d,m,g,[c[d].clone(),c[m].clone(),c[g].clone()]);this.faces.push(y),this.faceVertexUvs[0].push([s[d].clone(),s[m].clone(),s[g].clone()]),y=new n.Face3(m,v,g,[c[m].clone(),c[v].clone(),c[g].clone()]),this.faces.push(y),this.faceVertexUvs[0].push([s[m].clone(),s[v].clone(),s[g].clone()])}this.computeCentroids(),this.computeFaceNormals()},n.TorusGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusKnotGeometry=function(e,t,r,i,o,a,s){function c(e,t,r,i,o){var a=Math.cos(e),s=Math.sin(e),c=t/r*e,l=Math.cos(c),h=i*(2+l)*.5*a,u=i*(2+l)*s*.5,f=o*i*Math.sin(c)*.5;return new n.Vector3(h,u,f)}n.Geometry.call(this),this.className="TorusKnotGeometry";var l=this;this.radius=e||100,this.tube=t||40,this.radialSegments=r||64,this.tubularSegments=i||8,this.p=o||2,this.q=a||3,this.heightScale=s||1,this.grid=new Array(this.radialSegments);for(var h=new n.Vector3,u=new n.Vector3,f=new n.Vector3,p=0;p<this.radialSegments;++p){this.grid[p]=new Array(this.tubularSegments);var d=p/this.radialSegments*2*this.p*Math.PI,m=c(d,this.q,this.p,this.radius,this.heightScale),v=c(d+.01,this.q,this.p,this.radius,this.heightScale);h.subVectors(v,m),u.addVectors(v,m),f.crossVectors(h,u),u.crossVectors(f,h),f.normalize(),u.normalize();for(var g=0;g<this.tubularSegments;++g){var y=g/this.tubularSegments*2*Math.PI,x=-this.tube*Math.cos(y),_=this.tube*Math.sin(y),b=new n.Vector3;b.x=m.x+x*u.x+_*f.x,b.y=m.y+x*u.y+_*f.y,b.z=m.z+x*u.z+_*f.z,this.grid[p][g]=l.vertices.push(b)-1}}for(var p=0;p<this.radialSegments;++p)for(var g=0;g<this.tubularSegments;++g){var w=(p+1)%this.radialSegments,M=(g+1)%this.tubularSegments,S=this.grid[p][g],A=this.grid[w][g],C=this.grid[w][M],T=this.grid[p][M],E=new n.Vector2(p/this.radialSegments,g/this.tubularSegments),L=new n.Vector2((p+1)/this.radialSegments,g/this.tubularSegments),P=new n.Vector2((p+1)/this.radialSegments,(g+1)/this.tubularSegments),R=new n.Vector2(p/this.radialSegments,(g+1)/this.tubularSegments);this.faces.push(new n.Face3(S,A,T)),this.faceVertexUvs[0].push([E,L,R]),this.faces.push(new n.Face3(A,C,T)),this.faceVertexUvs[0].push([L.clone(),P,R.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.TorusKnotGeometry.prototype=Object.create(n.Geometry.prototype),n.TubeGeometry=function(e,t,r,i,o){function a(e,t,r){return T.vertices.push(new n.Vector3(e,t,r))-1}n.Geometry.call(this),this.className="TubeGeometry",this.path=e,this.segments=t||64,this.radius=r||1,this.radialSegments=i||8,this.closed=o||!1,this.grid=[];var s,c,l,h,u,f,p,d,m,v,g,y,x,_,b,w,M,S,A,C,T=this,E=this.segments+1,L=new n.Vector3,P=new n.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),R=P.tangents,D=P.normals,V=P.binormals;for(this.tangents=R,this.normals=D,this.binormals=V,m=0;m<E;m++)for(this.grid[m]=[],h=m/(E-1),d=e.getPointAt(h),s=R[m],c=D[m],l=V[m],v=0;v<this.radialSegments;v++)u=v/this.radialSegments*2*Math.PI,f=-this.radius*Math.cos(u),p=this.radius*Math.sin(u),L.copy(d),L.x+=f*c.x+p*l.x,L.y+=f*c.y+p*l.y,L.z+=f*c.z+p*l.z,this.grid[m][v]=a(L.x,L.y,L.z);for(m=0;m<this.segments;m++)for(v=0;v<this.radialSegments;v++)g=this.closed?(m+1)%this.segments:m+1,y=(v+1)%this.radialSegments,x=this.grid[m][v],_=this.grid[g][v],b=this.grid[g][y],w=this.grid[m][y],M=new n.Vector2(m/this.segments,v/this.radialSegments),S=new n.Vector2((m+1)/this.segments,v/this.radialSegments),A=new n.Vector2((m+1)/this.segments,(v+1)/this.radialSegments),C=new n.Vector2(m/this.segments,(v+1)/this.radialSegments),this.faces.push(new n.Face3(x,_,w)),this.faceVertexUvs[0].push([M,S,C]),this.faces.push(new n.Face3(_,b,w)),this.faceVertexUvs[0].push([S.clone(),A,C.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.TubeGeometry.prototype=Object.create(n.Geometry.prototype),n.TubeGeometry.FrenetFrames=function(e,t,r){function i(){d[0]=new n.Vector3,m[0]=new n.Vector3,a=Number.MAX_VALUE,s=Math.abs(p[0].x),c=Math.abs(p[0].y),l=Math.abs(p[0].z),s<=a&&(a=s,f.set(1,0,0)),c<=a&&(a=c,f.set(0,1,0)),l<=a&&f.set(0,0,1),v.crossVectors(p[0],f).normalize(),d[0].crossVectors(p[0],v),m[0].crossVectors(p[0],d[0])}var o,a,s,c,l,h,u,f=(new n.Vector3,new n.Vector3),p=(new n.Vector3,[]),d=[],m=[],v=new n.Vector3,g=new n.Matrix4,y=t+1,x=1e-4;for(this.tangents=p,this.normals=d,this.binormals=m,h=0;h<y;h++)u=h/(y-1),p[h]=e.getTangentAt(u),p[h].normalize();for(i(),h=1;h<y;h++)d[h]=d[h-1].clone(),m[h]=m[h-1].clone(),v.crossVectors(p[h-1],p[h]),v.length()>x&&(v.normalize(),o=Math.acos(n.Math.clamp(p[h-1].dot(p[h]),-1,1)),d[h].applyMatrix4(g.makeRotationAxis(v,o))),m[h].crossVectors(p[h],d[h]);if(r)for(o=Math.acos(n.Math.clamp(d[0].dot(d[y-1]),-1,1)),o/=y-1,p[0].dot(v.crossVectors(d[0],d[y-1]))>0&&(o=-o),h=1;h<y;h++)d[h].applyMatrix4(g.makeRotationAxis(p[h],o*h)),m[h].crossVectors(p[h],d[h])},n.PolyhedronGeometry=function(e,t,r,i){function o(e){var t=e.normalize().clone();t.index=u.vertices.push(t)-1;var r=c(e)/2/Math.PI+.5,i=l(e)/Math.PI+.5;return t.uv=new n.Vector2(r,1-i),t}function a(e,t,r){var i=new n.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);i.centroid.add(e).add(t).add(r).divideScalar(3),u.faces.push(i);var o=c(i.centroid);u.faceVertexUvs[0].push([h(e.uv,e,o),h(t.uv,t,o),h(r.uv,r,o)])}function s(e,t){for(var r=Math.pow(2,t),i=(Math.pow(4,t),o(u.vertices[e.a])),n=o(u.vertices[e.b]),s=o(u.vertices[e.c]),c=[],l=0;l<=r;l++){c[l]=[];for(var h=o(i.clone().lerp(s,l/r)),f=o(n.clone().lerp(s,l/r)),p=r-l,d=0;d<=p;d++)0==d&&l==r?c[l][d]=h:c[l][d]=o(h.clone().lerp(f,d/p))}for(var l=0;l<r;l++)for(var d=0;d<2*(r-l)-1;d++){var m=Math.floor(d/2);d%2==0?a(c[l][m+1],c[l+1][m],c[l][m]):a(c[l][m+1],c[l+1][m+1],c[l+1][m])}}function c(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function h(e,t,r){return r<0&&1===e.x&&(e=new n.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new n.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}n.Geometry.call(this),this.className="PolyhedronGeometry",r=r||1,i=i||0;for(var u=this,f=0,p=e.length;f<p;f++)o(new n.Vector3(e[f][0],e[f][1],e[f][2]));for(var d=this.vertices,m=[],f=0,p=t.length;f<p;f++){var v=d[t[f][0]],g=d[t[f][1]],y=d[t[f][2]];m[f]=new n.Face3(v.index,g.index,y.index,[v.clone(),g.clone(),y.clone()])}for(var f=0,p=m.length;f<p;f++)s(m[f],i);for(var f=0,p=this.faceVertexUvs[0].length;f<p;f++){var x=this.faceVertexUvs[0][f],_=x[0].x,b=x[1].x,w=x[2].x,M=Math.max(_,Math.max(b,w)),S=Math.min(_,Math.min(b,w));M>.9&&S<.1&&(_<.2&&(x[0].x+=1),b<.2&&(x[1].x+=1),w<.2&&(x[2].x+=1))}for(var f=0,p=this.vertices.length;f<p;f++)this.vertices[f].multiplyScalar(r);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,r)},n.PolyhedronGeometry.prototype=Object.create(n.Geometry.prototype),n.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var r=(1+Math.sqrt(5))/2,i=[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]],o=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];n.PolyhedronGeometry.call(this,i,o,e,t),this.className="IcosahedronGeometry"},n.IcosahedronGeometry.prototype=Object.create(n.Geometry.prototype),n.OctahedronGeometry=function(e,t){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];n.PolyhedronGeometry.call(this,r,i,e,t),this.className="OctahedronGeometry"},n.OctahedronGeometry.prototype=Object.create(n.Geometry.prototype),n.TetrahedronGeometry=function(e,t){this.className="TetrahedronGeometry";var r=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],i=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];n.PolyhedronGeometry.call(this,r,i,e,t)},n.TetrahedronGeometry.prototype=Object.create(n.Geometry.prototype),n.ParametricGeometry=function(e,t,r){n.Geometry.call(this),this.className="ParametricGeometry";var i,o,a,s,c,l=this.vertices,h=this.faces,u=this.faceVertexUvs[0],f=t+1;for(i=0;i<=r;i++)for(c=i/r,o=0;o<=t;o++)s=o/t,a=e(s,c),l.push(a);var p,d,m,v,g,y,x,_;for(i=0;i<r;i++)for(o=0;o<t;o++)p=i*f+o,d=i*f+o+1,m=(i+1)*f+o+1,v=(i+1)*f+o,g=new n.Vector2(o/t,i/r),y=new n.Vector2((o+1)/t,i/r),x=new n.Vector2((o+1)/t,(i+1)/r),_=new n.Vector2(o/t,(i+1)/r),h.push(new n.Face3(p,d,v)),u.push([g,y,_]),h.push(new n.Face3(d,m,v)),u.push([y.clone(),x,_.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},n.ParametricGeometry.prototype=Object.create(n.Geometry.prototype),n.AxisHelper=function(e){e=e||1;var t=new n.Geometry;t.vertices.push(new n.Vector3,new n.Vector3(e,0,0),new n.Vector3,new n.Vector3(0,e,0),new n.Vector3,new n.Vector3(0,0,e)),t.colors.push(new n.Color(16711680),new n.Color(16755200),new n.Color(65280),new n.Color(11206400),new n.Color(255),new n.Color(43775));var r=new n.LineBasicMaterial({vertexColors:n.VertexColors});n.Line.call(this,t,r,n.LinePieces),this.className="AxisHelper"},n.AxisHelper.prototype=Object.create(n.Line.prototype),n.ArrowHelper=function(e,t,r,i,o,a){n.Object3D.call(this),this.className="ArrowHelper",void 0===i&&(i=16776960),void 0===r&&(r=1),void 0===o&&(o=.2*r),void 0===a&&(a=.2*o),this.position=t;var s=new n.Geometry;s.vertices.push(new n.Vector3(0,0,0)),s.vertices.push(new n.Vector3(0,1,0)),this.line=new n.Line(s,new n.LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line);var c=new n.CylinderGeometry(0,.5,1,5,1);c.applyMatrix((new n.Matrix4).makeTranslation(0,-.5,0)),this.cone=new n.Mesh(c,new n.MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,a)},n.ArrowHelper.prototype=Object.create(n.Object3D.prototype),n.ArrowHelper.prototype.setDirection=function(){var e,t=new n.Vector3;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),n.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},n.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},n.BoxHelper=function(e){var t=[new n.Vector3(1,1,1),new n.Vector3((-1),1,1),new n.Vector3((-1),(-1),1),new n.Vector3(1,(-1),1),new n.Vector3(1,1,(-1)),new n.Vector3((-1),1,(-1)),new n.Vector3((-1),(-1),(-1)),new n.Vector3(1,(-1),(-1))];this.vertices=t;var r=new n.Geometry;r.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),n.Line.call(this,r,new n.LineBasicMaterial({color:16776960}),n.LinePieces),void 0!==e&&this.update(e)},n.BoxHelper.prototype=Object.create(n.Line.prototype),n.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,i=t.boundingBox.max,n=this.vertices;n[0].set(i.x,i.y,i.z),n[1].set(r.x,i.y,i.z),n[2].set(r.x,r.y,i.z),n[3].set(i.x,r.y,i.z),n[4].set(i.x,i.y,r.z),n[5].set(r.x,i.y,r.z),n[6].set(r.x,r.y,r.z),n[7].set(i.x,r.y,r.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},n.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new n.Box3,n.Mesh.call(this,new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial({color:r,wireframe:!0}))},n.BoundingBoxHelper.prototype=Object.create(n.Mesh.prototype),n.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},n.CameraHelper=function(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){i.vertices.push(new n.Vector3),i.colors.push(new n.Color(t)),void 0===a[e]&&(a[e]=[]),a[e].push(i.vertices.length-1)}var i=new n.Geometry,o=new n.LineBasicMaterial({color:16777215,vertexColors:n.FaceColors}),a={},s=16755200,c=16711680,l=43775,h=16777215,u=3355443;t("n1","n2",s),t("n2","n4",s),t("n4","n3",s),t("n3","n1",s),t("f1","f2",s),t("f2","f4",s),t("f4","f3",s),t("f3","f1",s),t("n1","f1",s),t("n2","f2",s),t("n3","f3",s),t("n4","f4",s),t("p","n1",c),t("p","n2",c),t("p","n3",c),t("p","n4",c),t("u1","u2",l),t("u2","u3",l),t("u3","u1",l),t("c","t",h),t("p","c",u),t("cn1","cn2",u),t("cn3","cn4",u),t("cf1","cf2",u),t("cf3","cf4",u),n.Line.call(this,i,o,n.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},n.CameraHelper.prototype=Object.create(n.Line.prototype),n.CameraHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Camera,r=new n.Projector;return function(){function i(i,o,a,s){e.set(o,a,s),r.unprojectVector(e,t);var c=n.pointMap[i];if(void 0!==c)for(var l=0,h=c.length;l<h;l++)n.geometry.vertices[c[l]].copy(e)}var n=this,o=1,a=1;t.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-o,-a,-1),i("n2",o,-a,-1),i("n3",-o,a,-1),i("n4",o,a,-1),i("f1",-o,-a,1),i("f2",o,-a,1),i("f3",-o,a,1),i("f4",o,a,1),i("u1",.7*o,1.1*a,-1),i("u2",.7*-o,1.1*a,-1),i("u3",0,2*a,-1),i("cf1",-o,0,1),i("cf2",o,0,1),i("cf3",0,-a,1),i("cf4",0,a,1),i("cn1",-o,0,-1),i("cn2",o,0,-1),i("cn3",0,-a,-1),i("cn4",0,a,-1),this.geometry.verticesNeedUpdate=!0}}(),n.DirectionalLightHelper=function(e,t){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new n.PlaneGeometry(t,t),i=new n.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new n.Mesh(r,i),this.add(this.lightPlane),r=new n.Geometry,r.vertices.push(new n.Vector3),r.vertices.push(new n.Vector3),i=new n.LineBasicMaterial({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new n.Line(r,i),this.add(this.targetLine),this.update()},n.DirectionalLightHelper.prototype=Object.create(n.Object3D.prototype),n.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},n.DirectionalLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),n.EdgesHelper=function(e,t){var r=void 0!==t?t:16777215,i=[0,0],o={},a=function(e,t){return e-t},s=["a","b","c"],c=new n.BufferGeometry,l=e.geometry.clone();l.mergeVertices(),l.computeFaceNormals();for(var h=l.vertices,u=l.faces,f=0,p=0,d=u.length;p<d;p++)for(var m=u[p],v=0;v<3;v++){i[0]=m[s[v]],i[1]=m[s[(v+1)%3]],i.sort(a);var g=i.toString();void 0===o[g]?(o[g]={vert1:i[0],vert2:i[1],face1:p,face2:void 0},f++):o[g].face2=p}c.addAttribute("position",Float32Array,2*f,3);var y=c.attributes.position.array,x=0;for(var g in o){var _=o[g];if(void 0===_.face2||u[_.face1].normal.dot(u[_.face2].normal)<.9999){var b=h[_.vert1];y[x++]=b.x,y[x++]=b.y,y[x++]=b.z,b=h[_.vert2],y[x++]=b.x,y[x++]=b.y,y[x++]=b.z}}n.Line.call(this,c,new n.LineBasicMaterial({color:r}),n.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},n.EdgesHelper.prototype=Object.create(n.Line.prototype),n.FaceNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:16776960,a=void 0!==i?i:1,s=new n.Geometry,c=this.object.geometry.faces,l=0,h=c.length;l<h;l++)s.vertices.push(new n.Vector3),s.vertices.push(new n.Vector3);n.Line.call(this,s,new n.LineBasicMaterial({color:o,linewidth:a}),n.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new n.Matrix3,this.update()},n.FaceNormalsHelper.prototype=Object.create(n.Line.prototype),n.FaceNormalsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,i=this.object.geometry.faces,n=this.object.matrixWorld,o=0,a=i.length;o<a;o++){var s=i[o];t.copy(s.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var c=2*o;r[c].copy(s.centroid).applyMatrix4(n),r[c+1].addVectors(r[c],t)}return this.geometry.verticesNeedUpdate=!0,this}}(),n.GridHelper=function(e,t){var r=new n.Geometry,i=new n.LineBasicMaterial({vertexColors:n.VertexColors});this.color1=new n.Color(4473924),this.color2=new n.Color(8947848);for(var o=-e;o<=e;o+=t){r.vertices.push(new n.Vector3((-e),0,o),new n.Vector3(e,0,o),new n.Vector3(o,0,(-e)),new n.Vector3(o,0,e));var a=0===o?this.color1:this.color2;r.colors.push(a,a,a,a)}n.Line.call(this,r,i,n.LinePieces)},n.GridHelper.prototype=Object.create(n.Line.prototype),n.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},n.HemisphereLightHelper=function(e,t,r,i){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new n.Color,new n.Color];var o=new n.SphereGeometry(t,4,2);o.applyMatrix((new n.Matrix4).makeRotationX(-Math.PI/2));for(var a=0,s=8;a<s;a++)o.faces[a].color=this.colors[a<4?0:1];var c=new n.MeshBasicMaterial({vertexColors:n.FaceColors,wireframe:!0});this.lightSphere=new n.Mesh(o,c),this.add(this.lightSphere),this.update()},n.HemisphereLightHelper.prototype=Object.create(n.Object3D.prototype),n.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},n.HemisphereLightHelper.prototype.update=function(){var e=new n.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),n.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new n.SphereGeometry(t,4,2),i=new n.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),n.Mesh.call(this,r,i),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},n.PointLightHelper.prototype=Object.create(n.Mesh.prototype),n.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},n.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},n.SpotLightHelper=function(e){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new n.CylinderGeometry(0,1,1,8,1,(!0));t.applyMatrix((new n.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new n.Matrix4).makeRotationX(-Math.PI/2));var r=new n.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new n.Mesh(t,r),this.add(this.cone),this.update()},n.SpotLightHelper.prototype=Object.create(n.Object3D.prototype),n.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},n.SpotLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),n.VertexNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:16711680,a=void 0!==i?i:1,s=new n.Geometry,c=(e.geometry.vertices,e.geometry.faces),l=0,h=c.length;l<h;l++)for(var u=c[l],f=0,p=u.vertexNormals.length;f<p;f++)s.vertices.push(new n.Vector3),s.vertices.push(new n.Vector3);n.Line.call(this,s,new n.LineBasicMaterial({color:o,linewidth:a}),n.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new n.Matrix3,this.update()},n.VertexNormalsHelper.prototype=Object.create(n.Line.prototype),n.VertexNormalsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,c=0,l=o.length;c<l;c++)for(var h=o[c],u=0,f=h.vertexNormals.length;u<f;u++){var p=h[r[u]],d=n[p],m=h.vertexNormals[u];i[s].copy(d).applyMatrix4(a),t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(i[s]),s+=1,i[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),n.VertexTangentsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:255,a=void 0!==i?i:1,s=new n.Geometry,c=(e.geometry.vertices,e.geometry.faces),l=0,h=c.length;l<h;l++)for(var u=c[l],f=0,p=u.vertexTangents.length;f<p;f++)s.vertices.push(new n.Vector3),s.vertices.push(new n.Vector3);n.Line.call(this,s,new n.LineBasicMaterial({color:o,linewidth:a}),n.LinePieces),this.matrixAutoUpdate=!1,this.update()},n.VertexTangentsHelper.prototype=Object.create(n.Line.prototype),n.VertexTangentsHelper.prototype.update=function(e){var t=new n.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,c=0,l=o.length;c<l;c++)for(var h=o[c],u=0,f=h.vertexTangents.length;u<f;u++){var p=h[r[u]],d=n[p],m=h.vertexTangents[u];i[s].copy(d).applyMatrix4(a),t.copy(m).transformDirection(a).multiplyScalar(this.size),t.add(i[s]),s+=1,i[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),n.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215,i=[0,0],o={},a=function(e,t){return e-t},s=["a","b","c"],c=new n.BufferGeometry;if(e.geometry instanceof n.Geometry){for(var l=e.geometry.vertices,h=e.geometry.faces,u=0,f=new Uint32Array(6*h.length),p=0,d=h.length;p<d;p++)for(var m=h[p],v=0;v<3;v++){i[0]=m[s[v]],i[1]=m[s[(v+1)%3]],i.sort(a);var g=i.toString();void 0===o[g]&&(f[2*u]=i[0],f[2*u+1]=i[1],o[g]=!0,u++)}c.addAttribute("position",Float32Array,2*u,3);for(var y=c.attributes.position.array,p=0,d=u;p<d;p++)for(var v=0;v<2;v++){var x=l[f[2*p+v]],_=6*p+3*v;y[_+0]=x.x,y[_+1]=x.y,y[_+2]=x.z}}else if(e.geometry instanceof n.BufferGeometry&&void 0!==e.geometry.attributes.index){for(var l=e.geometry.attributes.position.array,b=e.geometry.attributes.index.array,w=e.geometry.offsets,u=0,f=new Uint32Array(2*b.length),M=0,S=w.length;M<S;++M)for(var A=w[M].start,C=w[M].count,_=w[M].index,p=A,T=A+C;p<T;p+=3)for(var v=0;v<3;v++){i[0]=_+b[p+v],i[1]=_+b[p+(v+1)%3],i.sort(a);var g=i.toString();void 0===o[g]&&(f[2*u]=i[0],f[2*u+1]=i[1],o[g]=!0,u++)}c.addAttribute("position",Float32Array,2*u,3);for(var y=c.attributes.position.array,p=0,d=u;p<d;p++)for(var v=0;v<2;v++){var _=6*p+3*v,E=3*f[2*p+v];y[_+0]=l[E],y[_+1]=l[E+1],y[_+2]=l[E+2]}}else if(e.geometry instanceof n.BufferGeometry){var l=e.geometry.attributes.position.array,u=l.length/3,L=u/3;c.addAttribute("position",Float32Array,2*u,3);for(var y=c.attributes.position.array,p=0,d=L;p<d;p++)for(var v=0;v<3;v++){var _=18*p+6*v,P=9*p+3*v;y[_+0]=l[P],y[_+1]=l[P+1],y[_+2]=l[P+2];var E=9*p+3*((v+1)%3);y[_+3]=l[E],y[_+4]=l[E+1],y[_+5]=l[E+2]}}n.Line.call(this,c,new n.LineBasicMaterial({color:r}),n.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},n.WireframeHelper.prototype=Object.create(n.Line.prototype),n.ImmediateRenderObject=function(){n.Object3D.call(this),this.render=function(e){}},n.ImmediateRenderObject.prototype=Object.create(n.Object3D.prototype),n.LensFlare=function(e,t,r,i,o){n.Object3D.call(this),this.lensFlares=[],this.positionScreen=new n.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,o)},n.LensFlare.prototype=Object.create(n.Object3D.prototype),n.LensFlare.prototype.add=function(e,t,r,i,o,a){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=new n.Color(16777215)),void 0===i&&(i=n.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:o,blending:i})},n.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<r;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},n.MorphBlendMesh=function(e,t){n.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",o=0,a=r-1,s=r/1;this.createAnimation(i,o,a,s),this.setAnimationWeight(i,1)},n.MorphBlendMesh.prototype=Object.create(n.Mesh.prototype),n.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},n.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)(\d+)/,i={},n=this.geometry,o=0,a=n.morphTargets.length;o<a;o++){var s=n.morphTargets[o],c=s.name.match(r);
if(c&&c.length>1){var l=c[1];c[2];i[l]||(i[l]={start:1/0,end:-(1/0)});var h=i[l];o<h.start&&(h.start=o),o>h.end&&(h.end=o),t||(t=l)}}for(var l in i){var h=i[l];this.createAnimation(l,h.start,h.end,e)}this.firstAnimation=t},n.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},n.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},n.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},n.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},n.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},n.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},n.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},n.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},n.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):n.onwarning("animation["+e+"] undefined")},n.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},n.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var i=this.animationsList[t];if(i.active){var o=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var a=i.startFrame+n.Math.clamp(Math.floor(i.time/o),0,i.length-1),s=i.weight;a!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*s,this.morphTargetInfluences[a]=0,i.lastFrame=i.currentFrame,i.currentFrame=a);var c=i.time%o/o;i.directionBackwards&&(c=1-c),this.morphTargetInfluences[i.currentFrame]=c*s,this.morphTargetInfluences[i.lastFrame]=(1-c)*s}}},n.LensFlarePlugin=function(){function e(e,r){var i=t.createProgram(),n=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),a="precision "+r+" float;\n";return t.shaderSource(n,a+e.fragmentShader),t.shaderSource(o,a+e.vertexShader),t.compileShader(n),t.compileShader(o),t.attachShader(i,n),t.attachShader(i,o),t.linkProgram(i),i}var t,r,i,o={};this.init=function(a){t=a.context,r=a,i=a.getPrecision(),o.vertices=new Float32Array(16),o.faces=new Uint16Array(6);var s=0;o.vertices[s++]=-1,o.vertices[s++]=-1,o.vertices[s++]=0,o.vertices[s++]=0,o.vertices[s++]=1,o.vertices[s++]=-1,o.vertices[s++]=1,o.vertices[s++]=0,o.vertices[s++]=1,o.vertices[s++]=1,o.vertices[s++]=1,o.vertices[s++]=1,o.vertices[s++]=-1,o.vertices[s++]=1,o.vertices[s++]=0,o.vertices[s++]=1,s=0,o.faces[s++]=0,o.faces[s++]=1,o.faces[s++]=2,o.faces[s++]=0,o.faces[s++]=2,o.faces[s++]=3,o.vertexBuffer=t.createBuffer(),o.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,o.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o.faces,t.STATIC_DRAW),o.tempTexture=t.createTexture(),o.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(o.hasVertexTexture=!1,o.program=e(n.ShaderFlares.lensFlare,i)):(o.hasVertexTexture=!0,o.program=e(n.ShaderFlares.lensFlareVertexTexture,i)),o.attributes={},o.uniforms={},o.attributes.vertex=t.getAttribLocation(o.program,"position"),o.attributes.uv=t.getAttribLocation(o.program,"uv"),o.uniforms.renderType=t.getUniformLocation(o.program,"renderType"),o.uniforms.map=t.getUniformLocation(o.program,"map"),o.uniforms.occlusionMap=t.getUniformLocation(o.program,"occlusionMap"),o.uniforms.opacity=t.getUniformLocation(o.program,"opacity"),o.uniforms.color=t.getUniformLocation(o.program,"color"),o.uniforms.scale=t.getUniformLocation(o.program,"scale"),o.uniforms.rotation=t.getUniformLocation(o.program,"rotation"),o.uniforms.screenPosition=t.getUniformLocation(o.program,"screenPosition")},this.render=function(e,i,a,s){var c=e.__webglFlares,l=c.length;if(l){var h=new n.Vector3,u=s/a,f=.5*a,p=.5*s,d=16/s,m=new n.Vector2(d*u,d),v=new n.Vector3(1,1,0),g=new n.Vector2(1,1),y=o.uniforms,x=o.attributes;t.useProgram(o.program),t.enableVertexAttribArray(o.attributes.vertex),t.enableVertexAttribArray(o.attributes.uv),t.uniform1i(y.occlusionMap,0),t.uniform1i(y.map,1),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.vertexAttribPointer(x.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(x.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);var _,b,w,M,S;for(_=0;_<l;_++)if(d=16/s,m.set(d*u,d),M=c[_],h.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),h.applyMatrix4(i.matrixWorldInverse),h.applyProjection(i.projectionMatrix),v.copy(h),g.x=v.x*f+f,g.y=v.y*p+p,o.hasVertexTexture||g.x>0&&g.x<a&&g.y>0&&g.y<s)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,g.x-8,g.y-8,16,16,0),t.uniform1i(y.renderType,0),t.uniform2f(y.scale,m.x,m.y),t.uniform3f(y.screenPosition,v.x,v.y,v.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,g.x-8,g.y-8,16,16,0),t.uniform1i(y.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),M.positionScreen.copy(v),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),t.uniform1i(y.renderType,2),t.enable(t.BLEND),b=0,w=M.lensFlares.length;b<w;b++)S=M.lensFlares[b],S.opacity>.001&&S.scale>.001&&(v.x=S.x,v.y=S.y,v.z=S.z,d=S.size*S.scale/s,m.x=d*u,m.y=d,t.uniform3f(y.screenPosition,v.x,v.y,v.z),t.uniform2f(y.scale,m.x,m.y),t.uniform1f(y.rotation,S.rotation),t.uniform1f(y.opacity,S.opacity),t.uniform3f(y.color,S.color.r,S.color.g,S.color.b),r.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),r.setTexture(S.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},n.ShadowMapPlugin=function(){function e(e,t){var r=new n.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var i=r.pointsWorld,o=r.pointsFrustum,a=0;a<8;a++)i[a]=new n.Vector3,o[a]=new n.Vector3;var s=e.shadowCascadeNearZ[t],c=e.shadowCascadeFarZ[t];return o[0].set(-1,-1,s),o[1].set(1,-1,s),o[2].set(-1,1,s),o[3].set(1,1,s),o[4].set(-1,-1,c),o[5].set(1,-1,c),o[6].set(-1,1,c),o[7].set(1,1,c),r}function t(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],o=r.pointsFrustum;o[0].z=i,o[1].z=i,o[2].z=i,o[3].z=i,o[4].z=n,o[5].z=n,o[6].z=n,o[7].z=n}function r(e,t){var r=t.shadowCamera,i=t.pointsFrustum,o=t.pointsWorld;p.set(1/0,1/0,1/0),d.set(-(1/0),-(1/0),-(1/0));for(var a=0;a<8;a++){var s=o[a];s.copy(i[a]),n.ShadowMapPlugin.__projector.unprojectVector(s,e),s.applyMatrix4(r.matrixWorldInverse),s.x<p.x&&(p.x=s.x),s.x>d.x&&(d.x=s.x),s.y<p.y&&(p.y=s.y),s.y>d.y&&(d.y=s.y),s.z<p.z&&(p.z=s.z),s.z>d.z&&(d.z=s.z)}r.left=p.x,r.right=d.x,r.top=d.y,r.bottom=p.y,r.updateProjectionMatrix()}function i(e){return e.material instanceof n.MeshFaceMaterial?e.material.materials[0]:e.material}var o,a,s,c,l,h,u=new n.Frustum,f=new n.Matrix4,p=new n.Vector3,d=new n.Vector3,m=new n.Vector3;this.init=function(e){o=e.context,a=e;var t=n.ShaderLib.depthRGBA,r=n.UniformsUtils.clone(t.uniforms);s=new n.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r}),c=new n.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0}),l=new n.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,skinning:!0}),h=new n.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0,skinning:!0}),s._shadowPass=!0,c._shadowPass=!0,l._shadowPass=!0,h._shadowPass=!0},this.render=function(e,t){a.shadowMapEnabled&&a.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(p,d){var v,g,y,x,_,b,w,M,S,A,C,T,E,L,P=[],R=0,D=null;for(o.clearColor(1,1,1,1),o.disable(o.BLEND),o.enable(o.CULL_FACE),o.frontFace(o.CCW),a.shadowMapCullFace===n.CullFaceFront?o.cullFace(o.FRONT):o.cullFace(o.BACK),a.setDepthTest(!0),v=0,g=p.__lights.length;v<g;v++)if(E=p.__lights[v],E.castShadow)if(E instanceof n.DirectionalLight&&E.shadowCascade)for(_=0;_<E.shadowCascadeCount;_++){var V;if(E.shadowCascadeArray[_])V=E.shadowCascadeArray[_];else{V=e(E,_),V.originalCamera=d;var F=new n.Gyroscope;F.position=E.shadowCascadeOffset,F.add(V),F.add(V.target),d.add(F),E.shadowCascadeArray[_]=V}t(E,_),P[R]=V,R++}else P[R]=E,R++;for(v=0,g=P.length;v<g;v++){if(E=P[v],!E.shadowMap){var U=n.NearestFilter;a.shadowMapType===n.PCFSoftShadowMap&&(U=n.NearestFilter);var N={minFilter:U,magFilter:U,format:n.RGBAFormat};E.shadowMap=new n.WebGLRenderTarget(E.shadowMapWidth,E.shadowMapHeight,N),E.shadowMapSize=new n.Vector2(E.shadowMapWidth,E.shadowMapHeight),E.shadowMatrix=new n.Matrix4}if(!E.shadowCamera){if(E instanceof n.SpotLight)E.shadowCamera=new n.PerspectiveCamera(E.shadowCameraFov,E.shadowMapWidth/E.shadowMapHeight,E.shadowCameraNear,E.shadowCameraFar);else{if(!(E instanceof n.DirectionalLight)){n.onerror("Unsupported light type for shadow");continue}E.shadowCamera=new n.OrthographicCamera(E.shadowCameraLeft,E.shadowCameraRight,E.shadowCameraTop,E.shadowCameraBottom,E.shadowCameraNear,E.shadowCameraFar)}p.add(E.shadowCamera),p.autoUpdate===!0&&p.updateMatrixWorld()}for(E.shadowCameraVisible&&!E.cameraHelper&&(E.cameraHelper=new n.CameraHelper(E.shadowCamera),E.shadowCamera.add(E.cameraHelper)),E.isVirtual&&V.originalCamera==d&&r(d,E),b=E.shadowMap,w=E.shadowMatrix,M=E.shadowCamera,M.position.setFromMatrixPosition(E.matrixWorld),m.setFromMatrixPosition(E.target.matrixWorld),M.lookAt(m),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),E.cameraHelper&&(E.cameraHelper.visible=E.shadowCameraVisible),E.shadowCameraVisible&&E.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(M.projectionMatrix),w.multiply(M.matrixWorldInverse),f.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),u.setFromMatrix(f),a.setRenderTarget(b),a.clear(),L=p.__webglObjects,y=0,x=L.length;y<x;y++)C=L[y],T=C.object,C.render=!1,T.visible&&T.castShadow&&((T instanceof n.Mesh||T instanceof n.ParticleSystem)&&T.frustumCulled&&!u.intersectsObject(T)||(T._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,T.matrixWorld),C.render=!0));var O,k,B;for(y=0,x=L.length;y<x;y++)C=L[y],C.render&&(T=C.object,S=C.buffer,O=i(T),k=void 0!==T.geometry.morphTargets&&T.geometry.morphTargets.length>0&&O.morphTargets,B=T instanceof n.SkinnedMesh&&O.skinning,A=T.customDepthMaterial?T.customDepthMaterial:B?k?h:l:k?c:s,S instanceof n.BufferGeometry?a.renderBufferDirect(M,p.__lights,D,A,S,T):a.renderBuffer(M,p.__lights,D,A,S,T));for(L=p.__webglObjectsImmediate,y=0,x=L.length;y<x;y++)C=L[y],T=C.object,T.visible&&T.castShadow&&(T._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,T.matrixWorld),a.renderImmediateObject(M,p.__lights,D,s,T))}var z=a.getClearColor(),I=a.getClearAlpha();o.clearColor(z.r,z.g,z.b,I),o.enable(o.BLEND),a.shadowMapCullFace===n.CullFaceFront&&o.cullFace(o.BACK)}},n.ShadowMapPlugin.__projector=new n.Projector,n.SpritePlugin=function(){function e(){var e=r.createProgram(),t=r.createShader(r.VERTEX_SHADER),n=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(t,["precision "+i.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),r.shaderSource(n,["precision "+i.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),r.compileShader(t),r.compileShader(n),r.attachShader(e,t),r.attachShader(e,n),r.linkProgram(e),e}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var r,i,o,a,s,c,l,h,u,f;this.init=function(t){r=t.context,i=t,a=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),s=new Uint16Array([0,1,2,0,2,3]),c=r.createBuffer(),l=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,c),r.bufferData(r.ARRAY_BUFFER,a,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l),r.bufferData(r.ELEMENT_ARRAY_BUFFER,s,r.STATIC_DRAW),h=e(),u={position:r.getAttribLocation(h,"position"),uv:r.getAttribLocation(h,"uv")},f={uvOffset:r.getUniformLocation(h,"uvOffset"),uvScale:r.getUniformLocation(h,"uvScale"),rotation:r.getUniformLocation(h,"rotation"),scale:r.getUniformLocation(h,"scale"),color:r.getUniformLocation(h,"color"),map:r.getUniformLocation(h,"map"),opacity:r.getUniformLocation(h,"opacity"),modelViewMatrix:r.getUniformLocation(h,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(h,"projectionMatrix"),fogType:r.getUniformLocation(h,"fogType"),fogDensity:r.getUniformLocation(h,"fogDensity"),fogNear:r.getUniformLocation(h,"fogNear"),fogFar:r.getUniformLocation(h,"fogFar"),fogColor:r.getUniformLocation(h,"fogColor"),alphaTest:r.getUniformLocation(h,"alphaTest")};var p=document.createElement("canvas");p.width=8,p.height=8;var d=p.getContext("2d");d.fillStyle="#ffffff",d.fillRect(0,0,p.width,p.height),o=new n.Texture(p),o.needsUpdate=!0},this.render=function(e,a,s,p){var d=e.__webglSprites,m=d.length;if(m){r.useProgram(h),r.enableVertexAttribArray(u.position),r.enableVertexAttribArray(u.uv),r.disable(r.CULL_FACE),r.enable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,c),r.vertexAttribPointer(u.position,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(u.uv,2,r.FLOAT,!1,16,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l),r.uniformMatrix4fv(f.projectionMatrix,!1,a.projectionMatrix.elements),r.activeTexture(r.TEXTURE0),r.uniform1i(f.map,0);var v=0,g=0,y=e.fog;y?(r.uniform3f(f.fogColor,y.color.r,y.color.g,y.color.b),y instanceof n.Fog?(r.uniform1f(f.fogNear,y.near),r.uniform1f(f.fogFar,y.far),r.uniform1i(f.fogType,1),v=1,g=1):y instanceof n.FogExp2&&(r.uniform1f(f.fogDensity,y.density),r.uniform1i(f.fogType,2),v=2,g=2)):(r.uniform1i(f.fogType,0),v=0,g=0);var x,_,b,w,M=[];for(x=0;x<m;x++)_=d[x],b=_.material,_.visible!==!1&&(_._modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,_.matrixWorld),_.z=-_._modelViewMatrix.elements[14]);for(d.sort(t),x=0;x<m;x++)_=d[x],_.visible!==!1&&(b=_.material,r.uniform1f(f.alphaTest,b.alphaTest),r.uniformMatrix4fv(f.modelViewMatrix,!1,_._modelViewMatrix.elements),M[0]=_.scale.x,M[1]=_.scale.y,w=e.fog&&b.fog?g:0,v!==w&&(r.uniform1i(f.fogType,w),v=w),null!==b.map?(r.uniform2f(f.uvOffset,b.map.offset.x,b.map.offset.y),r.uniform2f(f.uvScale,b.map.repeat.x,b.map.repeat.y)):(r.uniform2f(f.uvOffset,0,0),r.uniform2f(f.uvScale,1,1)),r.uniform1f(f.opacity,b.opacity),r.uniform3f(f.color,b.color.r,b.color.g,b.color.b),r.uniform1f(f.rotation,b.rotation),r.uniform2fv(f.scale,M),i.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),i.setDepthTest(b.depthTest),i.setDepthWrite(b.depthWrite),b.map&&b.map.image&&b.map.image.width?i.setTexture(b.map,0):i.setTexture(o,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0));r.enable(r.CULL_FACE)}}},n.DepthPassPlugin=function(){function e(e){return e.material instanceof n.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var t,r,i,o,a,s,c=new n.Frustum,l=new n.Matrix4;this.init=function(e){t=e.context,r=e;var c=n.ShaderLib.depthRGBA,l=n.UniformsUtils.clone(c.uniforms);i=new n.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:l}),o=new n.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:l,morphTargets:!0}),a=new n.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:l,skinning:!0}),s=new n.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0,s._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(h,u){var f,p,d,m,v,g,y,x=null;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),r.setDepthTest(!0),h.autoUpdate===!0&&h.updateMatrixWorld(),u.matrixWorldInverse.getInverse(u.matrixWorld),l.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),c.setFromMatrix(l),r.setRenderTarget(this.renderTarget),r.clear(),y=h.__webglObjects,f=0,p=y.length;f<p;f++)v=y[f],g=v.object,v.render=!1,g.visible&&((g instanceof n.Mesh||g instanceof n.ParticleSystem)&&g.frustumCulled&&!c.intersectsObject(g)||(g._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,g.matrixWorld),v.render=!0));var _,b,w;for(f=0,p=y.length;f<p;f++)if(v=y[f],v.render){if(g=v.object,d=v.buffer,g instanceof n.ParticleSystem&&!g.customDepthMaterial)continue;_=e(g),_&&r.setMaterialFaces(g.material),b=g.geometry.morphTargets.length>0&&_.morphTargets,w=g instanceof n.SkinnedMesh&&_.skinning,m=g.customDepthMaterial?g.customDepthMaterial:w?b?s:a:b?o:i,d instanceof n.BufferGeometry?r.renderBufferDirect(u,h.__lights,x,m,d,g):r.renderBuffer(u,h.__lights,x,m,d,g)}for(y=h.__webglObjectsImmediate,f=0,p=y.length;f<p;f++)v=y[f],g=v.object,g.visible&&(g._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,g.matrixWorld),r.renderImmediateObject(u,h.__lights,x,i,g));var M=r.getClearColor(),S=r.getClearAlpha();t.clearColor(M.r,M.g,M.b,S),t.enable(t.BLEND)}},n.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},"undefined"!=typeof r?("undefined"!=typeof t&&t.exports&&(r=t.exports=n),r.THREE=n):this.THREE=n},{}],42:[function(e,t,r){(function(){function e(e){function t(t,r,i,n,o,a){for(;o>=0&&o<a;o+=e){var s=n?n[o]:o;i=r(i,t[s],s,t)}return i}return function(r,i,n,o){i=b(i,o,4);var a=!E(r)&&_.keys(r),s=(a||r).length,c=e>0?0:s-1;return arguments.length<3&&(n=r[a?a[c]:c],c+=e),t(r,i,n,a,c,s)}}function i(e){return function(t,r,i){r=w(r,i);for(var n=T(t),o=e>0?0:n-1;o>=0&&o<n;o+=e)if(r(t[o],o,t))return o;return-1}}function n(e,t,r){return function(i,n,o){var a=0,s=T(i);if("number"==typeof o)e>0?a=o>=0?o:Math.max(o+s,a):s=o>=0?Math.min(o+1,s):o+s+1;else if(r&&o&&s)return o=r(i,n),i[o]===n?o:-1;if(n!==n)return o=t(f.call(i,a,s),_.isNaN),o>=0?o+a:-1;for(o=e>0?a:s-1;o>=0&&o<s;o+=e)if(i[o]===n)return o;return-1}}function o(e,t){var r=V.length,i=e.constructor,n=_.isFunction(i)&&i.prototype||l,o="constructor";for(_.has(e,o)&&!_.contains(t,o)&&t.push(o);r--;)o=V[r],o in e&&e[o]!==n[o]&&!_.contains(t,o)&&t.push(o)}var a=this,s=a._,c=Array.prototype,l=Object.prototype,h=Function.prototype,u=c.push,f=c.slice,p=l.toString,d=l.hasOwnProperty,m=Array.isArray,v=Object.keys,g=h.bind,y=Object.create,x=function(){},_=function(e){return e instanceof _?e:this instanceof _?void(this._wrapped=e):new _(e)};"undefined"!=typeof r?("undefined"!=typeof t&&t.exports&&(r=t.exports=_),r._=_):a._=_,_.VERSION="1.8.3";var b=function(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)};case 4:return function(r,i,n,o){return e.call(t,r,i,n,o)}}return function(){return e.apply(t,arguments)}},w=function(e,t,r){return null==e?_.identity:_.isFunction(e)?b(e,t,r):_.isObject(e)?_.matcher(e):_.property(e)};_.iteratee=function(e,t){return w(e,t,1/0)};var M=function(e,t){return function(r){var i=arguments.length;if(i<2||null==r)return r;for(var n=1;n<i;n++)for(var o=arguments[n],a=e(o),s=a.length,c=0;c<s;c++){var l=a[c];t&&void 0!==r[l]||(r[l]=o[l])}return r}},S=function(e){if(!_.isObject(e))return{};if(y)return y(e);x.prototype=e;var t=new x;return x.prototype=null,t},A=function(e){return function(t){return null==t?void 0:t[e]}},C=Math.pow(2,53)-1,T=A("length"),E=function(e){var t=T(e);return"number"==typeof t&&t>=0&&t<=C};_.each=_.forEach=function(e,t,r){t=b(t,r);var i,n;if(E(e))for(i=0,n=e.length;i<n;i++)t(e[i],i,e);else{var o=_.keys(e);for(i=0,n=o.length;i<n;i++)t(e[o[i]],o[i],e)}return e},_.map=_.collect=function(e,t,r){t=w(t,r);for(var i=!E(e)&&_.keys(e),n=(i||e).length,o=Array(n),a=0;a<n;a++){var s=i?i[a]:a;o[a]=t(e[s],s,e)}return o},_.reduce=_.foldl=_.inject=e(1),_.reduceRight=_.foldr=e(-1),_.find=_.detect=function(e,t,r){var i;if(i=E(e)?_.findIndex(e,t,r):_.findKey(e,t,r),void 0!==i&&i!==-1)return e[i]},_.filter=_.select=function(e,t,r){var i=[];return t=w(t,r),_.each(e,function(e,r,n){t(e,r,n)&&i.push(e)}),i},_.reject=function(e,t,r){return _.filter(e,_.negate(w(t)),r)},_.every=_.all=function(e,t,r){t=w(t,r);for(var i=!E(e)&&_.keys(e),n=(i||e).length,o=0;o<n;o++){var a=i?i[o]:o;if(!t(e[a],a,e))return!1}return!0},_.some=_.any=function(e,t,r){t=w(t,r);for(var i=!E(e)&&_.keys(e),n=(i||e).length,o=0;o<n;o++){var a=i?i[o]:o;if(t(e[a],a,e))return!0}return!1},_.contains=_.includes=_.include=function(e,t,r,i){return E(e)||(e=_.values(e)),("number"!=typeof r||i)&&(r=0),_.indexOf(e,t,r)>=0},_.invoke=function(e,t){var r=f.call(arguments,2),i=_.isFunction(t);return _.map(e,function(e){var n=i?t:e[t];return null==n?n:n.apply(e,r)})},_.pluck=function(e,t){return _.map(e,_.property(t))},_.where=function(e,t){return _.filter(e,_.matcher(t))},_.findWhere=function(e,t){return _.find(e,_.matcher(t))},_.max=function(e,t,r){var i,n,o=-(1/0),a=-(1/0);if(null==t&&null!=e){e=E(e)?e:_.values(e);for(var s=0,c=e.length;s<c;s++)i=e[s],i>o&&(o=i)}else t=w(t,r),_.each(e,function(e,r,i){n=t(e,r,i),(n>a||n===-(1/0)&&o===-(1/0))&&(o=e,a=n)});return o},_.min=function(e,t,r){var i,n,o=1/0,a=1/0;if(null==t&&null!=e){e=E(e)?e:_.values(e);for(var s=0,c=e.length;s<c;s++)i=e[s],i<o&&(o=i)}else t=w(t,r),_.each(e,function(e,r,i){n=t(e,r,i),(n<a||n===1/0&&o===1/0)&&(o=e,a=n)});return o},_.shuffle=function(e){for(var t,r=E(e)?e:_.values(e),i=r.length,n=Array(i),o=0;o<i;o++)t=_.random(0,o),t!==o&&(n[o]=n[t]),n[t]=r[o];return n},_.sample=function(e,t,r){return null==t||r?(E(e)||(e=_.values(e)),e[_.random(e.length-1)]):_.shuffle(e).slice(0,Math.max(0,t))},_.sortBy=function(e,t,r){return t=w(t,r),_.pluck(_.map(e,function(e,r,i){return{value:e,index:r,criteria:t(e,r,i)}}).sort(function(e,t){var r=e.criteria,i=t.criteria;if(r!==i){if(r>i||void 0===r)return 1;if(r<i||void 0===i)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,r,i){var n={};return r=w(r,i),_.each(t,function(i,o){var a=r(i,o,t);e(n,i,a)}),n}};_.groupBy=L(function(e,t,r){_.has(e,r)?e[r].push(t):e[r]=[t]}),_.indexBy=L(function(e,t,r){e[r]=t}),_.countBy=L(function(e,t,r){_.has(e,r)?e[r]++:e[r]=1}),_.toArray=function(e){return e?_.isArray(e)?f.call(e):E(e)?_.map(e,_.identity):_.values(e):[]},_.size=function(e){return null==e?0:E(e)?e.length:_.keys(e).length},_.partition=function(e,t,r){t=w(t,r);var i=[],n=[];return _.each(e,function(e,r,o){(t(e,r,o)?i:n).push(e)}),[i,n]},_.first=_.head=_.take=function(e,t,r){if(null!=e)return null==t||r?e[0]:_.initial(e,e.length-t)},_.initial=function(e,t,r){return f.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))},_.last=function(e,t,r){if(null!=e)return null==t||r?e[e.length-1]:_.rest(e,Math.max(0,e.length-t))},_.rest=_.tail=_.drop=function(e,t,r){return f.call(e,null==t||r?1:t)},_.compact=function(e){return _.filter(e,_.identity)};var P=function(e,t,r,i){for(var n=[],o=0,a=i||0,s=T(e);a<s;a++){var c=e[a];if(E(c)&&(_.isArray(c)||_.isArguments(c))){t||(c=P(c,t,r));var l=0,h=c.length;for(n.length+=h;l<h;)n[o++]=c[l++]}else r||(n[o++]=c)}return n};_.flatten=function(e,t){return P(e,t,!1)},_.without=function(e){return _.difference(e,f.call(arguments,1))},_.uniq=_.unique=function(e,t,r,i){_.isBoolean(t)||(i=r,r=t,t=!1),null!=r&&(r=w(r,i));for(var n=[],o=[],a=0,s=T(e);a<s;a++){var c=e[a],l=r?r(c,a,e):c;t?(a&&o===l||n.push(c),o=l):r?_.contains(o,l)||(o.push(l),n.push(c)):_.contains(n,c)||n.push(c)}return n},_.union=function(){return _.uniq(P(arguments,!0,!0))},_.intersection=function(e){for(var t=[],r=arguments.length,i=0,n=T(e);i<n;i++){var o=e[i];if(!_.contains(t,o)){for(var a=1;a<r&&_.contains(arguments[a],o);a++);a===r&&t.push(o)}}return t},_.difference=function(e){var t=P(arguments,!0,!0,1);return _.filter(e,function(e){return!_.contains(t,e)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(e){for(var t=e&&_.max(e,T).length||0,r=Array(t),i=0;i<t;i++)r[i]=_.pluck(e,i);return r},_.object=function(e,t){for(var r={},i=0,n=T(e);i<n;i++)t?r[e[i]]=t[i]:r[e[i][0]]=e[i][1];return r},_.findIndex=i(1),_.findLastIndex=i(-1),_.sortedIndex=function(e,t,r,i){r=w(r,i,1);for(var n=r(t),o=0,a=T(e);o<a;){var s=Math.floor((o+a)/2);r(e[s])<n?o=s+1:a=s}return o},_.indexOf=n(1,_.findIndex,_.sortedIndex),_.lastIndexOf=n(-1,_.findLastIndex),_.range=function(e,t,r){null==t&&(t=e||0,e=0),r=r||1;for(var i=Math.max(Math.ceil((t-e)/r),0),n=Array(i),o=0;o<i;o++,e+=r)n[o]=e;return n};var R=function(e,t,r,i,n){if(!(i instanceof t))return e.apply(r,n);var o=S(e.prototype),a=e.apply(o,n);return _.isObject(a)?a:o};_.bind=function(e,t){if(g&&e.bind===g)return g.apply(e,f.call(arguments,1));if(!_.isFunction(e))throw new TypeError("Bind must be called on a function");var r=f.call(arguments,2),i=function(){return R(e,i,t,this,r.concat(f.call(arguments)))};return i},_.partial=function(e){var t=f.call(arguments,1),r=function(){for(var i=0,n=t.length,o=Array(n),a=0;a<n;a++)o[a]=t[a]===_?arguments[i++]:t[a];for(;i<arguments.length;)o.push(arguments[i++]);return R(e,r,this,this,o)};return r},_.bindAll=function(e){var t,r,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(t=1;t<i;t++)r=arguments[t],e[r]=_.bind(e[r],e);return e},_.memoize=function(e,t){var r=function(i){var n=r.cache,o=""+(t?t.apply(this,arguments):i);return _.has(n,o)||(n[o]=e.apply(this,arguments)),n[o]};return r.cache={},r;
},_.delay=function(e,t){var r=f.call(arguments,2);return setTimeout(function(){return e.apply(null,r)},t)},_.defer=_.partial(_.delay,_,1),_.throttle=function(e,t,r){var i,n,o,a=null,s=0;r||(r={});var c=function(){s=r.leading===!1?0:_.now(),a=null,o=e.apply(i,n),a||(i=n=null)};return function(){var l=_.now();s||r.leading!==!1||(s=l);var h=t-(l-s);return i=this,n=arguments,h<=0||h>t?(a&&(clearTimeout(a),a=null),s=l,o=e.apply(i,n),a||(i=n=null)):a||r.trailing===!1||(a=setTimeout(c,h)),o}},_.debounce=function(e,t,r){var i,n,o,a,s,c=function(){var l=_.now()-a;l<t&&l>=0?i=setTimeout(c,t-l):(i=null,r||(s=e.apply(o,n),i||(o=n=null)))};return function(){o=this,n=arguments,a=_.now();var l=r&&!i;return i||(i=setTimeout(c,t)),l&&(s=e.apply(o,n),o=n=null),s}},_.wrap=function(e,t){return _.partial(t,e)},_.negate=function(e){return function(){return!e.apply(this,arguments)}},_.compose=function(){var e=arguments,t=e.length-1;return function(){for(var r=t,i=e[t].apply(this,arguments);r--;)i=e[r].call(this,i);return i}},_.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},_.before=function(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}},_.once=_.partial(_.before,2);var D=!{toString:null}.propertyIsEnumerable("toString"),V=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(e){if(!_.isObject(e))return[];if(v)return v(e);var t=[];for(var r in e)_.has(e,r)&&t.push(r);return D&&o(e,t),t},_.allKeys=function(e){if(!_.isObject(e))return[];var t=[];for(var r in e)t.push(r);return D&&o(e,t),t},_.values=function(e){for(var t=_.keys(e),r=t.length,i=Array(r),n=0;n<r;n++)i[n]=e[t[n]];return i},_.mapObject=function(e,t,r){t=w(t,r);for(var i,n=_.keys(e),o=n.length,a={},s=0;s<o;s++)i=n[s],a[i]=t(e[i],i,e);return a},_.pairs=function(e){for(var t=_.keys(e),r=t.length,i=Array(r),n=0;n<r;n++)i[n]=[t[n],e[t[n]]];return i},_.invert=function(e){for(var t={},r=_.keys(e),i=0,n=r.length;i<n;i++)t[e[r[i]]]=r[i];return t},_.functions=_.methods=function(e){var t=[];for(var r in e)_.isFunction(e[r])&&t.push(r);return t.sort()},_.extend=M(_.allKeys),_.extendOwn=_.assign=M(_.keys),_.findKey=function(e,t,r){t=w(t,r);for(var i,n=_.keys(e),o=0,a=n.length;o<a;o++)if(i=n[o],t(e[i],i,e))return i},_.pick=function(e,t,r){var i,n,o={},a=e;if(null==a)return o;_.isFunction(t)?(n=_.allKeys(a),i=b(t,r)):(n=P(arguments,!1,!1,1),i=function(e,t,r){return t in r},a=Object(a));for(var s=0,c=n.length;s<c;s++){var l=n[s],h=a[l];i(h,l,a)&&(o[l]=h)}return o},_.omit=function(e,t,r){if(_.isFunction(t))t=_.negate(t);else{var i=_.map(P(arguments,!1,!1,1),String);t=function(e,t){return!_.contains(i,t)}}return _.pick(e,t,r)},_.defaults=M(_.allKeys,!0),_.create=function(e,t){var r=S(e);return t&&_.extendOwn(r,t),r},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e},_.isMatch=function(e,t){var r=_.keys(t),i=r.length;if(null==e)return!i;for(var n=Object(e),o=0;o<i;o++){var a=r[o];if(t[a]!==n[a]||!(a in n))return!1}return!0};var F=function(e,t,r,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof _&&(e=e._wrapped),t instanceof _&&(t=t._wrapped);var n=p.call(e);if(n!==p.call(t))return!1;switch(n){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o="[object Array]"===n;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(_.isFunction(a)&&a instanceof a&&_.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[],i=i||[];for(var c=r.length;c--;)if(r[c]===e)return i[c]===t;if(r.push(e),i.push(t),o){if(c=e.length,c!==t.length)return!1;for(;c--;)if(!F(e[c],t[c],r,i))return!1}else{var l,h=_.keys(e);if(c=h.length,_.keys(t).length!==c)return!1;for(;c--;)if(l=h[c],!_.has(t,l)||!F(e[l],t[l],r,i))return!1}return r.pop(),i.pop(),!0};_.isEqual=function(e,t){return F(e,t)},_.isEmpty=function(e){return null==e||(E(e)&&(_.isArray(e)||_.isString(e)||_.isArguments(e))?0===e.length:0===_.keys(e).length)},_.isElement=function(e){return!(!e||1!==e.nodeType)},_.isArray=m||function(e){return"[object Array]"===p.call(e)},_.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){_["is"+e]=function(t){return p.call(t)==="[object "+e+"]"}}),_.isArguments(arguments)||(_.isArguments=function(e){return _.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(e){return"function"==typeof e||!1}),_.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},_.isNaN=function(e){return _.isNumber(e)&&e!==+e},_.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===p.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return null!=e&&d.call(e,t)},_.noConflict=function(){return a._=s,this},_.identity=function(e){return e},_.constant=function(e){return function(){return e}},_.noop=function(){},_.property=A,_.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},_.matcher=_.matches=function(e){return e=_.extendOwn({},e),function(t){return _.isMatch(t,e)}},_.times=function(e,t,r){var i=Array(Math.max(0,e));t=b(t,r,1);for(var n=0;n<e;n++)i[n]=t(n);return i},_.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},_.now=Date.now||function(){return(new Date).getTime()};var U={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=_.invert(U),O=function(e){var t=function(t){return e[t]},r="(?:"+_.keys(e).join("|")+")",i=RegExp(r),n=RegExp(r,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(n,t):e}};_.escape=O(U),_.unescape=O(N),_.result=function(e,t,r){var i=null==e?void 0:e[t];return void 0===i&&(i=r),_.isFunction(i)?i.call(e):i};var k=0;_.uniqueId=function(e){var t=++k+"";return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,G=function(e){return"\\"+z[e]};_.template=function(e,t,r){!t&&r&&(t=r),t=_.defaults({},t,_.templateSettings);var i=RegExp([(t.escape||B).source,(t.interpolate||B).source,(t.evaluate||B).source].join("|")+"|$","g"),n=0,o="__p+='";e.replace(i,function(t,r,i,a,s){return o+=e.slice(n,s).replace(I,G),n=s+t.length,r?o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(t.variable||"obj","_",o)}catch(s){throw s.source=o,s}var c=function(e){return a.call(this,e,_)},l=t.variable||"obj";return c.source="function("+l+"){\n"+o+"}",c},_.chain=function(e){var t=_(e);return t._chain=!0,t};var j=function(e,t){return e._chain?_(t).chain():t};_.mixin=function(e){_.each(_.functions(e),function(t){var r=_[t]=e[t];_.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),j(this,r.apply(_,e))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=c[e];_.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==e&&"splice"!==e||0!==r.length||delete r[0],j(this,r)}}),_.each(["concat","join","slice"],function(e){var t=c[e];_.prototype[e]=function(){return j(this,t.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this)},{}]},{},[22]);